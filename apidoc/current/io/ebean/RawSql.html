<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<!-- NewPage -->
<html lang="en">
<head>
<!-- Generated by javadoc (1.8.0_202-ea) on Tue Mar 05 23:06:09 NZDT 2019 -->
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<title>RawSql (ebean 11.35.3 API)</title>
<meta name="date" content="2019-03-05">
<link rel="stylesheet" type="text/css" href="../../stylesheet.css" title="Style">
<script type="text/javascript" src="../../script.js"></script>
</head>
<body>
<script type="text/javascript"><!--
    try {
        if (location.href.indexOf('is-external=true') == -1) {
            parent.document.title="RawSql (ebean 11.35.3 API)";
        }
    }
    catch(err) {
    }
//-->
</script>
<noscript>
<div>JavaScript is disabled on your browser.</div>
</noscript>
<!-- ========= START OF TOP NAVBAR ======= -->
<div class="topNav"><a name="navbar.top">
<!--   -->
</a>
<div class="skipNav"><a href="#skip.navbar.top" title="Skip navigation links">Skip navigation links</a></div>
<a name="navbar.top.firstrow">
<!--   -->
</a>
<ul class="navList" title="Navigation">
<li><a href="../../overview-summary.html">Overview</a></li>
<li><a href="package-summary.html">Package</a></li>
<li class="navBarCell1Rev">Class</li>
<li><a href="class-use/RawSql.html">Use</a></li>
<li><a href="package-tree.html">Tree</a></li>
<li><a href="../../deprecated-list.html">Deprecated</a></li>
<li><a href="../../index-all.html">Index</a></li>
<li><a href="../../help-doc.html">Help</a></li>
</ul>
</div>
<div class="subNav">
<ul class="navList">
<li><a href="../../io/ebean/QueryType.html" title="enum in io.ebean"><span class="typeNameLink">Prev&nbsp;Class</span></a></li>
<li><a href="../../io/ebean/RawSqlBuilder.html" title="interface in io.ebean"><span class="typeNameLink">Next&nbsp;Class</span></a></li>
</ul>
<ul class="navList">
<li><a href="../../index.html?io/ebean/RawSql.html" target="_top">Frames</a></li>
<li><a href="RawSql.html" target="_top">No&nbsp;Frames</a></li>
</ul>
<ul class="navList" id="allclasses_navbar_top">
<li><a href="../../allclasses-noframe.html">All&nbsp;Classes</a></li>
</ul>
<div>
<script type="text/javascript"><!--
  allClassesLink = document.getElementById("allclasses_navbar_top");
  if(window==top) {
    allClassesLink.style.display = "block";
  }
  else {
    allClassesLink.style.display = "none";
  }
  //-->
</script>
</div>
<div>
<ul class="subNavList">
<li>Summary:&nbsp;</li>
<li>Nested&nbsp;|&nbsp;</li>
<li>Field&nbsp;|&nbsp;</li>
<li>Constr&nbsp;|&nbsp;</li>
<li>Method</li>
</ul>
<ul class="subNavList">
<li>Detail:&nbsp;</li>
<li>Field&nbsp;|&nbsp;</li>
<li>Constr&nbsp;|&nbsp;</li>
<li>Method</li>
</ul>
</div>
<a name="skip.navbar.top">
<!--   -->
</a></div>
<!-- ========= END OF TOP NAVBAR ========= -->
<!-- ======== START OF CLASS DATA ======== -->
<div class="header">
<div class="subTitle">io.ebean</div>
<h2 title="Interface RawSql" class="title">Interface RawSql</h2>
</div>
<div class="contentContainer">
<div class="description">
<ul class="blockList">
<li class="blockList">
<hr>
<br>
<pre>public interface <a href="../../src-html/io/ebean/RawSql.html#line.161">RawSql</a></pre>
<div class="block">Used to build object graphs based on a raw SQL statement (rather than
generated by Ebean).
<p>
If you don't want to build object graphs you can use <a href="../../io/ebean/SqlQuery.html" title="interface in io.ebean"><code>SqlQuery</code></a> instead
which returns <a href="../../io/ebean/SqlRow.html" title="interface in io.ebean"><code>SqlRow</code></a> objects rather than entity beans.
</p>
<p>
<b>Unparsed RawSql:</b>
</p>
<p>
When RawSql is created via <a href="../../io/ebean/RawSqlBuilder.html#unparsed-java.lang.String-"><code>RawSqlBuilder.unparsed(String)</code></a> then Ebean can not
modify the SQL at all. It can't add any extra expressions into the SQL.
</p>
<p>
<b>Parsed RawSql:</b>
</p>
<p>
When RawSql is created via <a href="../../io/ebean/RawSqlBuilder.html#parse-java.lang.String-"><code>RawSqlBuilder.parse(String)</code></a> then Ebean will parse the
SQL and find places in the SQL where it can add extra where expressions, add
extra having expressions or replace the order by clause. If you want to
explicitly tell Ebean where these insertion points are you can place special
strings into your SQL (<code>${where}</code> or <code>${andWhere}</code> and <code>${having}</code> or
<code>${andHaving})</code>.
</p>
<p>
If the SQL already includes a WHERE clause put in <code>${andWhere}</code> in the location
you want Ebean to add any extra where expressions. If the SQL doesn't have a
WHERE clause put <code>${where}</code> in instead. Similarly you can put in <code>${having}</code> or
<code>${andHaving}</code> where you want Ebean put add extra having expressions.
</p>
<p>
<b>Aggregates:</b>
</p>
<p>
Often RawSql will be used with Aggregate functions (sum, avg, max etc). The
follow example shows an example based on Total Order Amount -
sum(d.order_qty*d.unit_price).
</p>
<p>
We can use a OrderAggregate bean that has a &#064;Sql to indicate it is based
on RawSql and not based on a real DB Table or DB View. It has some properties
to hold the values for the aggregate functions (sum etc) and a &#064;OneToOne
to Order.
</p>
<p>
<h3>Example OrderAggregate</h3>
<div class="syntax java"><div class="highlight"><pre> <span class="o">...</span>
 <span class="c1">// @Sql indicates to that this bean</span>
 <span class="c1">// is based on RawSql rather than a table</span>

<span class="nd">@Entity</span>
<span class="nd">@Sql</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">OrderAggregate</span> <span class="o">{</span>

 <span class="nd">@OneToOne</span>
 <span class="n">Order</span> <span class="n">order</span><span class="o">;</span>

 <span class="n">Double</span> <span class="n">totalAmount</span><span class="o">;</span>

 <span class="n">Double</span> <span class="n">totalItems</span><span class="o">;</span>

 <span class="c1">// getters and setters</span>
 <span class="o">...</span>
</pre></div>
</div>
<p>
<h3>Example 1:</h3>
<p>
<div class="syntax java"><div class="highlight"><pre>  <span class="n">String</span> <span class="n">sql</span> <span class="o">=</span> <span class="s">&quot; select order_id, o.status, c.id, c.name, sum(d.order_qty*d.unit_price) as totalAmount&quot;</span>
    <span class="o">+</span> <span class="s">&quot; from o_order o&quot;</span>
    <span class="o">+</span> <span class="s">&quot; join o_customer c on c.id = o.kcustomer_id &quot;</span>
    <span class="o">+</span> <span class="s">&quot; join o_order_detail d on d.order_id = o.id &quot;</span> <span class="o">+</span> <span class="s">&quot; group by order_id, o.status &quot;</span><span class="o">;</span>

  <span class="n">RawSql</span> <span class="n">rawSql</span> <span class="o">=</span> <span class="n">RawSqlBuilder</span><span class="o">.</span><span class="na">parse</span><span class="o">(</span><span class="n">sql</span><span class="o">)</span>
    <span class="c1">// map the sql result columns to bean properties</span>
    <span class="o">.</span><span class="na">columnMapping</span><span class="o">(</span><span class="s">&quot;order_id&quot;</span><span class="o">,</span> <span class="s">&quot;order.id&quot;</span><span class="o">)</span>
    <span class="o">.</span><span class="na">columnMapping</span><span class="o">(</span><span class="s">&quot;o.status&quot;</span><span class="o">,</span> <span class="s">&quot;order.status&quot;</span><span class="o">)</span>
    <span class="o">.</span><span class="na">columnMapping</span><span class="o">(</span><span class="s">&quot;c.id&quot;</span><span class="o">,</span> <span class="s">&quot;order.customer.id&quot;</span><span class="o">)</span>
    <span class="o">.</span><span class="na">columnMapping</span><span class="o">(</span><span class="s">&quot;c.name&quot;</span><span class="o">,</span> <span class="s">&quot;order.customer.name&quot;</span><span class="o">)</span>
    <span class="c1">// we don&#39;t need to map this one due to the sql column alias</span>
    <span class="c1">// .columnMapping(&quot;sum(d.order_qty*d.unit_price)&quot;, &quot;totalAmount&quot;)</span>
    <span class="o">.</span><span class="na">create</span><span class="o">();</span>

  <span class="n">List</span><span class="o">&lt;</span><span class="n">OrderAggregate</span><span class="o">&gt;</span> <span class="n">list</span> <span class="o">=</span> <span class="n">DB</span><span class="o">.</span><span class="na">find</span><span class="o">(</span><span class="n">OrderAggregate</span><span class="o">.</span><span class="na">class</span><span class="o">)</span>
      <span class="o">.</span><span class="na">setRawSql</span><span class="o">(</span><span class="n">rawSql</span><span class="o">)</span>
      <span class="o">.</span><span class="na">where</span><span class="o">().</span><span class="na">gt</span><span class="o">(</span><span class="s">&quot;order.id&quot;</span><span class="o">,</span> <span class="mi">0</span><span class="o">)</span>
      <span class="o">.</span><span class="na">having</span><span class="o">().</span><span class="na">gt</span><span class="o">(</span><span class="s">&quot;totalAmount&quot;</span><span class="o">,</span> <span class="mi">20</span><span class="o">)</span>
      <span class="o">.</span><span class="na">findList</span><span class="o">();</span>
</pre></div>
</div>
<p>
<h3>Example 2:</h3>
<p>
The following example uses a FetchConfig().query() so that after the initial
RawSql query is executed Ebean executes a secondary query to fetch the
associated order status, orderDate along with the customer name.
</p>
<p>
<div class="syntax java"><div class="highlight"><pre> <span class="n">String</span> <span class="n">sql</span> <span class="o">=</span> <span class="s">&quot; select order_id, &#39;ignoreMe&#39;, sum(d.order_qty*d.unit_price) as totalAmount &quot;</span>
    <span class="o">+</span> <span class="s">&quot; from o_order_detail d&quot;</span>
    <span class="o">+</span> <span class="s">&quot; group by order_id &quot;</span><span class="o">;</span>

  <span class="n">RawSql</span> <span class="n">rawSql</span> <span class="o">=</span> <span class="n">RawSqlBuilder</span><span class="o">.</span><span class="na">parse</span><span class="o">(</span><span class="n">sql</span><span class="o">)</span>
    <span class="o">.</span><span class="na">columnMapping</span><span class="o">(</span><span class="s">&quot;order_id&quot;</span><span class="o">,</span> <span class="s">&quot;order.id&quot;</span><span class="o">)</span>
    <span class="o">.</span><span class="na">columnMappingIgnore</span><span class="o">(</span><span class="s">&quot;&#39;ignoreMe&#39;&quot;</span><span class="o">)</span>
    <span class="o">.</span><span class="na">create</span><span class="o">();</span>

  <span class="n">List</span><span class="o">&lt;</span><span class="n">OrderAggregate</span><span class="o">&gt;</span> <span class="n">orders</span> <span class="o">=</span> <span class="n">DB</span><span class="o">.</span><span class="na">find</span><span class="o">(</span><span class="n">OrderAggregate</span><span class="o">.</span><span class="na">class</span><span class="o">)</span>
    <span class="o">.</span><span class="na">setRawSql</span><span class="o">(</span><span class="n">rawSql</span><span class="o">)</span>
    <span class="o">.</span><span class="na">fetch</span><span class="o">(</span><span class="s">&quot;order&quot;</span><span class="o">,</span> <span class="s">&quot;status,orderDate&quot;</span><span class="o">,</span> <span class="k">new</span> <span class="n">FetchConfig</span><span class="o">().</span><span class="na">query</span><span class="o">())</span>
    <span class="o">.</span><span class="na">fetch</span><span class="o">(</span><span class="s">&quot;order.customer&quot;</span><span class="o">,</span> <span class="s">&quot;name&quot;</span><span class="o">)</span>
    <span class="o">.</span><span class="na">where</span><span class="o">().</span><span class="na">gt</span><span class="o">(</span><span class="s">&quot;order.id&quot;</span><span class="o">,</span> <span class="mi">0</span><span class="o">)</span>
    <span class="o">.</span><span class="na">having</span><span class="o">().</span><span class="na">gt</span><span class="o">(</span><span class="s">&quot;totalAmount&quot;</span><span class="o">,</span> <span class="mi">20</span><span class="o">)</span>
    <span class="o">.</span><span class="na">order</span><span class="o">().</span><span class="na">desc</span><span class="o">(</span><span class="s">&quot;totalAmount&quot;</span><span class="o">)</span>
    <span class="o">.</span><span class="na">setMaxRows</span><span class="o">(</span><span class="mi">10</span><span class="o">)</span>
    <span class="o">.</span><span class="na">findList</span><span class="o">();</span>
</pre></div>
</div>
<p>
<h3>Example 3: tableAliasMapping</h3>
<p>
Instead of mapping each column you can map each table alias to a path using tableAliasMapping().
</p>
<div class="syntax java"><div class="highlight"><pre>  <span class="n">String</span> <span class="n">rs</span> <span class="o">=</span> <span class="s">&quot;select o.id, o.status, c.id, c.name, &quot;</span><span class="o">+</span>
              <span class="s">&quot; d.id, d.order_qty, p.id, p.name &quot;</span> <span class="o">+</span>
              <span class="s">&quot;from o_order o join o_customer c on c.id = o.kcustomer_id &quot;</span> <span class="o">+</span>
              <span class="s">&quot;join o_order_detail d on d.order_id = o.id  &quot;</span> <span class="o">+</span>
              <span class="s">&quot;join o_product p on p.id = d.product_id  &quot;</span> <span class="o">+</span>
              <span class="s">&quot;where o.id &lt;= :maxOrderId  and p.id = :productId &quot;</span><span class="o">+</span>
              <span class="s">&quot;order by o.id, d.id asc&quot;</span><span class="o">;</span>

 <span class="n">RawSql</span> <span class="n">rawSql</span> <span class="o">=</span> <span class="n">RawSqlBuilder</span><span class="o">.</span><span class="na">parse</span><span class="o">(</span><span class="n">rs</span><span class="o">)</span>
      <span class="o">.</span><span class="na">tableAliasMapping</span><span class="o">(</span><span class="s">&quot;c&quot;</span><span class="o">,</span> <span class="s">&quot;customer&quot;</span><span class="o">)</span>
      <span class="o">.</span><span class="na">tableAliasMapping</span><span class="o">(</span><span class="s">&quot;d&quot;</span><span class="o">,</span> <span class="s">&quot;details&quot;</span><span class="o">)</span>
      <span class="o">.</span><span class="na">tableAliasMapping</span><span class="o">(</span><span class="s">&quot;p&quot;</span><span class="o">,</span> <span class="s">&quot;details.product&quot;</span><span class="o">)</span>
      <span class="o">.</span><span class="na">create</span><span class="o">();</span>

 <span class="n">List</span><span class="o">&lt;</span><span class="n">Order</span><span class="o">&gt;</span> <span class="n">ordersFromRaw</span> <span class="o">=</span> <span class="n">DB</span><span class="o">.</span><span class="na">find</span><span class="o">(</span><span class="n">Order</span><span class="o">.</span><span class="na">class</span><span class="o">)</span>
      <span class="o">.</span><span class="na">setRawSql</span><span class="o">(</span><span class="n">rawSql</span><span class="o">)</span>
      <span class="o">.</span><span class="na">setParameter</span><span class="o">(</span><span class="s">&quot;maxOrderId&quot;</span><span class="o">,</span> <span class="mi">2</span><span class="o">)</span>
      <span class="o">.</span><span class="na">setParameter</span><span class="o">(</span><span class="s">&quot;productId&quot;</span><span class="o">,</span> <span class="mi">1</span><span class="o">)</span>
      <span class="o">.</span><span class="na">findList</span><span class="o">();</span>
</pre></div>
</div>
<p>
<p>
Note that lazy loading also works with object graphs built with RawSql.
</p></div>
</li>
</ul>
</div>
</div>
<!-- ========= END OF CLASS DATA ========= -->
<!-- ======= START OF BOTTOM NAVBAR ====== -->
<div class="bottomNav"><a name="navbar.bottom">
<!--   -->
</a>
<div class="skipNav"><a href="#skip.navbar.bottom" title="Skip navigation links">Skip navigation links</a></div>
<a name="navbar.bottom.firstrow">
<!--   -->
</a>
<ul class="navList" title="Navigation">
<li><a href="../../overview-summary.html">Overview</a></li>
<li><a href="package-summary.html">Package</a></li>
<li class="navBarCell1Rev">Class</li>
<li><a href="class-use/RawSql.html">Use</a></li>
<li><a href="package-tree.html">Tree</a></li>
<li><a href="../../deprecated-list.html">Deprecated</a></li>
<li><a href="../../index-all.html">Index</a></li>
<li><a href="../../help-doc.html">Help</a></li>
</ul>
</div>
<div class="subNav">
<ul class="navList">
<li><a href="../../io/ebean/QueryType.html" title="enum in io.ebean"><span class="typeNameLink">Prev&nbsp;Class</span></a></li>
<li><a href="../../io/ebean/RawSqlBuilder.html" title="interface in io.ebean"><span class="typeNameLink">Next&nbsp;Class</span></a></li>
</ul>
<ul class="navList">
<li><a href="../../index.html?io/ebean/RawSql.html" target="_top">Frames</a></li>
<li><a href="RawSql.html" target="_top">No&nbsp;Frames</a></li>
</ul>
<ul class="navList" id="allclasses_navbar_bottom">
<li><a href="../../allclasses-noframe.html">All&nbsp;Classes</a></li>
</ul>
<div>
<script type="text/javascript"><!--
  allClassesLink = document.getElementById("allclasses_navbar_bottom");
  if(window==top) {
    allClassesLink.style.display = "block";
  }
  else {
    allClassesLink.style.display = "none";
  }
  //-->
</script>
</div>
<div>
<ul class="subNavList">
<li>Summary:&nbsp;</li>
<li>Nested&nbsp;|&nbsp;</li>
<li>Field&nbsp;|&nbsp;</li>
<li>Constr&nbsp;|&nbsp;</li>
<li>Method</li>
</ul>
<ul class="subNavList">
<li>Detail:&nbsp;</li>
<li>Field&nbsp;|&nbsp;</li>
<li>Constr&nbsp;|&nbsp;</li>
<li>Method</li>
</ul>
</div>
<a name="skip.navbar.bottom">
<!--   -->
</a></div>
<!-- ======== END OF BOTTOM NAVBAR ======= -->
<p class="legalCopy"><small>Copyright &#169; 2019. All rights reserved.</small></p>
</body>
</html>
