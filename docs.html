
<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta id="layout-head" />
    <title>avaje ebean</title>
    <link rel="shortcut icon" href="/images/favicon.ico" >
    <!--<link href="/css/bootstrap.min.css" rel="stylesheet">-->
    <!-- Latest compiled and minified CSS -->
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.5/css/bootstrap.min.css">
    <link rel="stylesheet" href="/css/pygments.css" type="text/css" />
    <link rel="stylesheet" href="/css/site.css">
    <link rel="stylesheet" href="//netdna.bootstrapcdn.com/font-awesome/4.1.0/css/font-awesome.min.css">
      <!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
      <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
      <script src="https://oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>
    <![endif]-->
  </head>
  <body>
  <div id="wrap">
    <div id="header">
    <div class="navbar navbar-inverse navbar-fixed-top" role="navigation">
      <div class="container">
        <div class="navbar-header">
          <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
            <span class="sr-only">Toggle navigation</span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
          </button>
          <a class="navbar-brand" href="/">Ebean ORM</a>
        </div>
        <div class="collapse navbar-collapse">
          <ul class="nav navbar-nav pull-right">
            <li ><a href="/"><span class="glyphicon glyphicon-home"></span>  Home</a></li>
            <li ><a href="/videos">Videos</a></li>
            <li ><a href="/quickstart">Quick Start</a></li>
            <li ><a href="/support">Support</a></li>
            <li class="active"><a href="/docs">Docs</a></li>
            <li ><a target="_blank" href="/apidocs">ApiDocs</a></li>
            <li ><a href="/releases">Releases</a></li>
            <li ><a target="_blank" href="https://github.com/ebean-orm/avaje-ebeanorm"> <i class="fa fa-github"></i> Github</a></li>
          </ul>
        </div><!--/.nav-collapse -->
      </div>
    </div>

  </div>
  <div id="main" data-offset="60">
<div class="jumbotron mini">
    <div class="container">
      <h1>Documentation</h1>
    </div>
  </div>

<div class="container doc-index bs-docs-container">

<div class="row">

  <div class="col-md-9" role="main">


<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta id="layout-head" />
    <title>avaje ebean</title>
    <link rel="shortcut icon" href="/images/favicon.ico" >
    <!--<link href="/css/bootstrap.min.css" rel="stylesheet">-->
    <!-- Latest compiled and minified CSS -->
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.5/css/bootstrap.min.css">
    <link rel="stylesheet" href="/css/pygments.css" type="text/css" />
    <link rel="stylesheet" href="/css/site.css">
    <link rel="stylesheet" href="//netdna.bootstrapcdn.com/font-awesome/4.1.0/css/font-awesome.min.css">
      <!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
      <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
      <script src="https://oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>
    <![endif]-->
</head>
  <body>
  <div id="wrap">
    <div id="header">
    <div class="navbar navbar-inverse navbar-fixed-top" role="navigation">
      <div class="container">
        <div class="navbar-header">
          <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
            <span class="sr-only">Toggle navigation</span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
          </button>
          <a class="navbar-brand" href="/">Ebean ORM</a>
        </div>
        <div class="collapse navbar-collapse">
          <ul class="nav navbar-nav pull-right">
            <li ><a href="/"><span class="glyphicon glyphicon-home"></span>  Home</a></li>
            <li ><a href="/videos">Videos</a></li>
            <li ><a href="/quickstart">Quick Start</a></li>
            <li ><a href="/support">Support</a></li>
            <li class="active"><a href="/docs">Docs</a></li>
            <li ><a target="_blank" href="/apidocs">ApiDocs</a></li>
            <li ><a href="/releases">Releases</a></li>
            <li ><a target="_blank" href="https://github.com/ebean-orm/avaje-ebeanorm"> <i class="fa fa-github"></i> Github</a></li>
          </ul>
        </div><!--/.nav-collapse -->
      </div>
    </div>

  </div>
  <div id="main" data-offset="60">
<div class="jumbotron mini">
  <div class="container">
    <h1><a href="/docs">Documentation</a> / Introduction </h1>
  </div>
</div>

<div class="container doc-index bs-docs-container">

  <div class="row">

    <div class="col-md-9" role="main">

      <div class="bs-docs-section">

  <h1 id="introduction" class="page-header">Introduction</h1>

  <div class="row">
    <div class="col-md-3">
      <div class="well">
        <h4>Simple to learn</h4>

        <p>
          Ebean's goal is to be simple to use and understand. Developers should be able to be productive quickly and get
          stuff done without fuss or worry.
        </p>
      </div>
    </div>

    <div class="col-md-3">
      <div class="well">
        <h4>Elegant</h4>

        <p>
          Large queries, batch processing, need to use raw SQL - Ebean will elegantly handle your more difficult
          requirements.
        </p>
      </div>
    </div>

    <div class="col-md-3">
      <div class="well">
        <h4>Performance</h4>

        <p>
          Ebean is designed for performance. Fetch only what you need using 'partial objects', query joins, batch lazy
          loading.
        </p>
      </div>
    </div>
  </div> 



  <div class="row">
    <div class="col-md-12">

      <h2 id="use_jpa_mapping">Use JPA Mapping</h2>

      <p>
        Use standard JPA Mapping annotations - @Entity, @Table, @Id etc.
      </p>

      <div class="syntax java"><div class="highlight"><pre>      <span class="cm">/**</span>
<span class="cm">      * Use standard JPA Mapping annotations.</span>
<span class="cm">      */</span>
      <span class="nd">@Entity</span>
      <span class="nd">@Table</span><span class="o">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">&quot;o_customer&quot;</span><span class="o">)</span>
      <span class="kd">public</span> <span class="kd">class</span> <span class="nc">Customer</span> <span class="o">{</span>

      <span class="nd">@Id</span>
      <span class="n">Long</span> <span class="n">id</span><span class="o">;</span>

      <span class="nd">@Version</span>
      <span class="n">Long</span> <span class="n">version</span><span class="o">;</span>

      <span class="n">String</span> <span class="n">name</span><span class="o">;</span>

      <span class="nd">@ManyToOne</span>
      <span class="n">Address</span> <span class="n">address</span><span class="o">;</span>

      <span class="nd">@OneToMany</span><span class="o">(</span><span class="n">mappedBy</span> <span class="o">=</span> <span class="s">&quot;customer&quot;</span><span class="o">)</span>
      <span class="n">List</span>
      <span class="o">&lt;</span><span class="n">Order</span><span class="o">&gt;</span> <span class="n">orders</span><span class="o">;</span>

        <span class="c1">// getters and setters</span>

        <span class="o">}</span>
        
</pre></div>
</div>

        <h2 id="simple_query_language">Simple query language</h2>

        <p>
          Ebean provides a simple query language. It will determine what joins are required to support your WHERE clause
          and add them as appropriate
          so that the developer can concentrate on by doing some of the work for you.
        </p>

        <h4>Example - find by id:</h4>
        <div class="syntax java"><div class="highlight"><pre>        <span class="nd">@Inject</span>
        <span class="n">EbeanServer</span> <span class="n">server</span><span class="o">;</span>
        <span class="o">...</span>

        <span class="c1">// find customer by id</span>
        <span class="n">Customer</span> <span class="n">customer</span> <span class="o">=</span> <span class="n">server</span><span class="o">.</span><span class="na">find</span><span class="o">(</span><span class="n">Customer</span><span class="o">.</span><span class="na">class</span><span class="o">,</span> <span class="n">customerId</span><span class="o">);</span>
        
</pre></div>
</div>

        <h4>Example:</h4>
        <div class="syntax java"><div class="highlight"><pre>        <span class="nd">@Inject</span>
        <span class="n">EbeanServer</span> <span class="n">server</span><span class="o">;</span>
        <span class="o">...</span>

        <span class="c1">// find orders for a customer</span>
        <span class="c1">// shipped since last week</span>
        <span class="n">List</span>
        <span class="o">&lt;</span><span class="n">Order</span><span class="o">&gt;</span> <span class="n">orders</span> <span class="o">=</span>
          <span class="n">server</span><span class="o">.</span><span class="na">find</span><span class="o">(</span><span class="n">Order</span><span class="o">.</span><span class="na">class</span><span class="o">)</span>
          <span class="o">.</span><span class="na">where</span><span class="o">()</span>
          <span class="o">.</span><span class="na">eq</span><span class="o">(</span><span class="s">&quot;customer.id&quot;</span><span class="o">,</span> <span class="n">customerId</span><span class="o">)</span> <span class="c1">// eq = equal to</span>
          <span class="o">.</span><span class="na">gt</span><span class="o">(</span><span class="s">&quot;shipDate&quot;</span><span class="o">,</span> <span class="n">lastWeek</span><span class="o">)</span> <span class="c1">// gt = greater than</span>
          <span class="o">.</span><span class="na">findList</span><span class="o">();</span>

          
</pre></div>
</div>

          <h4>Example:</h4>
          <div class="syntax java"><div class="highlight"><pre>          <span class="c1">// find new customers with a name like rob%</span>
          <span class="c1">// .. only fetch their name and status</span>
          <span class="n">List</span>
          <span class="o">&lt;</span><span class="n">Customer</span><span class="o">&gt;</span> <span class="n">customers</span> <span class="o">=</span>
            <span class="n">server</span><span class="o">.</span><span class="na">find</span><span class="o">(</span><span class="n">Customer</span><span class="o">.</span><span class="na">class</span><span class="o">)</span>
            <span class="c1">// just fetch the properties you need</span>
            <span class="o">.</span><span class="na">select</span><span class="o">(</span><span class="s">&quot;name, status&quot;</span><span class="o">)</span>
            <span class="o">.</span><span class="na">where</span><span class="o">()</span>
            <span class="o">.</span><span class="na">eq</span><span class="o">(</span><span class="s">&quot;status&quot;</span><span class="o">,</span> <span class="n">Status</span><span class="o">.</span><span class="na">NEW</span><span class="o">)</span>
            <span class="o">.</span><span class="na">ilike</span><span class="o">(</span><span class="s">&quot;name&quot;</span><span class="o">,</span> <span class="s">&quot;rob%&quot;</span><span class="o">)</span>
            <span class="o">.</span><span class="na">orderBy</span><span class="o">(</span><span class="s">&quot;name&quot;</span><span class="o">)</span>
            <span class="o">.</span><span class="na">findList</span><span class="o">();</span>


            
</pre></div>
</div>

            <h2 id="intro_save_and_delete">Save and delete</h2>

            <p>
              Ebean is architected to make insert, update, delete simple to use and understand.
            </p>


            <h4>Example insert:</h4>
            <div class="syntax java"><div class="highlight"><pre>            <span class="nd">@Inject</span>
            <span class="n">EbeanServer</span> <span class="n">server</span><span class="o">;</span>
            <span class="o">...</span>

            <span class="n">Customer</span> <span class="n">customer</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Customer</span><span class="o">();</span>
            <span class="n">customer</span><span class="o">.</span><span class="na">setName</span><span class="o">(</span><span class="s">&quot;Rob&quot;</span><span class="o">);</span>
            <span class="n">customer</span><span class="o">.</span><span class="na">setStatus</span><span class="o">(</span><span class="n">Status</span><span class="o">.</span><span class="na">NEW</span><span class="o">);</span>

            <span class="c1">// inserts the customer</span>
            <span class="n">server</span><span class="o">.</span><span class="na">save</span><span class="o">(</span><span class="n">customer</span><span class="o">);</span>

            
</pre></div>
</div>


            <h4>Example update/delete:</h4>
            <div class="syntax java"><div class="highlight"><pre>            <span class="nd">@Inject</span>
            <span class="n">EbeanServer</span> <span class="n">server</span><span class="o">;</span>
            <span class="o">...</span>

            <span class="n">Customer</span> <span class="n">customer</span> <span class="o">=</span> <span class="n">server</span><span class="o">.</span><span class="na">find</span><span class="o">(</span><span class="n">Customer</span><span class="o">.</span><span class="na">class</span><span class="o">,</span> <span class="n">customerId</span><span class="o">);</span>
            <span class="n">customer</span><span class="o">.</span><span class="na">setName</span><span class="o">(</span><span class="s">&quot;Person formally known as Rob&quot;</span><span class="o">);</span>

            <span class="c1">// update</span>
            <span class="n">server</span><span class="o">.</span><span class="na">save</span><span class="o">(</span><span class="n">customer</span><span class="o">);</span>

            <span class="c1">// delete</span>
            <span class="n">server</span><span class="o">.</span><span class="na">delete</span><span class="o">(</span><span class="n">customer</span><span class="o">);</span>

            
</pre></div>
</div>

            <h2 id="jpa_comparison">Comparison to JPA</h2>

            <h4>Dirty state on the bean</h4>

            <p>
              The core architectural difference is that Ebean stores the 'dirty state' on
              the bean itself. All knowledge required to persist a bean is on the bean itself and beans
              are explicited saved or deleted.
            </p>

            <p>
              With Hibernate the Session holds the 'original state' and this along with the bean are used to
              persist the beans. Beans need to be 'attached' to the Session in order to persist them.
            </p>

            <p class="bs-callout bs-callout-info">
              This architectural difference means that there is no EntityManager with the associated bean lifecycle
              and flush mechanism. This is what makes Ebean easier to use and understand.
            </p>

            <h4>Lifecycle - EntityManager</h4>

            <p>
              With Hibernate, JPA and JDO the beans have a lifecycle where the beans are
              attached/detached/merged/flushed
              using a JPA EntityManager (and similarly with JDO PersistenceManager).
              Developers need to be aware of this lifecycle and now not only have to manage
              the DB Transaction demarcation but they additionally have to manage the JPA EntityManager (or JDO
              PersistenceManager).
              Some containers and frameworks provide assistence to developers to help manage the EntityManager like
              'Transaction scoped Persistence Context'
              but architecturally with JPA and JDO there are 2 things demarcate/scope. When developers want to use
              multiple transactions with the same persistence context and have to deal with the failure cases they now
              need to have a good understanding of the underlying EntityManager/Session and throw it away or ponder what
              is needed to make the EntityManager/Session usable.
            </p>

            <p class="bs-callout bs-callout-info">
              With Ebean you only need to demarcate/scope the transaction - no EntityManager/Session to manage.
            </p>

            <h4>Explicit save rather than flush</h4>

            <p>
              With Ebean the developer explicitly controls which beans are persisted. With JPA/JDO you don't have that
              control and instead use flush() and the dirty beans that are 'attached' to the Session/EntityManager are
              persisted.
              When the EntityManager is used by various blocks of code it is not always obvious what beans will be
              included in the flush() - an
              attached bean might have subtly been made dirty or an additional dirty bean attached. This lack of
              explicit
              control can make these issues occur and are not always easy to resolve.
            </p>

            <p class="bs-callout bs-callout-info">
              With Ebean the developer explicitly controls which beans are persisted.
            </p>

            <h4>Partial Objects</h4>

            <p>
              Back in 1995 I worked for Oracle Tech Support and was a trained Oracle DBA. If your query (or part of
              the query execution) could be resolved by just hitting 'index blocks' and didn't have to read 'data
              blocks'
              that was great for performance. Any decent ORM query language almost 20 years later would surely support
              the ability to only select the properties you need in order to support this fundamental performance
              optimisation?
            </p>

            <p class="bs-callout bs-callout-info">
              Ebean makes partial object queries easy.
            </p>

            <p>
              JPA has added 'FetchGroups' to support Partial Objects but to me it is not easy to use and should instead
              have become part of the query language.
            </p>

            <p>
              It is unsurprising that DBA's and SQL orientated developers have looked at the SQL that their ORM
              has generated and had a feeling of disappointment and maybe even dispair. I suspect there wasn't
              a DBA in the room when JPQL was designed or perhaps they didn't get a strong vote.
            </p>

            <p>
              Ebean's query language has be designed from the perspective of making is easy to specify the parts
              of the object graph you wish to fetch (Partial Objects). Additionally Ebean has made it easier
              to use by automatically determining the joins that are required to support the select, where and
              order by.
            </p>

            <h4>Autofetch - Query optimisation</h4>

            <p>
              The extension to supporting 'Partial Objects' is to provide a mechanism that profiles what parts of
              the object graph are used for any given query. This profiling information can then be used to
              actively tune the query or provide performance improvement suggestions.
            </p>

            <h4>Raw SQL</h4>

            <p>
              ORM's do some SQL generation well but there are many things that you can do with SQL that are <em>not</em>
              a natural fit for an ORM especially around aggregation, reporting and bulk updates. With Ebean the
              expectation
              is that developers will use raw SQL building some object graphs as well as for bulk updates. Ebean does
              have quite a nice wide sweet spot with it's great support for Partial Objects but it is never
              going to exhaustively support all the capabilities in SQL.
            </p>

            <p>
              With Ebean using raw SQL is well supported and beans any beans loaded via RawSql are fully functional with
              further lazy loading, query joins, insert, update and delete all supported.
            </p>

            <p>
              Bulk updates should not be shunned or avoided - some problems are much more effeciently solved by using a
              'relational approach'
              and perhaps an issue when developing with an ORM is to forget to consider 'relational approaches' and
              especially bulk update.
            </p>

            <h2 id="ebean_does_not">Ebean does not...</h2>

            <p>...(under construction)... list any missing features</a>

            <p>Ebean supports JPA annotations, not JPA2.</p>

            <p>Ebean does not provide functionality to DDl that can be used to update an existing database. Ebean does
              generate DDL that lets you drop and recreate your tables.
              There are a few database schema evolution tools such as <a href="http://flywaydb.org/">Flyway</a> and <a
                  href="http://www.liquibase.org/">Liquibase</a></p>


    </div>
  </div> 

</div>

    </div>

    <div class="col-md-3" role="complementary">
      <nav class="bs-docs-sidebar hidden-print hidden-xs hidden-sm">
        <ul class="nav bs-docs-sidenav">


<li class="active">
  <a href="/docs/introduction">Introduction</a>
        <ul class="nav">
          <li><a href="#use_jpa_mapping">Use JPA mappings</a></li>
          <li><a href="#simple_query_language">Simple query language</a></li>
          <li><a href="#intro_save_and_delete">Save and delete</a></li>
          <li><a href="#jpa_comparison">Comparison to JPA</a></li>
          <li><a href="#ebean_does_not">Ebean does not...</a></li>
        </ul>
</li>
<li >
  <a href="/docs/enhancement">Enhancement</a>
</li>
<li >
  <a href="/docs/configuration">Configuration</a>
</li>
<li >
  <a href="/docs/ebean_access_patterns">Ebean access patterns</a>
</li>
<li >
  <a href="/docs/field_and_property_access">Field and property access</a>
</li>

<li >
  <a href="/docs/queries">Queries</a>
</li>
<li >
  <a href="/docs/saving">Saving</a>
</li>
<li >
  <a href="/docs/mapping">Mapping</a>
</li>
<li >
  <a href="/docs/transactions">Transactions</a>
</li>
<li >
  <a href="/docs/json">JSON</a>
</li>
<li >
  <a href="/docs/eventlisteners">Event listeners</a>
</li>
<li >
  <a href="/docs/readaudit">Read Audit</a>
</li>
<li >
  <a href="/docs/changelog">Change Log</a>
</li>
<li >
  <a href="/docs/l2caching">L2 caching</a>
</li>
<li >
  <a href="/docs/testing">Testing</a>
</li>
<li >
  <a href="/docs/jvmlanguages">JVM Languages</a>
</li>

<li >
  <a href="/docs/clustering">Clustering</a>
</li>
<li >
  <a href="/docs/monitoring">Monitoring</a>
</li>
<li >
  <a href="/docs/architecture">Architecture</a>
</li>

        </ul>
          <a class="back-to-top" href="#top">
            Back to top
          </a>
      </nav>
    </div>
  </div>

</div>
<!-- /.row -->
</div>  <!-- /.container -->
  </div>
</div>

<footer id="footer">
 <div class="doc-footer">
  <ul class="doc-footer-links">
    <li><a href="/">Ebean ORM</a></li>
    <li> | </li>
    <li><a href="http://avaje-metric.github.io">Metrics</a></li>
    <li> | </li>
    <li><a href="/websitegenerator/index">Website Generator</a></li>
    <li> | </li>
    <li><a href="/jetty/index">Jetty Runnable War</a></li>
  </ul>
 </div>
</footer>

  <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.2/jquery.min.js"></script>
  <script src="/js/bootstrap.min.js"></script>
  <script src="/js/jquery.easing.min.js"></script>

  <script src="/js/json2.js"></script>
  <script src="/js/jquery.cookie.min.js"></script>
  <script src="/js/jquery.storageapi.min.js"></script>

  <script src="/js/ebean-site.js"></script>

  </body>
</html>

<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta id="layout-head" />
    <title>avaje ebean</title>
    <link rel="shortcut icon" href="/images/favicon.ico" >
    <!--<link href="/css/bootstrap.min.css" rel="stylesheet">-->
    <!-- Latest compiled and minified CSS -->
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.5/css/bootstrap.min.css">
    <link rel="stylesheet" href="/css/pygments.css" type="text/css" />
    <link rel="stylesheet" href="/css/site.css">
    <link rel="stylesheet" href="//netdna.bootstrapcdn.com/font-awesome/4.1.0/css/font-awesome.min.css">
      <!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
      <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
      <script src="https://oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>
    <![endif]-->
</head>
  <body>
  <div id="wrap">
    <div id="header">
    <div class="navbar navbar-inverse navbar-fixed-top" role="navigation">
      <div class="container">
        <div class="navbar-header">
          <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
            <span class="sr-only">Toggle navigation</span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
          </button>
          <a class="navbar-brand" href="/">Ebean ORM</a>
        </div>
        <div class="collapse navbar-collapse">
          <ul class="nav navbar-nav pull-right">
            <li ><a href="/"><span class="glyphicon glyphicon-home"></span>  Home</a></li>
            <li ><a href="/videos">Videos</a></li>
            <li ><a href="/quickstart">Quick Start</a></li>
            <li ><a href="/support">Support</a></li>
            <li class="active"><a href="/docs">Docs</a></li>
            <li ><a target="_blank" href="/apidocs">ApiDocs</a></li>
            <li ><a href="/releases">Releases</a></li>
            <li ><a target="_blank" href="https://github.com/ebean-orm/avaje-ebeanorm"> <i class="fa fa-github"></i> Github</a></li>
          </ul>
        </div><!--/.nav-collapse -->
      </div>
    </div>

  </div>
  <div id="main" data-offset="60">
<div class="jumbotron mini">
  <div class="container">
    <h1><a href="/docs">Documentation</a> / Enhancement </h1>
  </div>
</div>

<div class="container doc-index bs-docs-container">

  <div class="row">

    <div class="col-md-9" role="main">

      <div class="bs-docs-section">
<h1 id="enhancement" class="page-header">Enhancement</h1>

<p>The term "Enhancement" covesr all the ways (javaagent, ant, maven,IDE plugin, etc)
that are used to modify the entity beans.<p>

<p>Other similar terms to Enhancement that are used  include Weaving,
Transformation and byte code manipulation.</p>

<p>LTW â€“ Load time weaving is used to refer to when the class manipulation occurs at "load
time" typically via javaagent compared with class manipulation occuring at "build time"
typically via Maven, Ant or IDE plugin.</p>

<p>In raw terms a class is just a byte[] and Ebean is simply manipulating those bytes prior to
the class being defined by its ClassLoader.</p>


<div class="row icon-info">
<div class="col-md-3">
  <div class="well">
  <h4><span class="glyphicon glyphicon-chevron-right"></span> Maven, Ant</h4>
  <p>
Use Maven or Ant to enhance your beans at build compile time.
  </p>
  </div>
</div>

<div class="col-md-3">
  <div class="well">
  <h4><span class="glyphicon glyphicon-chevron-right"></span> Agent, AgentLoader</h4>
  <p>
Specify the agent on the command line or use AgentLoader to load the agent via code
onto a running JVM.
  </p>
  </div>
</div>

<div class="col-md-3">
  <div class="well">
  <h4><span class="glyphicon glyphicon-chevron-right"></span> Idea, Eclipse IDE</h4>
  <p>
Use IDE plugin to run the enhancement as part of the IDE compile/save.
  </p>
  </div>
</div>
</div> <!-- ./row -->

<div class="row">
<div class="col-md-12">

<h2 id="enhance_maven">Maven enhancement</h2>
<p>A Maven plugin for build time enhancement</p>

<div class="syntax xml"><div class="highlight"><pre><span class="nt">&lt;plugin&gt;</span>
  <span class="nt">&lt;groupId&gt;</span>org.avaje.ebeanorm<span class="nt">&lt;/groupId&gt;</span>
  <span class="nt">&lt;artifactId&gt;</span>avaje-ebeanorm-mavenenhancer<span class="nt">&lt;/artifactId&gt;</span>
  <span class="nt">&lt;version&gt;</span><span class='avaje-ebeanorm-mavenenhancer-version'>${version}</span><span class="nt">&lt;/version&gt;</span>
  <span class="nt">&lt;executions&gt;</span>
     <span class="nt">&lt;execution&gt;</span>
      <span class="nt">&lt;id&gt;</span>main<span class="nt">&lt;/id&gt;</span>
      <span class="nt">&lt;phase&gt;</span>process-classes<span class="nt">&lt;/phase&gt;</span>
      <span class="nt">&lt;configuration&gt;</span>
        <span class="nt">&lt;classSource&gt;</span>target/classes<span class="nt">&lt;/classSource&gt;</span>
        <span class="nt">&lt;classDestination&gt;</span>target/classes<span class="nt">&lt;/classDestination&gt;</span>
        <span class="nt">&lt;packages&gt;</span>org.example.domain.**,org.example.anotherdomain.**<span class="nt">&lt;/packages&gt;</span>
        <span class="nt">&lt;transformArgs&gt;</span>debug=1<span class="nt">&lt;/transformArgs&gt;</span>
      <span class="nt">&lt;/configuration&gt;</span>
      <span class="nt">&lt;goals&gt;</span>
        <span class="nt">&lt;goal&gt;</span>enhance<span class="nt">&lt;/goal&gt;</span>
      <span class="nt">&lt;/goals&gt;</span>
    <span class="nt">&lt;/execution&gt;</span>
  <span class="nt">&lt;/executions&gt;</span>
<span class="nt">&lt;/plugin&gt;</span>
</pre></div>
</div>



<h2 id="enhance_maven_eclipse">Eclipse + Maven enhancement</h2>
<p>Eclipse can be configured to enhance the classes during build using maven configuration</p>

<div class="syntax xml"><div class="highlight"><pre><span class="nt">&lt;build&gt;</span>
    <span class="nt">&lt;plugins&gt;</span>
        <span class="c">&lt;!-- plugins here --&gt;</span>
    <span class="nt">&lt;/plugins&gt;</span>
    <span class="nt">&lt;pluginManagement&gt;</span>
        <span class="nt">&lt;plugins&gt;</span>
            <span class="c">&lt;!--This plugin&#39;s configuration is used to store Eclipse m2e settings only. It has no influence on the Maven build itself. --&gt;</span>
            <span class="nt">&lt;plugin&gt;</span>
                <span class="nt">&lt;groupId&gt;</span>org.eclipse.m2e<span class="nt">&lt;/groupId&gt;</span>
                <span class="nt">&lt;artifactId&gt;</span>lifecycle-mapping<span class="nt">&lt;/artifactId&gt;</span>
                <span class="nt">&lt;version&gt;</span>1.0.0<span class="nt">&lt;/version&gt;</span>
                <span class="nt">&lt;configuration&gt;</span>
                    <span class="nt">&lt;lifecycleMappingMetadata&gt;</span>
                        <span class="nt">&lt;pluginExecutions&gt;</span>
                            <span class="nt">&lt;pluginExecution&gt;</span>
                                <span class="nt">&lt;pluginExecutionFilter&gt;</span>
                                    <span class="nt">&lt;groupId&gt;</span>org.avaje.ebeanorm<span class="nt">&lt;/groupId&gt;</span>
                                    <span class="nt">&lt;artifactId&gt;</span>avaje-ebeanorm-mavenenhancer<span class="nt">&lt;/artifactId&gt;</span>
                                    <span class="nt">&lt;versionRange&gt;</span>[<span class='avaje-ebeanorm-mavenenhancer-version'>${version}</span>,)<span class="nt">&lt;/versionRange&gt;</span>
                                    <span class="nt">&lt;goals&gt;</span>
                                        <span class="nt">&lt;goal&gt;</span>enhance<span class="nt">&lt;/goal&gt;</span>
                                    <span class="nt">&lt;/goals&gt;</span>
                                <span class="nt">&lt;/pluginExecutionFilter&gt;</span>
                                <span class="nt">&lt;action&gt;</span>
                                    <span class="nt">&lt;execute&gt;</span>
                                        <span class="nt">&lt;runOnConfiguration&gt;</span>true<span class="nt">&lt;/runOnConfiguration&gt;</span>
                                        <span class="nt">&lt;runOnIncremental&gt;</span>true<span class="nt">&lt;/runOnIncremental&gt;</span>
                                    <span class="nt">&lt;/execute&gt;</span>
                                <span class="nt">&lt;/action&gt;</span>
                            <span class="nt">&lt;/pluginExecution&gt;</span>
                        <span class="nt">&lt;/pluginExecutions&gt;</span>
                    <span class="nt">&lt;/lifecycleMappingMetadata&gt;</span>
                <span class="nt">&lt;/configuration&gt;</span>
            <span class="nt">&lt;/plugin&gt;</span>
        <span class="nt">&lt;/plugins&gt;</span>
    <span class="nt">&lt;/pluginManagement&gt;</span>
<span class="nt">&lt;/build&gt;</span>
</pre></div>
</div>



<h2 id="enhance_ant">Ant enhancement</h2>
<p>Modify your ant build.xml file to:
  <ol>
    <li>Define the AntEnhanceTask.</li>
    <li>Create a target that uses the AntEnhanceTask to enhance the entity classes.</li>
  </ol>
</p>

<div class="syntax xml"><div class="highlight"><pre><span class="nt">&lt;taskdef</span>
    <span class="na">name=</span><span class="s">&quot;ebeanEnhance&quot;</span>
    <span class="na">classname=</span><span class="s">&quot;com.avaje.ebean.enhance.ant.AntEnhanceTask&quot;</span>
    <span class="na">classpath=</span><span class="s">&quot;your_path_to/ebean-x.x.x.jar&quot;</span> <span class="nt">/&gt;</span>

<span class="nt">&lt;target</span> <span class="na">name=</span><span class="s">&quot;ormEnhance&quot;</span> <span class="na">depends=</span><span class="s">&quot;clean,compile&quot;</span><span class="nt">&gt;</span>
 <span class="c">&lt;!--</span>
<span class="c"> classSource: This is the directory that contains your class files. That is, the directory where your IDE will compile your java class files to, or the directory where a previous ant task will compile your java class files to.</span>

<span class="c"> classDest: The directory where the enhanced classes are written to. If not specified this defaults to the classSource effectively replacing the original class file with the enhanced class file.</span>

<span class="c"> packages: a comma delimited list of packages that contain entity classes. All the classes in these packages are searched for entity classes to be enhanced. transformArgs: This contains a debug level (0 - 10) .</span>
<span class="c"> --&gt;</span>
 <span class="nt">&lt;ebeanEnhance</span>
    <span class="na">classSource=</span><span class="s">&quot;your_classes_directory&quot;</span>
    <span class="na">packages=</span><span class="s">&quot;app.entity*&quot;</span>
    <span class="na">transformArgs=</span><span class="s">&quot;debug=5&quot;</span> <span class="nt">/&gt;</span>
<span class="nt">&lt;/target&gt;</span>
</pre></div>
</div>
</p>

<h2 id="enhance_agent">Agent enhancement</h2>
<p>JVM javaagent for runtime enhancement - you will usually start the JVM with an -javaagent:lib/avaje-ebeanorm-agent.jar command line option.  Ebean will automatically enhance the beans and use the resulting subclasses instead</p>



  <div role="tabpanel">

    <ul class="nav nav-tabs" role="tablist">
      <li role="presentation" class="active"><a href="#Maven3" aria-controls="Maven3" role="tab" data-toggle="tab">Maven</a></li>
      <li role="presentation"><a href="#Ivy3" aria-controls="Ivy3" role="tab" data-toggle="tab">Ivy</a></li>
      <li role="presentation"><a href="#Grape3" aria-controls="Grape3" role="tab" data-toggle="tab">Grape</a></li>
      <li role="presentation"><a href="#Gradle3" aria-controls="Gradle3" role="tab" data-toggle="tab">Gradle</a></li>
      <li role="presentation"><a href="#Buildr3" aria-controls="Buildr3" role="tab" data-toggle="tab">Buildr</a></li>
      <li role="presentation"><a href="#SBT3" aria-controls="SBT3" role="tab" data-toggle="tab">SBT</a></li>
      <li role="presentation"><a href="#Leiningen3" aria-controls="Leiningen3" role="tab" data-toggle="tab">Leiningen</a></li>
    </ul>

    <div class="tab-content">
      <div role="tabpanel" class="tab-pane active" id="Maven3">
<div class="syntax xml"><div class="highlight"><pre><span class="nt">&lt;dependency&gt;</span>
  <span class="nt">&lt;groupId&gt;</span>org.avaje<span class="nt">&lt;/groupId&gt;</span>
  <span class="nt">&lt;artifactId&gt;</span>avaje-agentloader<span class="nt">&lt;/artifactId&gt;</span>
  <span class="nt">&lt;version&gt;</span><span class='avaje-agentloader-version'>${version}</span><span class="nt">&lt;/version&gt;</span>
<span class="nt">&lt;/dependency&gt;</span>
</pre></div>
</div>
      </div>
      <div role="tabpanel" class="tab-pane" id="Ivy3">
<div class="syntax xml"><div class="highlight"><pre><span class="nt">&lt;dependency</span> <span class="na">org=</span><span class="s">&quot;org.avaje&quot;</span> <span class="na">name=</span><span class="s">&quot;avaje-agentloader&quot;</span> <span class="na">rev=</span><span class="s">&quot;<span class='avaje-agentloader-version'>${version}</span>&quot;</span><span class="nt">/&gt;</span>
</pre></div>
</div>
      </div>
      <div role="tabpanel" class="tab-pane" id="Grape3">
<div class="syntax groovy"><div class="highlight"><pre><span class="nd">@Grapes</span><span class="o">(</span>
  <span class="nd">@Grab</span><span class="o">(</span><span class="n">group</span><span class="o">=</span><span class="s1">&#39;org.avaje&#39;</span><span class="o">,</span> <span class="n">module</span><span class="o">=</span><span class="s1">&#39;avaje-agentloader&#39;</span><span class="o">,</span> <span class="n">version</span><span class="o">=</span><span class="s1">&#39;<span class='avaje-agentloader-version'>${version}</span>&#39;</span><span class="o">)</span>
<span class="o">)</span>
</pre></div>
</div>
      </div>
      <div role="tabpanel" class="tab-pane" id="Gradle3">
<div class="syntax groovy"><div class="highlight"><pre><span class="s1">&#39;org.avaje:avaje-agentloader:<span class='avaje-agentloader-version'>${version}</span>&#39;</span>
</pre></div>
</div>
      </div>
      <div role="tabpanel" class="tab-pane" id="Buildr3">
<div class="syntax groovy"><div class="highlight"><pre><span class="s1">&#39;org.avaje:avaje-agentloader:<span class='avaje-agentloader-version'>${version}</span>&#39;</span>
</pre></div>
</div>    </div>
      <div role="tabpanel" class="tab-pane" id="SBT3">
<div class="syntax scala"><div class="highlight"><pre><span class="n">libraryDependencies</span> <span class="o">+=</span> <span class="s">&quot;org.avaje&quot;</span> <span class="o">%</span> <span class="s">&quot;avaje-agentloader&quot;</span> <span class="o">%</span> <span class="s">&quot;<span class='avaje-agentloader-version'>${version}</span>&quot;</span>
</pre></div>
</div>
      </div>
      <div role="tabpanel" class="tab-pane" id="Leiningen3">
<div class="syntax xml"><div class="highlight"><pre>[org.avaje/avaje-agentloader &quot;<span class='avaje-agentloader-version'>${version}</span>&quot;]
</pre></div>
</div>
      </div>
    </div>


  </div>

<p>Enables programmatic loading of the java agent instead of starting the jvm with the -javaagent command line option</p>



  <div role="tabpanel">

    <ul class="nav nav-tabs" role="tablist">
      <li role="presentation" class="active"><a href="#Maven4" aria-controls="Maven4" role="tab" data-toggle="tab">Maven</a></li>
      <li role="presentation"><a href="#Ivy4" aria-controls="Ivy4" role="tab" data-toggle="tab">Ivy</a></li>
      <li role="presentation"><a href="#Grape4" aria-controls="Grape4" role="tab" data-toggle="tab">Grape</a></li>
      <li role="presentation"><a href="#Gradle4" aria-controls="Gradle4" role="tab" data-toggle="tab">Gradle</a></li>
      <li role="presentation"><a href="#Buildr4" aria-controls="Buildr4" role="tab" data-toggle="tab">Buildr</a></li>
      <li role="presentation"><a href="#SBT4" aria-controls="SBT4" role="tab" data-toggle="tab">SBT</a></li>
      <li role="presentation"><a href="#Leiningen4" aria-controls="Leiningen4" role="tab" data-toggle="tab">Leiningen</a></li>
    </ul>

    <div class="tab-content">
      <div role="tabpanel" class="tab-pane active" id="Maven4">
<div class="syntax xml"><div class="highlight"><pre><span class="nt">&lt;dependency&gt;</span>
  <span class="nt">&lt;groupId&gt;</span>org.avaje.ebeanorm<span class="nt">&lt;/groupId&gt;</span>
  <span class="nt">&lt;artifactId&gt;</span>avaje-ebeanorm-agent<span class="nt">&lt;/artifactId&gt;</span>
  <span class="nt">&lt;version&gt;</span><span class='avaje-ebeanorm-agent-version'>${version}</span><span class="nt">&lt;/version&gt;</span>
<span class="nt">&lt;/dependency&gt;</span>
</pre></div>
</div>
      </div>
      <div role="tabpanel" class="tab-pane" id="Ivy4">
<div class="syntax xml"><div class="highlight"><pre><span class="nt">&lt;dependency</span> <span class="na">org=</span><span class="s">&quot;org.avaje.ebeanorm&quot;</span> <span class="na">name=</span><span class="s">&quot;avaje-ebeanorm-agent&quot;</span> <span class="na">rev=</span><span class="s">&quot;<span class='avaje-ebeanorm-agent-version'>${version}</span>&quot;</span><span class="nt">/&gt;</span>
</pre></div>
</div>
      </div>
      <div role="tabpanel" class="tab-pane" id="Grape4">
<div class="syntax groovy"><div class="highlight"><pre><span class="nd">@Grapes</span><span class="o">(</span>
  <span class="nd">@Grab</span><span class="o">(</span><span class="n">group</span><span class="o">=</span><span class="s1">&#39;org.avaje.ebeanorm&#39;</span><span class="o">,</span> <span class="n">module</span><span class="o">=</span><span class="s1">&#39;avaje-ebeanorm-agent&#39;</span><span class="o">,</span> <span class="n">version</span><span class="o">=</span><span class="s1">&#39;<span class='avaje-ebeanorm-agent-version'>${version}</span>&#39;</span><span class="o">)</span>
<span class="o">)</span>
</pre></div>
</div>
      </div>
      <div role="tabpanel" class="tab-pane" id="Gradle4">
<div class="syntax groovy"><div class="highlight"><pre><span class="s1">&#39;org.avaje.ebeanorm:avaje-ebeanorm-agent:<span class='avaje-ebeanorm-agent-version'>${version}</span>&#39;</span>
</pre></div>
</div>
      </div>
      <div role="tabpanel" class="tab-pane" id="Buildr4">
<div class="syntax groovy"><div class="highlight"><pre><span class="s1">&#39;org.avaje.ebeanorm:avaje-ebeanorm-agent:<span class='avaje-ebeanorm-agent-version'>${version}</span>&#39;</span>
</pre></div>
</div>    </div>
      <div role="tabpanel" class="tab-pane" id="SBT4">
<div class="syntax scala"><div class="highlight"><pre><span class="n">libraryDependencies</span> <span class="o">+=</span> <span class="s">&quot;org.avaje.ebeanorm&quot;</span> <span class="o">%</span> <span class="s">&quot;avaje-ebeanorm-agent&quot;</span> <span class="o">%</span> <span class="s">&quot;<span class='avaje-ebeanorm-agent-version'>${version}</span>&quot;</span>
</pre></div>
</div>
      </div>
      <div role="tabpanel" class="tab-pane" id="Leiningen4">
<div class="syntax xml"><div class="highlight"><pre>[org.avaje.ebeanorm/avaje-ebeanorm-agent &quot;<span class='avaje-ebeanorm-agent-version'>${version}</span>&quot;]
</pre></div>
</div>
      </div>
    </div>


  </div>

Next, you need to start the enhancer agent.  You can start the enhancer agent programmatically:
<div class="syntax java"><div class="highlight"><pre><span class="kn">import</span> <span class="nn">org.avaje.agentloader</span><span class="o">;</span>
<span class="o">...</span>
<span class="kd">public</span> <span class="kt">void</span> <span class="nf">someApplicationBootupMethod</span><span class="o">()</span> <span class="o">{</span>
  <span class="c1">// Load the agent into the running JVM process</span>
  <span class="k">if</span> <span class="o">(!</span><span class="n">AgentLoader</span><span class="o">.</span><span class="na">loadAgentFromClasspath</span><span class="o">(</span><span class="s">&quot;avaje-ebeanorm-agent&quot;</span><span class="o">,</span><span class="s">&quot;debug=1;packages=org.example.model.**&quot;</span><span class="o">))</span> <span class="o">{</span>
    <span class="n">logger</span><span class="o">.</span><span class="na">info</span><span class="o">(</span><span class="s">&quot;avaje-ebeanorm-agent not found in classpath - not dynamically loaded&quot;</span><span class="o">);</span>
  <span class="o">}</span>
<span class="o">}</span>
</pre></div>
</div>

Alternatively, you can start the enhancer agent from the command line, examples:
<div class="syntax xml"><div class="highlight"><pre>java -javaagent:avaje-ebeanorm-agent-<span class='avaje-ebeanorm-mavenenhancer-version'>${version}</span>.jar MyApplication
java -javaagent:avaje-ebeanorm-agent-<span class='avaje-ebeanorm-mavenenhancer-version'>${version}</span>.jar=debug=3 MyApplication
java -javaagent:avaje-ebeanorm-agent-<span class='avaje-ebeanorm-mavenenhancer-version'>${version}</span>.jar=packages=org.example.model.** MyApplication
java -javaagent:avaje-ebeanorm-agent-<span class='avaje-ebeanorm-mavenenhancer-version'>${version}</span>.jar=debug=3;packages=org.example.model.**,org.example.model2.** MyApplication
</pre></div>
</div>



And as a final alternative, you can enhance your entities yourself programmatically with the agent:

<div class="syntax java"><div class="highlight"><pre><span class="n">Transformer</span> <span class="n">transformer</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Transformer</span><span class="o">(</span><span class="s">&quot;&quot;</span><span class="o">,</span> <span class="s">&quot;debug=&quot;</span> <span class="o">+</span> <span class="n">EBEAN_TRANSFORM_LOG_LEVEL</span><span class="o">);</span><span class="c1">//0-9 -&gt; none - all</span>
<span class="n">InputStreamTransform</span> <span class="n">streamTransform</span> <span class="o">=</span> <span class="k">new</span> <span class="n">InputStreamTransform</span><span class="o">(</span><span class="n">transformer</span><span class="o">,</span> <span class="n">Ebean</span><span class="o">.</span><span class="na">class</span><span class="o">.</span><span class="na">getClassLoader</span><span class="o">());</span>
<span class="n">InputStream</span> <span class="n">in</span> <span class="o">=</span> <span class="k">new</span> <span class="n">URL</span><span class="o">(</span><span class="s">&quot;your.class.file.class&quot;</span><span class="o">).</span><span class="na">openStream</span><span class="o">();</span><span class="c1">//Or use ASM or Javassist get bytecode and new InputSream eg. in = new ByteArrayInputStream(ctClass.toBytecode());</span>
<span class="kt">byte</span><span class="o">[]</span> <span class="n">result</span> <span class="o">=</span> <span class="kc">null</span><span class="o">;</span>
<span class="k">try</span> <span class="o">{</span>
    <span class="n">result</span> <span class="o">=</span> <span class="n">streamTransform</span><span class="o">.</span><span class="na">transform</span><span class="o">(</span><span class="s">&quot;your.class.name&quot;</span><span class="o">,</span> <span class="n">in</span><span class="o">);</span><span class="c1">//class must be not loaded by classLoader</span>
<span class="o">}</span> <span class="k">finally</span> <span class="o">{</span>
    <span class="n">in</span><span class="o">.</span><span class="na">close</span><span class="o">();</span>
<span class="o">}</span>
<span class="k">if</span> <span class="o">(</span><span class="n">result</span> <span class="o">==</span> <span class="kc">null</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">throw</span> <span class="k">new</span> <span class="nf">CannotCompileException</span><span class="o">(</span><span class="s">&quot;ebean enhance model fail!&quot;</span><span class="o">);</span>
<span class="o">}</span>
<span class="n">defineClass</span><span class="o">(</span><span class="s">&quot;your.class.name&quot;</span><span class="o">,</span> <span class="n">result</span><span class="o">,</span> <span class="mi">0</span><span class="o">,</span> <span class="n">result</span><span class="o">.</span><span class="na">length</span><span class="o">);</span>
</pre></div>
</div>


</p>

<h2 id="enhance_ide">IDE enhancement</h2>
<p>Under Construction</p>
</div>
</div> <!-- ./row -->

</div>

    </div>

    <div class="col-md-3" role="complementary">
      <nav class="bs-docs-sidebar hidden-print hidden-xs hidden-sm">
        <ul class="nav bs-docs-sidenav">


<li class="active">
  <a href="/docs/introduction">Introduction</a>
        <ul class="nav">
          <li><a href="#use_jpa_mapping">Use JPA mappings</a></li>
          <li><a href="#simple_query_language">Simple query language</a></li>
          <li><a href="#intro_save_and_delete">Save and delete</a></li>
          <li><a href="#jpa_comparison">Comparison to JPA</a></li>
          <li><a href="#ebean_does_not">Ebean does not...</a></li>
        </ul>
</li>
<li class="active">
  <a href="/docs/enhancement">Enhancement</a>

          <ul class="nav">
            <li><a href="#enhance_maven">Maven</a></li>
            <li><a href="#enhance_maven_eclipse">Eclipse + Maven</a></li>
            <li><a href="#enhance_ant">Ant</a></li>
            <li><a href="#enhance_agent">Agent</a></li>
            <li><a href="#enhance_ide">IDE enhancement</a></li>
          </ul>
</li>
<li >
  <a href="/docs/configuration">Configuration</a>
</li>
<li >
  <a href="/docs/ebean_access_patterns">Ebean access patterns</a>
</li>
<li >
  <a href="/docs/field_and_property_access">Field and property access</a>
</li>

<li >
  <a href="/docs/queries">Queries</a>
</li>
<li >
  <a href="/docs/saving">Saving</a>
</li>
<li >
  <a href="/docs/mapping">Mapping</a>
</li>
<li >
  <a href="/docs/transactions">Transactions</a>
</li>
<li >
  <a href="/docs/json">JSON</a>
</li>
<li >
  <a href="/docs/eventlisteners">Event listeners</a>
</li>
<li >
  <a href="/docs/readaudit">Read Audit</a>
</li>
<li >
  <a href="/docs/changelog">Change Log</a>
</li>
<li >
  <a href="/docs/l2caching">L2 caching</a>
</li>
<li >
  <a href="/docs/testing">Testing</a>
</li>
<li >
  <a href="/docs/jvmlanguages">JVM Languages</a>
</li>

<li >
  <a href="/docs/clustering">Clustering</a>
</li>
<li >
  <a href="/docs/monitoring">Monitoring</a>
</li>
<li >
  <a href="/docs/architecture">Architecture</a>
</li>

        </ul>
          <a class="back-to-top" href="#top">
            Back to top
          </a>
      </nav>
    </div>
  </div>

</div>
<!-- /.row -->
</div>  <!-- /.container -->
  </div>
</div>

<footer id="footer">
 <div class="doc-footer">
  <ul class="doc-footer-links">
    <li><a href="/">Ebean ORM</a></li>
    <li> | </li>
    <li><a href="http://avaje-metric.github.io">Metrics</a></li>
    <li> | </li>
    <li><a href="/websitegenerator/index">Website Generator</a></li>
    <li> | </li>
    <li><a href="/jetty/index">Jetty Runnable War</a></li>
  </ul>
 </div>
</footer>

  <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.2/jquery.min.js"></script>
  <script src="/js/bootstrap.min.js"></script>
  <script src="/js/jquery.easing.min.js"></script>

  <script src="/js/json2.js"></script>
  <script src="/js/jquery.cookie.min.js"></script>
  <script src="/js/jquery.storageapi.min.js"></script>

  <script src="/js/ebean-site.js"></script>

  </body>
</html>

<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta id="layout-head" />
    <title>avaje ebean</title>
    <link rel="shortcut icon" href="/images/favicon.ico" >
    <!--<link href="/css/bootstrap.min.css" rel="stylesheet">-->
    <!-- Latest compiled and minified CSS -->
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.5/css/bootstrap.min.css">
    <link rel="stylesheet" href="/css/pygments.css" type="text/css" />
    <link rel="stylesheet" href="/css/site.css">
    <link rel="stylesheet" href="//netdna.bootstrapcdn.com/font-awesome/4.1.0/css/font-awesome.min.css">
      <!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
      <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
      <script src="https://oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>
    <![endif]-->
</head>
  <body>
  <div id="wrap">
    <div id="header">
    <div class="navbar navbar-inverse navbar-fixed-top" role="navigation">
      <div class="container">
        <div class="navbar-header">
          <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
            <span class="sr-only">Toggle navigation</span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
          </button>
          <a class="navbar-brand" href="/">Ebean ORM</a>
        </div>
        <div class="collapse navbar-collapse">
          <ul class="nav navbar-nav pull-right">
            <li ><a href="/"><span class="glyphicon glyphicon-home"></span>  Home</a></li>
            <li ><a href="/videos">Videos</a></li>
            <li ><a href="/quickstart">Quick Start</a></li>
            <li ><a href="/support">Support</a></li>
            <li class="active"><a href="/docs">Docs</a></li>
            <li ><a target="_blank" href="/apidocs">ApiDocs</a></li>
            <li ><a href="/releases">Releases</a></li>
            <li ><a target="_blank" href="https://github.com/ebean-orm/avaje-ebeanorm"> <i class="fa fa-github"></i> Github</a></li>
          </ul>
        </div><!--/.nav-collapse -->
      </div>
    </div>

  </div>
  <div id="main" data-offset="60">
<div class="jumbotron mini">
  <div class="container">
    <h1><a href="/docs">Documentation</a> / Bootstrap </h1>
  </div>
</div>

<div class="container doc-index bs-docs-container">

  <div class="row">

    <div class="col-md-9" role="main">

      <div class="bs-docs-section">
<h1 id="configuration" class="page-header">Bootstrap</h1>



<h2 id="properties_config">ebean.properties configuration</h2>

<p>Create an ebean.properties file and put it in your classpath or working directory. You can use the example below as a starting point.</p>

<p>
You need to change the DataSource parameters to suite your own environment.
</p>

<div class="syntax properties"><div class="highlight"><pre><span class="c"># -------------------------------------------------------------</span>
<span class="c"># Load (Dev/Test/Prod) properties external to your war/jar</span>
<span class="c"># -------------------------------------------------------------</span>
<span class="c"># You can use load.properties to load the properties from a</span>
<span class="c"># file external to your war/jar.</span>
<span class="c">#load.properties.override=$\{CATALINA_HOME}/conf/myapp.ebean.properties</span>


<span class="na">ebean.ddl.generate</span><span class="o">=</span><span class="s">false</span>
<span class="na">ebean.ddl.run</span><span class="o">=</span><span class="s">false</span>

<span class="na">ebean.debug.sql</span><span class="o">=</span><span class="s">true</span>
<span class="na">ebean.debug.lazyload</span><span class="o">=</span><span class="s">false</span>


<span class="c"># -------------------------------------------------------------</span>
<span class="c"># Transaction Logging</span>
<span class="c"># -------------------------------------------------------------</span>

<span class="c"># Use java util logging to log transaction details</span>
<span class="c">#ebean.loggingToJavaLogger=true</span>

<span class="c"># General logging level: (none, explicit, all)</span>
<span class="na">ebean.logging</span><span class="o">=</span><span class="s">all</span>

<span class="c"># Sharing log files: (none, explicit, all)</span>
<span class="na">ebean.logging.logfilesharing</span><span class="o">=</span><span class="s">all</span>

<span class="c"># location of transaction logs</span>
<span class="na">ebean.logging.directory</span><span class="o">=</span><span class="s">logs</span>
<span class="c">#ebean.logging.directory=$\{catalina.base}/logs/trans</span>

<span class="c"># Specific Log levels (none, summary, binding, sql)</span>
<span class="na">ebean.logging.iud</span><span class="o">=</span><span class="s">sql</span>
<span class="na">ebean.logging.query</span><span class="o">=</span><span class="s">sql</span>
<span class="na">ebean.logging.sqlquery</span><span class="o">=</span><span class="s">sql</span>

<span class="na">ebean.logging.txnCommit</span><span class="o">=</span><span class="s">none</span>

<span class="c"># -------------------------------------------------------------</span>
<span class="c"># DataSources (If using default Ebean DataSourceFactory)</span>
<span class="c"># -------------------------------------------------------------</span>
<span class="c"># You can specify many DataSources (one per EbeanServer)  and</span>
<span class="c"># one of them is defined as the default/primary DataSource</span>

<span class="c"># specify the default/primary DataSource</span>
<span class="na">datasource.default</span><span class="o">=</span><span class="s">h2</span>

<span class="na">datasource.h2.username</span><span class="o">=</span><span class="s">sa</span>
<span class="na">datasource.h2.password</span><span class="o">=</span>
<span class="na">datasource.h2.databaseUrl</span><span class="o">=</span><span class="s">jdbc:h2:mem:tests;DB_CLOSE_DELAY=-1</span>
<span class="na">datasource.h2.databaseDriver</span><span class="o">=</span><span class="s">org.h2.Driver</span>
<span class="na">datasource.h2.minConnections</span><span class="o">=</span><span class="s">1</span>
<span class="na">datasource.h2.maxConnections</span><span class="o">=</span><span class="s">25</span>
<span class="na">datasource.h2.heartbeatsql</span><span class="o">=</span><span class="s">select 1</span>
<span class="na">datasource.h2.isolationlevel</span><span class="o">=</span><span class="s">read_committed</span>

<span class="na">datasource.mysql.username</span><span class="o">=</span><span class="s">test</span>
<span class="na">datasource.mysql.password</span><span class="o">=</span><span class="s">test</span>
<span class="na">datasource.mysql.databaseUrl</span><span class="o">=</span><span class="s">jdbc:mysql://127.0.0.1:3306/test</span>
<span class="na">datasource.mysql.databaseDriver</span><span class="o">=</span><span class="s">com.mysql.jdbc.Driver</span>
<span class="na">datasource.mysql.minConnections</span><span class="o">=</span><span class="s">1</span>
<span class="na">datasource.mysql.maxConnections</span><span class="o">=</span><span class="s">25</span>
<span class="c">#datasource.mysql.heartbeatsql=select 1</span>
<span class="na">datasource.mysql.isolationlevel</span><span class="o">=</span><span class="s">read_committed</span>

<span class="c">#datasource.ora.username=test</span>
<span class="c">#datasource.ora.password=test</span>
<span class="c">#datasource.ora.databaseUrl=jdbc:oracle:thin:@127.0.0.1:1521:XE</span>
<span class="c">#datasource.ora.databaseDriver=oracle.jdbc.driver.OracleDriver</span>
<span class="c">#datasource.ora.minConnections=1</span>
<span class="c">#datasource.ora.maxConnections=25</span>
<span class="c">#datasource.ora.heartbeatsql=select count(*) from dual</span>
<span class="c">#datasource.ora.isolationlevel=read_committed</span>

<span class="c">#datasource.pg.username=test</span>
<span class="c">#datasource.pg.password=test</span>
<span class="c">#datasource.pg.databaseUrl=jdbc:postgresql://127.0.0.1:5433/test</span>
<span class="c">#datasource.pg.databaseDriver=org.postgresql.Driver</span>
<span class="c">#datasource.pg.heartbeatsql=select 1</span>
</pre></div>
</div>

<h2 id="programmatic_config">Programmatic configuration</h2>
<p>
You can programmatically build EbeanServer instances. ServerConfig is used to collect configuration settings and then passed to EbeanServerFactory to create the actual instance.
</p>
<p>
Note: When you use the Ebean singleton with a ebean.properties file it internally will create a ServerConfig, populate it from settings in the ebean.properties file and call EbeanServerFactory much like the code below.
</p>

<div class="syntax java"><div class="highlight"><pre><span class="c1">// programmatically build a EbeanServer instance</span>
<span class="c1">// specify the configuration...</span>

<span class="n">ServerConfig</span> <span class="n">config</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ServerConfig</span><span class="o">();</span>
<span class="n">config</span><span class="o">.</span><span class="na">setName</span><span class="o">(</span><span class="s">&quot;pgtest&quot;</span><span class="o">);</span>

<span class="c1">// Define DataSource parameters</span>
<span class="n">DataSourceConfig</span> <span class="n">postgresDb</span> <span class="o">=</span> <span class="k">new</span> <span class="n">DataSourceConfig</span><span class="o">();</span>
<span class="n">postgresDb</span><span class="o">.</span><span class="na">setDriver</span><span class="o">(</span><span class="s">&quot;org.postgresql.Driver&quot;</span><span class="o">);</span>
<span class="n">postgresDb</span><span class="o">.</span><span class="na">setUsername</span><span class="o">(</span><span class="s">&quot;test&quot;</span><span class="o">);</span>
<span class="n">postgresDb</span><span class="o">.</span><span class="na">setPassword</span><span class="o">(</span><span class="s">&quot;test&quot;</span><span class="o">);</span>
<span class="n">postgresDb</span><span class="o">.</span><span class="na">setUrl</span><span class="o">(</span><span class="s">&quot;jdbc:postgresql://127.0.0.1:5432/test&quot;</span><span class="o">);</span>
<span class="n">postgresDb</span><span class="o">.</span><span class="na">setHeartbeatSql</span><span class="o">(</span><span class="s">&quot;select count(*) from t_one&quot;</span><span class="o">);</span>

<span class="n">config</span><span class="o">.</span><span class="na">setDataSourceConfig</span><span class="o">(</span><span class="n">postgresDb</span><span class="o">);</span>

<span class="c1">// specify a JNDI DataSource</span>
<span class="c1">// config.setDataSourceJndiName(&quot;someJndiDataSourceName&quot;);</span>

<span class="c1">// set DDL options...</span>
<span class="n">config</span><span class="o">.</span><span class="na">setDdlGenerate</span><span class="o">(</span><span class="kc">true</span><span class="o">);</span>
<span class="n">config</span><span class="o">.</span><span class="na">setDdlRun</span><span class="o">(</span><span class="kc">true</span><span class="o">);</span>

<span class="n">config</span><span class="o">.</span><span class="na">setDefaultServer</span><span class="o">(</span><span class="kc">false</span><span class="o">);</span>
<span class="n">config</span><span class="o">.</span><span class="na">setRegister</span><span class="o">(</span><span class="kc">false</span><span class="o">);</span>


<span class="c1">// automatically determine the DatabasePlatform</span>
<span class="c1">// using the jdbc driver</span>
<span class="c1">// config.setDatabasePlatform(new PostgresPlatform());</span>

<span class="c1">// specify the entity classes (and listeners etc)</span>
<span class="c1">// ... if these are not specified Ebean will search</span>
<span class="c1">// ... the classpath looking for entity classes.</span>
<span class="n">config</span><span class="o">.</span><span class="na">addClass</span><span class="o">(</span><span class="n">Order</span><span class="o">.</span><span class="na">class</span><span class="o">);</span>
<span class="n">config</span><span class="o">.</span><span class="na">addClass</span><span class="o">(</span><span class="n">Customer</span><span class="o">.</span><span class="na">class</span><span class="o">);</span>
<span class="o">...</span>

<span class="c1">// specify jars to search for entity beans</span>
<span class="n">config</span><span class="o">.</span><span class="na">addJar</span><span class="o">(</span><span class="s">&quot;someJarThatContainsEntityBeans.jar&quot;</span><span class="o">);</span>

<span class="c1">// create the EbeanServer instance</span>
<span class="n">EbeanServer</span> <span class="n">server</span> <span class="o">=</span> <span class="n">EbeanServerFactory</span><span class="o">.</span><span class="na">create</span><span class="o">(</span><span class="n">config</span><span class="o">);</span>
</pre></div>
</div>

<h2 id="logging">Logging</h2>

<p>Ebean uses <a href="http://www.slf4j.org/">SLF4J</a> for logging.</p>

<div class="syntax xml"><div class="highlight"><pre><span class="c">&lt;!-- SQL and bind values --&gt;</span>
<span class="nt">&lt;logger</span> <span class="na">name=</span><span class="s">&quot;org.avaje.ebean.SQL&quot;</span> <span class="na">level=</span><span class="s">&quot;TRACE&quot;</span><span class="nt">/&gt;</span>
<span class="c">&lt;!-- Transaction Commit and Rollback events --&gt;</span>
<span class="nt">&lt;logger</span> <span class="na">name=</span><span class="s">&quot;org.avaje.ebean.TXN&quot;</span> <span class="na">level=</span><span class="s">&quot;TRACE&quot;</span><span class="nt">/&gt;</span>
<span class="c">&lt;!-- Summary level details --&gt;</span>
<span class="nt">&lt;logger</span> <span class="na">name=</span><span class="s">&quot;org.avaje.ebean.SUM&quot;</span> <span class="na">level=</span><span class="s">&quot;TRACE&quot;</span><span class="nt">/&gt;</span>
</pre></div>
</div>

<p>
In your early stages of using Ebean you should find where the transaction logs are going
so that you can see exactly what Ebean is doing.
</p>

<p>...(under construction)... would be good to give full details on how to setup logging</p>

</div>

    </div>

    <div class="col-md-3" role="complementary">
      <nav class="bs-docs-sidebar hidden-print hidden-xs hidden-sm">
        <ul class="nav bs-docs-sidenav">


<li class="active">
  <a href="/docs/introduction">Introduction</a>
        <ul class="nav">
          <li><a href="#use_jpa_mapping">Use JPA mappings</a></li>
          <li><a href="#simple_query_language">Simple query language</a></li>
          <li><a href="#intro_save_and_delete">Save and delete</a></li>
          <li><a href="#jpa_comparison">Comparison to JPA</a></li>
          <li><a href="#ebean_does_not">Ebean does not...</a></li>
        </ul>
</li>
<li class="active">
  <a href="/docs/enhancement">Enhancement</a>

          <ul class="nav">
            <li><a href="#enhance_maven">Maven</a></li>
            <li><a href="#enhance_maven_eclipse">Eclipse + Maven</a></li>
            <li><a href="#enhance_ant">Ant</a></li>
            <li><a href="#enhance_agent">Agent</a></li>
            <li><a href="#enhance_ide">IDE enhancement</a></li>
          </ul>
</li>
<li >
  <a href="/docs/configuration">Configuration</a>
</li>
<li >
  <a href="/docs/ebean_access_patterns">Ebean access patterns</a>
</li>
<li >
  <a href="/docs/field_and_property_access">Field and property access</a>
</li>

<li >
  <a href="/docs/queries">Queries</a>
</li>
<li >
  <a href="/docs/saving">Saving</a>
</li>
<li >
  <a href="/docs/mapping">Mapping</a>
</li>
<li >
  <a href="/docs/transactions">Transactions</a>
</li>
<li >
  <a href="/docs/json">JSON</a>
</li>
<li >
  <a href="/docs/eventlisteners">Event listeners</a>
</li>
<li >
  <a href="/docs/readaudit">Read Audit</a>
</li>
<li >
  <a href="/docs/changelog">Change Log</a>
</li>
<li >
  <a href="/docs/l2caching">L2 caching</a>
</li>
<li >
  <a href="/docs/testing">Testing</a>
</li>
<li >
  <a href="/docs/jvmlanguages">JVM Languages</a>
</li>

<li >
  <a href="/docs/clustering">Clustering</a>
</li>
<li >
  <a href="/docs/monitoring">Monitoring</a>
</li>
<li >
  <a href="/docs/architecture">Architecture</a>
</li>

        </ul>
          <a class="back-to-top" href="#top">
            Back to top
          </a>
      </nav>
    </div>
  </div>

</div>
<!-- /.row -->
</div>  <!-- /.container -->
  </div>
</div>

<footer id="footer">
 <div class="doc-footer">
  <ul class="doc-footer-links">
    <li><a href="/">Ebean ORM</a></li>
    <li> | </li>
    <li><a href="http://avaje-metric.github.io">Metrics</a></li>
    <li> | </li>
    <li><a href="/websitegenerator/index">Website Generator</a></li>
    <li> | </li>
    <li><a href="/jetty/index">Jetty Runnable War</a></li>
  </ul>
 </div>
</footer>

  <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.2/jquery.min.js"></script>
  <script src="/js/bootstrap.min.js"></script>
  <script src="/js/jquery.easing.min.js"></script>

  <script src="/js/json2.js"></script>
  <script src="/js/jquery.cookie.min.js"></script>
  <script src="/js/jquery.storageapi.min.js"></script>

  <script src="/js/ebean-site.js"></script>

  </body>
</html>

<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta id="layout-head" />
    <title>avaje ebean</title>
    <link rel="shortcut icon" href="/images/favicon.ico" >
    <!--<link href="/css/bootstrap.min.css" rel="stylesheet">-->
    <!-- Latest compiled and minified CSS -->
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.5/css/bootstrap.min.css">
    <link rel="stylesheet" href="/css/pygments.css" type="text/css" />
    <link rel="stylesheet" href="/css/site.css">
    <link rel="stylesheet" href="//netdna.bootstrapcdn.com/font-awesome/4.1.0/css/font-awesome.min.css">
      <!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
      <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
      <script src="https://oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>
    <![endif]-->
</head>
  <body>
  <div id="wrap">
    <div id="header">
    <div class="navbar navbar-inverse navbar-fixed-top" role="navigation">
      <div class="container">
        <div class="navbar-header">
          <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
            <span class="sr-only">Toggle navigation</span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
          </button>
          <a class="navbar-brand" href="/">Ebean ORM</a>
        </div>
        <div class="collapse navbar-collapse">
          <ul class="nav navbar-nav pull-right">
            <li ><a href="/"><span class="glyphicon glyphicon-home"></span>  Home</a></li>
            <li ><a href="/videos">Videos</a></li>
            <li ><a href="/quickstart">Quick Start</a></li>
            <li ><a href="/support">Support</a></li>
            <li class="active"><a href="/docs">Docs</a></li>
            <li ><a target="_blank" href="/apidocs">ApiDocs</a></li>
            <li ><a href="/releases">Releases</a></li>
            <li ><a target="_blank" href="https://github.com/ebean-orm/avaje-ebeanorm"> <i class="fa fa-github"></i> Github</a></li>
          </ul>
        </div><!--/.nav-collapse -->
      </div>
    </div>

  </div>
  <div id="main" data-offset="60">
<div class="jumbotron mini">
  <div class="container">
    <h1><a href="/docs">Documentation</a> / Change log </h1>
  </div>
</div>

<div class="container doc-index bs-docs-container">

  <div class="row">

    <div class="col-md-9" role="main">

      <div class="bs-docs-section">
<h1 id="ebean_access_patterns">Ebean access patterns</h1>

<div class="row icon-info">
<div class="col-md-12">

<h2 id="dependency_injection">Dependency Injection</h2>
<p>
In this style Spring or Guice etc is used to inject an EbeanServer into your service objects.
Use a Spring FactoryBean or similar to create a EbeanServer instance in the DI context.
</p>

<h4>ServerConfig and EbeanServerFactory</h4>
<p>
You can programmatically create an EbeanServer instance using <code>ServerConfig</code> and <code>EbeanServerFactory</code>.

</p>

<div class="syntax java"><div class="highlight"><pre>  <span class="cm">/**</span>
<span class="cm">   * Example creating a EbeanServer instance programmatically using</span>
<span class="cm">   * ServerConfig and EbeanServerFactory.</span>
<span class="cm">   */</span>
  <span class="kd">private</span> <span class="n">EbeanServer</span> <span class="nf">createEbeanServer</span><span class="o">()</span> <span class="o">{</span>

    <span class="n">ServerConfig</span> <span class="n">c</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ServerConfig</span><span class="o">();</span>
    <span class="n">c</span><span class="o">.</span><span class="na">setName</span><span class="o">(</span><span class="s">&quot;pgtest&quot;</span><span class="o">);</span>

    <span class="c1">// programmatically configure a DataSource</span>
    <span class="n">DataSourceConfig</span> <span class="n">postgresDb</span> <span class="o">=</span> <span class="k">new</span> <span class="n">DataSourceConfig</span><span class="o">();</span>
    <span class="n">postgresDb</span><span class="o">.</span><span class="na">setDriver</span><span class="o">(</span><span class="s">&quot;org.postgresql.Driver&quot;</span><span class="o">);</span>
    <span class="n">postgresDb</span><span class="o">.</span><span class="na">setUsername</span><span class="o">(</span><span class="s">&quot;test&quot;</span><span class="o">);</span>
    <span class="n">postgresDb</span><span class="o">.</span><span class="na">setPassword</span><span class="o">(</span><span class="s">&quot;test&quot;</span><span class="o">);</span>
    <span class="n">postgresDb</span><span class="o">.</span><span class="na">setUrl</span><span class="o">(</span><span class="s">&quot;jdbc:postgresql://127.0.0.1:5432/test&quot;</span><span class="o">);</span>
    <span class="n">postgresDb</span><span class="o">.</span><span class="na">setHeartbeatSql</span><span class="o">(</span><span class="s">&quot;select count(*) from t_one&quot;</span><span class="o">);</span>

    <span class="c1">// load some configuration from ebean.properties</span>
    <span class="n">c</span><span class="o">.</span><span class="na">loadFromProperties</span><span class="o">();</span>

    <span class="c1">// set some configuration</span>
    <span class="n">c</span><span class="o">.</span><span class="na">setDdlGenerate</span><span class="o">(</span><span class="kc">true</span><span class="o">);</span>
    <span class="n">c</span><span class="o">.</span><span class="na">setDdlRun</span><span class="o">(</span><span class="kc">true</span><span class="o">);</span>
    <span class="n">c</span><span class="o">.</span><span class="na">setDefaultServer</span><span class="o">(</span><span class="kc">false</span><span class="o">);</span>
    <span class="n">c</span><span class="o">.</span><span class="na">setRegister</span><span class="o">(</span><span class="kc">false</span><span class="o">);</span>
    <span class="n">c</span><span class="o">.</span><span class="na">setDataSourceConfig</span><span class="o">(</span><span class="n">postgresDb</span><span class="o">);</span>
    <span class="n">c</span><span class="o">.</span><span class="na">setDatabasePlatform</span><span class="o">(</span><span class="k">new</span> <span class="n">PostgresPlatform</span><span class="o">());</span>

    <span class="c1">// explicitly register entity beans, listeners, adpaters etc</span>
    <span class="n">c</span><span class="o">.</span><span class="na">addClass</span><span class="o">(</span><span class="n">Customer</span><span class="o">.</span><span class="na">class</span><span class="o">);</span>
    <span class="n">c</span><span class="o">.</span><span class="na">addClass</span><span class="o">(</span><span class="n">Contact</span><span class="o">.</span><span class="na">class</span><span class="o">);</span>

    <span class="c1">// create the EbeanServer instance</span>
    <span class="k">return</span> <span class="n">EbeanServerFactory</span><span class="o">.</span><span class="na">create</span><span class="o">(</span><span class="n">c</span><span class="o">);</span>
  <span class="o">}</span>
</pre></div>
</div>

<h4>Example - Spring FactoryBean</h4>
<p>
You can write your own Spring FactoryBean like below:
</p>
<div class="syntax java"><div class="highlight"><pre><span class="cm">/**</span>
<span class="cm"> * Simple Spring bean factory for creating the EbeanServer (Database access).</span>
<span class="cm"> */</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">MyEbeanServerFactory</span> <span class="kd">implements</span> <span class="n">FactoryBean</span><span class="o">&lt;</span><span class="n">EbeanServer</span><span class="o">&gt;</span> <span class="o">{</span>


  <span class="kd">public</span> <span class="n">EbeanServer</span> <span class="nf">getObject</span><span class="o">()</span> <span class="kd">throws</span> <span class="n">Exception</span> <span class="o">{</span>

    <span class="k">return</span> <span class="nf">createEbeanServer</span><span class="o">();</span>
  <span class="o">}</span>

  <span class="kd">public</span> <span class="n">Class</span><span class="o">&lt;?&gt;</span> <span class="n">getObjectType</span><span class="o">()</span> <span class="o">{</span>
    <span class="k">return</span> <span class="n">EbeanServer</span><span class="o">.</span><span class="na">class</span><span class="o">;</span>
  <span class="o">}</span>

  <span class="kd">public</span> <span class="kt">boolean</span> <span class="nf">isSingleton</span><span class="o">()</span> <span class="o">{</span>
    <span class="k">return</span> <span class="kc">true</span><span class="o">;</span>
  <span class="o">}</span>

  <span class="cm">/**</span>
<span class="cm">   * Create a EbeanServer instance.</span>
<span class="cm">   */</span>
  <span class="kd">private</span> <span class="n">EbeanServer</span> <span class="nf">createEbeanServer</span><span class="o">()</span> <span class="o">{</span>

    <span class="c1">// programmatically create a EbeanServer instance</span>
    <span class="o">...</span>
  <span class="o">}</span>
<span class="o">}</span>
</pre></div>
</div>
<h4>Ebean Spring</h4>
<p>
Alternatively you can use the avaje-ebeanorm-spring.  TODO: more info here
</p>


<h4>Example - Typical @Inject use</h4>
<p>
In your service objects you <code>@Inject</code> or <code>@Autowire</code> a EbeanServer instance.
</p>
<div class="syntax java"><div class="highlight"><pre><span class="o">...</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">MyService</span> <span class="o">{</span>

  <span class="kd">final</span> <span class="n">EbeanServer</span> <span class="n">ebeanServer</span><span class="o">;</span>

  <span class="cm">/**</span>
<span class="cm">   * Constructor injection example ...</span>
<span class="cm">   */</span>
  <span class="nd">@Inject</span>
  <span class="kd">public</span> <span class="nf">MyService</span><span class="o">(</span><span class="n">EbeanServer</span> <span class="n">ebeanServer</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">this</span><span class="o">.</span><span class="na">ebeanServer</span> <span class="o">=</span> <span class="n">ebeanServer</span><span class="o">;</span>
  <span class="o">}</span>

  <span class="cm">/**</span>
<span class="cm">   * Some example ... using the EbeanServer instance.</span>
<span class="cm">   */</span>
  <span class="kd">public</span> <span class="kt">void</span> <span class="nf">processOrders</span><span class="o">(</span><span class="n">Date</span> <span class="n">since</span><span class="o">)</span> <span class="o">{</span>

    <span class="c1">// fetch ...</span>
    <span class="n">List</span><span class="o">&lt;</span><span class="n">Order</span><span class="o">&gt;</span> <span class="n">newOrders</span> <span class="o">=</span> <span class="n">ebeanServer</span><span class="o">.</span><span class="na">find</span><span class="o">(</span><span class="n">Order</span><span class="o">.</span><span class="na">class</span><span class="o">)</span>
       <span class="o">.</span><span class="na">where</span><span class="o">()</span>
         <span class="o">.</span><span class="na">eq</span><span class="o">(</span><span class="s">&quot;status&quot;</span><span class="o">,</span> <span class="n">Order</span><span class="o">.</span><span class="na">Status</span><span class="o">.</span><span class="na">NEW</span><span class="o">)</span>
         <span class="o">.</span><span class="na">gt</span><span class="o">(</span><span class="s">&quot;orderDate&quot;</span><span class="o">,</span> <span class="n">since</span><span class="o">)</span>
       <span class="o">.</span><span class="na">findList</span><span class="o">();</span>

    <span class="o">...</span>

    <span class="c1">// save ...</span>
    <span class="n">ebeanServer</span><span class="o">.</span><span class="na">save</span><span class="o">(</span><span class="n">order</span><span class="o">);</span>

  <span class="o">}</span>

<span class="o">}</span>
</pre></div>
</div>

<h2 id="play_active_record">Ebean Model / Active Record</h2>

<p>
When you create your entity beans extend the Model object and add a Finder. When your entity beans extend the Model object they
inherit some convenience methods save(), delete() etc. Adding a Finder as a public static field provides a nice way to get
query functionality.
</p>


<p>
  Use the Model MappedSuperclass to add insert(), update(), delete() etc convenience methods to your entity beans.
  This results in a clean programming style made popular by use in the Play framework. The Model and Finder objects
  have now been incorporated into Ebean to support this programming style.
</p>

<h4>Extend Model, add Finder:</h4>

<p>Ebean provides <a href="http://127.0.0.1:4000/apidocs/com/avaje/ebean/Model.html">Model</a> that provides convenience methods for inserting, updating and deleting beans.</p>

<p>It is a @MappedSuperclass base class.  To use it, you have your entity beans extend it, and it provides am 'Active Record' style programming model for you entities.</p>

<p>There is a avaje-ebeanorm-mocker project that enables you to use Mockito or similar tools to still mock out the underlying 'default EbeanServer' for testing purposes.</p>

<p>You may choose not use this Model mapped superclass if you don't like the 'Active Record' style or if you believe it 'pollutes' your entity beans.</p>

 <p>If you choose to use the Model mapped superclass you will probably also chose to additionally add a Finder as a public static field to complete the active record pattern and provide a relatively nice clean way to write queries.</p>


<p>
NOTE: Model is annotated with JPA @MappedSuperclass.  It internally makes use of the Ebean singleton in order to
provide the save, delete etc methods. View the source code for <a href='https://github.com/ebean-orm/avaje-ebeanorm/blob/play/src/main/java/com/avaje/ebean/Model.java'>Model here</a>.
<p>

<p>
  Ebean Model provides convenience methods related to the entity. Here is a subset of them:
  <ul>
    <li>save() - Saves the entity</li>
    <li>update() - Update the entity</li>
    <li>insert() - Insert the entity</li>
    <li>delete() - Delete the entity</li>
    <li>refresh() - Refreshes the entity from the database</li>
    <li>markAsDirty() - this is used so that when a bean that is otherwise unmodified is updated the version property is updated</li>
    <li>update(String server) - Update the entity using the specified Ebean server</li>
    <li>insert(String server)- Insert the entity using the specified server</li>
    <li>delete(String server)- Delete the entity using the specified server</li>
  </ul>

  The Ebean Model also makes it easy for you to define a Finder in your extended class. See the example:
<div class="syntax java"><div class="highlight"><pre><span class="cm">/**</span>
<span class="cm"> * Extend Model to get the save(), delete() etc</span>
<span class="cm"> * methods on the bean itself (active record style).</span>
<span class="cm"> */</span>
<span class="nd">@Entity</span>
<span class="nd">@Table</span><span class="o">(</span><span class="n">name</span><span class="o">=</span><span class="s">&quot;be_customer&quot;</span><span class="o">)</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">Customer</span> <span class="kd">extends</span> <span class="n">Model</span> <span class="o">{</span>


  <span class="c1">// Create a static Finder</span>
  <span class="kd">public</span> <span class="kd">static</span> <span class="n">Finder</span><span class="o">&lt;</span><span class="n">Long</span><span class="o">,</span><span class="n">Customer</span><span class="o">&gt;</span> <span class="n">find</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Finder</span><span class="o">&lt;</span><span class="n">Long</span><span class="o">,</span><span class="n">Customer</span><span class="o">&gt;(</span><span class="n">Long</span><span class="o">.</span><span class="na">class</span><span class="o">,</span> <span class="n">Customer</span><span class="o">.</span><span class="na">class</span><span class="o">);</span>

  <span class="nd">@Id</span>
  <span class="n">Long</span> <span class="n">id</span><span class="o">;</span>

  <span class="n">String</span> <span class="n">name</span><span class="o">;</span>

  <span class="n">Date</span> <span class="n">registered</span><span class="o">;</span>

  <span class="n">String</span> <span class="n">comments</span><span class="o">;</span>

  <span class="o">...</span>
</pre></div>
</div>
</p><p>
The Finder provides convenience methods querying.
</p>

<h4>Example: save</h4>
<div class="syntax java"><div class="highlight"><pre>    <span class="n">Customer</span> <span class="n">customer</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Customer</span><span class="o">();</span>
    <span class="n">customer</span><span class="o">.</span><span class="na">setName</span><span class="o">(</span><span class="s">&quot;Rob&quot;</span><span class="o">);</span>

    <span class="n">customer</span><span class="o">.</span><span class="na">save</span><span class="o">();</span>
</pre></div>
</div>

<h4>Example: find.byId</h4>
<div class="syntax java"><div class="highlight"><pre>    <span class="n">Customer</span> <span class="n">customer</span> <span class="o">=</span> <span class="n">Customer</span><span class="o">.</span><span class="na">find</span><span class="o">.</span><span class="na">byId</span><span class="o">(</span><span class="n">customer</span><span class="o">.</span><span class="na">getId</span><span class="o">());</span>
</pre></div>
</div>

<h4>Example: find.where</h4>
<div class="syntax java"><div class="highlight"><pre>    <span class="n">List</span><span class="o">&lt;</span><span class="n">Customer</span><span class="o">&gt;</span> <span class="n">customers</span> <span class="o">=</span>
        <span class="n">Customer</span><span class="o">.</span><span class="na">find</span><span class="o">.</span>
          <span class="nf">where</span><span class="o">().</span><span class="na">ilike</span><span class="o">(</span><span class="s">&quot;name&quot;</span><span class="o">,</span> <span class="s">&quot;rob%&quot;</span><span class="o">)</span>
          <span class="o">.</span><span class="na">findList</span><span class="o">();</span>
</pre></div>
</div>

Use code completion in your favorite ide or see <a href="/apidocs/com/avaje/ebean/Model.html">Model</a> and <a href="/apidocs/com/avaje/ebean/Model.Finder.html">Model.Finder</a> classes for more details.



</p>


<h2 id="ebean_singleton">Ebean singleton</h2>
<p>
Use the Ebean singleton object. Similar to the Play / Active record style but you don't use the Ebean specific
Model and Finder objects in your model.
</p>
<p>
The core API is provided by <code>EbeanServer</code>.  The <code>Ebean</code> singleton provides a convienience for using the 'default' or 'primary'
EbeanServer.
</p>
<p>
A <code>ebean.properties</code> file is used to control how the EbeanServer instance is configured.
</p>

<h4>Example:</h4>
<div class="syntax java"><div class="highlight"><pre><span class="c1">// get the &#39;default&#39; or &#39;primary&#39; EbeanServer instance</span>
<span class="n">EbeanServer</span> <span class="n">defaultServer</span> <span class="o">=</span> <span class="n">Ebean</span><span class="o">.</span><span class="na">getServer</span><span class="o">(</span><span class="kc">null</span><span class="o">);</span>


<span class="c1">// get an EbeanServer instance that uses a different database</span>
<span class="n">EbeanServer</span> <span class="n">defaultServer</span> <span class="o">=</span> <span class="n">Ebean</span><span class="o">.</span><span class="na">getServer</span><span class="o">(</span><span class="s">&quot;humanresources&quot;</span><span class="o">);</span>
</pre></div>
</div>

<p>
The Ebean singleton provides convienience methods:
</p>

<h4>Example:</h4>
<div class="syntax java"><div class="highlight"><pre><span class="n">Ebean</span><span class="o">.</span><span class="na">save</span><span class="o">(</span><span class="n">customer</span><span class="o">);</span>

<span class="c1">// is the Similar to ...</span>

<span class="n">EbeanServer</span> <span class="n">defaultServer</span> <span class="o">=</span> <span class="n">Ebean</span><span class="o">.</span><span class="na">getServer</span><span class="o">(</span><span class="kc">null</span><span class="o">);</span>
<span class="n">defaultServer</span><span class="o">.</span><span class="na">save</span><span class="o">(</span><span class="n">customer</span><span class="o">);</span>
</pre></div>
</div>


</div>
</div> <!-- ./row -->

</div>

    </div>

    <div class="col-md-3" role="complementary">
      <nav class="bs-docs-sidebar hidden-print hidden-xs hidden-sm">
        <ul class="nav bs-docs-sidenav">


<li class="active">
  <a href="/docs/introduction">Introduction</a>
        <ul class="nav">
          <li><a href="#use_jpa_mapping">Use JPA mappings</a></li>
          <li><a href="#simple_query_language">Simple query language</a></li>
          <li><a href="#intro_save_and_delete">Save and delete</a></li>
          <li><a href="#jpa_comparison">Comparison to JPA</a></li>
          <li><a href="#ebean_does_not">Ebean does not...</a></li>
        </ul>
</li>
<li class="active">
  <a href="/docs/enhancement">Enhancement</a>

          <ul class="nav">
            <li><a href="#enhance_maven">Maven</a></li>
            <li><a href="#enhance_maven_eclipse">Eclipse + Maven</a></li>
            <li><a href="#enhance_ant">Ant</a></li>
            <li><a href="#enhance_agent">Agent</a></li>
            <li><a href="#enhance_ide">IDE enhancement</a></li>
          </ul>
</li>
<li >
  <a href="/docs/configuration">Configuration</a>
</li>
<li >
  <a href="/docs/ebean_access_patterns">Ebean access patterns</a>
</li>
<li >
  <a href="/docs/field_and_property_access">Field and property access</a>
</li>

<li >
  <a href="/docs/queries">Queries</a>
</li>
<li >
  <a href="/docs/saving">Saving</a>
</li>
<li >
  <a href="/docs/mapping">Mapping</a>
</li>
<li >
  <a href="/docs/transactions">Transactions</a>
</li>
<li >
  <a href="/docs/json">JSON</a>
</li>
<li >
  <a href="/docs/eventlisteners">Event listeners</a>
</li>
<li >
  <a href="/docs/readaudit">Read Audit</a>
</li>
<li class="active">
  <a href="/docs/changelog">Change Log</a>
</li>
<li >
  <a href="/docs/l2caching">L2 caching</a>
</li>
<li >
  <a href="/docs/testing">Testing</a>
</li>
<li >
  <a href="/docs/jvmlanguages">JVM Languages</a>
</li>

<li >
  <a href="/docs/clustering">Clustering</a>
</li>
<li >
  <a href="/docs/monitoring">Monitoring</a>
</li>
<li >
  <a href="/docs/architecture">Architecture</a>
</li>

        </ul>
          <a class="back-to-top" href="#top">
            Back to top
          </a>
      </nav>
    </div>
  </div>

</div>
<!-- /.row -->
</div>  <!-- /.container -->
  </div>
</div>

<footer id="footer">
 <div class="doc-footer">
  <ul class="doc-footer-links">
    <li><a href="/">Ebean ORM</a></li>
    <li> | </li>
    <li><a href="http://avaje-metric.github.io">Metrics</a></li>
    <li> | </li>
    <li><a href="/websitegenerator/index">Website Generator</a></li>
    <li> | </li>
    <li><a href="/jetty/index">Jetty Runnable War</a></li>
  </ul>
 </div>
</footer>

  <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.2/jquery.min.js"></script>
  <script src="/js/bootstrap.min.js"></script>
  <script src="/js/jquery.easing.min.js"></script>

  <script src="/js/json2.js"></script>
  <script src="/js/jquery.cookie.min.js"></script>
  <script src="/js/jquery.storageapi.min.js"></script>

  <script src="/js/ebean-site.js"></script>

  </body>
</html>

<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta id="layout-head" />
    <title>avaje ebean</title>
    <link rel="shortcut icon" href="/images/favicon.ico" >
    <!--<link href="/css/bootstrap.min.css" rel="stylesheet">-->
    <!-- Latest compiled and minified CSS -->
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.5/css/bootstrap.min.css">
    <link rel="stylesheet" href="/css/pygments.css" type="text/css" />
    <link rel="stylesheet" href="/css/site.css">
    <link rel="stylesheet" href="//netdna.bootstrapcdn.com/font-awesome/4.1.0/css/font-awesome.min.css">
      <!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
      <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
      <script src="https://oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>
    <![endif]-->
</head>
  <body>
  <div id="wrap">
    <div id="header">
    <div class="navbar navbar-inverse navbar-fixed-top" role="navigation">
      <div class="container">
        <div class="navbar-header">
          <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
            <span class="sr-only">Toggle navigation</span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
          </button>
          <a class="navbar-brand" href="/">Ebean ORM</a>
        </div>
        <div class="collapse navbar-collapse">
          <ul class="nav navbar-nav pull-right">
            <li ><a href="/"><span class="glyphicon glyphicon-home"></span>  Home</a></li>
            <li ><a href="/videos">Videos</a></li>
            <li ><a href="/quickstart">Quick Start</a></li>
            <li ><a href="/support">Support</a></li>
            <li class="active"><a href="/docs">Docs</a></li>
            <li ><a target="_blank" href="/apidocs">ApiDocs</a></li>
            <li ><a href="/releases">Releases</a></li>
            <li ><a target="_blank" href="https://github.com/ebean-orm/avaje-ebeanorm"> <i class="fa fa-github"></i> Github</a></li>
          </ul>
        </div><!--/.nav-collapse -->
      </div>
    </div>

  </div>
  <div id="main" data-offset="60">
<div class="jumbotron mini">
  <div class="container">
    <h1><a href="/docs">Documentation</a> / Field and property access </h1>
  </div>
</div>

<div class="container doc-index bs-docs-container">

  <div class="row">

    <div class="col-md-9" role="main">

      <div class="bs-docs-section">
<h1 id="field_and_property_access">Field and property access</h1>
<p>Field and Property access are the two ways in which a field/property is
managed/intercepted. What this means is that the ORM needs to intercept the reading or
writing of either Fields or Properties.
</p><p>
An ORM does this interception to provide lazy loading and dirty checking functionality and
an ORM achieves this using either Enhancement or Subclass generation (Subclass
generation is also referred to as "Proxy classes").
</p><p>
To explain Field Access and Property Access I'll use an example focusing on a single field
(in this case "firstName") and how Property Access and Field Acccess works in Ebean.

<div class="syntax java"><div class="highlight"><pre><span class="o">...</span>
<span class="nd">@Entity</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">Person</span> <span class="o">{</span>

  <span class="nd">@Id</span>
  <span class="kt">int</span> <span class="n">id</span><span class="o">;</span>
  <span class="n">String</span> <span class="n">firstName</span><span class="o">;</span>
  <span class="n">String</span> <span class="n">lastName</span><span class="o">;</span>

  <span class="o">...</span>

  <span class="c1">// An extra method... NOT a getter...</span>
  <span class="c1">// here to highlight the difference between</span>
  <span class="c1">// Field and Property Access</span>
  <span class="kd">public</span> <span class="n">String</span> <span class="nf">getFullName</span><span class="o">()</span> <span class="o">{</span>
    <span class="k">return</span> <span class="n">firstName</span> <span class="o">+</span> <span class="s">&quot; &quot;</span> <span class="o">+</span> <span class="n">lastName</span><span class="o">;</span>
  <span class="o">}</span>

  <span class="kd">public</span> <span class="n">String</span> <span class="nf">getFirstName</span><span class="o">()</span> <span class="o">{</span>
    <span class="k">return</span> <span class="n">firstName</span><span class="o">;</span>
  <span class="o">}</span>

  <span class="kd">public</span> <span class="kt">void</span> <span class="nf">setFirstName</span><span class="o">(</span><span class="n">String</span> <span class="n">firstName</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">this</span><span class="o">.</span><span class="na">firstName</span> <span class="o">=</span> <span class="n">firstName</span><span class="o">;</span>
  <span class="o">}</span>

  <span class="c1">// getters and setters for id and lastName not shown...</span>
  <span class="o">...</span>
</pre></div>
</div>

<h2 id="property_access">Property access</h2>
<p>By "Property" we really mean a Java Bean Property. In the case of the "firstName"
property this means the related getter and setter methods of getFirstName() and
setFirstName(...). Refer to the Java Bean naming convention for clarification.
</p><p>
With Property Access you MUST have a setter and a getter.
</p><p>
With Property Access ONLY the getter and setter are intercepted. If you use the field in
other methods then access to that field is not intercepted/managed (See the
getFullName() method as an example).

<h4>Property Access with Ebean</h4>

<div class="syntax java"><div class="highlight"><pre>  <span class="o">...</span>
  <span class="kd">public</span> <span class="n">String</span> <span class="nf">getFullName</span><span class="o">()</span> <span class="o">{</span>
    <span class="c1">// not getter or setter so NOT intercepted...</span>
    <span class="k">return</span> <span class="n">firstName</span><span class="o">+</span><span class="s">&quot; &quot;</span><span class="o">+</span> <span class="n">lastName</span><span class="o">;</span>
  <span class="o">}</span>
  <span class="kd">public</span> <span class="n">String</span> <span class="nf">getFirstName</span><span class="o">()</span> <span class="o">{</span>
    <span class="n">_ebean_intercept</span><span class="o">.</span><span class="na">preGetter</span><span class="o">(</span><span class="s">&quot;firstName&quot;</span><span class="o">);</span>
    <span class="k">return</span> <span class="n">firstName</span><span class="o">;</span>
  <span class="o">}</span>
  <span class="kd">public</span> <span class="kt">void</span> <span class="nf">setFirstName</span><span class="o">(</span><span class="n">String</span> <span class="n">newValue</span><span class="o">)</span> <span class="o">{</span>
    <span class="n">_ebean_intercept</span><span class="o">.</span><span class="na">preSetter</span><span class="o">(</span><span class="s">&quot;firstName&quot;</span><span class="o">,</span> <span class="n">newValue</span><span class="o">,</span> <span class="n">getFirstName</span><span class="o">());</span>
    <span class="k">this</span><span class="o">.</span><span class="na">firstName</span> <span class="o">=</span> <span class="n">newValue</span><span class="o">;</span>
  <span class="o">}</span>
</pre></div>
</div>

<p>
This is an example of how Ebean modifies/generates code to support "property access"
</p><p>
The modified/generated class now has a _ebean_intercept field.
</p><p>
In calling getName() the preGetter() method is called on the intercept field and this will invoke lazy loading if required.
</p><p>
In calling setName() getName() is called which in turn can invoke lazy loading. The
getName() returns the "Old Value" / "Previous Value" of the name. The preSetter() method
is called on the intercept and will maintain the "Dirty Checking" information.
</p><p>
If your entity beans just have getter and setter methods they are well suited to property
access. From a design perspective they may also be called "Anemic" in the sense that
they don't have any logic and can almost be viewed as pure data.

<h2 id="field_access">Field access</h2>
<p>Field access in general is implemented via bytecode Enhancement (Also refered to as Weaving and Transformation).
/p><p>
The class bytes are modified replacing the GETFIELD and PUTFIELD bytecode calls to
"persistent fields" with method calls.
</p><p>
With Ebean Field access looks something like this... (note: other ORMs could generate
quite different code)

<div class="syntax java"><div class="highlight"><pre>  <span class="kd">public</span> <span class="n">String</span> <span class="nf">getFullName</span><span class="o">()</span> <span class="o">{</span>
    <span class="c1">// GETFIELD firstName replaced...</span>
    <span class="k">return</span> <span class="nf">_ebean_getFirstName</span><span class="o">()+</span><span class="s">&quot; &quot;</span><span class="o">+</span><span class="n">_ebean_getLastName</span><span class="o">();</span>
  <span class="o">}</span>
  <span class="kd">public</span> <span class="n">String</span> <span class="nf">getFirstName</span><span class="o">()</span> <span class="o">{</span>
    <span class="c1">// GETFIELD firstName replaced</span>
    <span class="k">return</span> <span class="nf">_ebean_getFirstName</span><span class="o">();</span>
  <span class="o">}</span>
  <span class="kd">public</span> <span class="kt">void</span> <span class="nf">setFirstName</span><span class="o">(</span><span class="n">String</span> <span class="n">newValue</span><span class="o">)</span> <span class="o">{</span>
    <span class="c1">// PUTFIELD firstName replaced</span>
    <span class="n">_ebean_setFirstName</span><span class="o">(</span><span class="n">newValue</span><span class="o">);</span>
  <span class="o">}</span>

  <span class="c1">// new method generated by Ebean</span>
  <span class="c1">// used to replace GETFIELD firstName</span>
  <span class="n">String</span> <span class="nf">_ebean_getFirstName</span><span class="o">()</span> <span class="o">{</span>
    <span class="n">_ebean_intercept</span><span class="o">.</span><span class="na">preGetter</span><span class="o">(</span><span class="s">&quot;firstName&quot;</span><span class="o">);</span>
    <span class="k">return</span> <span class="k">this</span><span class="o">.</span><span class="na">firstName</span><span class="o">;</span>
  <span class="o">}</span>

  <span class="c1">// new method generated by Ebean</span>
  <span class="c1">// used to replace PUTFIELD firstName</span>
  <span class="kt">void</span> <span class="nf">_ebean_setFirstName</span><span class="o">(</span><span class="n">String</span> <span class="n">newValue</span><span class="o">)</span> <span class="o">{</span>
    <span class="n">String</span> <span class="n">currentValue</span> <span class="o">=</span> <span class="n">_ebean_getFirstName</span><span class="o">();</span>
    <span class="n">_ebean_intercept</span><span class="o">.</span><span class="na">preSetter</span><span class="o">(</span><span class="s">&quot;firstName&quot;</span><span class="o">,</span> <span class="n">newValue</span><span class="o">,</span> <span class="n">currentValue</span><span class="o">);</span>
    <span class="k">this</span><span class="o">.</span><span class="na">firstName</span> <span class="o">=</span> <span class="n">newValue</span><span class="o">;</span>
  <span class="o">}</span>
</pre></div>
</div>
</p><p>
With Field access it actually doesn't matter where the field is used the GETFIELD and
PUTFIELD byte code instructions are replaced. It is important to note that in the example
above the getFullName() method is also modified to support the interception/mangement
by the ORM.
</p><p>
Unlike property access field access does not require the getter or setter to even exist â€“
they can be removed if you want.
Essentially with Field access you can write whatever code you like (within reason) and it
will behave as expected (ORM interception occuring as and how you would expect).
</p>


<h2 id="field_vs_property_access">Ebean â€“ Field vs Property access</h2>

<p>...(under construction)... this documentation needs reworked due to ebean no longer supporting subclassing</p>

<p>
With JPA you choose between field or property access on a per field / property basis. If
you put the annotation on the field this implies that you want field access and if you put
the annotation on the associated getter method of the property then you should get
property access.
</p><p>
Ebean does not work this way!!!
</p>

<p>Ebean has not followed the JPA approach. With Ebean you get Field Access when you
use Enhancement and you get Property Access when you use Subclassing.
</p><p>
The reason for this comes down to...
<ul>
  <li>Keeping things simple</li>
  <li>Field Access is the preferred approach</li>
  <li>Subclassing approach introduces security / visibility issues for Field Access</li>
</ul>
</p><p>
There are a few downsides to Field Access.
  <ul>
    <li>Serialization: Your entity beans now include and depend on Ebean objects. Where you
deserialize them you will need some Ebean classes in you class path.</li>
    <li>Using javaagent or one of the build time enhancement methods can an be a pain. Ebean
has tried to make this as simple and robust as possible.</li>
    <li>Java Web Start does not support javaagent. However, you can enhance the
classes at build time.</li>
  </ul>
</p>

<h4>Ebean interception notes</h4>
<p><b>Id Interception</b></p>
<p>Id fields/properties are not intercepted ever (either for reading or writing). That is, getting
or setting an ID will never invoke lazy loading or cause the entity to be marked as dirty.</p>

<p><b>OneToMany and ManyToMany Interception</b></p>
<p>
The List Set and Map persistent properties are not intercepted when they are being set.
That is, setting a associated many property does not invoke lazy loading or mark the entity
as dirty.
</p><p>
When you get a entity back from a query every associated many property (List Set or
Map) will have a 'proxy' in place. It is not until you invoke a method on the List Set or Map
proxy that lazy loading of that proxy will occur.
</p><p>
A reference object (obtained by Ebean.getReference()) will lazy load the entity bean if a
List Set or Map associated many property is read (via getter etc).

<p><b>toString() interception</b></p>
<p>
No interception is invoked by a toString() method. The reason for this decision is that
toString() is often invoked by an IDE while running a debugger â€“ in the past this has lead
to confusion to have lazy loading being invoked accidentally in this fashion.
</p>

<p><b>equals() and hashCode() generation</b></p>
<p>
If your entity bean does not have a equals() or hashCode() method then one will be
generated for you based on the identity property using the "" technique.
The generated equals() or hashCode() methods do not invoke lazy loading.
</p>
<p><b>@Transient on methods</b></p>
<p>If you are using Ebean enhancement (Field Access) then you can put the @Transient
annotation on a method and it is NOT intercepted. Specifically the method is left exactly
as it is (rather than having the GETFIELD PUTFIELD byte codes replaced with
intercepted method calls).
</p><p>
This is an Ebean extension to the JPA spec. This enables you to write a method on an
entity bean that you know will not have its field access intercepted.
</p>



<p>Q: JPA supports the mixing of Field and Property access on the same entity bean. Will
Ebean look to support this?
</p><p>
A: No. If you can do field access then you should. On the web there is mention of benefits
to using Property access such as performance and type conversion benefits. None of
these apply to Ebean.
</p><p>
Q: How does the enhancement work for with Groovy or Scala entity beans?
</p><p>
A: You can use Ebean enhancement on Groovy or Scala beans. Note this includes
support for Scala's properties (which don't follow the Java Bean Spec getter setter method
naming conventions). Ebean can tell if it is a Groovy bean or Scala bean and take that into
account as needed.
</p>
</div>

    </div>

    <div class="col-md-3" role="complementary">
      <nav class="bs-docs-sidebar hidden-print hidden-xs hidden-sm">
        <ul class="nav bs-docs-sidenav">


<li class="active">
  <a href="/docs/introduction">Introduction</a>
        <ul class="nav">
          <li><a href="#use_jpa_mapping">Use JPA mappings</a></li>
          <li><a href="#simple_query_language">Simple query language</a></li>
          <li><a href="#intro_save_and_delete">Save and delete</a></li>
          <li><a href="#jpa_comparison">Comparison to JPA</a></li>
          <li><a href="#ebean_does_not">Ebean does not...</a></li>
        </ul>
</li>
<li class="active">
  <a href="/docs/enhancement">Enhancement</a>

          <ul class="nav">
            <li><a href="#enhance_maven">Maven</a></li>
            <li><a href="#enhance_maven_eclipse">Eclipse + Maven</a></li>
            <li><a href="#enhance_ant">Ant</a></li>
            <li><a href="#enhance_agent">Agent</a></li>
            <li><a href="#enhance_ide">IDE enhancement</a></li>
          </ul>
</li>
<li >
  <a href="/docs/configuration">Configuration</a>
</li>
<li >
  <a href="/docs/ebean_access_patterns">Ebean access patterns</a>
</li>
<li >
  <a href="/docs/field_and_property_access">Field and property access</a>
</li>

<li >
  <a href="/docs/queries">Queries</a>
</li>
<li >
  <a href="/docs/saving">Saving</a>
</li>
<li >
  <a href="/docs/mapping">Mapping</a>
</li>
<li >
  <a href="/docs/transactions">Transactions</a>
</li>
<li >
  <a href="/docs/json">JSON</a>
</li>
<li >
  <a href="/docs/eventlisteners">Event listeners</a>
</li>
<li >
  <a href="/docs/readaudit">Read Audit</a>
</li>
<li class="active">
  <a href="/docs/changelog">Change Log</a>
</li>
<li >
  <a href="/docs/l2caching">L2 caching</a>
</li>
<li >
  <a href="/docs/testing">Testing</a>
</li>
<li >
  <a href="/docs/jvmlanguages">JVM Languages</a>
</li>

<li >
  <a href="/docs/clustering">Clustering</a>
</li>
<li >
  <a href="/docs/monitoring">Monitoring</a>
</li>
<li >
  <a href="/docs/architecture">Architecture</a>
</li>

        </ul>
          <a class="back-to-top" href="#top">
            Back to top
          </a>
      </nav>
    </div>
  </div>

</div>
<!-- /.row -->
</div>  <!-- /.container -->
  </div>
</div>

<footer id="footer">
 <div class="doc-footer">
  <ul class="doc-footer-links">
    <li><a href="/">Ebean ORM</a></li>
    <li> | </li>
    <li><a href="http://avaje-metric.github.io">Metrics</a></li>
    <li> | </li>
    <li><a href="/websitegenerator/index">Website Generator</a></li>
    <li> | </li>
    <li><a href="/jetty/index">Jetty Runnable War</a></li>
  </ul>
 </div>
</footer>

  <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.2/jquery.min.js"></script>
  <script src="/js/bootstrap.min.js"></script>
  <script src="/js/jquery.easing.min.js"></script>

  <script src="/js/json2.js"></script>
  <script src="/js/jquery.cookie.min.js"></script>
  <script src="/js/jquery.storageapi.min.js"></script>

  <script src="/js/ebean-site.js"></script>

  </body>
</html>

<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta id="layout-head" />
    <title>avaje ebean</title>
    <link rel="shortcut icon" href="/images/favicon.ico" >
    <!--<link href="/css/bootstrap.min.css" rel="stylesheet">-->
    <!-- Latest compiled and minified CSS -->
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.5/css/bootstrap.min.css">
    <link rel="stylesheet" href="/css/pygments.css" type="text/css" />
    <link rel="stylesheet" href="/css/site.css">
    <link rel="stylesheet" href="//netdna.bootstrapcdn.com/font-awesome/4.1.0/css/font-awesome.min.css">
      <!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
      <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
      <script src="https://oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>
    <![endif]-->
</head>
  <body>
  <div id="wrap">
    <div id="header">
    <div class="navbar navbar-inverse navbar-fixed-top" role="navigation">
      <div class="container">
        <div class="navbar-header">
          <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
            <span class="sr-only">Toggle navigation</span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
          </button>
          <a class="navbar-brand" href="/">Ebean ORM</a>
        </div>
        <div class="collapse navbar-collapse">
          <ul class="nav navbar-nav pull-right">
            <li ><a href="/"><span class="glyphicon glyphicon-home"></span>  Home</a></li>
            <li ><a href="/videos">Videos</a></li>
            <li ><a href="/quickstart">Quick Start</a></li>
            <li ><a href="/support">Support</a></li>
            <li class="active"><a href="/docs">Docs</a></li>
            <li ><a target="_blank" href="/apidocs">ApiDocs</a></li>
            <li ><a href="/releases">Releases</a></li>
            <li ><a target="_blank" href="https://github.com/ebean-orm/avaje-ebeanorm"> <i class="fa fa-github"></i> Github</a></li>
          </ul>
        </div><!--/.nav-collapse -->
      </div>
    </div>

  </div>
  <div id="main" data-offset="60">
<div class="jumbotron mini">
  <div class="container">
    <h1><a href="/docs">Documentation</a> / Queries </h1>
  </div>
</div>

<div class="container doc-index bs-docs-container">

  <div class="row">

    <div class="col-md-9" role="main">

      <div class="bs-docs-section">
  <h1 id="queries">Queries</h1>

  <div class="syntax java"><div class="highlight"><pre>  <span class="c1">// find by id</span>
  <span class="n">Order</span> <span class="n">order</span> <span class="o">=</span> <span class="n">Ebean</span><span class="o">.</span><span class="na">find</span><span class="o">(</span><span class="n">Order</span><span class="o">.</span><span class="na">class</span><span class="o">,</span> <span class="mi">12</span><span class="o">);</span>
  
</pre></div>
</div>
  executes the sql:
  <div class="syntax sql"><div class="highlight"><pre>  <span class="k">select</span> <span class="n">o</span><span class="p">.</span><span class="n">id</span><span class="p">,</span> <span class="n">o</span><span class="p">.</span><span class="n">order_date</span><span class="p">,</span> <span class="n">o</span><span class="p">.</span><span class="n">ship_date</span><span class="p">,</span> <span class="n">o</span><span class="p">.</span><span class="n">cretime</span><span class="p">,</span> <span class="n">o</span><span class="p">.</span><span class="n">updtime</span><span class="p">,</span> <span class="n">o</span><span class="p">.</span><span class="n">status_code</span><span class="p">,</span> <span class="n">o</span><span class="p">.</span><span class="n">customer_id</span>
  <span class="k">from</span> <span class="n">or_order</span> <span class="n">o</span>
  <span class="k">where</span> <span class="k">or</span><span class="p">.</span><span class="n">id</span> <span class="o">=</span> <span class="o">?</span>
  
</pre></div>
</div>

  <div class="syntax java"><div class="highlight"><pre>  <span class="c1">// these are the same</span>
    <span class="n">Query</span><span class="o">&lt;</span><span class="n">Order</span><span class="o">&gt;</span> <span class="n">query</span> <span class="o">=</span> <span class="n">Ebean</span><span class="o">.</span><span class="na">createQuery</span><span class="o">(</span><span class="n">Order</span><span class="o">.</span><span class="na">class</span><span class="o">);</span>
    <span class="n">Query</span><span class="o">&lt;</span><span class="n">Order</span><span class="o">&gt;</span> <span class="n">query</span> <span class="o">=</span> <span class="n">Ebean</span><span class="o">.</span><span class="na">find</span><span class="o">(</span><span class="n">Order</span><span class="o">.</span><span class="na">class</span><span class="o">);</span>
      
</pre></div>
</div>
      These two methods do exactly the same thing. The reason both
      exist is because the createQuery() style is consistent with JPA and could be argued is a
      better more accurate name. And find() is more consistent with the fluid API style.

  <div class="syntax java"><div class="highlight"><pre>  <span class="c1">// fluid API style with find()</span>
  <span class="n">List</span><span class="o">&lt;</span><span class="n">Order</span><span class="o">&gt;</span> <span class="n">list</span> <span class="o">=</span>
    <span class="n">Ebean</span><span class="o">.</span><span class="na">find</span><span class="o">(</span><span class="n">Order</span><span class="o">.</span><span class="na">class</span><span class="o">)</span>
    <span class="o">.</span><span class="na">fetch</span><span class="o">(</span><span class="s">&quot;customer&quot;</span><span class="o">)</span>
    <span class="o">.</span><span class="na">where</span><span class="o">().</span><span class="na">eq</span><span class="o">(</span><span class="s">&quot;status.code&quot;</span><span class="o">,</span> <span class="s">&quot;SHIPPED&quot;</span><span class="o">)</span>
    <span class="o">.</span><span class="na">findList</span><span class="o">();</span>
    
</pre></div>
</div>

        <h2 id="where_clause">Where clause</h2>

        <p>
          You can specify 'predicates' for the where clause.
        </p>

  <div class="syntax java"><div class="highlight"><pre>  <span class="c1">// find all the orders shipped since a week ago</span>
  <span class="n">List</span><span class="o">&lt;</span><span class="n">Order</span><span class="o">&gt;</span> <span class="n">list</span> <span class="o">=</span> <span class="n">Ebean</span><span class="o">.</span><span class="na">find</span><span class="o">(</span><span class="n">Order</span><span class="o">.</span><span class="na">class</span><span class="o">)</span>
    <span class="o">.</span><span class="na">where</span><span class="o">()</span>
    <span class="o">.</span><span class="na">eq</span><span class="o">(</span><span class="s">&quot;status&quot;</span><span class="o">,</span> <span class="n">Order</span><span class="o">.</span><span class="na">Status</span><span class="o">.</span><span class="na">SHIPPED</span><span class="o">)</span>
    <span class="o">.</span><span class="na">gt</span><span class="o">(</span><span class="s">&quot;shipDate&quot;</span><span class="o">,</span> <span class="n">lastWeek</span><span class="o">)</span>
    <span class="o">.</span><span class="na">findList</span><span class="o">();</span>
    
</pre></div>
</div>

          <h4>Example Predicates</h4>
          <ul>
            <li>eq(...) = equals</li>
            <li>ne(...) = not equals
            <li>
            <li>ieq(...) = case insensitve equals</li>
            <li>between(...) = between</li>
            <li>gt(...) = greater than</li>
            <li>ge(...) = greater than or equals</li>
            <li>lt(...) = less than or equals</li>
            <li>le(...) = less than or equals</li>
            <li>isNull(...) = is null</li>
            <li>isNotNull(...) = is not null</li>
            <li>like(...) = like</li>
            <li>startsWith(...) = string starts with</li>
            <li>endswith(...) = string ends with</li>
            <li>contains(...) = string conains</li>
            <li>in(...) = in a subquery, collection or array</li>
            <li>exists(...) = at least one row exists in a subquery</li>
            <li>notExists(...) = no row exists in a subquery</li>
            <li>more...</li>
          </ul>
          <p>
            Use code completion in your favorite ide or see <a href="/apidocs/com/avaje/ebean/ExpressionList.html">ExpressionList</a>
            class for more details.
          </p>


          <p>
            Ebean will automatically add SQL joins if they are required for the where clause or order by clause (and the
            matching joins are not explicitly included).
          </p>

  <div class="syntax java"><div class="highlight"><pre>  <span class="n">List</span><span class="o">&lt;</span><span class="n">Order</span><span class="o">&gt;</span> <span class="n">orders</span> <span class="o">=</span>
    <span class="n">Ebean</span><span class="o">.</span><span class="na">find</span><span class="o">(</span><span class="n">Order</span><span class="o">.</span><span class="na">class</span><span class="o">)</span>
    <span class="o">.</span><span class="na">where</span><span class="o">().</span><span class="na">ilike</span><span class="o">(</span><span class="s">&quot;customer.name&quot;</span><span class="o">,</span> <span class="s">&quot;rob%&quot;</span><span class="o">)</span>
    <span class="o">.</span><span class="na">findList</span><span class="o">();</span>
    
</pre></div>
</div>

    ... in the sql below, the join to or_customer is automatically added to support the where clause.

  <div class="syntax xml"><div class="highlight"><pre>  <span class="nt">&lt;sql</span> <span class="na">summary=</span><span class="s">&#39;[app.data.test.Order]&#39;</span><span class="nt">&gt;</span>
    select o.id, o.order_date, o.ship_date, o.cretime, o.updtime, o.status_code, o.customer_id
    from or_order o
    join or_customer c on o.customer_id = c.id
    where lower(c.name) like ?
  <span class="nt">&lt;/sql&gt;</span>
      
</pre></div>
</div>

<h2 id="query_language">Ebean query language</h2>

<p>Ebean has it's own query language. Prior to this decision JPQL (the JPA query language)
  was investigated to see if it would meet the desired goals of Ebean and it did not.
  Specifically the desire for Ebean is to support "Partial Objects" via the query language and it is
  difficult to
  see how JPQL will evolve to support this (specifically difficulties around its select clause).
</p>

<p>
  Apart from "Partial Object" support there was also a desire to simplify the join syntax,
  specifically Ebean will automatically determine the type of join (outer join etc) for you and
  also automatically add joins to support predicates and order by clauses.
</p>

<p>
  JPQL is more powerful with the ability to mix entity beans with scalar values returning
  Object[]. However, this feature also could be a major stumbling block for it to evolve
  support for partial objects for any node in the object graph.
</p>

<p>
  In summary you could say the Ebean query language is much simplier that JPQL with the
  benefit of proper support for "Partial Objects" for any node in the object graph (this is not
  possible with JPQL in it's current form).
</p>

<p>
  "Partial Object" support in Ebean is important for design reasons and performance
  reasons. From a performance perspective your queries are more performant if they fetch
  less data back from the database. From a design perspective you do not need to model
  using secondary tables but instead use partial objects at any depth in the query.
</p>

<p>
  For example, to build an object graph for an Order you may want some product
  information for each orderDetail.
</p>

<p>Examples
  <div class="syntax groovy"><div class="highlight"><pre>  <span class="c1">// find all the orders fetching all the properties of order</span>
  <span class="n">find</span> <span class="n">order</span>

  <span class="c1">// find all the orders fetching all the properties of order</span>
  <span class="c1">// ... this is the same as the first query</span>
  <span class="n">find</span> <span class="nf">order</span> <span class="o">(*)</span>

  <span class="c1">// find all the orders fetching the id, orderDate and shipDate</span>
  <span class="c1">// ... This is described as a &quot;partial object query&quot;</span>
  <span class="c1">// ... the ID property is *ALWAYS* fetched</span>
  <span class="n">find</span> <span class="nf">order</span> <span class="o">(</span><span class="n">orderDate</span><span class="o">,</span> <span class="n">shipDate</span><span class="o">)</span>

  <span class="c1">// find all the orders (and orderDetails)</span>
  <span class="c1">// ... fetching all the properties of order</span>
  <span class="c1">// ... and all the properties of orderDetails</span>
  <span class="c1">// ... the type of fetch(Outer etc) is determined automatically</span>
  <span class="n">find</span> <span class="n">order</span>
  <span class="n">fetch</span> <span class="n">orderDetails</span>

  <span class="c1">// find all the orders (with their orderDetails)</span>
  <span class="c1">// ... fetching all the properties of order</span>
  <span class="c1">// ... and all the properties of orderDetails</span>
  <span class="n">find</span> <span class="nf">order</span> <span class="o">(*)</span>
  <span class="n">fetch</span> <span class="nf">orderDetails</span> <span class="o">(*)</span>

  <span class="c1">// find all the orders (with orderDetails and products)</span>
  <span class="c1">// ... fetching the order id, orderDate and shipDate</span>
  <span class="c1">// ... fetching all the properties for orderDetail</span>
  <span class="c1">// ... fetching the product id, sku and name</span>
  <span class="n">find</span> <span class="nf">order</span> <span class="o">(</span><span class="n">orderDate</span><span class="o">,</span> <span class="n">shipDate</span><span class="o">)</span>
  <span class="n">fetch</span> <span class="nf">orderDetails</span> <span class="o">(*)</span>
  <span class="n">fetch</span> <span class="n">orderDetails</span><span class="o">.</span><span class="na">product</span> <span class="o">(</span><span class="n">sku</span><span class="o">,</span> <span class="n">name</span><span class="o">)</span>
  
</pre></div>
</div>

  <div class="syntax java"><div class="highlight"><pre>  <span class="n">String</span> <span class="n">query</span> <span class="o">=</span> <span class="s">&quot;find order where status.code=:status and shipDate &gt; :shipped&quot;</span><span class="o">;</span>

  <span class="n">List</span><span class="o">&lt;</span><span class="n">Order</span><span class="o">&gt;</span> <span class="n">list</span> <span class="o">=</span> <span class="n">Ebean</span><span class="o">.</span><span class="na">find</span><span class="o">(</span><span class="n">Order</span><span class="o">.</span><span class="na">class</span><span class="o">)</span>
    <span class="o">.</span><span class="na">setQuery</span><span class="o">(</span><span class="n">query</span><span class="o">)</span>
    <span class="o">.</span><span class="na">setParameter</span><span class="o">(</span><span class="s">&quot;status&quot;</span><span class="o">,</span> <span class="n">Order</span><span class="o">.</span><span class="na">Status</span><span class="o">.</span><span class="na">SHIPPED</span><span class="o">)</span>
    <span class="o">.</span><span class="na">setParameter</span><span class="o">(</span><span class="s">&quot;shipped&quot;</span><span class="o">,</span> <span class="n">lastWeek</span><span class="o">)</span>
    <span class="o">.</span><span class="na">findList</span><span class="o">();</span>
    
</pre></div>
</div>

    <div class="syntax xml"><div class="highlight"><pre>    <span class="nt">&lt;sql</span> <span class="na">summary=</span><span class="s">&#39;[app.data.test.Order] autoFetchTuned[false]&#39;</span><span class="nt">&gt;</span>
      select o.id, o.order_date, o.ship_date, o.cretime, o.updtime, o.status_code, o.customer_id
      from or_order o
      where o.status_code = ? and o.ship_date &gt; ?
    <span class="nt">&lt;/sql&gt;</span>
    
</pre></div>
</div>


    <p>Every object in the object graph can be a partial object. This is what you can't do in JPQL
      currently.</p>

    <p>These Partially populated objects are will lazy load as required and are fully updatable etc.
      You can treat them just like fully populated objects.</p>

    <p>Autofetch can use partial objects to only fetch the properties that the application actually
      uses. In this way you can get the performance of partial objects without any work on your
      part (Autofetch determines the joins and properties to fetch for you).</p>


  <h2 id="partial_objects">Partial objects</h2>

  <p>
    The Query object has select() and fetch() methods and these allow you to specify
    the properties that should be fetched.
  </p>

  <p>This can be a very significant performance benefit by only fetching the properties you need. If
    the properties are in DB indexes then the DB doesn't have to read Index Blocks. This is also a
    design benefit in that it removes the "fixed" design constraints of using secondary table
    properties.</p>

  <p>Note that <a href="#autofetch">Autofetch</a> can use profiling to specify the properties to
    select rather than you manually doing so (which saves you the work).</p>

  <h4>Select</h4>

  <p>
    With select you specify the properties that should be fetched on the root level type.
  </p>

  <p>
    Partially loading a bean or object graph using select() and fetch().
    <div class="syntax java"><div class="highlight"><pre>    <span class="n">Customer</span> <span class="n">customer</span> <span class="o">=</span> <span class="n">Customer</span><span class="o">.</span><span class="na">find</span>
    <span class="o">.</span><span class="na">select</span><span class="o">(</span><span class="s">&quot;name&quot;</span><span class="o">)</span>
    <span class="o">.</span><span class="na">where</span><span class="o">().</span><span class="na">idEq</span><span class="o">(</span><span class="mi">1L</span><span class="o">)</span>
    <span class="o">.</span><span class="na">findUnique</span><span class="o">();</span>
    
</pre></div>
</div>

    <div class="syntax sql"><div class="highlight"><pre>    <span class="k">select</span> <span class="n">t0</span><span class="p">.</span><span class="n">id</span> <span class="n">c0</span><span class="p">,</span> <span class="n">t0</span><span class="p">.</span><span class="n">name</span> <span class="n">c1</span>
    <span class="k">from</span> <span class="n">o_customer</span> <span class="n">t0</span>
    <span class="k">where</span> <span class="n">t0</span><span class="p">.</span><span class="n">id</span> <span class="o">=</span> <span class="o">?</span> <span class="p">;</span> <span class="c1">--bind(1)</span>
    
</pre></div>
</div>
  </p>
  <h4>Fetch</h4>

  <p>
    With fetch you specify the properties that should be fetched on the associated beans.
  </p>

  <p>*ANY* node of the object graph can be a partial object. This example shows several ways partial
    objects can be fetched.

    <div class="syntax java"><div class="highlight"><pre>    <span class="n">Order</span> <span class="n">order</span> <span class="o">=</span> <span class="n">Order</span><span class="o">.</span><span class="na">find</span>
    <span class="o">.</span><span class="na">select</span><span class="o">(</span><span class="s">&quot;status, orderDate, shipDate&quot;</span><span class="o">)</span> <span class="c1">// 3 fields from order</span>
    <span class="o">.</span><span class="na">fetch</span><span class="o">(</span><span class="s">&quot;customer&quot;</span><span class="o">,</span> <span class="s">&quot;name&quot;</span><span class="o">)</span> <span class="c1">// just name field from customer</span>
    <span class="o">.</span><span class="na">fetch</span><span class="o">(</span><span class="s">&quot;details&quot;</span><span class="o">)</span> <span class="c1">// all fields from details</span>
    <span class="o">.</span><span class="na">fetch</span><span class="o">(</span><span class="s">&quot;details.product&quot;</span><span class="o">,</span> <span class="s">&quot;sku&quot;</span><span class="o">)</span> <span class="c1">// just sku field from product</span>
    <span class="o">.</span><span class="na">where</span><span class="o">().</span><span class="na">idEq</span><span class="o">(</span><span class="mi">1L</span><span class="o">)</span>
    <span class="o">.</span><span class="na">findUnique</span><span class="o">();</span>
    
</pre></div>
</div>
    <div class="syntax sql"><div class="highlight"><pre>    <span class="k">select</span> <span class="n">t0</span><span class="p">.</span><span class="n">id</span> <span class="n">c0</span><span class="p">,</span> <span class="n">t0</span><span class="p">.</span><span class="n">status</span> <span class="n">c1</span><span class="p">,</span> <span class="n">t0</span><span class="p">.</span><span class="n">order_date</span> <span class="n">c2</span><span class="p">,</span> <span class="n">t0</span><span class="p">.</span><span class="n">ship_date</span> <span class="n">c3</span><span class="p">,</span>
    <span class="n">t1</span><span class="p">.</span><span class="n">id</span> <span class="n">c4</span><span class="p">,</span> <span class="n">t1</span><span class="p">.</span><span class="n">name</span> <span class="n">c5</span><span class="p">,</span> <span class="c1">-- customer name</span>
    <span class="n">t2</span><span class="p">.</span><span class="n">id</span> <span class="n">c6</span><span class="p">,</span> <span class="n">t2</span><span class="p">.</span><span class="n">order_qty</span> <span class="n">c7</span><span class="p">,</span> <span class="n">t2</span><span class="p">.</span><span class="n">ship_qty</span> <span class="n">c8</span><span class="p">,</span> <span class="n">t2</span><span class="p">.</span><span class="n">unit_price</span> <span class="n">c9</span><span class="p">,</span> <span class="n">t2</span><span class="p">.</span><span class="k">version</span> <span class="n">c10</span><span class="p">,</span>
    <span class="n">t2</span><span class="p">.</span><span class="n">when_created</span> <span class="n">c11</span><span class="p">,</span> <span class="n">t2</span><span class="p">.</span><span class="n">when_updated</span> <span class="n">c12</span><span class="p">,</span> <span class="n">t2</span><span class="p">.</span><span class="n">order_id</span> <span class="n">c13</span><span class="p">,</span>
    <span class="n">t3</span><span class="p">.</span><span class="n">id</span> <span class="n">c14</span><span class="p">,</span> <span class="n">t3</span><span class="p">.</span><span class="n">sku</span> <span class="n">c15</span> <span class="c1">-- product sku</span>
    <span class="k">from</span> <span class="n">o_order</span> <span class="n">t0</span>
    <span class="k">join</span> <span class="n">o_customer</span> <span class="n">t1</span> <span class="k">on</span> <span class="n">t1</span><span class="p">.</span><span class="n">id</span> <span class="o">=</span> <span class="n">t0</span><span class="p">.</span><span class="n">customer_id</span>
    <span class="k">left</span> <span class="k">outer</span> <span class="k">join</span> <span class="n">o_order_detail</span> <span class="n">t2</span> <span class="k">on</span> <span class="n">t2</span><span class="p">.</span><span class="n">order_id</span> <span class="o">=</span> <span class="n">t0</span><span class="p">.</span><span class="n">id</span>
    <span class="k">left</span> <span class="k">outer</span> <span class="k">join</span> <span class="n">o_product</span> <span class="n">t3</span> <span class="k">on</span> <span class="n">t3</span><span class="p">.</span><span class="n">id</span> <span class="o">=</span> <span class="n">t2</span><span class="p">.</span><span class="n">product_id</span>
    <span class="k">where</span> <span class="n">t0</span><span class="p">.</span><span class="n">id</span> <span class="o">=</span> <span class="o">?</span>
    <span class="k">order</span> <span class="k">by</span> <span class="n">t0</span><span class="p">.</span><span class="n">id</span><span class="p">,</span> <span class="n">t2</span><span class="p">.</span><span class="n">id</span> <span class="k">asc</span><span class="p">;</span> <span class="c1">--bind(1)</span>
    
</pre></div>
</div>
  </p>

  <h4>Saving a partial object</h4>

  <p>
    You can save or delete a Partial Object.
  </p>

  <div class="syntax java"><div class="highlight"><pre>  <span class="c1">// find customer 1</span>
  <span class="c1">// ... just fetch the customer id, name and version property</span>
  <span class="n">Customer</span> <span class="n">customer</span> <span class="o">=</span> <span class="n">Ebean</span><span class="o">.</span><span class="na">find</span><span class="o">(</span><span class="n">Customer</span><span class="o">.</span><span class="na">class</span><span class="o">)</span>
  <span class="o">.</span><span class="na">select</span><span class="o">(</span><span class="s">&quot;name&quot;</span><span class="o">)</span>
  <span class="o">.</span><span class="na">where</span><span class="o">().</span><span class="na">idEq</span><span class="o">(</span><span class="mi">1</span><span class="o">)</span>
  <span class="o">.</span><span class="na">findUnique</span><span class="o">();</span>

  <span class="n">customer</span><span class="o">.</span><span class="na">setName</span><span class="o">(</span><span class="s">&quot;CoolName&quot;</span><span class="o">);</span>

  <span class="n">Ebean</span><span class="o">.</span><span class="na">save</span><span class="o">(</span><span class="n">customer</span><span class="o">);</span>
  
</pre></div>
</div>

  <p>
    The query generates the following SQL...
    <div class="syntax xml"><div class="highlight"><pre>    <span class="nt">&lt;sql</span> <span class="na">summary=</span><span class="s">&#39;[app.data.test.Customer]&#39;</span><span class="nt">&gt;</span>
      select c.id, c.name
      from or_customer c
      where c.id = ?
    <span class="nt">&lt;/sql&gt;</span>
    
</pre></div>
</div>
  </p>
  <p>and in the transaction logs we can find the update dml and bind values.</p>
  <div class="syntax xml"><div class="highlight"><pre>  ... update or_customer set name=?, updtime=? where id=? and name=?
  ... Binding Update [or_customer] set[name=CoolName, updtime=2008-11-19 10:58:08.598, ] where[id=1,
  name=Ford, ]
  ... Updated [app.data.test.Customer] [1]
  
</pre></div>
</div>

<h2 id="query_joins">Query joins</h2>
<h4>
  Controlling eager loading of the object graph using query joins.
</h4>

<p>You can use fetch() to explicitly state which additional paths you want to fetch. You would do
  this to reduce "lazy loading" of those beans later.</p>

<p>
  When more than 1 OneToMany or ManyToMany relationship is eagerly fetched
  then Ebean will automatically convert one of those into a 'Query Join'. Ebean does this so that it
  avoids
  generating a cartesian product query. Note that Ebean determines the type of SQL join for you
  based on the cardinality and optionality of the relationship.
</p>
<h4>Example 1</h4>

<p>
  It this example both "customer.contacts" and "details" are OneToMany relationships.
  <div class="syntax java"><div class="highlight"><pre>  <span class="n">List</span><span class="o">&lt;</span><span class="n">Order</span><span class="o">&gt;</span> <span class="n">orders</span> <span class="o">=</span> <span class="n">Order</span><span class="o">.</span><span class="na">find</span>
    <span class="o">.</span><span class="na">select</span><span class="o">(</span><span class="s">&quot;status&quot;</span><span class="o">)</span>
    <span class="o">.</span><span class="na">fetch</span><span class="o">(</span><span class="s">&quot;customer&quot;</span><span class="o">)</span>
    <span class="o">.</span><span class="na">fetch</span><span class="o">(</span><span class="s">&quot;customer.contacts&quot;</span><span class="o">)</span> <span class="c1">// contacts is a @OneToMany</span>
    <span class="o">.</span><span class="na">fetch</span><span class="o">(</span><span class="s">&quot;details&quot;</span><span class="o">)</span> <span class="c1">// details is a @OneToMany</span>
    <span class="o">.</span><span class="na">orderBy</span><span class="o">(</span><span class="s">&quot;customer.name&quot;</span><span class="o">)</span>
    <span class="o">.</span><span class="na">findList</span><span class="o">();</span>
    
</pre></div>
</div>

    ... results in the "left outer join o_contact" and related t2.* columns being included in the
    query (so they won't be lazy loaded later).

    <div class="syntax sql"><div class="highlight"><pre>    <span class="c1">-- This first query includes the customer contacts</span>
    <span class="c1">-- but does not include the order details</span>
    <span class="k">select</span> <span class="n">t0</span><span class="p">.</span><span class="n">id</span> <span class="n">c0</span><span class="p">,</span> <span class="n">t0</span><span class="p">.</span><span class="n">status</span> <span class="n">c1</span><span class="p">,</span>
    <span class="n">t1</span><span class="p">.</span><span class="n">id</span> <span class="n">c2</span><span class="p">,</span> <span class="n">t1</span><span class="p">.</span><span class="n">inactive</span> <span class="n">c3</span><span class="p">,</span> <span class="n">t1</span><span class="p">.</span><span class="n">name</span> <span class="n">c4</span><span class="p">,</span> <span class="p">...</span> <span class="c1">-- truncated</span>
    <span class="n">t2</span><span class="p">.</span><span class="n">id</span> <span class="n">c12</span><span class="p">,</span> <span class="n">t2</span><span class="p">.</span><span class="n">first_name</span> <span class="n">c13</span><span class="p">,</span> <span class="n">t2</span><span class="p">.</span><span class="n">last_name</span> <span class="n">c14</span><span class="p">,</span> <span class="p">...</span> <span class="c1">-- truncated</span>
    <span class="n">t2</span><span class="p">.</span><span class="n">when_updated</span> <span class="n">c19</span><span class="p">,</span> <span class="n">t2</span><span class="p">.</span><span class="n">customer_id</span> <span class="n">c20</span>
    <span class="k">from</span> <span class="n">o_order</span> <span class="n">t0</span>
    <span class="k">join</span> <span class="n">o_customer</span> <span class="n">t1</span> <span class="k">on</span> <span class="n">t1</span><span class="p">.</span><span class="n">id</span> <span class="o">=</span> <span class="n">t0</span><span class="p">.</span><span class="n">customer_id</span>
    <span class="k">left</span> <span class="k">outer</span> <span class="k">join</span> <span class="n">o_contact</span> <span class="n">t2</span> <span class="k">on</span> <span class="n">t2</span><span class="p">.</span><span class="n">customer_id</span> <span class="o">=</span> <span class="n">t1</span><span class="p">.</span><span class="n">id</span>
    <span class="k">order</span> <span class="k">by</span> <span class="n">t1</span><span class="p">.</span><span class="n">name</span><span class="p">;</span>
    
</pre></div>
</div>
</p>


<h4>The 'Query Join' query ...</h4>
<div class="syntax sql"><div class="highlight"><pre><span class="c1">-- This second query fetchs the order details associated</span>
<span class="c1">-- with the orders that were returned by the first query</span>
<span class="k">select</span> <span class="n">t0</span><span class="p">.</span><span class="n">order_id</span> <span class="n">c0</span><span class="p">,</span> <span class="n">t0</span><span class="p">.</span><span class="n">id</span> <span class="n">c1</span><span class="p">,</span> <span class="n">t0</span><span class="p">.</span><span class="n">order_qty</span> <span class="n">c2</span><span class="p">,</span> <span class="p">...</span>
<span class="k">from</span> <span class="n">o_order_detail</span> <span class="n">t0</span>
<span class="k">where</span> <span class="p">(</span><span class="n">t0</span><span class="p">.</span><span class="n">order_id</span><span class="p">)</span> <span class="k">in</span> <span class="p">(</span><span class="o">?</span><span class="p">,</span><span class="o">?</span><span class="p">,</span><span class="o">?</span><span class="p">,</span><span class="o">?</span><span class="p">,</span><span class="o">?</span><span class="p">,</span><span class="o">?</span><span class="p">,</span><span class="o">?</span><span class="p">,</span><span class="o">?</span><span class="p">,</span><span class="o">?</span><span class="p">,</span><span class="o">?</span><span class="p">)</span>
<span class="k">order</span> <span class="k">by</span> <span class="n">t0</span><span class="p">.</span><span class="n">order_id</span><span class="p">,</span> <span class="n">t0</span><span class="p">.</span><span class="n">id</span><span class="p">;</span>
<span class="c1">--bind(2,1,1,1,3,3,3,4,4,4)</span>
</pre></div>
</div>

<h4>Example 2</h4>

<p>
  In this example contacts is a @OneToMany and then off from each contact notes is a @OneToMany.
</p>
<div class="syntax java"><div class="highlight"><pre><span class="n">List</span><span class="o">&lt;</span><span class="n">Customer</span><span class="o">&gt;</span> <span class="n">customers</span> <span class="o">=</span> <span class="n">Customer</span><span class="o">.</span><span class="na">find</span>
  <span class="o">.</span><span class="na">fetch</span><span class="o">(</span><span class="s">&quot;contacts&quot;</span><span class="o">)</span> <span class="c1">// contacts is a OneToMany</span>
  <span class="o">.</span><span class="na">fetch</span><span class="o">(</span><span class="s">&quot;contacts.notes&quot;</span><span class="o">)</span> <span class="c1">// notes is a OneToMany</span>
  <span class="o">.</span><span class="na">orderBy</span><span class="o">(</span><span class="s">&quot;name&quot;</span><span class="o">)</span>
  <span class="o">.</span><span class="na">findList</span><span class="o">();</span>
  
</pre></div>
</div>

  <div class="syntax sql"><div class="highlight"><pre>  <span class="k">select</span> <span class="n">t0</span><span class="p">.</span><span class="n">id</span> <span class="n">c0</span><span class="p">,</span> <span class="n">t0</span><span class="p">.</span><span class="n">inactive</span> <span class="n">c1</span><span class="p">,</span> <span class="n">t0</span><span class="p">.</span><span class="n">name</span> <span class="n">c2</span><span class="p">,</span> <span class="p">...</span>
  <span class="n">t0</span><span class="p">.</span><span class="n">when_updated</span> <span class="n">c7</span><span class="p">,</span> <span class="n">t0</span><span class="p">.</span><span class="n">billing_address_id</span> <span class="n">c8</span><span class="p">,</span> <span class="p">...</span>
  <span class="n">t1</span><span class="p">.</span><span class="n">id</span> <span class="n">c10</span><span class="p">,</span> <span class="n">t1</span><span class="p">.</span><span class="n">first_name</span> <span class="n">c11</span><span class="p">,</span> <span class="n">t1</span><span class="p">.</span><span class="n">last_name</span> <span class="n">c12</span><span class="p">,</span> <span class="p">...</span>
  <span class="k">from</span> <span class="n">o_customer</span> <span class="n">t0</span>
  <span class="k">left</span> <span class="k">outer</span> <span class="k">join</span> <span class="n">be_contact</span> <span class="n">t1</span> <span class="k">on</span> <span class="n">t1</span><span class="p">.</span><span class="n">customer_id</span> <span class="o">=</span> <span class="n">t0</span><span class="p">.</span><span class="n">id</span>
  <span class="k">order</span> <span class="k">by</span> <span class="n">t0</span><span class="p">.</span><span class="n">name</span><span class="p">,</span> <span class="n">t0</span><span class="p">.</span><span class="n">id</span>
  
</pre></div>
</div>

  <h4>The 'Query Join' query ...</h4>
  <div class="syntax sql"><div class="highlight"><pre>  <span class="c1">-- fetch the contact notes for all the contacts</span>
  <span class="k">select</span> <span class="n">t0</span><span class="p">.</span><span class="n">contact_id</span> <span class="n">c0</span><span class="p">,</span> <span class="n">t0</span><span class="p">.</span><span class="n">id</span> <span class="n">c1</span><span class="p">,</span> <span class="n">t0</span><span class="p">.</span><span class="n">contact_id</span> <span class="n">c2</span><span class="p">,</span> <span class="n">t0</span><span class="p">.</span><span class="n">title</span> <span class="n">c3</span><span class="p">,</span> <span class="p">...</span>
  <span class="k">from</span> <span class="n">contact_note</span> <span class="n">t0</span>
  <span class="k">where</span> <span class="p">(</span><span class="n">t0</span><span class="p">.</span><span class="n">contact_id</span><span class="p">)</span> <span class="k">in</span> <span class="p">(</span><span class="o">?</span><span class="p">,</span><span class="o">?</span><span class="p">,</span><span class="o">?</span><span class="p">,</span><span class="o">?</span><span class="p">,</span><span class="o">?</span><span class="p">,</span><span class="o">?</span><span class="p">,</span><span class="o">?</span><span class="p">,</span><span class="o">?</span><span class="p">,</span><span class="o">?</span><span class="p">,</span><span class="o">?</span><span class="p">,</span><span class="o">?</span><span class="p">,</span><span class="o">?</span><span class="p">,</span><span class="o">?</span><span class="p">,</span><span class="o">?</span><span class="p">,</span><span class="o">?</span><span class="p">,</span><span class="o">?</span><span class="p">,</span><span class="o">?</span><span class="p">,</span><span class="o">?</span><span class="p">,</span><span class="o">?</span><span class="p">,</span><span class="o">?</span><span class="p">)</span>
</pre></div>
</div>

<h2 id="fetchconfig">FetchConfig</h2>

<p>When you specify a Query with Ebean it can result in more than 1 SQL query. Sometimes
you want explicit control over this (what the secondary queries are, batch size used, eager
or lazily invoked)</p>

<p>FetchConfig gives you the ability to specify these "secondary queries" and let them
executed lazily ("lazy loading join") or eagerly ("query join").</p>


<p>Note that explicitly using FetchConfig is not a requirement. Ebean is able to automatically
convert some joins
to "query joins" when it is needed such as when building object graphs with multiple *ToMany
relationships or when limit offset
is used with a *ToMany relationship.</p>


<p>You use FetchConfig to define that you want to use a separate SQL query to fetch that part of
the object graph (to use a "query join" rather than a "fetch join"). What this means is that
Ebean will use 2 SQL queries rather than 1 to build the object graph.
</p>

<p>Note that you do not need to expicitly use FetchConfig if you don't want to. In that case Ebean
will automatically convert any fetch paths over to use FetchConfig if it needs to (multiple
*ToMany relationships etc).
</p>

<p>FetchConfig defines the configuration options for a "query fetch" or a "lazy loading fetch".
This gives you the ability to use multiple smaller queries to populate an object graph as
opposed to a single large query. The primary goal is to provide efficient ways of loading
complex object graphs avoiding SQL Cartesian product and issues around populating object graphs
that have multiple *ToMany relationships. It also provides the ability to control the lazy
loading queries (batch size, selected properties and fetches) to avoid N+1 queries etc.
</p>

<p>
There can also be cases loading across a single OneToMany where 2 SQL queries using Ebean
FetchConfig.query() can be more efficient than one SQL query. When the "One" side is wide (lots
of columns) and the cardinality difference is high (a lot of "Many" beans per "One" bean) then
this can be more efficient loaded as 2 SQL queries.
</p>

<p>The reason for using "Query Joins" as opposed to "Fetch joins" is that there are some
cases where using multiple queries is more efficient that a single query.

<p>

<p>Any time you want to load multiple OneToMany associations it will likely be more
performant as multiple SQL queries. If a single SQL query was used that would result in a
Cartesian product.</p>

<p>There can also be cases loading across a single OneToMany where 2 SQL queries (using
Ebean "query join") can be more efficient than one SQL query (using Ebean "fetch join").
When the "One" side is wide (lots of columns) and the cardinality difference is high (a lot
of "Many" beans per "One" bean) then this can be more efficient loaded as 2 SQL queries.</p>


<p>
Example: Find Orders join details using a single SQL query
<div class="syntax java"><div class="highlight"><pre><span class="c1">// Normal fetch join results in a single SQL query</span>
<span class="n">List</span><span class="o">&lt;</span><span class="n">Order</span><span class="o">&gt;</span> <span class="n">list</span> <span class="o">=</span> <span class="n">Ebean</span><span class="o">.</span><span class="na">find</span><span class="o">(</span><span class="n">Order</span><span class="o">.</span><span class="na">class</span><span class="o">).</span><span class="na">fetch</span><span class="o">(</span><span class="s">&quot;details&quot;</span><span class="o">).</span><span class="na">findList</span><span class="o">();</span>
</pre></div>
</div>
<p>

<p>
Example: Using a "query join" instead of a "fetch join" we instead use 2 SQL queries

<div class="syntax java"><div class="highlight"><pre><span class="c1">// This will use 2 SQL queries to build this object graph.</span>
<span class="n">List</span><span class="o">&lt;</span><span class="n">Order</span><span class="o">&gt;</span> <span class="n">list</span> <span class="o">=</span>
  <span class="n">Ebean</span><span class="o">.</span><span class="na">find</span><span class="o">(</span><span class="n">Order</span><span class="o">.</span><span class="na">class</span><span class="o">)</span>
  <span class="o">.</span><span class="na">fetch</span><span class="o">(</span><span class="s">&quot;details&quot;</span><span class="o">,</span> <span class="k">new</span> <span class="n">FetchConfig</span><span class="o">().</span><span class="na">query</span><span class="o">())</span>
  <span class="o">.</span><span class="na">findList</span><span class="o">();</span>
  
</pre></div>
</div>
  queries:
  <ol>
    <li>find order</li>
    <li>find orderDetails where order.id in (?,?...) // first 100 order id's</li>
  </ol>
</p>


<p>
Example: Using 2 "query joins"

<div class="syntax java"><div class="highlight"><pre><span class="c1">// This will use 3 SQL queries to build this object graph</span>
<span class="n">List</span><span class="o">&lt;</span><span class="n">Order</span><span class="o">&gt;</span> <span class="n">list</span> <span class="o">=</span>
  <span class="n">Ebean</span><span class="o">.</span><span class="na">find</span><span class="o">(</span><span class="n">Order</span><span class="o">.</span><span class="na">class</span><span class="o">)</span>
  <span class="o">.</span><span class="na">fetch</span><span class="o">(</span><span class="s">&quot;details&quot;</span><span class="o">,</span> <span class="k">new</span> <span class="n">FetchConfig</span><span class="o">().</span><span class="na">query</span><span class="o">())</span>
  <span class="o">.</span><span class="na">fetch</span><span class="o">(</span><span class="s">&quot;customer&quot;</span><span class="o">,</span> <span class="k">new</span> <span class="n">FetchConfig</span><span class="o">().</span><span class="na">queryFirst</span><span class="o">(</span><span class="mi">5</span><span class="o">))</span>
  <span class="o">.</span><span class="na">findList</span><span class="o">();</span>
  
</pre></div>
</div>
  queries:
  <ol>
    <li>find order</li>
    <li>find orderDetails where order.id in (?,?...) // first 100 order id's</li>
    <li>find customer where id in (?,?,?,?,?) // first 5 customers</li>
  </ol>
</p>

<p>
Example: Using "query joins" and partial objects

<div class="syntax java"><div class="highlight"><pre><span class="c1">// This will use 3 SQL queries to build this object graph</span>
<span class="n">List</span><span class="o">&lt;</span><span class="n">Order</span><span class="o">&gt;</span> <span class="n">list</span> <span class="o">=</span>
  <span class="n">Ebean</span><span class="o">.</span><span class="na">find</span><span class="o">(</span><span class="n">Order</span><span class="o">.</span><span class="na">class</span><span class="o">)</span>
  <span class="o">.</span><span class="na">select</span><span class="o">(</span><span class="s">&quot;status, shipDate&quot;</span><span class="o">)</span>
  <span class="o">.</span><span class="na">fetch</span><span class="o">(</span><span class="s">&quot;details&quot;</span><span class="o">,</span> <span class="s">&quot;quantity, price&quot;</span><span class="o">,</span> <span class="k">new</span> <span class="n">FetchConfig</span><span class="o">().</span><span class="na">query</span><span class="o">())</span>
  <span class="o">.</span><span class="na">fetch</span><span class="o">(</span><span class="s">&quot;details.product&quot;</span><span class="o">,</span> <span class="s">&quot;sku, name&quot;</span><span class="o">)</span>
  <span class="o">.</span><span class="na">fetch</span><span class="o">(</span><span class="s">&quot;customer&quot;</span><span class="o">,</span> <span class="s">&quot;name&quot;</span><span class="o">,</span> <span class="k">new</span> <span class="n">FetchConfig</span><span class="o">().</span><span class="na">queryFirst</span><span class="o">(</span><span class="mi">5</span><span class="o">))</span>
  <span class="o">.</span><span class="na">fetch</span><span class="o">(</span><span class="s">&quot;customer.contacts&quot;</span><span class="o">)</span>
  <span class="o">.</span><span class="na">fetch</span><span class="o">(</span><span class="s">&quot;customer.shippingAddress&quot;</span><span class="o">)</span>
  <span class="o">.</span><span class="na">findList</span><span class="o">();</span>
  
</pre></div>
</div>
  queries:
  <ol>
    <li>find order (status, shipDate)</li>
    <li>find orderDetail (quantity, price) fetch product (sku, name) where order.id in (?,?
      ...)
    </li>
    <li>find customer (name) fetch contacts (*) fetch shippingAddress (*) where id in
      (?,?,?,?,?)
    </li>
  </ol>
  Note: the fetch of "details.product" is automatically included into the fetch of "details"<br>
  Note: the fetch of "customer.contacts" and "customer.shippingAddress" are automatically
  included in the fetch of "customer"
</p>

<p>You can use query() and lazy together on a single join. The query is executed immediately
and the lazy defines the batch size to use for further lazy loading (if lazy loading is
invoked).

<div class="syntax java"><div class="highlight"><pre><span class="n">List</span><span class="o">&lt;</span><span class="n">Order</span><span class="o">&gt;</span> <span class="n">list</span> <span class="o">=</span>
  <span class="n">Ebean</span><span class="o">.</span><span class="na">find</span><span class="o">(</span><span class="n">Order</span><span class="o">.</span><span class="na">class</span><span class="o">)</span>
  <span class="o">.</span><span class="na">fetch</span><span class="o">(</span><span class="s">&quot;customer&quot;</span><span class="o">,</span> <span class="k">new</span> <span class="n">FetchConfig</span><span class="o">().</span><span class="na">query</span><span class="o">(</span><span class="mi">10</span><span class="o">).</span><span class="na">lazy</span><span class="o">(</span><span class="mi">5</span><span class="o">))</span>
  <span class="o">.</span><span class="na">findList</span><span class="o">();</span>
  
</pre></div>
</div>
  queries:
  <ol>
    <li>find order</li>
    <li>find customer where id in (?,?,?,?,?,?,?,?,?,?) // first 10 customers</li>
    <li>then if lazy loading of customers is invoked, use a batch size of 5 to load the
      customers
    </li>
  </ol>
</p>

  <p>
    Example of controlling the lazy loading query:
  </p>

  <p>
    This gives us the ability to optimise the lazy loading query for a given use case.

    List<Order> list = Ebean.find(Order.class)
    .fetch("customer","name", new FetchConfig().lazy(5))
    .fetch("customer.contacts","contactName, phone, email")
    .fetch("customer.shippingAddress")
    .where().eq("status",Order.Status.NEW)
    .findList();
    
      queries:
      <ol>
        <li>find order where status = Order.Status.NEW</li>
        <li>if lazy loading of customers is invoked, use a batch size of 5 to load the
          customers.
  </p>
  </ol>

  Note: when the laxy loading of customers is performed, it perform like:
  <div class="syntax xml"><div class="highlight"><pre>  find customer (name)
  fetch customer.contacts (contactName, phone, email)
  fetch customer.shippingAddress (*)
  where id in (?,?,?,?,?)
  
</pre></div>
</div>


  <p>Example of wo "Query Joins" results in 3 SQL queries used to build an object graph
    <div class="syntax java"><div class="highlight"><pre>    <span class="c1">// A more advanced example with multiple query joins</span>
    <span class="n">List</span><span class="o">&lt;</span><span class="n">Order</span><span class="o">&gt;</span> <span class="n">l0</span> <span class="o">=</span> <span class="n">Ebean</span><span class="o">.</span><span class="na">find</span><span class="o">(</span><span class="n">Order</span><span class="o">.</span><span class="na">class</span><span class="o">)</span>
      <span class="o">.</span><span class="na">select</span><span class="o">(</span><span class="s">&quot;status, shipDate&quot;</span><span class="o">)</span>
      <span class="o">.</span><span class="na">fetch</span><span class="o">(</span><span class="s">&quot;details&quot;</span><span class="o">,</span> <span class="s">&quot;orderQty, unitPrice&quot;</span><span class="o">,</span> <span class="k">new</span> <span class="n">FetchConfig</span><span class="o">().</span><span class="na">query</span><span class="o">())</span>
      <span class="o">.</span><span class="na">fetch</span><span class="o">(</span><span class="s">&quot;details.product&quot;</span><span class="o">,</span> <span class="s">&quot;sku, name&quot;</span><span class="o">)</span>
      <span class="o">.</span><span class="na">fetch</span><span class="o">(</span><span class="s">&quot;customer&quot;</span><span class="o">,</span> <span class="s">&quot;name&quot;</span><span class="o">,</span> <span class="k">new</span> <span class="n">FetchConfig</span><span class="o">().</span><span class="na">query</span><span class="o">(</span><span class="mi">10</span><span class="o">))</span>
      <span class="o">.</span><span class="na">fetch</span><span class="o">(</span><span class="s">&quot;customer.contacts&quot;</span><span class="o">,</span><span class="s">&quot;firstName, lastName, mobile&quot;</span><span class="o">)</span>
      <span class="o">.</span><span class="na">fetch</span><span class="o">(</span><span class="s">&quot;customer.shippingAddress&quot;</span><span class="o">,</span><span class="s">&quot;line1, city&quot;</span><span class="o">)</span>
      <span class="o">.</span><span class="na">findList</span><span class="o">();</span>
      
</pre></div>
</div>

      The resulting 3 sql queries are:
  </p>
  <p>
    Query 1 - the main query - Note: customer_id was automatically added to support query join.
    <div class="syntax xml"><div class="highlight"><pre>    // query 1 â€¦ the main query
    <span class="nt">&lt;sql</span> <span class="na">summary=</span><span class="s">&#39;Order&#39;</span><span class="nt">&gt;</span>
      select o.id c0, o.status c1, o.ship_date c2, o.customer_id c3
      from o_order o
    <span class="nt">&lt;/sql&gt;</span>
    
</pre></div>
</div>
  </p>
  <p>
    Query 2 - query join on customer - fetching the first 10 customers referenced (batch:10) but
    there where actually only 2 to fetch (actual:2).
    <div class="syntax xml"><div class="highlight"><pre>    <span class="nt">&lt;sql</span> <span class="na">mode=</span><span class="s">&#39;+query&#39;</span> <span class="na">summary=</span><span class="s">&#39;Customer, shippingAddress</span>
<span class="s">+many:contacts&#39;</span> <span class="na">load=</span><span class="s">&#39;path:customer batch:10 actual:2&#39;</span><span class="nt">&gt;</span>
      select c.id c0, c.name c1
      , cs.id c2, cs.line_1 c3, cs.city c4
      , cc.id c5, cc.first_name c6, cc.last_name c7, cc.mobile c8
      from o_customer c
      left outer join o_address cs on cs.id = c.shipping_address_id
      left outer join contact cc on cc.customer_id = c.id
      where c.id in (?,?,?,?,?,?,?,?,?,?)
      order by c.id
    <span class="nt">&lt;/sql&gt;</span>
    
</pre></div>
</div>
  </p>
  <p>
    Query 3 â€“ query join on details - fetching the order details for the first 100 orders
    (batch:100).
    <div class="syntax xml"><div class="highlight"><pre>    <span class="nt">&lt;sql</span> <span class="na">mode=</span><span class="s">&#39;+query&#39;</span> <span class="na">summary=</span><span class="s">&#39;Order +many:details, details.product&#39;</span>
         <span class="na">load=</span><span class="s">&#39;path:details batch:100 actual:3&#39;</span><span class="nt">&gt;</span>
      select o.id c0
      , od.id c1, od.order_qty c2, od.unit_price c3
      , odp.id c4, odp.sku c5, odp.name c6
      from o_order o
      left outer join o_order_detail od on od.order_id = o.id
      left outer join o_product odp on odp.id = od.product_id
      where o.id in (?,?,?,?,?,?,?,?,?,?,?,?,?,?,?,?,?,?,?,?)
      order by o.id
    <span class="nt">&lt;/sql&gt;</span>
    
</pre></div>
</div>

  <h4>FetchConfig.lazy() - "Lazy Joins"</h4>

  <p>If a join is not defined at all (neither a fetch join or a query join) â€“ then lazy loading
    will by
    default just fetch all the properties for that entity.
  </p>

  <p>
    FetchConfig.lazy() allows you to control that lazy loading query â€“ define the batch size,
    properties to select and also fetch paths to include on the lazy load query.
  </p>

  <p>
    This is very similar to a "query join" except that the loading occurs on demand (when the
    property is requested and not already loaded).
  </p>

  <p>
    The reason you would want to control the lazy loading query is to optimise performance
    for further lazy loading (avoid N+1 queries, define joins that should be included for lazy
    loading queries, load only the properties required and no more).
  </p>

  <p>
    Example: Control the query used to lazy load
    <div class="syntax java"><div class="highlight"><pre>    <span class="c1">// control the lazy loading of customers ...</span>
    <span class="n">List</span><span class="o">&lt;</span><span class="n">Order</span><span class="o">&gt;</span> <span class="n">list</span> <span class="o">=</span> <span class="n">Ebean</span><span class="o">.</span><span class="na">find</span><span class="o">(</span><span class="n">Order</span><span class="o">.</span><span class="na">class</span><span class="o">)</span>
      <span class="o">.</span><span class="na">fetch</span><span class="o">(</span><span class="s">&quot;customer&quot;</span><span class="o">,</span><span class="s">&quot;name&quot;</span><span class="o">,</span> <span class="k">new</span> <span class="n">FetchConfig</span><span class="o">().</span><span class="na">lazy</span><span class="o">(</span><span class="mi">5</span><span class="o">))</span>
      <span class="o">.</span><span class="na">fetch</span><span class="o">(</span><span class="s">&quot;customer.contacts&quot;</span><span class="o">,</span><span class="s">&quot;contactName, phone, email&quot;</span><span class="o">)</span>
      <span class="o">.</span><span class="na">fetch</span><span class="o">(</span><span class="s">&quot;customer.shippingAddress&quot;</span><span class="o">)</span>
      <span class="o">.</span><span class="na">where</span><span class="o">().</span><span class="na">eq</span><span class="o">(</span><span class="s">&quot;status&quot;</span><span class="o">,</span><span class="n">Order</span><span class="o">.</span><span class="na">Status</span><span class="o">.</span><span class="na">NEW</span><span class="o">)</span>
      <span class="o">.</span><span class="na">findList</span><span class="o">();</span>
      
</pre></div>
</div>
  </p>
  <p>
    In the example above the orders are loaded. Only when the application requests a
    customer property (that is not the customer's id) then the lazy loading of the customer is
    invoked. At that point the customer name is loaded, with the contacts and
    shippingAddress â€“ this is done in batch of 5 customers.
  </p>

  <p>
    Note that if the customer status is requested (rather than the customer name) and that
    invokes the lazy loading then all the customer's properties are loaded (rather than just the
    customers name).

    <div class="syntax java"><div class="highlight"><pre>    <span class="n">Order</span> <span class="n">order</span> <span class="o">=</span> <span class="n">list</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="mi">0</span><span class="o">);</span>
    <span class="n">Customer</span> <span class="n">customer</span> <span class="o">=</span> <span class="n">order</span><span class="o">.</span><span class="na">getCustomer</span><span class="o">();</span>

    <span class="c1">// this invokes the lazy loading of 5 customers</span>
    <span class="n">String</span> <span class="n">name</span> <span class="o">=</span> <span class="n">customer</span><span class="o">.</span><span class="na">getName</span><span class="o">();</span>
    
</pre></div>
</div>
  </p>

  <p>
    The resulting lazy loading query is â€¦
    <div class="syntax xml"><div class="highlight"><pre>    <span class="nt">&lt;sql</span> <span class="na">mode=</span><span class="s">&#39;+lazy&#39;</span> <span class="na">summary=</span><span class="s">&#39;Customer, shippingAddress +many:contacts&#39;</span>
         <span class="na">load=</span><span class="s">&#39;path:customer batch:5 actual:2&#39;</span><span class="nt">&gt;</span>
      select c.id c0, c.name c1, cs.id c2, cs.line_1 c3, cs.line_2 c4, cs.city c5,
      cs.cretime c6, cs.updtime c7, cs.country_code c8,
      cc.id c9, cc.phone c10, cc.email c11
      from o_customer c
      left outer join o_address cs on cs.id = c.shipping_address_id
      left outer join contact cc on cc.customer_id = c.id
      where c.id in (?,?,?,?,?)
      order by c.id
    <span class="nt">&lt;/sql&gt;</span>
    
</pre></div>
</div>

  <h4>Using both</h4>

  <p>You can use both queryFirst() and lazy() on a single join. The queryFirst() part defines
    the
    number of beans that will be loaded eagerly via an additional query and then lazy defines
    the batch size of the lazy loading that occurs after than (if there is any).

    <div class="syntax java"><div class="highlight"><pre>    <span class="k">new</span> <span class="n">FetchQuery</span><span class="o">.</span><span class="na">queryFirst</span><span class="o">(</span><span class="mi">100</span><span class="o">).</span><span class="na">lazy</span><span class="o">(</span><span class="mi">10</span><span class="o">);</span>
    
</pre></div>
</div>

  </p>

  <h4>+query and +lazy â€“ query language syntax</h4>

  <p>
    To define "query joins" and "lazy joins" in the query language you can use +query and
    +lazy. Optionally you can specify the batch size for both.

    <div class="syntax groovy"><div class="highlight"><pre>    <span class="n">find</span> <span class="n">order</span>
    <span class="n">join</span> <span class="nf">customers</span> <span class="o">(+</span><span class="n">query</span> <span class="o">)</span>
    <span class="n">where</span> <span class="n">status</span> <span class="o">=</span> <span class="o">:</span><span class="n">status</span>
    
</pre></div>
</div>

    <div class="syntax groovy"><div class="highlight"><pre>    <span class="n">find</span> <span class="nf">order</span> <span class="o">(</span><span class="n">status</span><span class="o">,</span> <span class="n">shipDate</span><span class="o">)</span>
    <span class="n">join</span> <span class="nf">customers</span> <span class="o">(+</span><span class="n">lazy</span><span class="o">(</span><span class="mi">10</span><span class="o">)</span> <span class="n">name</span><span class="o">,</span> <span class="n">status</span><span class="o">)</span>
    <span class="n">where</span> <span class="n">status</span> <span class="o">=</span> <span class="o">:</span><span class="n">orderStatus</span>
    
</pre></div>
</div>
  </p>


  <h2 id="lazy_loading">Lazy loading</h2>
  <h4>
    Fine grained control over lazy loading.
  </h4>

  <p>
    A Partial Object will lazy load the rest of the data on demand when you get or set a
    property it does not have.
  </p>

  <div class="syntax java"><div class="highlight"><pre>  <span class="c1">// find order 12</span>
  <span class="c1">// ... fetching the order id, orderDate and version property</span>
  <span class="c1">// .... nb: the Id and version property are always fetched</span>

  <span class="n">Order</span> <span class="n">order</span> <span class="o">=</span> <span class="n">Ebean</span><span class="o">.</span><span class="na">find</span><span class="o">(</span><span class="n">Order</span><span class="o">.</span><span class="na">class</span><span class="o">)</span>
  <span class="o">.</span><span class="na">select</span><span class="o">(</span><span class="s">&quot;orderDate&quot;</span><span class="o">)</span>
  <span class="o">.</span><span class="na">where</span><span class="o">().</span><span class="na">idEq</span><span class="o">(</span><span class="mi">12</span><span class="o">)</span>
  <span class="o">.</span><span class="na">findUnique</span><span class="o">();</span>

  <span class="c1">// shipDate is not in the partially populated order</span>
  <span class="c1">// ... so it will lazy load all the missing properties</span>
  <span class="n">Date</span> <span class="n">shipDate</span> <span class="o">=</span> <span class="n">order</span><span class="o">.</span><span class="na">getShipDate</span><span class="o">();</span>

  <span class="c1">// similarly if we where to set the shipDate</span>
  <span class="c1">// ... that would also trigger a lazy load</span>
  <span class="n">order</span><span class="o">.</span><span class="na">setShipDate</span><span class="o">(</span><span class="k">new</span> <span class="n">Date</span><span class="o">());</span>
  
</pre></div>
</div>

  <p>
    Lazy loading occurs automatically when you set or get a property that the partially
    populated bean does not have.
  </p>

  <h2 id="named_queries">Named Queries</h2>

  <div class="syntax java"><div class="highlight"><pre>  <span class="kn">import</span> <span class="nn">javax.persistence.NamedQueries</span><span class="o">;</span>
  <span class="kn">import</span> <span class="nn">javax.persistence.NamedQuery</span><span class="o">;</span>

  <span class="o">...</span>
  <span class="nd">@NamedQueries</span><span class="o">(</span><span class="n">value</span><span class="o">={</span>
    <span class="nd">@NamedQuery</span><span class="o">(</span>
      <span class="n">name</span><span class="o">=</span><span class="s">&quot;bugsSummary&quot;</span><span class="o">,</span>
      <span class="n">query</span><span class="o">=</span><span class="s">&quot;find (name, email) fetch loggedBugs (title, status) where id=:id &quot;</span><span class="o">),</span>
    <span class="nd">@NamedQuery</span><span class="o">(</span>
      <span class="n">name</span><span class="o">=</span><span class="s">&quot;bugStatus&quot;</span><span class="o">,</span>
      <span class="n">query</span><span class="o">=</span><span class="s">&quot;fetch loggedBugs where loggedBugs.status = :bugStatusorder by name&quot;</span><span class="o">)</span>
    <span class="o">})</span>
  <span class="nd">@Entity</span>
  <span class="nd">@Table</span><span class="o">(</span><span class="n">name</span><span class="o">=</span><span class="s">&quot;s_user&quot;</span><span class="o">)</span>
  <span class="kd">public</span> <span class="kd">class</span> <span class="nc">User</span> <span class="kd">implements</span> <span class="n">Serializable</span> <span class="o">{</span>
  <span class="o">...</span>
  
</pre></div>
</div>
  <p>You can have named queries, where you define the query. Note that the names of the
    queries are per entity type (not global as they are in JPA).</p>

  <p>Once you get a named query you set any named parameters and then execute it â€“ in the
    case below we use findUnique() as we expect only one object graph returned.</p>

    <div class="syntax java"><div class="highlight"><pre>    <span class="n">User</span> <span class="n">u</span> <span class="o">=</span> <span class="n">Ebean</span><span class="o">.</span><span class="na">createNamedQuery</span><span class="o">(</span><span class="n">User</span><span class="o">.</span><span class="na">class</span><span class="o">,</span> <span class="s">&quot;bugsSummary&quot;</span><span class="o">)</span>
              <span class="o">.</span><span class="na">setParameter</span><span class="o">(</span><span class="s">&quot;id&quot;</span><span class="o">,</span> <span class="mi">1</span><span class="o">)</span>
              <span class="o">.</span><span class="na">findUnique</span><span class="o">();</span>
    
</pre></div>
</div>

  <h4>Named Queries are Modifyable</h4>

  <p>Named queries are parsed early and returned as query objects to you that you can
    modify. This means that you can get a named query and then modify the query by adding
    to the where clause, setting the order by, limits etc.</p>

  <p>This is an intentional feature and means that you can use Named Queries as a "starting
    point" to then modify via code and execute.</p>
  <div class="syntax java"><div class="highlight"><pre>  <span class="c1">// you can treat namedQueries as starting points...</span>
  <span class="c1">// ... in that you can modify them via code</span>
  <span class="c1">// ... prior to executing the query</span>
  <span class="c1">// you can modify a named query...</span>
  <span class="n">Set</span>
  <span class="o">&lt;</span><span class="n">User</span><span class="o">&gt;</span> <span class="n">users</span> <span class="o">=</span> <span class="n">Ebean</span><span class="o">.</span><span class="na">createQuery</span><span class="o">(</span><span class="n">User</span><span class="o">.</span><span class="na">class</span><span class="o">,</span> <span class="s">&quot;bugStatus&quot;</span><span class="o">)</span>
    <span class="o">.</span><span class="na">setParameter</span><span class="o">(</span><span class="s">&quot;bugStatus&quot;</span><span class="o">,</span> <span class="s">&quot;NEW&quot;</span><span class="o">)</span>

    <span class="c1">// you can add to the where clause</span>
    <span class="o">.</span><span class="na">where</span><span class="o">().</span><span class="na">ilike</span><span class="o">(</span><span class="s">&quot;name&quot;</span><span class="o">,</span> <span class="s">&quot;rob%&quot;</span><span class="o">)</span>

    <span class="c1">// you can set/override the order by</span>
    <span class="o">.</span><span class="na">orderBy</span><span class="o">(</span><span class="s">&quot;id desc&quot;</span><span class="o">)</span>

    <span class="c1">// you can set/override limits (max rows, first row)</span>
    <span class="o">.</span><span class="na">setMaxRows</span><span class="o">(</span><span class="mi">20</span><span class="o">)</span>
    <span class="o">.</span><span class="na">findSet</span><span class="o">();</span>
    
</pre></div>
</div>

<h2 id="large_queries">Large queries</h2>

<p>Large query results can take up a lot of memory if using findList() since loads all the
  results in memory at once.
  Ebean provides functionality for streaming the results. With this functionality, you
  process the results rows one at a time.</p>

<p><b>Query.findIterate()</b> - Execute the query iterating over the results. Requires
  calling QueryIterator.close(), typically in a finally block, to prevent resource leakage.

<p><b>Query.findEach(QueryEachConsumer
  <T> consumer)
</b> - Execute the query consuming each bean one at a time.
</p>
<o>
  This method is appropriate to process very large query results as the beans are consumed
  one at a time and do not need to be held in memory (unlike #findList #findSet etc)
</p>
<p>Note that internally Ebean can inform the JDBC driver that it is expecting larger resultSet and
  specifically for MySQL this hint is required to stop it's JDBC driver from buffering the entire
  resultSet. As such, for smaller resultSets findList() is generally preferable.
</p>

<p>
  Compared with findEachWhile() this will always process all the beans where as findEachWhile()
  provides a way to stop processing the query result early before all the beans have been read.
</p>

<p>
  This method is functionally equivalent to findIterate() but instead of using an iterator uses
  the QueryEachConsumer (SAM) interface which is better suited to use with Java8 closures.
</p>

<p>
  <div class="syntax java"><div class="highlight"><pre>  <span class="n">ebeanServer</span><span class="o">.</span><span class="na">find</span><span class="o">(</span><span class="n">Customer</span><span class="o">.</span><span class="na">class</span><span class="o">)</span>
  <span class="o">.</span><span class="na">where</span><span class="o">().</span><span class="na">eq</span><span class="o">(</span><span class="s">&quot;status&quot;</span><span class="o">,</span> <span class="n">Status</span><span class="o">.</span><span class="na">NEW</span><span class="o">)</span>
  <span class="o">.</span><span class="na">order</span><span class="o">().</span><span class="na">asc</span><span class="o">(</span><span class="s">&quot;id&quot;</span><span class="o">)</span>
  <span class="o">.</span><span class="na">findEach</span><span class="o">((</span><span class="n">Customer</span> <span class="n">customer</span><span class="o">)</span> <span class="o">-&gt;</span> <span class="o">{</span>

    <span class="c1">// do something with customer</span>
    <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&quot;-- visit &quot;</span> <span class="o">+</span> <span class="n">customer</span><span class="o">);</span>
  <span class="o">});</span>
  
</pre></div>
</div>

  <p><b>Query.findEachWhile(QueryEachWhileConsumer&lt;T&gt; consumer)
  </b> - >Execute the query using callbacks to a visitor to process the resulting beans one at a
    time.
  </p>
  <p>
    This is similar to .findEach(...) except that you return boolean true to continue processing
    beans and return false to stop processing early.
  </p>

  <p>
    This method is functionally equivalent to findIterate() but instead of using an iterator uses
    the QueryEachWhileConsumer (SAM) interface which is better suited to use with Java8 closures.
  </p>
  <div class="syntax java"><div class="highlight"><pre>  <span class="n">ebeanServer</span><span class="o">.</span><span class="na">find</span><span class="o">(</span><span class="n">Customer</span><span class="o">.</span><span class="na">class</span><span class="o">)</span>
    <span class="o">.</span><span class="na">fetch</span><span class="o">(</span><span class="s">&quot;contacts&quot;</span><span class="o">,</span> <span class="k">new</span> <span class="n">FetchConfig</span><span class="o">().</span><span class="na">query</span><span class="o">(</span><span class="mi">2</span><span class="o">))</span>
    <span class="o">.</span><span class="na">where</span><span class="o">().</span><span class="na">eq</span><span class="o">(</span><span class="s">&quot;status&quot;</span><span class="o">,</span> <span class="n">Status</span><span class="o">.</span><span class="na">NEW</span><span class="o">)</span>
    <span class="o">.</span><span class="na">order</span><span class="o">().</span><span class="na">asc</span><span class="o">(</span><span class="s">&quot;id&quot;</span><span class="o">)</span>
    <span class="o">.</span><span class="na">setMaxRows</span><span class="o">(</span><span class="mi">2000</span><span class="o">)</span>
    <span class="o">.</span><span class="na">findEachWhile</span><span class="o">((</span><span class="n">Customer</span> <span class="n">customer</span><span class="o">)</span> <span class="o">-&gt;</span> <span class="o">{</span>

      <span class="c1">// do something with customer</span>
      <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&quot;-- visit &quot;</span> <span class="o">+</span> <span class="n">customer</span><span class="o">);</span>

      <span class="c1">// return true to continue processing or false to stop</span>
      <span class="k">return</span> <span class="o">(</span><span class="n">customer</span><span class="o">.</span><span class="na">getId</span><span class="o">()</span> <span class="o">&lt;</span> <span class="mi">40</span><span class="o">);</span>
    <span class="o">});</span>
  
</pre></div>
</div>

  <h2 id="paging">Paging</h2>

  <p>Paging through the results means that instead of all the results are not fetched in a single
    query Ebean will use SQL to limit the results (limit/offset, rownum, row_number() etc).</p>

  <h4>
    Using firstRows and maxRows or findPagedList to fetch a 'page' of results.
  </h4>

  <p>
    If you are building a stateless application (not holding the PagingList over multiple requests)
    then this approach is a good option.
  </p>

  <p>
    Use setFirstRow() and setMaxRows() to control what rows are returned for the Query..
  </p>

  <p>

  </p>

  <h4>PagedList</h4>

  <p>The benefit of using PagedList over just using the normal Query with Query.setFirstRow(int) and
    Query.setMaxRows(int) is that it additionally wraps functionality that can call
    Query.findFutureRowCount() to determine total row count, total page count etc.</p>

  <p>Internally this works using Query.setFirstRow(int) and Query.setMaxRows(int) on the query. This
    translates into SQL that uses limit offset, rownum or row_number function to limit the result
    set.</p>

  <p>
    Example: typical use including total row count

    <div class="syntax java"><div class="highlight"><pre>    <span class="c1">// We want to find the first 100 new orders</span>
    <span class="c1">// ... 0 means first page</span>
    <span class="c1">// ... page size is 100</span>

    <span class="n">PagedList</span><span class="o">&lt;</span><span class="n">Order</span><span class="o">&gt;</span> <span class="n">pagedList</span>
      <span class="o">=</span> <span class="n">ebeanServer</span><span class="o">.</span><span class="na">find</span><span class="o">(</span><span class="n">Order</span><span class="o">.</span><span class="na">class</span><span class="o">)</span>
      <span class="o">.</span><span class="na">where</span><span class="o">().</span><span class="na">eq</span><span class="o">(</span><span class="s">&quot;status&quot;</span><span class="o">,</span> <span class="n">Order</span><span class="o">.</span><span class="na">Status</span><span class="o">.</span><span class="na">NEW</span><span class="o">)</span>
      <span class="o">.</span><span class="na">order</span><span class="o">().</span><span class="na">asc</span><span class="o">(</span><span class="s">&quot;id&quot;</span><span class="o">)</span>
      <span class="o">.</span><span class="na">findPagedList</span><span class="o">(</span><span class="mi">0</span><span class="o">,</span> <span class="mi">100</span><span class="o">);</span>

      <span class="c1">// Optional: initiate the loading of the total</span>
      <span class="c1">// row count in a background thread</span>
      <span class="n">pagedList</span><span class="o">.</span><span class="na">loadRowCount</span><span class="o">();</span>

      <span class="c1">// fetch and return the list in the foreground thread</span>
      <span class="n">List</span><span class="o">&lt;</span><span class="n">Order</span><span class="o">&gt;</span> <span class="n">orders</span> <span class="o">=</span> <span class="n">pagedList</span><span class="o">.</span><span class="na">getList</span><span class="o">();</span>

        <span class="c1">// get the total row count (from the future)</span>
        <span class="kt">int</span> <span class="n">totalRowCount</span> <span class="o">=</span> <span class="n">pagedList</span><span class="o">.</span><span class="na">getTotalRowCount</span><span class="o">();</span>
        
</pre></div>
</div>

        Example: No total row count required
        <div class="syntax java"><div class="highlight"><pre>        <span class="c1">// If you are not getting the &#39;first page&#39; often</span>
        <span class="c1">// you do not bother getting the total row count again</span>
        <span class="c1">// so instead just get the page list of data</span>

        <span class="c1">// fetch and return the list in the foreground thread</span>
        <span class="n">List</span><span class="o">&lt;</span><span class="n">Order</span><span class="o">&gt;</span> <span class="n">orders</span> <span class="o">=</span> <span class="n">pagedList</span><span class="o">.</span><span class="na">getList</span><span class="o">();</span>
          
</pre></div>
</div>
  </p>


<h2 id="async_queries">Asynchronous queries</h2>

<p>
Ebean has built in support for executing queries asynchronously. These queries are executed in a
background thread and "Future" objects are returned.
The "Future" objects returned extend java.util.concurrent.Future. This provides support for
cancelling the query, checking if it is cancelled or done and getting the result with waiting
and timeout support.
</p>


Methods on Query for ansychronous execution

<div class="syntax java"><div class="highlight"><pre><span class="kd">public</span> <span class="n">FutureList</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span> <span class="n">findFutureList</span><span class="o">();</span>

<span class="kd">public</span> <span class="n">FutureIds</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span> <span class="n">findFutureIds</span><span class="o">();</span>

<span class="kd">public</span> <span class="n">FutureRowCount</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span> <span class="n">findFutureRowCount</span><span class="o">();</span>
</pre></div>
</div>


example: shows the use of FutureList:

<div class="syntax java"><div class="highlight"><pre><span class="n">Query</span><span class="o">&lt;</span><span class="n">Order</span><span class="o">&gt;</span> <span class="n">query</span> <span class="o">=</span> <span class="n">Ebean</span><span class="o">.</span><span class="na">find</span><span class="o">(</span><span class="n">Order</span><span class="o">.</span><span class="na">class</span><span class="o">);</span>

<span class="c1">// find list using a background thread</span>
<span class="n">FutureList</span><span class="o">&lt;</span><span class="n">Order</span><span class="o">&gt;</span> <span class="n">futureList</span> <span class="o">=</span> <span class="n">query</span><span class="o">.</span><span class="na">findFutureList</span><span class="o">();</span>

  <span class="c1">// do something else ...</span>

  <span class="k">if</span> <span class="o">(!</span><span class="n">futureList</span><span class="o">.</span><span class="na">isDone</span><span class="o">()){</span>
  <span class="c1">// you can cancel the query. If supported by the JDBC</span>
  <span class="c1">// driver and database this will actually cancel the</span>
  <span class="c1">// sql query execution on the database</span>
  <span class="n">futureList</span><span class="o">.</span><span class="na">cancel</span><span class="o">(</span><span class="kc">true</span><span class="o">);</span>
  <span class="o">}</span>
  <span class="c1">// wait for the query to finish ... no timeout</span>
  <span class="n">List</span><span class="o">&lt;</span><span class="n">Order</span><span class="o">&gt;</span> <span class="n">list</span> <span class="o">=</span> <span class="n">futureList</span><span class="o">.</span><span class="na">get</span><span class="o">();</span>

    <span class="c1">// wait for the query to finish ... with a 30sec timeout</span>
    <span class="n">List</span><span class="o">&lt;</span><span class="n">Order</span><span class="o">&gt;</span> <span class="n">list2</span> <span class="o">=</span> <span class="n">futureList</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="mi">30</span><span class="o">,</span> <span class="n">TimeUnit</span><span class="o">.</span><span class="na">SECONDS</span><span class="o">);</span>
      
</pre></div>
</div>


  <h2 id="rawsql">RawSql</h2>
  <h4>
    Using RawSql to fully control the SQL used to load an object graph.
  </h4>

  <p>
    You can explicitly specify the SQL to use and have that mapped into Objects. You
    may want to do this so use aggregate functions like sum() max() etc or in cases
    where you just need exact control over the SQL.
  </p>
  <p>
    This is useful for "Reporting" type requirements where you want to use aggregate functions such as
    sum(), count(), max(), etc. It is also useful if you need to use Database specific SQL for whatever
    reason.
  </p>
  <p>
    You can programmatically use raw SQL like the following examples or put the Raw SQL and column
    mappings into ebean-orm.xml file and reference them as 'named queries' - see
    ebeanServer.createNamedQuery().
  </p>

  <p>You can use RawSql with ebean enhanced entity beans. You can fetch only the properties that are need
    (creating partially populated entity beans). All ebean enhanced entity beans built with RawSql invoke
    lazy loading etc and act just the same as if they where populated via Ebean generated SQL.</p>

  <p>
    If you let Ebean 'parse' the raw SQL then Ebean can add expressions to the WHERE and HAVING clauses as
    well as set the ORDER BY and LIMIT OFFSET clauses.


  <div class="syntax java"><div class="highlight"><pre>  <span class="c1">// Use raw SQL with an aggregate function</span>

  <span class="n">String</span> <span class="n">sql</span>
  <span class="o">=</span> <span class="s">&quot; select order_id, o.status, c.id, c.name, sum(d.order_qty*d.unit_price) as totalAmount&quot;</span>
  <span class="o">+</span> <span class="s">&quot; from o_order o&quot;</span>
  <span class="o">+</span> <span class="s">&quot; join o_customer c on c.id = o.kcustomer_id &quot;</span>
  <span class="o">+</span> <span class="s">&quot; join o_order_detail d on d.order_id = o.id &quot;</span>
  <span class="o">+</span> <span class="s">&quot; group by order_id, o.status &quot;</span><span class="o">;</span>

  <span class="n">RawSql</span> <span class="n">rawSql</span> <span class="o">=</span>
  <span class="n">RawSqlBuilder</span>
    <span class="c1">// let ebean parse the SQL so that it can</span>
    <span class="c1">// add expressions to the WHERE and HAVING</span>
    <span class="c1">// clauses</span>
    <span class="o">.</span><span class="na">parse</span><span class="o">(</span><span class="n">sql</span><span class="o">)</span>
      <span class="c1">// map resultSet columns to bean properties</span>
      <span class="o">.</span><span class="na">columnMapping</span><span class="o">(</span><span class="s">&quot;order_id&quot;</span><span class="o">,</span> <span class="s">&quot;order.id&quot;</span><span class="o">)</span>
      <span class="o">.</span><span class="na">columnMapping</span><span class="o">(</span><span class="s">&quot;o.status&quot;</span><span class="o">,</span> <span class="s">&quot;order.status&quot;</span><span class="o">)</span>
      <span class="o">.</span><span class="na">columnMapping</span><span class="o">(</span><span class="s">&quot;c.id&quot;</span><span class="o">,</span> <span class="s">&quot;order.customer.id&quot;</span><span class="o">)</span>
      <span class="o">.</span><span class="na">columnMapping</span><span class="o">(</span><span class="s">&quot;c.name&quot;</span><span class="o">,</span> <span class="s">&quot;order.customer.name&quot;</span><span class="o">)</span>
      <span class="o">.</span><span class="na">create</span><span class="o">();</span>


  <span class="n">Query</span><span class="o">&lt;</span><span class="n">OrderAggregate</span><span class="o">&gt;</span> <span class="n">query</span> <span class="o">=</span> <span class="n">Ebean</span><span class="o">.</span><span class="na">find</span><span class="o">(</span><span class="n">OrderAggregate</span><span class="o">.</span><span class="na">class</span><span class="o">);</span>
    <span class="n">query</span><span class="o">.</span><span class="na">setRawSql</span><span class="o">(</span><span class="n">rawSql</span><span class="o">)</span>
    <span class="c1">// add expressions to the WHERE and HAVING clauses</span>
    <span class="o">.</span><span class="na">where</span><span class="o">().</span><span class="na">gt</span><span class="o">(</span><span class="s">&quot;order.id&quot;</span><span class="o">,</span> <span class="mi">0</span><span class="o">)</span>
    <span class="o">.</span><span class="na">having</span><span class="o">().</span><span class="na">gt</span><span class="o">(</span><span class="s">&quot;totalAmount&quot;</span><span class="o">,</span> <span class="mi">20</span><span class="o">);</span>

    <span class="n">List</span><span class="o">&lt;</span><span class="n">OrderAggregate</span><span class="o">&gt;</span> <span class="n">list</span> <span class="o">=</span> <span class="n">query</span><span class="o">.</span><span class="na">findList</span><span class="o">();</span>
      
</pre></div>
</div>
  </p>

  <p>
    This example uses FetchConfig to fetch other parts of the object graph. After the raw SQL query is
    executed Ebean uses 'query joins' to fetch some order and customer properties.

  <div class="syntax java"><div class="highlight"><pre>  <span class="c1">// You can also use FetchConfig to get Ebean to</span>
  <span class="c1">// fetch additional parts of the object graph</span>
  <span class="c1">// after the Raw SQL query is executed.</span>

  <span class="n">String</span> <span class="n">sql</span>
  <span class="o">=</span> <span class="s">&quot; select order_id, sum(d.order_qty*d.unit_price) as totalAmount &quot;</span>
  <span class="o">+</span> <span class="s">&quot; from o_order_detail d&quot;</span>
  <span class="o">+</span> <span class="s">&quot; group by order_id &quot;</span><span class="o">;</span>

  <span class="n">RawSql</span> <span class="n">rawSql</span> <span class="o">=</span>
  <span class="n">RawSqlBuilder</span>
    <span class="o">.</span><span class="na">parse</span><span class="o">(</span><span class="n">sql</span><span class="o">)</span>
    <span class="o">.</span><span class="na">columnMapping</span><span class="o">(</span><span class="s">&quot;order_id&quot;</span><span class="o">,</span> <span class="s">&quot;order.id&quot;</span><span class="o">)</span>
    <span class="o">.</span><span class="na">create</span><span class="o">();</span>


  <span class="n">Query</span><span class="o">&lt;</span><span class="n">OrderAggregate</span><span class="o">&gt;</span> <span class="n">query</span> <span class="o">=</span> <span class="n">Ebean</span><span class="o">.</span><span class="na">find</span><span class="o">(</span><span class="n">OrderAggregate</span><span class="o">.</span><span class="na">class</span><span class="o">);</span>
    <span class="n">query</span><span class="o">.</span><span class="na">setRawSql</span><span class="o">(</span><span class="n">rawSql</span><span class="o">)</span>
      <span class="c1">// get ebean to fetch parts of the order and customer</span>
      <span class="c1">// after the raw SQL query is executed</span>
      <span class="o">.</span><span class="na">fetch</span><span class="o">(</span><span class="s">&quot;order&quot;</span><span class="o">,</span> <span class="s">&quot;status,orderDate&quot;</span><span class="o">,</span><span class="k">new</span> <span class="n">FetchConfig</span><span class="o">().</span><span class="na">query</span><span class="o">())</span>
      <span class="o">.</span><span class="na">fetch</span><span class="o">(</span><span class="s">&quot;order.customer&quot;</span><span class="o">,</span> <span class="s">&quot;name&quot;</span><span class="o">)</span>
      <span class="o">.</span><span class="na">where</span><span class="o">().</span><span class="na">gt</span><span class="o">(</span><span class="s">&quot;order.id&quot;</span><span class="o">,</span> <span class="mi">0</span><span class="o">)</span>
      <span class="o">.</span><span class="na">having</span><span class="o">().</span><span class="na">gt</span><span class="o">(</span><span class="s">&quot;totalAmount&quot;</span><span class="o">,</span> <span class="mi">20</span><span class="o">)</span>
      <span class="o">.</span><span class="na">order</span><span class="o">().</span><span class="na">desc</span><span class="o">(</span><span class="s">&quot;totalAmount&quot;</span><span class="o">)</span>
      <span class="o">.</span><span class="na">setMaxRows</span><span class="o">(</span><span class="mi">10</span><span class="o">);</span>
    
</pre></div>
</div>
</p>

<p>
  This is the OrderAggregate bean used in the examples above.

  <div class="syntax java"><div class="highlight"><pre>  <span class="kn">package</span> <span class="n">com</span><span class="o">.</span><span class="na">avaje</span><span class="o">.</span><span class="na">tests</span><span class="o">.</span><span class="na">model</span><span class="o">.</span><span class="na">basic</span><span class="o">;</span>

  <span class="kn">import</span> <span class="nn">javax.persistence.Entity</span><span class="o">;</span>
  <span class="kn">import</span> <span class="nn">javax.persistence.OneToOne</span><span class="o">;</span>

  <span class="kn">import</span> <span class="nn">com.avaje.ebean.annotation.Sql</span><span class="o">;</span>

  <span class="cm">/**</span>
<span class="cm">  * An example of an Aggregate object.</span>
<span class="cm">  *</span>
<span class="cm">  * Note the @Sql indicates to Ebean that this bean is not based on a table but</span>
<span class="cm">  * instead uses RawSql.</span>
<span class="cm">  *</span>
<span class="cm">  */</span>
  <span class="nd">@Entity</span>
  <span class="nd">@Sql</span>
  <span class="kd">public</span> <span class="kd">class</span> <span class="nc">OrderAggregate</span> <span class="o">{</span>

    <span class="nd">@OneToOne</span>
    <span class="n">Order</span> <span class="n">order</span><span class="o">;</span>

    <span class="n">Double</span> <span class="n">totalAmount</span><span class="o">;</span>

    <span class="n">Double</span> <span class="n">totalItems</span><span class="o">;</span>

    <span class="kd">public</span> <span class="n">String</span> <span class="nf">toString</span><span class="o">()</span> <span class="o">{</span>
      <span class="k">return</span> <span class="n">order</span><span class="o">.</span><span class="na">getId</span><span class="o">()</span> <span class="o">+</span> <span class="s">&quot; totalAmount:&quot;</span> <span class="o">+</span> <span class="n">totalAmount</span> <span class="o">+</span> <span class="s">&quot; totalItems:&quot;</span> <span class="o">+</span> <span class="n">totalItems</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="n">Order</span> <span class="nf">getOrder</span><span class="o">()</span> <span class="o">{</span>
      <span class="k">return</span> <span class="n">order</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">setOrder</span><span class="o">(</span><span class="n">Order</span> <span class="n">order</span><span class="o">)</span> <span class="o">{</span>
      <span class="k">this</span><span class="o">.</span><span class="na">order</span> <span class="o">=</span> <span class="n">order</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="n">Double</span> <span class="nf">getTotalAmount</span><span class="o">()</span> <span class="o">{</span>
      <span class="k">return</span> <span class="n">totalAmount</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">setTotalAmount</span><span class="o">(</span><span class="n">Double</span> <span class="n">totalAmount</span><span class="o">)</span> <span class="o">{</span>
      <span class="k">this</span><span class="o">.</span><span class="na">totalAmount</span> <span class="o">=</span> <span class="n">totalAmount</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="n">Double</span> <span class="nf">getTotalItems</span><span class="o">()</span> <span class="o">{</span>
      <span class="k">return</span> <span class="n">totalItems</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">setTotalItems</span><span class="o">(</span><span class="n">Double</span> <span class="n">totalItems</span><span class="o">)</span> <span class="o">{</span>
      <span class="k">this</span><span class="o">.</span><span class="na">totalItems</span> <span class="o">=</span> <span class="n">totalItems</span><span class="o">;</span>
    <span class="o">}</span>
  <span class="o">}</span>
  
</pre></div>
</div>
  </p>

  <h4>tableAliasMapping()</h4>
  tableAliasMapping() will automatically map columns from the query results to the associated object based
  on its path. It does this using the query alias. This is a convenience mathod so that you don't have to
  map each column individually.

  <p>So a test case looks like:

  <div class="syntax java"><div class="highlight"><pre>  <span class="n">String</span> <span class="n">rs</span> <span class="o">=</span> <span class="s">&quot;select o.id, o.status, c.id, c.name, &quot;</span><span class="o">+</span>
  <span class="s">&quot; d.id, d.order_qty, p.id, p.name &quot;</span> <span class="o">+</span>
  <span class="s">&quot;from o_order o join o_customer c on c.id = o.kcustomer_id &quot;</span> <span class="o">+</span>
  <span class="s">&quot;join o_order_detail d on d.order_id = o.id &quot;</span> <span class="o">+</span>
  <span class="s">&quot;join o_product p on p.id = d.product_id &quot;</span> <span class="o">+</span>
  <span class="s">&quot;where o.id &lt;= :maxOrderId and p.id = :productId &quot;</span><span class="o">+</span>
  <span class="s">&quot;order by o.id, d.id asc&quot;</span><span class="o">;</span>


  <span class="n">RawSql</span> <span class="n">rawSql</span> <span class="o">=</span> <span class="n">RawSqlBuilder</span><span class="o">.</span><span class="na">parse</span><span class="o">(</span><span class="n">rs</span><span class="o">)</span>
      <span class="o">.</span><span class="na">tableAliasMapping</span><span class="o">(</span><span class="s">&quot;c&quot;</span><span class="o">,</span> <span class="s">&quot;customer&quot;</span><span class="o">)</span>
      <span class="o">.</span><span class="na">tableAliasMapping</span><span class="o">(</span><span class="s">&quot;d&quot;</span><span class="o">,</span> <span class="s">&quot;details&quot;</span><span class="o">)</span>
      <span class="o">.</span><span class="na">tableAliasMapping</span><span class="o">(</span><span class="s">&quot;p&quot;</span><span class="o">,</span> <span class="s">&quot;details.product&quot;</span><span class="o">)</span>
      <span class="o">.</span><span class="na">create</span><span class="o">();</span>

  <span class="n">List</span><span class="o">&lt;</span><span class="n">Order</span><span class="o">&gt;</span> <span class="n">ordersFromRaw</span> <span class="o">=</span> <span class="n">Ebean</span><span class="o">.</span><span class="na">find</span><span class="o">(</span><span class="n">Order</span><span class="o">.</span><span class="na">class</span><span class="o">)</span>
      <span class="o">.</span><span class="na">setRawSql</span><span class="o">(</span><span class="n">rawSql</span><span class="o">)</span>
      <span class="o">.</span><span class="na">setParameter</span><span class="o">(</span><span class="s">&quot;maxOrderId&quot;</span><span class="o">,</span> <span class="mi">2</span><span class="o">)</span>
      <span class="o">.</span><span class="na">setParameter</span><span class="o">(</span><span class="s">&quot;productId&quot;</span><span class="o">,</span> <span class="mi">1</span><span class="o">)</span>
      <span class="o">.</span><span class="na">findList</span><span class="o">();</span>
    
</pre></div>
</div>

    Rather than using columnMapping like:

    <div class="syntax java"><div class="highlight"><pre>    <span class="n">RawSql</span> <span class="n">rawSql</span> <span class="o">=</span> <span class="n">RawSqlBuilder</span><span class="o">.</span><span class="na">parse</span><span class="o">(</span><span class="n">rs</span><span class="o">)</span>
        <span class="o">.</span><span class="na">columnMapping</span><span class="o">(</span><span class="s">&quot;t0.id&quot;</span><span class="o">,</span> <span class="s">&quot;id&quot;</span><span class="o">)</span>
        <span class="o">.</span><span class="na">columnMapping</span><span class="o">(</span><span class="s">&quot;t0.status&quot;</span><span class="o">,</span> <span class="s">&quot;status&quot;</span><span class="o">)</span>
        <span class="o">.</span><span class="na">columnMapping</span><span class="o">(</span><span class="s">&quot;t1.id&quot;</span><span class="o">,</span> <span class="s">&quot;customer.id&quot;</span><span class="o">)</span>
        <span class="o">.</span><span class="na">columnMapping</span><span class="o">(</span><span class="s">&quot;t1.name&quot;</span><span class="o">,</span> <span class="s">&quot;customer.name&quot;</span><span class="o">)</span>
        <span class="o">.</span><span class="na">columnMapping</span><span class="o">(</span><span class="s">&quot;t2.id&quot;</span><span class="o">,</span> <span class="s">&quot;details.id&quot;</span><span class="o">)</span>
        <span class="o">.</span><span class="na">columnMapping</span><span class="o">(</span><span class="s">&quot;t2.order_qty&quot;</span><span class="o">,</span> <span class="s">&quot;details.orderQty&quot;</span><span class="o">)</span>
        <span class="o">.</span><span class="na">columnMapping</span><span class="o">(</span><span class="s">&quot;t3.id&quot;</span><span class="o">,</span> <span class="s">&quot;details.product.id&quot;</span><span class="o">)</span>
        <span class="o">.</span><span class="na">columnMapping</span><span class="o">(</span><span class="s">&quot;t3.name&quot;</span><span class="o">,</span> <span class="s">&quot;details.product.name&quot;</span><span class="o">)</span>
        <span class="o">.</span><span class="na">create</span><span class="o">();</span>
    
</pre></div>
</div>

  <h2 id="sqlquery">SqlQuery</h2>
  <h4>
    Performing sql queries returning relational SqlRow's rather than beans / object graphs.
  </h4>

  <p>SqlQuery is where you specify the exact SQL SELECT statement and returns list, sets or maps of
    SqlRow objects. A SqlRow is a Map where the key is the column name.

  <p>

  <p>This is a fairly lightweight API that you could use instead of going to raw JDBC (which is of
    course an option).</p>

    <div class="syntax java"><div class="highlight"><pre>    <span class="n">String</span> <span class="n">sql</span> <span class="o">=</span> <span class="s">&quot;select b.id, b.title, b.type_code, b.updtime&quot;</span>
    <span class="o">+</span><span class="s">&quot; ,p.name as product_name &quot;</span>
    <span class="o">+</span><span class="s">&quot;from b_bug b join b_product p on p.id = b.product_id &quot;</span>
    <span class="o">+</span><span class="s">&quot;where b.id = :id&quot;</span><span class="o">;</span>

    <span class="n">SqlRow</span> <span class="n">bug</span> <span class="o">=</span> <span class="n">Ebean</span><span class="o">.</span><span class="na">createSqlQuery</span><span class="o">(</span><span class="n">sql</span><span class="o">)</span>
      <span class="o">.</span><span class="na">setParameter</span><span class="o">(</span><span class="s">&quot;id&quot;</span><span class="o">,</span> <span class="mi">1</span><span class="o">)</span>
      <span class="o">.</span><span class="na">findUnique</span><span class="o">();</span>
    <span class="n">String</span> <span class="n">prodName</span> <span class="o">=</span> <span class="n">bug</span><span class="o">.</span><span class="na">getString</span><span class="o">(</span><span class="s">&quot;product_name&quot;</span><span class="o">);</span>
    <span class="n">String</span> <span class="n">title</span> <span class="o">=</span> <span class="n">bug</span><span class="o">.</span><span class="na">getString</span><span class="o">(</span><span class="s">&quot;title&quot;</span><span class="o">);</span>
    
</pre></div>
</div>
<p>Note that you can use "Named" queries and put the sql statements in orm.xml rather than having it
in your code.</p>

<h2 id="l2cache">L2 Cache</h2>
<h4>
How to use the L2 cache with queries.
</h4>
...(under construction)...


<h2 id="autofetch">Autofetch</h2>
<h4>
Let Ebean automatically tune you queries using Autofetch.
</h4>

<p>Ebean can automatically tune your queries for you using a feature called "Autofetch". This has
the benefit of executing better performing queries that and reduced lazy loading.</p>

<p>Autofetch automatically modifies your queries â€“ essentially controlling the select() and
fetch() clauses to fetch all the data your application uses but no more. This has the effect
of reducing the amount of lazy loading and only fetches properties that are actually used</p>

<p>
Autofetch can also be used with a query that you have explicitly specified some
fetch() paths. Autofetch can add additional fetch() paths and tune which properties to fetch
per path.</p>

<p>
Example: a program that fetches some orders ... and processes them
<div class="syntax java"><div class="highlight"><pre><span class="c1">// fetch new orders</span>
<span class="n">List</span><span class="o">&lt;</span><span class="n">Order</span><span class="o">&gt;</span> <span class="n">orders</span> <span class="o">=</span>
  <span class="n">Ebean</span><span class="o">.</span><span class="na">find</span><span class="o">(</span><span class="n">Order</span><span class="o">.</span><span class="na">class</span><span class="o">)</span>
  <span class="o">.</span><span class="na">where</span><span class="o">().</span><span class="na">eq</span><span class="o">(</span><span class="s">&quot;status&quot;</span><span class="o">,</span> <span class="n">Order</span><span class="o">.</span><span class="na">Status</span><span class="o">.</span><span class="na">NEW</span><span class="o">)</span>
  <span class="o">.</span><span class="na">findList</span><span class="o">();</span>

  <span class="c1">// just read the orderDate</span>
  <span class="k">for</span> <span class="o">(</span><span class="n">Order</span> <span class="n">order</span> <span class="o">:</span> <span class="n">orders</span><span class="o">)</span> <span class="o">{</span>
    <span class="n">Date</span> <span class="n">orderDate</span> <span class="o">=</span> <span class="n">order</span><span class="o">.</span><span class="na">getOrderDate</span><span class="o">();</span>
  <span class="o">}</span>
  
</pre></div>
</div>
</p>
<p>
Initially Ebean has no "profiling" information so when the program is first run the query executed
is not optimal.
</p>

  <div class="syntax xml"><div class="highlight"><pre>  <span class="nt">&lt;sql</span> <span class="na">summary=</span><span class="s">&#39;[app.data.test.Order]&#39;</span><span class="nt">&gt;</span>
    select o.id, o.order_date, o.ship_date, o.cretime, o.updtime, o.status_code, o.customer_id
    from or_order o
    where o.status_code = ?
  <span class="nt">&lt;/sql&gt;</span>
  
</pre></div>
</div>
  <p>
    However, now that we have run the program once Ebean has collected some profiling information.
    Specifically it knows that for this query (based on the call stack) the program only reads the
    orderDate. So when we run the program a 2nd time...
  </p>

<div class="syntax xml"><div class="highlight"><pre>  <span class="nt">&lt;sql</span> <span class="na">summary=</span><span class="s">&#39;[app.data.test.Order] autoFetchTuned[true]&#39;</span><span class="nt">&gt;</span>
    select o.id, o.order_date, o.updtime
    from or_order o
    where o.status_code = ?
  <span class="nt">&lt;/sql&gt;</span>
</pre></div>
</div>

  <p>
    You will note the autoFetchTuned[true] on the output. This indicates that this query was
    tuned via Autofetch. In this case, the profiling indicated that only the orderDate
    property was used so that, along with the Id property and the version column are the only
    properties fetched.
  </p>

  <p>
    example: Now lets change the program. We will use another property of order and we will
    also get the customers name.
  </p>
  <div class="syntax java"><div class="highlight"><pre>  <span class="n">List</span><span class="o">&lt;</span><span class="n">Order</span><span class="o">&gt;</span> <span class="n">orders</span> <span class="o">=</span>
    <span class="n">Ebean</span><span class="o">.</span><span class="na">find</span><span class="o">(</span><span class="n">Order</span><span class="o">.</span><span class="na">class</span><span class="o">)</span>
    <span class="o">.</span><span class="na">where</span><span class="o">().</span><span class="na">eq</span><span class="o">(</span><span class="s">&quot;status&quot;</span><span class="o">,</span> <span class="n">Order</span><span class="o">.</span><span class="na">Status</span><span class="o">.</span><span class="na">NEW</span><span class="o">)</span>
    <span class="o">.</span><span class="na">findList</span><span class="o">();</span>

    <span class="k">for</span> <span class="o">(</span><span class="n">Order</span> <span class="n">order</span> <span class="o">:</span> <span class="n">orders</span><span class="o">)</span> <span class="o">{</span>
    <span class="n">Date</span> <span class="n">orderDate</span> <span class="o">=</span> <span class="n">order</span><span class="o">.</span><span class="na">getOrderDate</span><span class="o">();</span>
    <span class="c1">// also get the ship date</span>
    <span class="n">Date</span> <span class="n">shipDate</span> <span class="o">=</span> <span class="n">order</span><span class="o">.</span><span class="na">getShipDate</span><span class="o">();</span>
    <span class="c1">// ... and get the customer name</span>
    <span class="n">Customer</span> <span class="n">customer</span> <span class="o">=</span> <span class="n">order</span><span class="o">.</span><span class="na">getCustomer</span><span class="o">();</span>
    <span class="n">String</span> <span class="n">customerName</span> <span class="o">=</span> <span class="n">customer</span><span class="o">.</span><span class="na">getName</span><span class="o">();</span>
    <span class="o">}</span>
    
</pre></div>
</div>
  <p>
    The query Ebean will run is optimised for what the program USED to do. This results in
    some lazy loading occuring. The rest of the order is lazy loaded when the shipDate is
    read... and then the customer is lazy loaded when the customer name is read.
  </p>

  <div class="syntax xml"><div class="highlight"><pre>  <span class="nt">&lt;sql</span> <span class="na">summary=</span><span class="s">&#39;[app.data.test.Order] autoFetchTuned[true]&#39;</span><span class="nt">&gt;</span>
    select o.id, o.order_date, o.updtime
    from or_order o
    where o.status_code = ?
  <span class="nt">&lt;/sql&gt;</span>
  
</pre></div>
</div>
  -- LAZY LOADING: ... due to reading shipDate
  <div class="syntax xml"><div class="highlight"><pre>  <span class="nt">&lt;sql</span> <span class="na">summary=</span><span class="s">&#39;[app.data.test.Order]&#39;</span><span class="nt">&gt;</span>
    select o.id, o.order_date, o.ship_date, o.cretime, o.updtime, o.status_code,
    o.customer_id
    from or_order o
    where o.id = ?
  <span class="nt">&lt;/sql&gt;</span>
  
</pre></div>
</div>

  -- LAZY LOADING: ... due to reading customers name
  <div class="syntax xml"><div class="highlight"><pre>  <span class="nt">&lt;sql</span> <span class="na">summary=</span><span class="s">&#39;[app.data.test.Customer]&#39;</span><span class="nt">&gt;</span>
    select c.id, c.name, c.cretime, c.updtime, c.billing_address_id, c.status_code,
    c.shipping_address_id
    from or_customer c
    where c.id = ?
    <span class="nt">&lt;/sql&gt;</span>
  
</pre></div>
</div>

<p>
So the above queries are not so good. However, Ebean has now updated its profiling
information so when we run the program again...
</p>

  <div class="syntax xml"><div class="highlight"><pre>  <span class="nt">&lt;sql</span> <span class="na">summary=</span><span class="s">&#39;[app.data.test.Order, customer] autoFetchTuned[true]&#39;</span><span class="nt">&gt;</span>
    select o.id, o.order_date, o.updtime, o.ship_date
    , c.id, c.name, c.updtime
    from or_order o
    join or_customer c on o.customer_id = c.id
    where o.status_code = ?
  <span class="nt">&lt;sql&gt;</span>
  
</pre></div>
</div>

<p>
... now Ebean has added the shipDate and a join to customer fetching the
customer name.
</p>

<p>So, if you turn on autoFetch Ebean can optimise your queries based on how the
object graphs are actually used by the application. The developer has less work
by not having to define joins and you get the performance benefits of partial
objects with no work - nice.
</p>

<p>
Autofetch can continue to update its profiling information so that when your
application changes the queries will automatically be tuned to suit.
</p>


<h4>Explicit control on queries</h4>

<p>On the query object you can explicitly specify if you want to use autofetch or
not.
<div class="syntax java"><div class="highlight"><pre><span class="c1">// explicitly turn on Autofetch for this query</span>
<span class="n">query</span><span class="o">.</span><span class="na">setAutofetch</span><span class="o">(</span><span class="kc">true</span><span class="o">);</span>
</pre></div>
</div>
</p>

<h4>Implicit control from configuration</h4>

<p>There are a number of properties in ebean.properties which control how
autofetch works.

<div class="syntax properties"><div class="highlight"><pre><span class="c"># enable autofetch</span>
<span class="na">ebean.autofetch.querytuning</span><span class="o">=</span><span class="s">true</span>
<span class="c"># enable collection of profiling information</span>
<span class="na">ebean.autofetch.profiling</span><span class="o">=</span><span class="s">true</span>
<span class="c"># implicit autofetch mode</span>
<span class="c"># default_off, default_on, default_on_if_empty</span>
<span class="na">ebean.autofetch.implicitmode</span><span class="o">=</span><span class="s">default_on</span>
<span class="c"># minimum amount of profiling to collect before</span>
<span class="c"># autofetch will start tuning the query</span>
<span class="na">ebean.autofetch.profiling.min</span><span class="o">=</span><span class="s">1</span>
<span class="c"># profile every query up to base</span>
<span class="na">ebean.autofetch.profiling.base</span><span class="o">=</span><span class="s">10</span>
<span class="c"># after base collect profiling on 5% of queries</span>
<span class="na">ebean.autofetch.profiling.rate</span><span class="o">=</span><span class="s">0.05</span>
</pre></div>
</div>
<table class="table">
<tr>
<th>property</th>
<th>type/values</th>
<th>description</th>
</tr>
<tr>
<td>ebean.autofetch.querytuning</td>
<td>boolean</td>
<td>If true enables Autofetch to tune queries</td>
</tr>
<tr>
<td>ebean.autofetch.profiling</td>
<td>boolean</td>
<td>If true enables profiling information to be collected</td>
</tr>
<tr>
<td>ebean.autofetch.implicitmode</td>
<td>default_off<br>default_on<br>default_on_if_empty</td>
<td>default_on_if_empty means autofetch will only tune the query if neither
select() nor fetch() has been explicitly set on the query.
</td>
</tr>
<tr>
<td>ebean.autofetch.profiling.min</td>
<td>integer</td>
<td>The minimum amount of profiled queries to be collected before the
automatic query tuning will start to occur
</td>
</tr>
<tr>
<td>ebean.autofetch.profiling.base</td>
<td>integer</td>
<td>Will profile every query up to this number and after than will profile
based on the profiling.rate (5% of queries etc)
</td>
</tr>
<tr>
<td>ebean.autofetch.profiling.rate</td>
<td>float</td>
<td>The percentage of queries that are profiled after the base number has been
collected
</td>
</tr>
</table>
    </p>



  <h2 id="other_bits">Other Bits</h2>
  <h4>
    Other features for controlling queries.
  </h4>
  <ul>
    <li>forUpdate</li>
    <li>filterMany</li>
    <li>bufferFetchSize</li>
    <li>timeout</li>
    <li>distinct</li>
    <li>Fetching the 'row count'.</li>
  </ul>
  ...(under construction)...


</div>

    </div>

    <div class="col-md-3" role="complementary">
      <nav class="bs-docs-sidebar hidden-print hidden-xs hidden-sm">
        <ul class="nav bs-docs-sidenav">


<li class="active">
  <a href="/docs/introduction">Introduction</a>
        <ul class="nav">
          <li><a href="#use_jpa_mapping">Use JPA mappings</a></li>
          <li><a href="#simple_query_language">Simple query language</a></li>
          <li><a href="#intro_save_and_delete">Save and delete</a></li>
          <li><a href="#jpa_comparison">Comparison to JPA</a></li>
          <li><a href="#ebean_does_not">Ebean does not...</a></li>
        </ul>
</li>
<li class="active">
  <a href="/docs/enhancement">Enhancement</a>

          <ul class="nav">
            <li><a href="#enhance_maven">Maven</a></li>
            <li><a href="#enhance_maven_eclipse">Eclipse + Maven</a></li>
            <li><a href="#enhance_ant">Ant</a></li>
            <li><a href="#enhance_agent">Agent</a></li>
            <li><a href="#enhance_ide">IDE enhancement</a></li>
          </ul>
</li>
<li >
  <a href="/docs/configuration">Configuration</a>
</li>
<li >
  <a href="/docs/ebean_access_patterns">Ebean access patterns</a>
</li>
<li >
  <a href="/docs/field_and_property_access">Field and property access</a>
</li>

<li class="active">
  <a href="/docs/queries">Queries</a>
          <ul class="nav">
            <li><a href="#where_clause">Where clause</a></li>
            <li><a href="#query_language">Ebean query language</a></li>
            <li><a href="#partial_objects">Partial objects</a></li>
            <li><a href="#query_joins">Query joins</a></li>
            <li><a href="#fetchconfig">FetchConfig</a></li>
            <li><a href="#lazy_loading">Lazy loading</a></li>
            <li><a href="#named_queries">Named Queries</a></li>
            <li><a href="#large_queries">Large queries</a></li>
            <li><a href="#paging">Paging</a></li>
            <li><a href="#async_queriess">Asynchronous queries</a></li>
            <li><a href="#rawsql">RawSql</a></li>
            <li><a href="#sqlquery">SqlQuery</a></li>
            <li><a href="#l2cache">L2 cache</a></li>
            <li><a href="#autofetch">Autofetch</a></li>
            <li><a href="#other_bits">Other bits</a></li>
          </ul>
</li>
<li >
  <a href="/docs/saving">Saving</a>
</li>
<li >
  <a href="/docs/mapping">Mapping</a>
</li>
<li >
  <a href="/docs/transactions">Transactions</a>
</li>
<li >
  <a href="/docs/json">JSON</a>
</li>
<li >
  <a href="/docs/eventlisteners">Event listeners</a>
</li>
<li >
  <a href="/docs/readaudit">Read Audit</a>
</li>
<li class="active">
  <a href="/docs/changelog">Change Log</a>
</li>
<li >
  <a href="/docs/l2caching">L2 caching</a>
</li>
<li >
  <a href="/docs/testing">Testing</a>
</li>
<li >
  <a href="/docs/jvmlanguages">JVM Languages</a>
</li>

<li >
  <a href="/docs/clustering">Clustering</a>
</li>
<li >
  <a href="/docs/monitoring">Monitoring</a>
</li>
<li >
  <a href="/docs/architecture">Architecture</a>
</li>

        </ul>
          <a class="back-to-top" href="#top">
            Back to top
          </a>
      </nav>
    </div>
  </div>

</div>
<!-- /.row -->
</div>  <!-- /.container -->
  </div>
</div>

<footer id="footer">
 <div class="doc-footer">
  <ul class="doc-footer-links">
    <li><a href="/">Ebean ORM</a></li>
    <li> | </li>
    <li><a href="http://avaje-metric.github.io">Metrics</a></li>
    <li> | </li>
    <li><a href="/websitegenerator/index">Website Generator</a></li>
    <li> | </li>
    <li><a href="/jetty/index">Jetty Runnable War</a></li>
  </ul>
 </div>
</footer>

  <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.2/jquery.min.js"></script>
  <script src="/js/bootstrap.min.js"></script>
  <script src="/js/jquery.easing.min.js"></script>

  <script src="/js/json2.js"></script>
  <script src="/js/jquery.cookie.min.js"></script>
  <script src="/js/jquery.storageapi.min.js"></script>

  <script src="/js/ebean-site.js"></script>

  </body>
</html>

<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta id="layout-head" />
    <title>avaje ebean</title>
    <link rel="shortcut icon" href="/images/favicon.ico" >
    <!--<link href="/css/bootstrap.min.css" rel="stylesheet">-->
    <!-- Latest compiled and minified CSS -->
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.5/css/bootstrap.min.css">
    <link rel="stylesheet" href="/css/pygments.css" type="text/css" />
    <link rel="stylesheet" href="/css/site.css">
    <link rel="stylesheet" href="//netdna.bootstrapcdn.com/font-awesome/4.1.0/css/font-awesome.min.css">
      <!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
      <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
      <script src="https://oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>
    <![endif]-->
</head>
  <body>
  <div id="wrap">
    <div id="header">
    <div class="navbar navbar-inverse navbar-fixed-top" role="navigation">
      <div class="container">
        <div class="navbar-header">
          <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
            <span class="sr-only">Toggle navigation</span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
          </button>
          <a class="navbar-brand" href="/">Ebean ORM</a>
        </div>
        <div class="collapse navbar-collapse">
          <ul class="nav navbar-nav pull-right">
            <li ><a href="/"><span class="glyphicon glyphicon-home"></span>  Home</a></li>
            <li ><a href="/videos">Videos</a></li>
            <li ><a href="/quickstart">Quick Start</a></li>
            <li ><a href="/support">Support</a></li>
            <li class="active"><a href="/docs">Docs</a></li>
            <li ><a target="_blank" href="/apidocs">ApiDocs</a></li>
            <li ><a href="/releases">Releases</a></li>
            <li ><a target="_blank" href="https://github.com/ebean-orm/avaje-ebeanorm"> <i class="fa fa-github"></i> Github</a></li>
          </ul>
        </div><!--/.nav-collapse -->
      </div>
    </div>

  </div>
  <div id="main" data-offset="60">
<div class="jumbotron mini">
  <div class="container">
    <h1><a href="/docs">Documentation</a> / Saving </h1>
  </div>
</div>

<div class="container doc-index bs-docs-container">

  <div class="row">

    <div class="col-md-9" role="main">

      <div class="bs-docs-section">
<h1 id="updates">Saving</h1>


<h2 id="saves">Saves</h2>
<p>
Save will either insert or update the bean depending on its state.
</p>
<div class="syntax java"><div class="highlight"><pre><span class="n">Order</span> <span class="n">order</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Order</span><span class="o">();</span>
<span class="n">order</span><span class="o">.</span><span class="na">setOrderDate</span><span class="o">(</span><span class="k">new</span> <span class="n">Date</span><span class="o">());</span>
<span class="o">...</span>
<span class="c1">// insert the order</span>
<span class="n">Ebean</span><span class="o">.</span><span class="na">save</span><span class="o">(</span><span class="n">order</span><span class="o">);</span>
</pre></div>
</div>
<p>
If the bean was fetched it will be updated...
</p>

Order order = Ebean.find(Order.class, 12);
order.setStatus("SHIPPED");
...
// update the order
Ebean.save(order);

<p>
Save and Delete will CASCADE based on the CascadeType
specificed on the associated @OneToMany, @OneToOne etc annotation.
</p>
<p>
By default save and delete will not cascade so you need to
specify a cascade type (such as the one on details below) for
save() or delete() to cascade.
</p>

...
// the Entity bean with its Mapping Annotations
...
@Entity
@Table(name="or_order")
public class Order {

    ...
	// no cascading
    @ManyToOne
    Customer customer;

	// save and delete cascaded
    @OneToMany(cascade=CascadeType.ALL)
    List&lt;OrderDetail&gt; details;

	...


<p>
Note the <em>@OneToMany(cascade=CascadeType.ALL)</em> on
the details property. This means save() and delete() will
both casade from order to its order details.
</p>

...
// save the order ...  will cascade also saving the order details
Ebean.save(order);


<h2 id="deletes">Deletes</h2>
<p>
Delete is very similar to save. Just call Ebean.delete();
</p>

...
Order order = Ebean.find(Order.class, 12);

// delete the order
// ... this will cascade also deleting the order details
// ... with either CascadeType.ALL or CascadeType.REMOVE
Ebean.delete(order);


<h2 id="cascading">Cascading</h2>
<p>The mapping annotations @ManyToOne, @OneToMany, @OneToOne and
@ManyToMany provide a cascade attribute which is used to control whether saves and
deletes are cascaded.</p>

<p>The default is to not cascade a save or delete (as per JPA spec).</p>


<p>The example below shows the Order entity bean with its mapping annotations. If you save
an Order the details will be saved as well but the associated customer will not be saved as
there is no cascade atttribute and the default is to not cascade.</p>

<div class="syntax java"><div class="highlight"><pre><span class="o">...</span>
<span class="nd">@Entity</span>
<span class="nd">@Table</span><span class="o">(</span><span class="n">name</span><span class="o">=</span><span class="s">&quot;or_order&quot;</span><span class="o">)</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">Order</span> <span class="o">{</span>
  <span class="o">...</span>
  <span class="c1">// no cascading</span>
  <span class="nd">@ManyToOne</span>
  <span class="n">Customer</span> <span class="n">customer</span><span class="o">;</span>

  <span class="c1">// save and delete cascaded</span>
  <span class="nd">@OneToMany</span><span class="o">(</span><span class="n">cascade</span><span class="o">=</span><span class="n">CascadeType</span><span class="o">.</span><span class="na">ALL</span><span class="o">)</span>
  <span class="n">List</span><span class="o">&lt;</span><span class="n">OrderDetail</span><span class="o">&gt;</span> <span class="n">details</span><span class="o">;</span>
</pre></div>
</div>

<h2 id="bulkupdate">Bulk updates</h2>
<p>Update provides a way on issuing a insert, update or delete statement.</p>
<p>
This is useful for updating or deleting multiple rows (or a single row) with a single
statement (often described as a "bulk" update).</p>
<p>This is also useful if you want to perform an update or delete without having to execute a
query first. This is a typical approach for performing an update in a stateless web
application.</p>
<p>The statement can be provided in as raw DML with the table names and column names or
in a 'logical' form where entity name is used in place of the table name and property
names are used in place of column names.</p>

<div class="syntax java"><div class="highlight"><pre><span class="c1">// orm bulk delete use bean name and bean properties</span>
<span class="n">server</span><span class="o">.</span><span class="na">createUpdate</span><span class="o">(</span><span class="n">OrderDetail</span><span class="o">.</span><span class="na">class</span><span class="o">,</span> <span class="s">&quot;delete from orderDetail&quot;</span><span class="o">).</span><span class="na">execute</span><span class="o">();</span>

<span class="c1">// sql bulk update uses table and column names</span>
<span class="n">server</span><span class="o">.</span><span class="na">createSqlUpdate</span><span class="o">(</span><span class="s">&quot;delete from o_country&quot;</span><span class="o">).</span><span class="na">execute</span><span class="o">();</span>
</pre></div>
</div>`

<h2 id="bulksqlupdate">Bulk SQL updates</h2>

<p>In similar fashion to <a href="#sqlquery">SqlQuery</a> you can specify a SQL INSERT, UPDATE or DELETE statement with named or positioned parameters.</p>

<div class="syntax java"><div class="highlight"><pre><span class="n">String</span> <span class="n">dml</span> <span class="o">=</span> <span class="s">&quot;update b_bug set title=:title where id = :id&quot;</span><span class="o">;</span>
<span class="n">SqlUpdate</span> <span class="n">update</span> <span class="o">=</span> <span class="n">Ebean</span><span class="o">.</span><span class="na">createSqlUpdate</span><span class="o">(</span><span class="n">dml</span><span class="o">)</span>
  <span class="o">.</span><span class="na">setParameter</span><span class="o">(</span><span class="s">&quot;title&quot;</span><span class="o">,</span> <span class="s">&quot;Updated Again&quot;</span><span class="o">)</span>
  <span class="o">.</span><span class="na">setParameter</span><span class="o">(</span><span class="s">&quot;id&quot;</span><span class="o">,</span> <span class="mi">1</span><span class="o">);</span>
<span class="kt">int</span> <span class="n">rows</span> <span class="o">=</span> <span class="n">update</span><span class="o">.</span><span class="na">execute</span><span class="o">();</span>
</pre></div>
</div>

<h2 id="callablesql">CallableSql</h2>

<p>CallableSql provides a way to call a database stored procedure.</p>

<div class="syntax java"><div class="highlight"><pre><span class="n">String</span> <span class="n">sql</span> <span class="o">=</span> <span class="s">&quot;{call sp_order_mod(?,?)}&quot;</span><span class="o">;</span>
<span class="n">CallableSql</span> <span class="n">cs</span> <span class="o">=</span> <span class="n">Ebean</span><span class="o">.</span><span class="na">createCallableSql</span><span class="o">(</span><span class="n">sql</span><span class="o">);</span>
<span class="n">cs</span><span class="o">.</span><span class="na">setParameter</span><span class="o">(</span><span class="mi">1</span><span class="o">,</span> <span class="s">&quot;turbo&quot;</span><span class="o">);</span>
<span class="n">cs</span><span class="o">.</span><span class="na">registerOut</span><span class="o">(</span><span class="mi">2</span><span class="o">,</span> <span class="n">Types</span><span class="o">.</span><span class="na">INTEGER</span><span class="o">);</span>
<span class="n">Ebean</span><span class="o">.</span><span class="na">execute</span><span class="o">(</span><span class="n">cs</span><span class="o">);</span>

<span class="c1">// read the out parameter</span>
<span class="n">Integer</span> <span class="n">returnValue</span> <span class="o">=</span> <span class="o">(</span><span class="n">Integer</span><span class="o">)</span> <span class="n">cs</span><span class="o">.</span><span class="na">getObject</span><span class="o">(</span><span class="mi">2</span><span class="o">);</span>
</pre></div>
</div>

<p>You can extend CallableSql and you can also get the java.sql.Connection from a Transaction and use raw JDBC API to call a stored procedure.</p>


<h2 id="rawjdbc">Raw JDBC</h2>

<p>You can't always predict when your application requirements can't be meet with the
features in Ebean. It is nice you now you can easily use raw JDBC if and when you need
to.</p>
<p>The java.sql.Connection object can be returned from a transaction, and with that you can
perform any raw JDBC calls you like.</p>

<p>This may be useful for Savepoints, advanced Clob/Blob use or advanced stored
procedure calls (if CallableSql doesn't do the business for you).</p>

<div class="syntax java"><div class="highlight"><pre><span class="n">Transaction</span> <span class="n">transaction</span> <span class="o">=</span> <span class="n">Ebean</span><span class="o">.</span><span class="na">beginTransaction</span><span class="o">();</span>
<span class="k">try</span> <span class="o">{</span>
  <span class="n">Connection</span> <span class="n">connection</span> <span class="o">=</span> <span class="n">transaction</span><span class="o">.</span><span class="na">getConnection</span><span class="o">();</span>
  <span class="c1">// use raw JDBC</span>
  <span class="o">...</span>
  <span class="c1">// assuming we updated the &quot;o_shipping_details&quot; table</span>
  <span class="c1">// inform Ebean so it can maintain it&#39;s &#39;L2&#39; cache</span>
  <span class="n">transaction</span><span class="o">.</span><span class="na">addModification</span><span class="o">(</span><span class="s">&quot;o_shipping_details&quot;</span><span class="o">,</span><span class="kc">false</span><span class="o">,</span><span class="kc">true</span><span class="o">,</span><span class="kc">false</span><span class="o">);</span>
  <span class="n">Ebean</span><span class="o">.</span><span class="na">commitTransaction</span><span class="o">();</span>
<span class="o">}</span> <span class="k">finally</span> <span class="o">{</span>
  <span class="n">Ebean</span><span class="o">.</span><span class="na">endTransaction</span><span class="o">();</span>
<span class="o">}</span>
</pre></div>
</div>

<p>The <b>transaction.addModification()</b> in the code above informs Ebean that your jdbc code
updated the o_shipping_details table. Ebean uses this information to automatically
manage its "L2" cache as well as maintain Lucene text indexes.</p>

<h2 id="batch_processing">JDBC Batch</h2>
<p>
  Ebean provides support for JDBC batch processing.  Batch processing groups related SQL statements into a batch and submits them with one call to the database.
</p>
<p>
  Batch settings can be configured through <a href="properties_config">ebean.properties</a> or through <a href="programmatic_config">ServerConfig</a>, and can be overridden per transaction.
</p>

<p>
  You can set the batch mode for the entity being saved through setBatch() and for its child collections through setCascadeBatch().
</p>

<p>
  ...(under construction)... need to provide better guidance on how to determine batch mode, child batch mode, and batch size
</p>

<div class="syntax java"><div class="highlight"><pre><span class="n">Transaction</span> <span class="n">transaction</span> <span class="o">=</span> <span class="n">ebeanServer</span><span class="o">.</span><span class="na">beginTransaction</span><span class="o">();</span>
<span class="k">try</span> <span class="o">{</span>
  <span class="c1">// turn of cascade persist</span>
  <span class="n">transaction</span><span class="o">.</span><span class="na">setCascadePersist</span><span class="o">(</span><span class="kc">false</span><span class="o">);</span>

  <span class="c1">// control the jdbc batch mode and size</span>
  <span class="c1">// transaction.setBatchMode(true); // equivalent to transaction.setBatch(PersistBatch.ALL);</span>
  <span class="c1">// transaction.setBatchMode(false); // equivalent to transaction.setBatch(PersistBatch.NONE);</span>
  <span class="n">transaction</span><span class="o">.</span><span class="na">setBatch</span><span class="o">(</span><span class="n">PersistBatch</span><span class="o">.</span><span class="na">ALL</span><span class="o">);</span> <span class="c1">// PersistBatch: NONE, INSERT, ALL</span>
  <span class="n">transaction</span><span class="o">.</span><span class="na">setCascadeBatch</span><span class="o">(</span><span class="n">PersistBatch</span><span class="o">.</span><span class="na">INSERT</span><span class="o">);</span> <span class="c1">// PersistBatch: NONE, INSERT, ALL</span>
  <span class="n">transaction</span><span class="o">.</span><span class="na">setBatchSize</span><span class="o">(</span><span class="mi">30</span><span class="o">);</span>


  <span class="c1">// for a large batch insert if you want to skip</span>
  <span class="c1">// getting the generated keys</span>
  <span class="n">transaction</span><span class="o">.</span><span class="na">setBatchGetGeneratedKeys</span><span class="o">(</span><span class="kc">false</span><span class="o">);</span>

  <span class="c1">// for batch processing via raw SQL you can inform</span>
  <span class="c1">// Ebean what tables were modified so that it can</span>
  <span class="c1">// clear the appropriate L2 caches</span>
  <span class="n">String</span> <span class="n">tableName</span> <span class="o">=</span> <span class="s">&quot;o_customer&quot;</span><span class="o">;</span>
  <span class="kt">boolean</span> <span class="n">inserts</span> <span class="o">=</span> <span class="kc">true</span><span class="o">;</span>
  <span class="kt">boolean</span> <span class="n">upates</span> <span class="o">=</span> <span class="kc">true</span><span class="o">;</span>
  <span class="kt">boolean</span> <span class="n">deletes</span> <span class="o">=</span> <span class="kc">false</span><span class="o">;</span>
  <span class="n">transaction</span><span class="o">.</span><span class="na">addModification</span><span class="o">(</span><span class="n">tableName</span><span class="o">,</span> <span class="n">inserts</span><span class="o">,</span> <span class="n">updates</span><span class="o">,</span> <span class="n">deletes</span><span class="o">);</span>

  <span class="o">...</span>
<span class="o">}</span> <span class="k">finally</span> <span class="o">{</span>
  <span class="n">transaction</span><span class="o">.</span><span class="na">end</span><span class="o">();</span>
<span class="o">}</span>
</pre></div>
</div>

example using @Transactional
<div class="syntax java"><div class="highlight"><pre><span class="nd">@Transactional</span><span class="o">(</span><span class="n">batch</span> <span class="o">=</span> <span class="n">PersistBatch</span><span class="o">.</span><span class="na">ALL</span><span class="o">,</span> <span class="n">batchOnCascade</span> <span class="o">=</span> <span class="n">PersistBatch</span><span class="o">.</span><span class="na">ALL</span><span class="o">,</span> <span class="n">batchSize</span> <span class="o">=</span> <span class="mi">99</span><span class="o">)</span>
  <span class="kd">public</span> <span class="kt">void</span> <span class="nf">doWithBatchOptionsSet</span><span class="o">()</span> <span class="o">{</span>

    <span class="n">Transaction</span> <span class="n">txn</span> <span class="o">=</span> <span class="n">Ebean</span><span class="o">.</span><span class="na">currentTransaction</span><span class="o">();</span>
    <span class="n">assertEquals</span><span class="o">(</span><span class="n">PersistBatch</span><span class="o">.</span><span class="na">ALL</span><span class="o">,</span> <span class="n">txn</span><span class="o">.</span><span class="na">getBatch</span><span class="o">());</span>
    <span class="n">assertEquals</span><span class="o">(</span><span class="n">PersistBatch</span><span class="o">.</span><span class="na">ALL</span><span class="o">,</span> <span class="n">txn</span><span class="o">.</span><span class="na">getBatchOnCascade</span><span class="o">());</span>
    <span class="n">assertEquals</span><span class="o">(</span><span class="mi">99</span><span class="o">,</span> <span class="n">txn</span><span class="o">.</span><span class="na">getBatchSize</span><span class="o">());</span>
<span class="o">}</span>
</pre></div>
</div>

</div>

    </div>

    <div class="col-md-3" role="complementary">
      <nav class="bs-docs-sidebar hidden-print hidden-xs hidden-sm">
        <ul class="nav bs-docs-sidenav">


<li class="active">
  <a href="/docs/introduction">Introduction</a>
        <ul class="nav">
          <li><a href="#use_jpa_mapping">Use JPA mappings</a></li>
          <li><a href="#simple_query_language">Simple query language</a></li>
          <li><a href="#intro_save_and_delete">Save and delete</a></li>
          <li><a href="#jpa_comparison">Comparison to JPA</a></li>
          <li><a href="#ebean_does_not">Ebean does not...</a></li>
        </ul>
</li>
<li class="active">
  <a href="/docs/enhancement">Enhancement</a>

          <ul class="nav">
            <li><a href="#enhance_maven">Maven</a></li>
            <li><a href="#enhance_maven_eclipse">Eclipse + Maven</a></li>
            <li><a href="#enhance_ant">Ant</a></li>
            <li><a href="#enhance_agent">Agent</a></li>
            <li><a href="#enhance_ide">IDE enhancement</a></li>
          </ul>
</li>
<li >
  <a href="/docs/configuration">Configuration</a>
</li>
<li >
  <a href="/docs/ebean_access_patterns">Ebean access patterns</a>
</li>
<li >
  <a href="/docs/field_and_property_access">Field and property access</a>
</li>

<li class="active">
  <a href="/docs/queries">Queries</a>
          <ul class="nav">
            <li><a href="#where_clause">Where clause</a></li>
            <li><a href="#query_language">Ebean query language</a></li>
            <li><a href="#partial_objects">Partial objects</a></li>
            <li><a href="#query_joins">Query joins</a></li>
            <li><a href="#fetchconfig">FetchConfig</a></li>
            <li><a href="#lazy_loading">Lazy loading</a></li>
            <li><a href="#named_queries">Named Queries</a></li>
            <li><a href="#large_queries">Large queries</a></li>
            <li><a href="#paging">Paging</a></li>
            <li><a href="#async_queriess">Asynchronous queries</a></li>
            <li><a href="#rawsql">RawSql</a></li>
            <li><a href="#sqlquery">SqlQuery</a></li>
            <li><a href="#l2cache">L2 cache</a></li>
            <li><a href="#autofetch">Autofetch</a></li>
            <li><a href="#other_bits">Other bits</a></li>
          </ul>
</li>
<li class="active">
  <a href="/docs/saving">Saving</a>
          <ul class="nav">
            <li><a href="#saves">Save</a></li>
            <li><a href="#deletes">Delete</a></li>
            <li><a href="#cascading">Cascade</a></li>
            <li><a href="#bulkupdate">Bulk updates</a></li>
            <li><a href="#bulksqlupdate">Bulk SQL updates</a></li>
            <li><a href="#callablesql">CallableSql</a></li>
            <li><a href="#rawjdbc">Raw JDBC</a></li>
            <li><a href="#batch_processing">JDBC Batch</a></li>
          </ul>
</li>
<li >
  <a href="/docs/mapping">Mapping</a>
</li>
<li >
  <a href="/docs/transactions">Transactions</a>
</li>
<li >
  <a href="/docs/json">JSON</a>
</li>
<li >
  <a href="/docs/eventlisteners">Event listeners</a>
</li>
<li >
  <a href="/docs/readaudit">Read Audit</a>
</li>
<li class="active">
  <a href="/docs/changelog">Change Log</a>
</li>
<li >
  <a href="/docs/l2caching">L2 caching</a>
</li>
<li >
  <a href="/docs/testing">Testing</a>
</li>
<li >
  <a href="/docs/jvmlanguages">JVM Languages</a>
</li>

<li >
  <a href="/docs/clustering">Clustering</a>
</li>
<li >
  <a href="/docs/monitoring">Monitoring</a>
</li>
<li >
  <a href="/docs/architecture">Architecture</a>
</li>

        </ul>
          <a class="back-to-top" href="#top">
            Back to top
          </a>
      </nav>
    </div>
  </div>

</div>
<!-- /.row -->
</div>  <!-- /.container -->
  </div>
</div>

<footer id="footer">
 <div class="doc-footer">
  <ul class="doc-footer-links">
    <li><a href="/">Ebean ORM</a></li>
    <li> | </li>
    <li><a href="http://avaje-metric.github.io">Metrics</a></li>
    <li> | </li>
    <li><a href="/websitegenerator/index">Website Generator</a></li>
    <li> | </li>
    <li><a href="/jetty/index">Jetty Runnable War</a></li>
  </ul>
 </div>
</footer>

  <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.2/jquery.min.js"></script>
  <script src="/js/bootstrap.min.js"></script>
  <script src="/js/jquery.easing.min.js"></script>

  <script src="/js/json2.js"></script>
  <script src="/js/jquery.cookie.min.js"></script>
  <script src="/js/jquery.storageapi.min.js"></script>

  <script src="/js/ebean-site.js"></script>

  </body>
</html>

<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta id="layout-head" />
    <title>avaje ebean</title>
    <link rel="shortcut icon" href="/images/favicon.ico" >
    <!--<link href="/css/bootstrap.min.css" rel="stylesheet">-->
    <!-- Latest compiled and minified CSS -->
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.5/css/bootstrap.min.css">
    <link rel="stylesheet" href="/css/pygments.css" type="text/css" />
    <link rel="stylesheet" href="/css/site.css">
    <link rel="stylesheet" href="//netdna.bootstrapcdn.com/font-awesome/4.1.0/css/font-awesome.min.css">
      <!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
      <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
      <script src="https://oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>
    <![endif]-->
</head>
  <body>
  <div id="wrap">
    <div id="header">
    <div class="navbar navbar-inverse navbar-fixed-top" role="navigation">
      <div class="container">
        <div class="navbar-header">
          <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
            <span class="sr-only">Toggle navigation</span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
          </button>
          <a class="navbar-brand" href="/">Ebean ORM</a>
        </div>
        <div class="collapse navbar-collapse">
          <ul class="nav navbar-nav pull-right">
            <li ><a href="/"><span class="glyphicon glyphicon-home"></span>  Home</a></li>
            <li ><a href="/videos">Videos</a></li>
            <li ><a href="/quickstart">Quick Start</a></li>
            <li ><a href="/support">Support</a></li>
            <li class="active"><a href="/docs">Docs</a></li>
            <li ><a target="_blank" href="/apidocs">ApiDocs</a></li>
            <li ><a href="/releases">Releases</a></li>
            <li ><a target="_blank" href="https://github.com/ebean-orm/avaje-ebeanorm"> <i class="fa fa-github"></i> Github</a></li>
          </ul>
        </div><!--/.nav-collapse -->
      </div>
    </div>

  </div>
  <div id="main" data-offset="60">
<div class="jumbotron mini">
  <div class="container">
    <h1><a href="/docs">Documentation</a> / Mapping </h1>
  </div>
</div>

<div class="container doc-index bs-docs-container">

  <div class="row">

    <div class="col-md-9" role="main">

      <div class="bs-docs-section">
<h1 id="mapping">Mapping</h1>

<p>The main goal of "Mapping" is to isolate the application code from the Database Schema.</p>
<p>This means that some changes can occur to the schema without breaking the application.
The application code can be written without reference to the specific table names, view
names and column names. This means that your application can more easily withstand
some unforseen changes.</p>

<h2 id="jpa_mapping">JPA mapping</h2>
<p>Ebean uses the same mapping as per the JPA specification. You can learn and use the
same mapping annotations. This is generally a very good part of the specification and I'd
expect this part of the specification to mostly stand the test of time.</p>


<h2 id="ddl_generation">DDL generation</h2>
<p>Ebean generated DDL is useful for agile development and testing. It is also useful to help get an understanding of the mapping.</p>
<p>
For simple Databases the DDL generated will be sufficient but for large databases it is not
really 'production quality'. For large Databases you will likely use it as a starting point.
DBA's will want to add more control over physical aspects of Tables and Indexes (specify
tablespaces etc to spread IO across disks, partition large tables, control freespace
depending on the etc).
</p>

<h2 id="naming_convention">Naming convention</h2>

<p>Ebean has a Naming Convention API to map column names to property names. It also
maps entity to table names and can take into account database schema and catalog if
required.</p>

<p>Refer to: com.avaje.ebean.config.NamingConvention</p>
<p>The default UnderscoreNamingConvention converts column names with underscores into
normal java camel case property names (e.g. "first_name" maps to "firstName").</p>


<p>You can also use the MatchingNamingConvention or implement your own.</p>

<p>The MatchingNamingConvention names column names to match property names and table names to match entity names.
  Ebean follows the JPA specification which states that the in the case of no annotations the name of the class will be take as the table name and the name of a property will be taken as the name of the column.
</p>

<h2 id="mapping_annotations">Mapping annotations</h2>

<h4>Basics</h4>
<ul>
  <li>
    @Entity - This simply marks an Entity Bean. Ebean has the same restrictions as per the JPA spec
    with the entity beans requiring a default constructor and with properties following the java
    beans conventions (with getter and setter names).
  </li><li>
    @Table - Here you can specify the table name that the entity bean will use. More specifically this is
    the "base table" as an entity bean could have a number of "secondary" tables as well.
  </li><li>
    @Id and @EmbeddedId -Use one of these to mark the property that is the id property. You should use @Id if the id
    property is a simple scalar type (like Integer, String etc) and you should use @EmbeddedId if the id type is complex (an embedded bean).
  </li><li>
    @Column - Use this if the naming convention does not match the bean property name to the database
    column or if you need to use quoted identifiers. Otherwise it is not required.
  </li><li>
    @Lob - This marks a property that is mapped to a Clob/Blob/Longvarchar or Longvarbinary.
  </li><li>
    @Transient -This marks a property that is not persistent.
  </li><li>
    @CreatedTimestamp - Sets a timestamp property to current datetie when the entity is created/inserted. An alternative to using this annotation would be to use @Column(insertable = false, updateable = false) and then have the DB insert the current time (set the default value on the DB column is SYSTIME etc).  The downside to this alternative approach is that the inserted entity does not have the timestamp value after the insert has occurred. You need to fetch the entity back to get the inserted timestamp if you want to used it.
    <br>
    @UpdatedTimestamp - Set a timestamp property that is set to the datetime when the entity was last updated.

  </li>


</ul>


<h2 id="relationships">Relationships</h2>

<h4>Database Design and Normalisation</h4>
<p>If you are familiar with Database design and normalisation then the relationships
will become clear fairly quickly. If you are not familiar then it is recommended that you read up on these
topics (a quick trip to wikipedia) since it will help you a lot in this area of ORM mapping.
</p>

<h4>DB Foreign Keys and ORM Relationships</h4>
<p>Assuming your DB has foreign keys and has been well designed then the ORM mapping
should follow quite naturally. If you DB has a more "interesting" design then the ORM
mapping can be a lot more painful with more compromises.</p>

<h4>One-to-Many relationship</h4>
<p>This is probably the most common relationship so we will start with a One to Many
relationship. The @OneToMany and the @ManyToOne represent the two ends of a
relationship. This relationship typically maps directly to a Database Foreign Key
constraint...</p>

<h4>Database Foreign Key constraint</h4>
<p>A typical database design is full of "One to Many/Many to One" relationships implemented
using a Foreign Key constraint. A foreign key constraint has an "imported" side and an
"exported" side.</p>
<ul>
  <li>"A Customer has many Orders"</li>
  <li>"An Order belongs to a Customer"<li>
  <li>The customer table "exports" its primary key to the order table</li>
  <li>The order table "imports/references" the customer table's primary key.</li>
</ul>

<div class="bs-callout bs-callout-primary">
<p>  A Foreign Key constraint can be viewed from the exported side
(customer table) or the imported side (order table).</p>
<p>... @OneToMany and @ManyToOne map directly to this.</p>
</div>

<p>
The Customer entity bean...
<div class="syntax java"><div class="highlight"><pre><span class="o">...</span>
<span class="nd">@Entity</span>
<span class="nd">@Table</span><span class="o">(</span><span class="n">name</span><span class="o">=</span><span class="s">&quot;or_customer&quot;</span><span class="o">)</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">Customer</span> <span class="o">{</span>
  <span class="o">...</span>
  <span class="nd">@OneToMany</span>
  <span class="n">List</span><span class="o">&lt;</span><span class="n">Order</span><span class="o">&gt;</span> <span class="n">orders</span><span class="o">;</span>
</pre></div>
</div>

The Order entity bean...
...
@Entity
@Table(name="or_order")
public class Order {
  ...
  @ManyToOne
  Customer customer;

</p>
<p>
Because the @OneToMany and @ManyToOne are both mapped this is a
"Bidirectional" relationship. You can navigate the object graph in either
direction.
</p>

<h4>Unidirectional Relationships</h4>
<p>To turn a Bidirectional relationship into a Unidirectional relationship you need to either
remove the @OneToMany (Customer.orders property) or the @ManyToOne (Order.customer property).</p>

<h4>Removing a OneToMany - no problem</h4>
<p>eg. Remove List<Order> from Customer
</p><p>
You can generally remove the OneToMany side of a relationship without any major issues.
The issue being that you can not navigate the object graph in that direction.
</p><p>
Why remove a OneToMany? Sometimes the OneToMany side is not useful to the
application or even dangerous if used. For example on Product there could be a
List<OrderDetail> but that could be considered useless or even dangerous if it was
navigated (and all order details for a product where lazy loaded).

<h4>Removing a ManyToOne - watch those inserts...</h4>
<p>eg. Remove Customer from Order
</p><p>
If you remove a ManyToOne this effects how a bean is saved (specifically the insert). The
reason is because it is the ManyToOne (importing) side of the relationship that holds the
foreign key column (e.g. or_order table holds the customer_id foreign key column).
</p><p>
Q: If the customer property is removed from the Order object how would you specify
which customer placed an order when you create a new order?
In Database speak this translates to ... when inserting an order how is the customer_id
column populated?
</p><p>
A: You have to use cascading save on the customer.orders and save the customer.
Sounds like a pain... and it would be in this case... lets look at a more realistic case where
you want to remove a ManyToOne...
</p><p>
eg. Remove Order from OrderDetail
</p><p>
Lets say you remove the Order property from the OrderDetail bean. Now lets say you
want to write some code to add a OrderDetail to an Order (insert). How do you specify
which Order it should go to?
</p><p>
"Turn on" cascade save on the @OneToMany side
<div class="syntax java"><div class="highlight"><pre><span class="nd">@Entity</span>
<span class="nd">@Table</span><span class="o">(</span><span class="n">name</span><span class="o">=</span><span class="s">&quot;or_order&quot;</span><span class="o">)</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">Order</span> <span class="o">{</span>
  <span class="o">...</span>
  <span class="c1">// must cascade the save</span>
  <span class="nd">@OneToMany</span><span class="o">(</span><span class="n">cascade</span><span class="o">=</span><span class="n">CascadeType</span><span class="o">.</span><span class="na">ALL</span><span class="o">)</span>
  <span class="n">List</span><span class="o">&lt;</span><span class="n">OrderDetail</span><span class="o">&gt;</span> <span class="n">details</span><span class="o">;</span>
</pre></div>
</div>

And save the order... which cascade saves the details
<div class="syntax java"><div class="highlight"><pre><span class="c1">// create or fetch the order</span>
<span class="n">Order</span> <span class="n">order</span> <span class="o">=</span> <span class="o">...</span>
<span class="n">List</span><span class="o">&lt;</span><span class="n">OrderDetail</span><span class="o">&gt;</span> <span class="n">details</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ArrayList</span><span class="o">&lt;</span><span class="n">OrderDetail</span><span class="o">&gt;();</span>
<span class="n">OrderDetail</span> <span class="n">orderDetail</span> <span class="o">=</span> <span class="o">...</span>
<span class="n">details</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="n">orderDetail</span><span class="o">);</span>

<span class="c1">// set the new details...</span>
<span class="n">order</span><span class="o">.</span><span class="na">setDetails</span><span class="o">(</span><span class="n">details</span><span class="o">);</span>

<span class="c1">// save the order... which cascade saves</span>
<span class="c1">// the order details...</span>
<span class="n">Ebean</span><span class="o">.</span><span class="na">save</span><span class="o">(</span><span class="n">order</span><span class="o">);</span>
</pre></div>
</div>
</p><p>
So when the order is saved, because the @OneToMany relationship has cascade.ALL
the save is cascaded to all the order details.
</p><p>
Note that you can update OrderDetails individually (without relying on cascade save) but
to insert a new OrderDetail we are relying on the cascading save.
<div class="bs-callout bs-callout-primary">
<p>Removing a ManyToOne typically reflects a strong "ownership"
relationship. The Order "owns" the OrderDetails, they are persisted as
one via cascade save.</p>
</div>

<h4>Managed Relationships = @OneToMany + cascade save</h4>
<p>
If cascade save is on a @OneToMany when the save is cascaded down from the 'master'
to the 'details' Ebean will 'manage' the relationship.
</p><p>
For example, with the Order - OrderDetails relationship when you save the order Ebean
will get the order id and make sure it is 'set' on all the order details. Ebean does this for
both Bidirectional relationships and Unidirectional relationships.
</p><p>
What this means is that if your OrderDetails has an @ManyToOne Order property (its
bidirectional) you do not need to set the order against each orderDetail when you use
cascade save. Ebean will automatically set the 'master' order to each of the details when
you save the Order and that cascades down to the details.
</p>
<h4>@OneToMany Notes</h4>
<p>
When you assign a @OneToMany you typically specify a mappedBy attribute. This is for
Bi-directional relationships and in this case the "join" information is read from the other
side of the relationship (meaning you don't specify any @JoinColumn etc on this side).
</p><p>
If you don't have a mappedBy attribute (there is no matching property on the other related
bean) then this is a Unidirectional relationship. In this case you can specify a
<div class="syntax java"><div class="highlight"><pre><span class="nd">@JoinColumn</span> <span class="k">if</span> <span class="n">you</span> <span class="n">wish</span> <span class="n">to</span> <span class="n">override</span> <span class="n">the</span> <span class="n">join</span> <span class="n">column</span> <span class="n">information</span> <span class="n">from</span> <span class="n">the</span> <span class="k">default</span><span class="o">).</span>
<span class="nd">@Entity</span>
<span class="nd">@Table</span><span class="o">(</span><span class="n">name</span><span class="o">=</span><span class="s">&quot;s_user&quot;</span><span class="o">)</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">User</span> <span class="kd">implements</span> <span class="n">Serializable</span> <span class="o">{</span>

  <span class="c1">// unidirectional â€¦</span>
  <span class="c1">// â€¦ can explicitly specify the join column if needed</span>
  <span class="nd">@OneToMany</span>
  <span class="nd">@JoinColumn</span><span class="o">(</span><span class="n">name</span><span class="o">=</span><span class="s">&quot;pref_id&quot;</span><span class="o">)</span>
  <span class="n">List</span><span class="o">&lt;</span><span class="n">Preference</span><span class="o">&gt;</span> <span class="n">preferences</span><span class="o">;</span>

  <span class="c1">// bi-directional</span>
  <span class="c1">// â€¦ join information always read from the other side</span>
  <span class="nd">@OneToMany</span><span class="o">(</span><span class="n">mappedBy</span><span class="o">=</span><span class="s">&quot;userLogged&quot;</span><span class="o">)</span>
  <span class="n">List</span><span class="o">&lt;</span><span class="n">Bug</span><span class="o">&gt;</span> <span class="n">loggedBugs</span><span class="o">;</span>
</pre></div>
</div>

<h4>One-to-One relationship</h4>
<p>
A One-to-One relationship is exactly the same as a One-to-Many relationship except that
the many side is limited to a maximum of one.
</p><p>
That means that one of the @OneToOne sides operates just like a @ManyToOne (the
imported side with the foreign key column) and the other @OneToOne operates just like a
@OneToMany (exported side).
</p><p>
So you put the mappedBy on the 'exported side' â€“ as if it was a @OneToMany.
</p><p>
From a Database perspective a One to One relationship is implemented with a foreign key
constraint (like one to many) and adding a unique constraint on the foreign key column.
This has the effect of limiting the "many" side to a maximum of one (has to be unique).

<h4>Many-to-Many relationship</h4>
<p>
You are probably aware that there are no Many to Many relationships in a physical
database design. These are implemented with an intersection table and two One to Many
relationships.
</p><p>
Lets look at an example...
<ul>
  <li>A User can have many Roles</li>
  <li>A Role can be assigned to many Users</li>
  <li>A Many to Many between user and role</li>
</ul>

<img src="/images/docs/A_Many_to_Many_between_user_and_role.png" class="img-responsive">

<p>
In the database diagram above there is an intersection table called s_user_role. This
represents a logical many to many relationship between user and role.
</p><p>
Q: When is a Many to Many better represented as two One to Many relationships?
</p><p>
A: If there is ever an additional column in the intersection table then you should consider
changing this from a Many to Many to two One to Many's and including the intersection
table in the model.
</p><p>

One way to think of this is that each @ManyToMany operates just like it was a
@OneToMany. The relationship must be "managed" meaning Ebean must take care of
inserting into and deleting from the intersection table.
</p><p>
The way this works is that any additions or removables from the many list/set/map are
noted. These become inserts into and deletes from the intersection table.
<div class="syntax java"><div class="highlight"><pre><span class="nd">@Entity</span>
<span class="nd">@Table</span><span class="o">(</span><span class="n">name</span><span class="o">=</span><span class="s">&quot;s_user&quot;</span><span class="o">)</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">User</span> <span class="kd">implements</span> <span class="n">Serializable</span> <span class="o">{</span>
  <span class="o">...</span>
  <span class="nd">@ManyToMany</span><span class="o">(</span><span class="n">cascade</span><span class="o">=</span><span class="n">CascadeType</span><span class="o">.</span><span class="na">ALL</span><span class="o">)</span>
  <span class="n">List</span><span class="o">&lt;</span><span class="n">Role</span><span class="o">&gt;</span> <span class="n">roles</span><span class="o">;</span>
  <span class="nd">@Entity</span>
  <span class="nd">@Table</span><span class="o">(</span><span class="n">name</span><span class="o">=</span><span class="s">&quot;s_role&quot;</span><span class="o">)</span>
  <span class="kd">public</span> <span class="kd">class</span> <span class="nc">Role</span> <span class="o">{</span>
  <span class="o">...</span>
  <span class="nd">@ManyToMany</span><span class="o">(</span><span class="n">cascade</span><span class="o">=</span><span class="n">CascadeType</span><span class="o">.</span><span class="na">ALL</span><span class="o">)</span>
  <span class="n">List</span><span class="o">&lt;</span><span class="n">User</span><span class="o">&gt;</span> <span class="n">users</span><span class="o">;</span>
</pre></div>
</div>
</p><p>

The intersection table name and foreign key columns can default or be specified by @JoinTable etc.
</p><p>
The following code shows a new role added to a user.
<div class="syntax java"><div class="highlight"><pre><span class="n">User</span> <span class="n">user</span> <span class="o">=</span> <span class="n">Ebean</span><span class="o">.</span><span class="na">find</span><span class="o">(</span><span class="n">User</span><span class="o">.</span><span class="na">class</span><span class="o">,</span> <span class="mi">1</span><span class="o">);</span>
<span class="n">List</span><span class="o">&lt;</span><span class="n">Role</span><span class="o">&gt;</span> <span class="n">roles</span> <span class="o">=</span> <span class="n">user</span><span class="o">.</span><span class="na">getRoles</span><span class="o">();</span>
<span class="n">Role</span> <span class="n">role</span> <span class="o">=</span> <span class="n">Ebean</span><span class="o">.</span><span class="na">find</span><span class="o">(</span><span class="n">Role</span><span class="o">.</span><span class="na">class</span><span class="o">,</span> <span class="mi">27</span><span class="o">);</span>

<span class="c1">// adding a role to the list...this is remembered and will</span>
<span class="c1">// result in an insert into the intersection table</span>
<span class="c1">// when save cascades...</span>
<span class="n">roles</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="n">role</span><span class="o">);</span>

<span class="c1">// save cascades to roles... and in this case</span>
<span class="c1">// results in an insert into the intersection table</span>
<span class="n">Ebean</span><span class="o">.</span><span class="na">save</span><span class="o">(</span><span class="n">user</span><span class="o">);</span>
</pre></div>
</div>
</p><p>
Note that if a role was removed from the list this would result in an appropriate delete from
the intersection table.
</p>


<h2 id="id_generation">Id generation</h2>
<ul>
  <li>DB Identity / Autoincrement</li>
  <li>DB Sequences</li>
  <li>UUID</li>
  <li>Custom ID Generation</li>
</ul>

<p>There are 4 ways that ID's can be automatically generated for new Entities. This occurs
when a entity is going to be inserted and it does not already have an Id value.</p>

<p>The first 3 options are highly recommended for 2 reasons.</p>
<ol>
  <li>They are standard approaches that can also be used by other programs, stored
procedures, batch loading jobs etc that could be written in other languages etc. That is, if
you choose a custom ID Generation then this can make it more difficult to use other
programs / tools to insert into the DB.</li>
  <li>They support good concurrency â€“ can you really do better? Most Databases support Sequences or Identity/Autoincrement. DB2 and H2 support both.</li>
</ol>

<h4>UUID Id Generation</h4>
<p>To use UUID's with Ebean all you need to do is use the UUID type for your id property.</p>
<p>Ebean will automatically assign an appropriate UUID Id generator.
<div class="syntax java"><div class="highlight"><pre><span class="nd">@Entity</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">MyEntity</span> <span class="o">{</span>
<span class="nd">@Id</span>
<span class="n">UUID</span> <span class="n">id</span><span class="o">;</span>
<span class="o">...</span>
</pre></div>
</div>
</p>
<h4>DB Sequences / DB Autoincrement</h4>
<p>
Refer: com.avaje.ebean.config.dbplatform.DatabasePlatform and DbIdentity
</p>
<p>
For each database type (Oracle, MySql, H2, Postgres etc) there is a specific
DatabasePlatform which defines whether the database supports sequences or
autoincrement. This then defines whether DB sequences or DB Identity / Autoincrement
will be used. This also provides a sequence generator specific to that database.
</p><p>
For DB sequences the NamingConvention is used to define the default name of the
sequences. This name will be used unless the sequence name is explicitly defined via
annotations.
</p><p>
What this means is that, typically you only need to the the @Id annotation unless you
need to override a sequence name (when it doesn't match the naming convention).
<div class="syntax java"><div class="highlight"><pre><span class="nd">@Entity</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">MyEntity</span> <span class="o">{</span>
<span class="nd">@Id</span>
<span class="n">Integer</span> <span class="n">id</span><span class="o">;</span>
<span class="o">...</span>
</pre></div>
</div>
</p>

<h4>Batched fetch of Db Sequences</h4>
<p>For performance reasons we don't want to fetch a sequence value each time we want an
Id. Instead we fetch a 'batch' of sequences (refer to ServerConfig
setDatabaseSequenceBatchSize() ) - the default batch size is 20.
</p><p>
Also note that when the number of available Id's for a given sequence drops to half the
batch size then another batch of sequences is fetched via a background thread.
</p><p>
For Oracle, Postgres and H2 we use Db sequences. It is worth noting that this allows the
use of JDBC batch statements (PreparedStatement.addBatch() etc) which is a significant
performance optimization. You can globally turn on the use of JDBC batching via
ServerConfig.setUsePersistBatching() â€¦ or you can turn it on for a specific Transaction.
</p>


<h2 id="formula">@Formula</h2>

<p>
@Formula can be used to get read only values using SQL Literals, SQL Expressions and SQL Functions.
</p><p>
With a Formula the $\{ta} is a special token to represent the table alias. The table alias is
dynamically determined by Ebean and you can put the $\{ta} in the select or join attributes.
</p>
<h4>A SQL Expression</h4>
<p>
Example: The caseForm field using a SQL case expression
<div class="syntax java"><div class="highlight"><pre><span class="o">...</span>
<span class="nd">@Entity</span>
<span class="nd">@Table</span><span class="o">(</span><span class="n">name</span><span class="o">=</span><span class="s">&quot;s_user&quot;</span><span class="o">)</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">User</span> <span class="o">{</span>
  <span class="nd">@Id</span>
  <span class="n">Integer</span> <span class="n">id</span><span class="o">;</span>

  <span class="nd">@Formula</span><span class="o">(</span><span class="n">select</span><span class="o">=</span><span class="s">&quot;(case when $\{ta}.id &gt; 4 then &#39;T&#39; else &#39;F&#39; end)&quot;</span><span class="o">)</span>
  <span class="kt">boolean</span> <span class="n">caseForm</span><span class="o">;</span>
  <span class="o">...</span>
</pre></div>
</div>
</p><p>
Note the $\{ta} in place of the table alias
</p><p>
Note in this deployment 'T' and 'F' are mapped to boolean values.
</p>

<h4>A SQL Function</h4>
<p>
<div class="syntax java"><div class="highlight"><pre><span class="nd">@Formula</span><span class="o">(</span><span class="n">select</span><span class="o">=</span><span class="s">&quot;(select count(*) from f_topic _b where _b.user_id =$\{ta}.id)&quot;</span><span class="o">)</span>
<span class="kt">int</span> <span class="n">countAssiged</span><span class="o">;</span>
</pre></div>
</div>
</p><p>

The formula properties can be used as normal properties. This includes in query select
and where expressions.
<div class="syntax java"><div class="highlight"><pre><span class="c1">// include the countAssigned property</span>
<span class="n">Query</span><span class="o">&lt;</span><span class="n">User</span><span class="o">&gt;</span> <span class="n">query</span> <span class="o">=</span> <span class="n">Ebean</span><span class="o">.</span><span class="na">createQuery</span><span class="o">(</span><span class="n">User</span><span class="o">.</span><span class="na">class</span><span class="o">);</span>
<span class="n">query</span><span class="o">.</span><span class="na">select</span><span class="o">(</span><span class="s">&quot;id, name, countAssiged&quot;</span><span class="o">);</span>
<span class="n">query</span><span class="o">.</span><span class="na">fetch</span><span class="o">(</span><span class="s">&quot;topics&quot;</span><span class="o">);</span>
<span class="n">List</span><span class="o">&lt;</span><span class="n">User</span><span class="o">&gt;</span> <span class="n">list</span> <span class="o">=</span> <span class="n">query</span><span class="o">.</span><span class="na">findList</span><span class="o">();</span>
</pre></div>
</div>
</p><p>
The SQL generated from the query above is:
<div class="syntax xml"><div class="highlight"><pre><span class="nt">&lt;sql</span> <span class="na">summary=</span><span class="s">&#39;[app.data.User]&#39;</span><span class="nt">&gt;</span>
select u.id, u.name,
(select count(*) from f_topic _b where _b.user_id = u.id)
from s_user u
<span class="nt">&lt;/sql&gt;</span>
</pre></div>
</div>
</p><p>
Note the "u" in the sql has replaced the $\{ta} [table alias placeholder] specified in the
select attribute of the formula.
</p><p>
<b>It is also worth noting that this is potentially not great SQL!!!</b> You should check SQL
in this form (get the explain plan for the query â€“ get your DBA to review the sql etc) but
there is a good chance the sub query (select count(*) ... _b.user_id = u.id) will effectively
execute for each row returned. If that is the case the query above can quickly become
expensive and you may find you have an unhappy DBA .
</p><p>
The above can be re-written to use a view (if one exists). The benefit is that we can use a
join rather than a subquery which can perform much better from a database perspective.
<div class="syntax sql"><div class="highlight"><pre><span class="o">//</span> <span class="k">VIEW</span><span class="p">:</span> <span class="n">vw_topic_aggr</span>
<span class="o">//</span> <span class="n">Lets</span> <span class="n">say</span> <span class="n">there</span> <span class="k">is</span> <span class="n">a</span> <span class="k">view</span> <span class="n">base</span> <span class="k">on</span> <span class="n">this</span> <span class="k">SQL</span><span class="p">.</span>
<span class="o">//</span> <span class="n">It</span> <span class="k">is</span> <span class="n">typically</span> <span class="k">more</span> <span class="n">performant</span> <span class="k">to</span> <span class="k">JOIN</span>
<span class="o">//</span> <span class="k">to</span> <span class="n">a</span> <span class="k">view</span> <span class="n">rather</span> <span class="k">than</span> <span class="n">use</span> <span class="n">a</span> <span class="n">subquery</span>
<span class="k">create</span> <span class="k">view</span> <span class="n">vw_topic_aggr</span> <span class="k">as</span>
<span class="k">select</span> <span class="n">user_id</span><span class="p">,</span> <span class="k">max</span><span class="p">(</span><span class="n">id</span><span class="p">)</span> <span class="k">as</span> <span class="n">topic_max</span><span class="p">,</span> <span class="k">count</span><span class="p">(</span><span class="o">*</span><span class="p">)</span> <span class="k">as</span> <span class="n">topic_count</span>
<span class="k">from</span> <span class="n">f_topic</span>
<span class="k">group</span> <span class="k">by</span> <span class="n">user_id</span>
</pre></div>
</div>

And use the join attribute of @Formula

<div class="syntax java"><div class="highlight"><pre><span class="nd">@Formula</span><span class="o">(</span>
  <span class="n">select</span><span class="o">=</span><span class="s">&quot;_b$\{ta}.topic_count&quot;</span><span class="o">,</span>
  <span class="n">join</span><span class="o">=</span><span class="s">&quot;join vw_topic_aggr as _b$\{ta} on _b$\{ta}.user_id = id&quot;</span><span class="o">)</span>
<span class="kt">int</span> <span class="n">countWithJoin</span><span class="o">;</span>
</pre></div>
</div>
</p><p>
Now, if the view does not exist we can do something similar ...
</p><p>
In this next @Formula the join attribute contains the select effectively replacing the
vw_topic_aggr view with (select user_id, max(id) as topic_max, count(*) as topic_count
from f_topic group by user_id).
@Formula(
  select="_b$\{ta}.topic_count",
  join="join (select user_id, max(id) as topic_max, count(*) as topic_count from f_topic group by user_id) as _b$\{ta} on _b$ {ta}.user_id = id")
int countWithJoin;

<div class="syntax java"><div class="highlight"><pre><span class="n">Query</span><span class="o">&lt;</span><span class="n">User</span><span class="o">&gt;</span> <span class="n">query</span> <span class="o">=</span> <span class="n">Ebean</span><span class="o">.</span><span class="na">createQuery</span><span class="o">(</span><span class="n">User</span><span class="o">.</span><span class="na">class</span><span class="o">);</span>
<span class="n">query</span><span class="o">.</span><span class="na">select</span><span class="o">(</span><span class="s">&quot;id, name, countWithJoin&quot;</span><span class="o">);</span>
<span class="n">List</span><span class="o">&lt;</span><span class="n">User</span><span class="o">&gt;</span> <span class="n">list</span> <span class="o">=</span> <span class="n">query</span><span class="o">.</span><span class="na">findList</span><span class="o">();</span>
</pre></div>
</div>
</p><p>
Results in the following SQL: - will generally perform better than the subquery
<div class="syntax xml"><div class="highlight"><pre><span class="nt">&lt;sql</span> <span class="na">summary=</span><span class="s">&#39;[app.data.User]&#39;</span><span class="nt">&gt;</span>
select u.id, u.name, _bu.topic_count
from s_user u
join (select user_id, max(id) as topic_max, count(*) as topic_count
from f_topic group by user_id) as _bu on _bu.user_id = id
<span class="nt">&lt;/sql&gt;</span>
</pre></div>
</div>
</p><p>
It is also worth noting that the formula fields can be used in where expressions.
</p><p>
Example: where countWithJoin > 1
<div class="syntax java"><div class="highlight"><pre><span class="n">Query</span><span class="o">&lt;</span><span class="n">User</span><span class="o">&gt;</span> <span class="n">query</span> <span class="o">=</span> <span class="n">Ebean</span><span class="o">.</span><span class="na">createQuery</span><span class="o">(</span><span class="n">User</span><span class="o">.</span><span class="na">class</span><span class="o">);</span>
<span class="n">query</span><span class="o">.</span><span class="na">select</span><span class="o">(</span><span class="s">&quot;id, name, countWithJoin&quot;</span><span class="o">);</span>
<span class="c1">// using the formula field in the where</span>
<span class="n">query</span><span class="o">.</span><span class="na">where</span><span class="o">().</span><span class="na">gt</span><span class="o">(</span><span class="s">&quot;countWithJoin&quot;</span><span class="o">,</span> <span class="mi">1</span><span class="o">);</span>
<span class="n">List</span><span class="o">&lt;</span><span class="n">User</span><span class="o">&gt;</span> <span class="n">list</span> <span class="o">=</span> <span class="n">query</span><span class="o">.</span><span class="na">findList</span><span class="o">();</span>
</pre></div>
</div>
Resulting SQL:
<div class="syntax xml"><div class="highlight"><pre><span class="nt">&lt;sql</span> <span class="na">summary=</span><span class="s">&#39;[app.data.User]&#39;</span><span class="nt">&gt;</span>
select u.id, u.name, _bu.topic_count
from s_user u
join (select user_id, max(id) as topic_max, count(*) as topic_count
from f_topic group by user_id) as _bu on _bu.user_id = id
where _bu.topic_count &gt; ?
<span class="nt">&lt;/sql&gt;</span>
</pre></div>
</div>
</p>

<h2 id="enummapping">EnumMapping</h2>
<p>
This is an Ebean specific annotation (not part of JPA) for mapping Enum's to database
values. The reason it exists is that IMO the JPA approach for mapping of Enums is highly
dangerous (in the case of Ordinal mapping) or not very practical (in the case of String
mapping).
</p><p>
Lets take the example of this Enumeration:
<div class="syntax java"><div class="highlight"><pre><span class="kd">public</span> <span class="kd">enum</span> <span class="n">UserStatus</span> <span class="o">{</span>
  <span class="n">ACTIVE</span><span class="o">,</span> <span class="n">INACTIVE</span><span class="o">,</span> <span class="n">NEW</span>
<span class="o">}</span>
</pre></div>
</div>
</p><p>
Enum Ordinal Mapping is Dangerous
</p><p>
  In my opinion JPA Ordinal Mapping for Enum's is very dangerous, and it is recommended that you avoid it.
  The reason is because the ordinal values for Enum depends on the order in which they appear.
<div class="syntax java"><div class="highlight"><pre><span class="kd">public</span> <span class="kd">class</span> <span class="nc">TestStatus</span> <span class="o">{</span>
  <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="n">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="o">{</span>
      <span class="kt">int</span> <span class="n">ord0</span> <span class="o">=</span> <span class="n">UserStatus</span><span class="o">.</span><span class="na">ACTIVE</span><span class="o">.</span><span class="na">ordinal</span><span class="o">();</span>
      <span class="kt">int</span> <span class="n">ord1</span> <span class="o">=</span> <span class="n">UserStatus</span><span class="o">.</span><span class="na">INACTIVE</span><span class="o">.</span><span class="na">ordinal</span><span class="o">();</span>
      <span class="kt">int</span> <span class="n">ord2</span> <span class="o">=</span> <span class="n">UserStatus</span><span class="o">.</span><span class="na">NEW</span><span class="o">.</span><span class="na">ordinal</span><span class="o">();</span>

      <span class="c1">// 0, 1, 2</span>
      <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&quot;ord 0:&quot;</span><span class="o">+</span><span class="n">ord0</span><span class="o">+</span><span class="s">&quot; 1:&quot;</span><span class="o">+</span><span class="n">ord1</span><span class="o">+</span><span class="s">&quot; 2:&quot;</span><span class="o">+</span><span class="n">ord2</span><span class="o">);</span>

      <span class="n">String</span> <span class="n">str0</span> <span class="o">=</span> <span class="n">UserStatus</span><span class="o">.</span><span class="na">ACTIVE</span><span class="o">.</span><span class="na">name</span><span class="o">();</span>
      <span class="n">String</span> <span class="n">str1</span> <span class="o">=</span> <span class="n">UserStatus</span><span class="o">.</span><span class="na">INACTIVE</span><span class="o">.</span><span class="na">name</span><span class="o">();</span>
      <span class="n">String</span> <span class="n">str2</span> <span class="o">=</span> <span class="n">UserStatus</span><span class="o">.</span><span class="na">NEW</span><span class="o">.</span><span class="na">name</span><span class="o">();</span>

      <span class="c1">// &quot;ACTIVE&quot;, &quot;INACTIVE&quot;, &quot;NEW&quot;</span>
      <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&quot;str 0:&quot;</span><span class="o">+</span><span class="n">str0</span><span class="o">+</span><span class="s">&quot; 1:&quot;</span><span class="o">+</span><span class="n">str1</span><span class="o">+</span><span class="s">&quot; 2:&quot;</span><span class="o">+</span><span class="n">str2</span><span class="o">);</span>
  <span class="o">}</span>
<span class="o">}</span>
</pre></div>
</div>
OUTPUT:
<pre>
ord 0:0 1:1 2:2
str 0:ACTIVE 1:INACTIVE 2:NEW
</pre>
</p><p>

The problem is that if you change the order of the Enum elements such as in this example
(DELETED is now first with Ordinal value of 0) ...
<div class="syntax java"><div class="highlight"><pre><span class="kd">public</span> <span class="kd">enum</span> <span class="n">UserStatus</span> <span class="o">{</span>
  <span class="n">DELETED</span><span class="o">,</span> <span class="n">ACTIVE</span><span class="o">,</span> <span class="n">INACTIVE</span><span class="o">,</span> <span class="n">NEW</span>
<span class="o">}</span>
</pre></div>
</div>
</p><p>
With the above code the Ordinal values for ACTIVE, INACTIVE and NEW have all
changed. This is a very subtle change and now every status existing in the database will
be incorrectly represented in the application. Hopefully this issue would be picked up
quickly but there could be situations where this subtle data issue is not picked up before a
real disaster has occured.

<h4>Enum String mapping is limited</h4>
<p>It is more likely that your DBA would prefer to save space by mapping this to a
VARCHAR(1) column and use "A", "I", "N" and "D" as codes to represent ACTIVE,
INACTIVE, NEW and DELETED.
</p><p>
The issue with the String mapping is that more frequently than not the names of the
Enumeration elements will have to be comprimised to short less-meaningful names to
map into DB values or your DBA will be unhappy with long wasteful values.
</p>

<h4>@EnumValue</h4>
<div class="syntax java"><div class="highlight"><pre><span class="kd">public</span> <span class="kd">enum</span> <span class="n">UserStatus</span> <span class="o">{</span>
  <span class="nd">@EnumValue</span><span class="o">(</span><span class="s">&quot;D&quot;</span><span class="o">)</span> <span class="n">DELETED</span><span class="o">,</span>
  <span class="nd">@EnumValue</span><span class="o">(</span><span class="s">&quot;A&quot;</span><span class="o">)</span> <span class="n">ACTIVE</span><span class="o">,</span>
  <span class="nd">@EnumValue</span><span class="o">(</span><span class="s">&quot;I&quot;</span><span class="o">)</span> <span class="n">INACTIVE</span><span class="o">,</span>
  <span class="nd">@EnumValue</span><span class="o">(</span><span class="s">&quot;N&quot;</span><span class="o">)</span> <span class="n">NEW</span>
<span class="o">}</span>
</pre></div>
</div>
<p>
With EnumValue (Ebean specific annotation) you explicitly specify the value map the entry
to. This Annotation has been logged with the Eclipselink project in the hope it makes it's
way into the JPA spec.
</p>

<h2 id="encryption">Encryption</h2>
<h3>Transparent Encryption with Ebean</h3>
<p>
Ebean v2.4 added support for automatic Encryption/Decryption of properties.
The result is that without changing your application code some of your
properties on your entities can stored in encrypted form in the DB.
</p>

<h3>DB Encryption and "Java client Encryption"</h3>
<ul>

<li>The encryption can be performed by Database functions or on the Java side (Java client encryption).</li>
<li>
Properties that are encrypted using Database functions can be used in Query WHERE clauses.
</li>
<li>
Properties that are encrypted using "Java client Encryption" can NOT be used in Query WHERE clauses.
</li>
</ul>

<h3>DB Encryption of String and "Date" types</h3>
<p>
Currently DB Encryption for H2, Postgres, MySql and Oracle can be used on String types and "Date" types (java.sql.Date, Joda DateMidnight, Joda LocalDate).
</p>
<p>
Any type not supported by DB Encryption functions uses "Java client Encryption".
</p>


<h3>DB Encryption Functions</h3>
<p>
The default DB encryption decryption functions used are:
</p>

<ul>
<li>H2:  ENCRYPT() and DECRYPT() with 'AES' option</li>
<li>MySql: AES_ENCRYPT() and AES_DECRYPT()</li>
<li>Postgres: requires pgcryto and uses PGP_SYM_ENCRYPT() and PGP_SYN_DECRYPT()</li>
<li>Oracle: requires dbms_crypto and uses custom functions for encryption and decryption</li>
</ul>



<h3>Encryptor (Java client encryption implementation)</h3>
<p>
When Java client encryption occurs the "Encryptor" interface is used. By default Ebean has a AES 128 bit based implementation but you can also configure Ebean to use your own implementation if you wish.
</p>


<h3>EncryptKeyManager</h3>
<p>
Whenever a property is encrypted or decrypted a "Key" must be used. Ebean will internally ask the EncryptKeyManager for a key given the table and column name.
</p>
<p>
You must supply an implementation of the EncryptKeyManager.
</p>


<h3>Deployment: @Encrypted and EncryptDeployManager</h3>
<p>
You can mark a property to be Encrypted programmatically via EncryptDeployManager, or put the @Encrypted annotation on the bean property or a combination of the two.
</p>
<p>
By default a property will use DB encryption if it is supported (based on its type - String or 'Dates' basically). If you want to ensure a property uses Java encryption you can specify dbEncryption=false on the annotation or EncryptDeploy. You may want to do this so that the CPU cycles for encryption/decryption occur on the Java process rather than the DB process.
</p>
<p>

Your application code does not change
That's it.  Your code to query, insert, update and delete etc does not change and Ebean automatically does the encryption/decryption behind the scenes.
</p>

<div class="syntax java"><div class="highlight"><pre><span class="c1">// Use @Encrypted annotation to mark the encrypted properties</span>

<span class="o">...</span>
<span class="nd">@Entity</span>
<span class="nd">@Table</span><span class="o">(</span><span class="n">name</span><span class="o">=</span><span class="s">&quot;pm_patient&quot;</span><span class="o">)</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">Patient</span> <span class="o">{</span>

    <span class="nd">@Id</span>
    <span class="n">Integer</span> <span class="n">id</span><span class="o">;</span>

    <span class="nd">@Encrypted</span>
    <span class="n">String</span> <span class="n">name</span><span class="o">;</span>

    <span class="c1">// use client side encryption (not db functions)</span>
    <span class="nd">@Lob</span>
    <span class="nd">@Encrypted</span><span class="o">(</span><span class="n">dbEncryption</span><span class="o">=</span><span class="kc">false</span><span class="o">)</span>
    <span class="n">String</span> <span class="n">description</span><span class="o">;</span>

    <span class="nd">@Encrypted</span>
    <span class="n">Date</span> <span class="n">dob</span><span class="o">;</span>
    <span class="o">...</span>
</pre></div>
</div>

<h3>Limitations</h3>
<ul>
<li>
Properties using Java client encryption can NOT be used in WHERE clauses
</li>
<li>
Only DB Encryption support built in for H2, Postgres, MySql and Oracle.
</li>
<li>
You can not use Encryption with positioned (1,2,3...) parameters. You must
use named parameters or the criteria api to define queries.
</li>
</ul>


<h3>Examples:</h3>
List&lt;Patient&gt; list  =
    Ebean.find(Patient.class)
        .select("id, name")
        .where().eq("name", "Rob")
        .findList();

<p>
Results in the following SQL:
</p>
<div class="syntax xml"><div class="highlight"><pre><span class="nt">&lt;sql</span> <span class="na">summary=</span><span class="s">&#39;Patient&#39;</span> <span class="nt">&gt;</span>
  select e.id as c0, pgp_sym_decrypt(e.name,?) as c1
  from pm_patient e
  where pgp_sym_decrypt(e.description,?) = ?
<span class="nt">&lt;sql&gt;</span>
</pre></div>
</div>


<h3>Configuraton:</h3>
<p>
You can specify the EncryptKeyManager implementation in the ebean.properties
file like below:
</p>

<div class="syntax properties"><div class="highlight"><pre><span class="c"># ebean.properties - specify the Key Manager</span>
<span class="na">ebean.encryptKeyManager</span><span class="o">=</span><span class="s">com.avaje.tests.basic.encrypt.BasicEncyptKeyManager</span>
</pre></div>
</div>
<p>
Or if you are programmatically configuring an EbeanServer using ServerConfig,
set the EncryptKeyManager.
</p>
<div class="syntax java"><div class="highlight"><pre><span class="c1">// programmatically configure an EbeanServer</span>
<span class="c1">// with an EncryptKeyManager</span>

<span class="n">ServerConfig</span> <span class="n">config</span> <span class="o">=</span> <span class="n">ServerConfig</span><span class="o">();</span>
<span class="o">...</span>
<span class="n">EncryptKeyManager</span> <span class="n">keyManager</span> <span class="o">=</span> <span class="o">...;</span>
<span class="n">config</span><span class="o">.</span><span class="na">setEncryptKeyManager</span><span class="o">(</span><span class="n">encyptKeyManager</span><span class="o">());</span>
<span class="o">...</span>
<span class="n">EbeanServer</span> <span class="n">server</span> <span class="o">=</span> <span class="n">EbeanServerFactory</span><span class="o">.</span><span class="na">create</span><span class="o">(</span><span class="n">config</span><span class="o">);</span>
</pre></div>
</div>

<h3>A EncryptKeyManager:</h3>

<div class="syntax java"><div class="highlight"><pre><span class="kn">package</span> <span class="n">com</span><span class="o">.</span><span class="na">avaje</span><span class="o">.</span><span class="na">tests</span><span class="o">.</span><span class="na">basic</span><span class="o">.</span><span class="na">encrypt</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">com.avaje.ebean.config.EncryptKey</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.avaje.ebean.config.EncryptKeyManager</span><span class="o">;</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">BasicEncyptKeyManager</span> <span class="kd">implements</span> <span class="n">EncryptKeyManager</span> <span class="o">{</span>

    <span class="cm">/**</span>
<span class="cm">     * Initialise the key manager.</span>
<span class="cm">     */</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">initialise</span><span class="o">()</span> <span class="o">{</span>
        <span class="c1">// can load keys or initialise source resources ...</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="n">EncryptKey</span> <span class="nf">getEncryptKey</span><span class="o">(</span><span class="n">String</span> <span class="n">tableName</span><span class="o">,</span> <span class="n">String</span> <span class="n">columnName</span><span class="o">)</span> <span class="o">{</span>

        <span class="c1">// get the key for the given table and column</span>
        <span class="n">String</span> <span class="n">keyValue</span> <span class="o">=</span> <span class="o">...;</span>
        <span class="k">return</span> <span class="k">new</span> <span class="nf">BasicEncryptKey</span><span class="o">(</span><span class="n">keyValue</span><span class="o">);</span>
    <span class="o">}</span>

<span class="o">}</span>
</pre></div>
</div>

<h3>Internals</h3>
<p>
What Ebean is doing internally is detecting when an encrypted
property is being used. Internally it will call the EncryptKeyManager
with the table and column of the property to get the encryption key.
This key is then added as a bind variable to the prepared statement.
</p>
<p>
As the key is added as a bind variable into the statement you can
not use encryption with 'ordered' parameters because it can effectively
change the position of other parameters. You can use 'named'
parameters or the criteria api for building queries - but you can't
use positioned (1,2,3,4..) parameters.
</p>



</div>

    </div>

    <div class="col-md-3" role="complementary">
      <nav class="bs-docs-sidebar hidden-print hidden-xs hidden-sm">
        <ul class="nav bs-docs-sidenav">


<li class="active">
  <a href="/docs/introduction">Introduction</a>
        <ul class="nav">
          <li><a href="#use_jpa_mapping">Use JPA mappings</a></li>
          <li><a href="#simple_query_language">Simple query language</a></li>
          <li><a href="#intro_save_and_delete">Save and delete</a></li>
          <li><a href="#jpa_comparison">Comparison to JPA</a></li>
          <li><a href="#ebean_does_not">Ebean does not...</a></li>
        </ul>
</li>
<li class="active">
  <a href="/docs/enhancement">Enhancement</a>

          <ul class="nav">
            <li><a href="#enhance_maven">Maven</a></li>
            <li><a href="#enhance_maven_eclipse">Eclipse + Maven</a></li>
            <li><a href="#enhance_ant">Ant</a></li>
            <li><a href="#enhance_agent">Agent</a></li>
            <li><a href="#enhance_ide">IDE enhancement</a></li>
          </ul>
</li>
<li >
  <a href="/docs/configuration">Configuration</a>
</li>
<li >
  <a href="/docs/ebean_access_patterns">Ebean access patterns</a>
</li>
<li >
  <a href="/docs/field_and_property_access">Field and property access</a>
</li>

<li class="active">
  <a href="/docs/queries">Queries</a>
          <ul class="nav">
            <li><a href="#where_clause">Where clause</a></li>
            <li><a href="#query_language">Ebean query language</a></li>
            <li><a href="#partial_objects">Partial objects</a></li>
            <li><a href="#query_joins">Query joins</a></li>
            <li><a href="#fetchconfig">FetchConfig</a></li>
            <li><a href="#lazy_loading">Lazy loading</a></li>
            <li><a href="#named_queries">Named Queries</a></li>
            <li><a href="#large_queries">Large queries</a></li>
            <li><a href="#paging">Paging</a></li>
            <li><a href="#async_queriess">Asynchronous queries</a></li>
            <li><a href="#rawsql">RawSql</a></li>
            <li><a href="#sqlquery">SqlQuery</a></li>
            <li><a href="#l2cache">L2 cache</a></li>
            <li><a href="#autofetch">Autofetch</a></li>
            <li><a href="#other_bits">Other bits</a></li>
          </ul>
</li>
<li class="active">
  <a href="/docs/saving">Saving</a>
          <ul class="nav">
            <li><a href="#saves">Save</a></li>
            <li><a href="#deletes">Delete</a></li>
            <li><a href="#cascading">Cascade</a></li>
            <li><a href="#bulkupdate">Bulk updates</a></li>
            <li><a href="#bulksqlupdate">Bulk SQL updates</a></li>
            <li><a href="#callablesql">CallableSql</a></li>
            <li><a href="#rawjdbc">Raw JDBC</a></li>
            <li><a href="#batch_processing">JDBC Batch</a></li>
          </ul>
</li>
<li class="active">
  <a href="/docs/mapping">Mapping</a>
          <ul class="nav">
            <li><a href="#jpa_mapping">JPA mapping</a></li>
            <li><a href="#ddl_generation">DDL generation</a></li>
            <li><a href="#naming_convention">Naming convention</a></li>
            <li><a href="#mapping_annotations">Mapping annotations</a></li>
            <li><a href="#relationships">Relationships</a></li>
            <li><a href="#id_generation">Id generation</a></li>
            <li><a href="#formula">Formula</a></li>
            <li><a href="#enummapping">EnumMapping</a></li>
            <li><a href="#encryption">Encryption</a></li>
          </ul>
</li>
<li >
  <a href="/docs/transactions">Transactions</a>
</li>
<li >
  <a href="/docs/json">JSON</a>
</li>
<li >
  <a href="/docs/eventlisteners">Event listeners</a>
</li>
<li >
  <a href="/docs/readaudit">Read Audit</a>
</li>
<li class="active">
  <a href="/docs/changelog">Change Log</a>
</li>
<li >
  <a href="/docs/l2caching">L2 caching</a>
</li>
<li >
  <a href="/docs/testing">Testing</a>
</li>
<li >
  <a href="/docs/jvmlanguages">JVM Languages</a>
</li>

<li >
  <a href="/docs/clustering">Clustering</a>
</li>
<li >
  <a href="/docs/monitoring">Monitoring</a>
</li>
<li >
  <a href="/docs/architecture">Architecture</a>
</li>

        </ul>
          <a class="back-to-top" href="#top">
            Back to top
          </a>
      </nav>
    </div>
  </div>

</div>
<!-- /.row -->
</div>  <!-- /.container -->
  </div>
</div>

<footer id="footer">
 <div class="doc-footer">
  <ul class="doc-footer-links">
    <li><a href="/">Ebean ORM</a></li>
    <li> | </li>
    <li><a href="http://avaje-metric.github.io">Metrics</a></li>
    <li> | </li>
    <li><a href="/websitegenerator/index">Website Generator</a></li>
    <li> | </li>
    <li><a href="/jetty/index">Jetty Runnable War</a></li>
  </ul>
 </div>
</footer>

  <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.2/jquery.min.js"></script>
  <script src="/js/bootstrap.min.js"></script>
  <script src="/js/jquery.easing.min.js"></script>

  <script src="/js/json2.js"></script>
  <script src="/js/jquery.cookie.min.js"></script>
  <script src="/js/jquery.storageapi.min.js"></script>

  <script src="/js/ebean-site.js"></script>

  </body>
</html>

<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta id="layout-head" />
    <title>avaje ebean</title>
    <link rel="shortcut icon" href="/images/favicon.ico" >
    <!--<link href="/css/bootstrap.min.css" rel="stylesheet">-->
    <!-- Latest compiled and minified CSS -->
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.5/css/bootstrap.min.css">
    <link rel="stylesheet" href="/css/pygments.css" type="text/css" />
    <link rel="stylesheet" href="/css/site.css">
    <link rel="stylesheet" href="//netdna.bootstrapcdn.com/font-awesome/4.1.0/css/font-awesome.min.css">
      <!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
      <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
      <script src="https://oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>
    <![endif]-->
</head>
  <body>
  <div id="wrap">
    <div id="header">
    <div class="navbar navbar-inverse navbar-fixed-top" role="navigation">
      <div class="container">
        <div class="navbar-header">
          <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
            <span class="sr-only">Toggle navigation</span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
          </button>
          <a class="navbar-brand" href="/">Ebean ORM</a>
        </div>
        <div class="collapse navbar-collapse">
          <ul class="nav navbar-nav pull-right">
            <li ><a href="/"><span class="glyphicon glyphicon-home"></span>  Home</a></li>
            <li ><a href="/videos">Videos</a></li>
            <li ><a href="/quickstart">Quick Start</a></li>
            <li ><a href="/support">Support</a></li>
            <li class="active"><a href="/docs">Docs</a></li>
            <li ><a target="_blank" href="/apidocs">ApiDocs</a></li>
            <li ><a href="/releases">Releases</a></li>
            <li ><a target="_blank" href="https://github.com/ebean-orm/avaje-ebeanorm"> <i class="fa fa-github"></i> Github</a></li>
          </ul>
        </div><!--/.nav-collapse -->
      </div>
    </div>

  </div>
  <div id="main" data-offset="60">
<div class="jumbotron mini">
  <div class="container">
    <h1><a href="/docs">Documentation</a> / Transactions </h1>
  </div>
</div>

<div class="container doc-index bs-docs-container">

  <div class="row">

    <div class="col-md-9" role="main">

      <div class="bs-docs-section">
<h1 id="transactions">Transactions</h1>


<p>Within a Transaction, you can also control JDBC batching (batch size, flushing), turn on/off
transaction logging, and turn on/off cascading of save and delete. ...(under construction)... how?</p>


<h2 id="implicit_transactions">Implicit</h2>
<h4>Transactions are created implicitly for you</h4>

<p>
When there is no current transaction you can still execute a query, save or delete a bean etc.
When this happens Ebean will create an implicit transaction and commit it (or rollback if there was a failure).
</p>

<div class="syntax java"><div class="highlight"><pre><span class="c1">// execute a query without an existing transaction...</span>
<span class="c1">// ... a &quot;implicit&quot; transaction will be created</span>
<span class="c1">// ... and be commited (or rolled back) for you</span>
<span class="n">List</span><span class="o">&lt;</span><span class="n">User</span><span class="o">&gt;</span> <span class="n">users</span> <span class="o">=</span>
            <span class="n">Ebean</span><span class="o">.</span><span class="na">find</span><span class="o">(</span><span class="n">User</span><span class="o">.</span><span class="na">class</span><span class="o">)</span>
                <span class="o">.</span><span class="na">join</span><span class="o">(</span><span class="s">&quot;customer&quot;</span><span class="o">)</span>
                <span class="o">.</span><span class="na">where</span><span class="o">().</span><span class="na">eq</span><span class="o">(</span><span class="s">&quot;state&quot;</span><span class="o">,</span> <span class="n">UserState</span><span class="o">.</span><span class="na">ACTIVE</span><span class="o">)</span>
                <span class="o">.</span><span class="na">findList</span><span class="o">();</span>

<span class="c1">// execute a save without an existing transaction...</span>
<span class="c1">// ... will create an implicit transaction</span>
<span class="c1">// ... and be commited (or rolled back) for you</span>
<span class="n">Ebean</span><span class="o">.</span><span class="na">save</span><span class="o">(</span><span class="n">user</span><span class="o">);</span>
</pre></div>
</div>

<p>
The following SLF4J logs show the transaction that was implicitly created for the query.
</p>
<div class="syntax java"><div class="highlight"><pre><span class="mi">16</span><span class="o">:</span><span class="mi">38</span><span class="o">:</span><span class="mf">26.362</span> <span class="o">[</span><span class="n">main</span><span class="o">]</span> <span class="n">DEBUG</span> <span class="n">c</span><span class="o">.</span><span class="na">a</span><span class="o">.</span><span class="na">e</span><span class="o">.</span><span class="na">server</span><span class="o">.</span><span class="na">lib</span><span class="o">.</span><span class="na">thread</span><span class="o">.</span><span class="na">ThreadPool</span> <span class="o">-</span> <span class="n">ThreadPool</span> <span class="n">grow</span> <span class="n">created</span> <span class="o">[</span><span class="n">Ebean</span><span class="o">-</span><span class="n">h2</span><span class="o">.</span><span class="mi">0</span><span class="o">]</span> <span class="n">size</span><span class="o">[</span><span class="mi">0</span><span class="o">]</span>
<span class="mi">16</span><span class="o">:</span><span class="mi">38</span><span class="o">:</span><span class="mf">26.369</span> <span class="o">[</span><span class="n">main</span><span class="o">]</span> <span class="n">TRACE</span> <span class="n">org</span><span class="o">.</span><span class="na">avaje</span><span class="o">.</span><span class="na">ebean</span><span class="o">.</span><span class="na">TXN</span> <span class="o">-</span> <span class="n">txn</span><span class="o">[</span><span class="mi">1002</span><span class="o">]</span> <span class="n">Begin</span>
<span class="mi">16</span><span class="o">:</span><span class="mi">38</span><span class="o">:</span><span class="mf">26.548</span> <span class="o">[</span><span class="n">main</span><span class="o">]</span> <span class="n">INFO</span>  <span class="n">org</span><span class="o">.</span><span class="na">avaje</span><span class="o">.</span><span class="na">ebean</span><span class="o">.</span><span class="na">TXN</span> <span class="o">-</span> <span class="n">txn</span><span class="o">[</span><span class="mi">1002</span><span class="o">]</span> <span class="n">Commit</span>
<span class="mi">16</span><span class="o">:</span><span class="mi">38</span><span class="o">:</span><span class="mf">26.551</span> <span class="o">[</span><span class="n">main</span><span class="o">]</span> <span class="n">TRACE</span> <span class="n">org</span><span class="o">.</span><span class="na">avaje</span><span class="o">.</span><span class="na">ebean</span><span class="o">.</span><span class="na">TXN</span> <span class="o">-</span> <span class="n">txn</span><span class="o">[</span><span class="mi">1003</span><span class="o">]</span> <span class="n">Begin</span>
<span class="mi">16</span><span class="o">:</span><span class="mi">38</span><span class="o">:</span><span class="mf">26.554</span> <span class="o">[</span><span class="n">main</span><span class="o">]</span> <span class="n">TRACE</span> <span class="n">org</span><span class="o">.</span><span class="na">avaje</span><span class="o">.</span><span class="na">ebean</span><span class="o">.</span><span class="na">SQL</span> <span class="o">-</span> <span class="n">txn</span><span class="o">[</span><span class="mi">1003</span><span class="o">]</span> <span class="n">delete</span> <span class="n">from</span> <span class="n">or_order_ship</span>
<span class="mi">16</span><span class="o">:</span><span class="mi">38</span><span class="o">:</span><span class="mf">26.555</span> <span class="o">[</span><span class="n">main</span><span class="o">]</span> <span class="n">DEBUG</span> <span class="n">org</span><span class="o">.</span><span class="na">avaje</span><span class="o">.</span><span class="na">ebean</span><span class="o">.</span><span class="na">SUM</span> <span class="o">-</span> <span class="n">txn</span><span class="o">[</span><span class="mi">1003</span><span class="o">]</span> <span class="n">Delete</span> <span class="n">table</span><span class="o">[</span><span class="n">or_order_ship</span><span class="o">]</span> <span class="n">rows</span><span class="o">[</span><span class="mi">0</span><span class="o">]</span> <span class="n">bind</span><span class="o">[</span><span class="kc">null</span><span class="o">]</span>
<span class="mi">16</span><span class="o">:</span><span class="mi">38</span><span class="o">:</span><span class="mf">26.556</span> <span class="o">[</span><span class="n">main</span><span class="o">]</span> <span class="n">TRACE</span> <span class="n">org</span><span class="o">.</span><span class="na">avaje</span><span class="o">.</span><span class="na">ebean</span><span class="o">.</span><span class="na">SQL</span> <span class="o">-</span> <span class="n">txn</span><span class="o">[</span><span class="mi">1003</span><span class="o">]</span> <span class="n">delete</span> <span class="n">from</span> <span class="n">o_order_detail</span>
<span class="mi">16</span><span class="o">:</span><span class="mi">38</span><span class="o">:</span><span class="mf">26.557</span> <span class="o">[</span><span class="n">main</span><span class="o">]</span> <span class="n">DEBUG</span> <span class="n">org</span><span class="o">.</span><span class="na">avaje</span><span class="o">.</span><span class="na">ebean</span><span class="o">.</span><span class="na">SUM</span> <span class="o">-</span> <span class="n">txn</span><span class="o">[</span><span class="mi">1003</span><span class="o">]</span> <span class="n">Delete</span> <span class="n">table</span><span class="o">[</span><span class="n">o_order_detail</span><span class="o">]</span> <span class="n">rows</span><span class="o">[</span><span class="mi">0</span><span class="o">]</span> <span class="n">bind</span><span class="o">[</span><span class="kc">null</span><span class="o">]</span>
<span class="mi">16</span><span class="o">:</span><span class="mi">38</span><span class="o">:</span><span class="mf">26.557</span> <span class="o">[</span><span class="n">main</span><span class="o">]</span> <span class="n">TRACE</span> <span class="n">org</span><span class="o">.</span><span class="na">avaje</span><span class="o">.</span><span class="na">ebean</span><span class="o">.</span><span class="na">SQL</span> <span class="o">-</span> <span class="n">txn</span><span class="o">[</span><span class="mi">1003</span><span class="o">]</span> <span class="n">delete</span> <span class="n">from</span> <span class="n">o_order</span>
<span class="mi">16</span><span class="o">:</span><span class="mi">38</span><span class="o">:</span><span class="mf">26.557</span> <span class="o">[</span><span class="n">main</span><span class="o">]</span> <span class="n">DEBUG</span> <span class="n">org</span><span class="o">.</span><span class="na">avaje</span><span class="o">.</span><span class="na">ebean</span><span class="o">.</span><span class="na">SUM</span> <span class="o">-</span> <span class="n">txn</span><span class="o">[</span><span class="mi">1003</span><span class="o">]</span> <span class="n">Delete</span> <span class="n">table</span><span class="o">[</span><span class="n">o_order</span><span class="o">]</span> <span class="n">rows</span><span class="o">[</span><span class="mi">0</span><span class="o">]</span> <span class="n">bind</span><span class="o">[</span><span class="kc">null</span><span class="o">]</span>
<span class="mi">16</span><span class="o">:</span><span class="mi">38</span><span class="o">:</span><span class="mf">26.557</span> <span class="o">[</span><span class="n">main</span><span class="o">]</span> <span class="n">TRACE</span> <span class="n">org</span><span class="o">.</span><span class="na">avaje</span><span class="o">.</span><span class="na">ebean</span><span class="o">.</span><span class="na">SQL</span> <span class="o">-</span> <span class="n">txn</span><span class="o">[</span><span class="mi">1003</span><span class="o">]</span> <span class="n">delete</span> <span class="n">from</span> <span class="n">contact</span>
<span class="mi">16</span><span class="o">:</span><span class="mi">38</span><span class="o">:</span><span class="mf">26.557</span> <span class="o">[</span><span class="n">main</span><span class="o">]</span> <span class="n">DEBUG</span> <span class="n">org</span><span class="o">.</span><span class="na">avaje</span><span class="o">.</span><span class="na">ebean</span><span class="o">.</span><span class="na">SUM</span> <span class="o">-</span> <span class="n">txn</span><span class="o">[</span><span class="mi">1003</span><span class="o">]</span> <span class="n">Delete</span> <span class="n">table</span><span class="o">[</span><span class="n">contact</span><span class="o">]</span> <span class="n">rows</span><span class="o">[</span><span class="mi">0</span><span class="o">]</span> <span class="n">bind</span><span class="o">[</span><span class="kc">null</span><span class="o">]</span>
<span class="mi">16</span><span class="o">:</span><span class="mi">38</span><span class="o">:</span><span class="mf">26.557</span> <span class="o">[</span><span class="n">main</span><span class="o">]</span> <span class="n">TRACE</span> <span class="n">org</span><span class="o">.</span><span class="na">avaje</span><span class="o">.</span><span class="na">ebean</span><span class="o">.</span><span class="na">SQL</span> <span class="o">-</span> <span class="n">txn</span><span class="o">[</span><span class="mi">1003</span><span class="o">]</span> <span class="n">delete</span> <span class="n">from</span> <span class="n">o_customer</span>
<span class="mi">16</span><span class="o">:</span><span class="mi">38</span><span class="o">:</span><span class="mf">26.557</span> <span class="o">[</span><span class="n">main</span><span class="o">]</span> <span class="n">DEBUG</span> <span class="n">org</span><span class="o">.</span><span class="na">avaje</span><span class="o">.</span><span class="na">ebean</span><span class="o">.</span><span class="na">SUM</span> <span class="o">-</span> <span class="n">txn</span><span class="o">[</span><span class="mi">1003</span><span class="o">]</span> <span class="n">Delete</span> <span class="n">table</span><span class="o">[</span><span class="n">o_customer</span><span class="o">]</span> <span class="n">rows</span><span class="o">[</span><span class="mi">0</span><span class="o">]</span> <span class="n">bind</span><span class="o">[</span><span class="kc">null</span><span class="o">]</span>
<span class="mi">16</span><span class="o">:</span><span class="mi">38</span><span class="o">:</span><span class="mf">26.557</span> <span class="o">[</span><span class="n">main</span><span class="o">]</span> <span class="n">TRACE</span> <span class="n">org</span><span class="o">.</span><span class="na">avaje</span><span class="o">.</span><span class="na">ebean</span><span class="o">.</span><span class="na">SQL</span> <span class="o">-</span> <span class="n">txn</span><span class="o">[</span><span class="mi">1003</span><span class="o">]</span> <span class="n">delete</span> <span class="n">from</span> <span class="n">o_address</span>
<span class="mi">16</span><span class="o">:</span><span class="mi">38</span><span class="o">:</span><span class="mf">26.558</span> <span class="o">[</span><span class="n">main</span><span class="o">]</span> <span class="n">DEBUG</span> <span class="n">org</span><span class="o">.</span><span class="na">avaje</span><span class="o">.</span><span class="na">ebean</span><span class="o">.</span><span class="na">SUM</span> <span class="o">-</span> <span class="n">txn</span><span class="o">[</span><span class="mi">1003</span><span class="o">]</span> <span class="n">Delete</span> <span class="n">table</span><span class="o">[</span><span class="n">o_address</span><span class="o">]</span> <span class="n">rows</span><span class="o">[</span><span class="mi">0</span><span class="o">]</span> <span class="n">bind</span><span class="o">[</span><span class="kc">null</span><span class="o">]</span>
<span class="mi">16</span><span class="o">:</span><span class="mi">38</span><span class="o">:</span><span class="mf">26.563</span> <span class="o">[</span><span class="n">main</span><span class="o">]</span> <span class="n">TRACE</span> <span class="n">org</span><span class="o">.</span><span class="na">avaje</span><span class="o">.</span><span class="na">ebean</span><span class="o">.</span><span class="na">SQL</span> <span class="o">-</span> <span class="n">txn</span><span class="o">[</span><span class="mi">1003</span><span class="o">]</span> <span class="n">delete</span> <span class="n">from</span> <span class="n">o_country</span>
<span class="mi">16</span><span class="o">:</span><span class="mi">38</span><span class="o">:</span><span class="mf">26.563</span> <span class="o">[</span><span class="n">main</span><span class="o">]</span> <span class="n">DEBUG</span> <span class="n">org</span><span class="o">.</span><span class="na">avaje</span><span class="o">.</span><span class="na">ebean</span><span class="o">.</span><span class="na">SUM</span> <span class="o">-</span> <span class="n">txn</span><span class="o">[</span><span class="mi">1003</span><span class="o">]</span> <span class="n">DeleteSql</span> <span class="n">table</span><span class="o">[</span><span class="n">o_country</span><span class="o">]</span> <span class="n">rows</span><span class="o">[</span><span class="mi">0</span><span class="o">]</span> <span class="n">bind</span><span class="o">[</span><span class="kc">null</span><span class="o">]</span>
<span class="mi">16</span><span class="o">:</span><span class="mi">38</span><span class="o">:</span><span class="mf">26.563</span> <span class="o">[</span><span class="n">main</span><span class="o">]</span> <span class="n">TRACE</span> <span class="n">org</span><span class="o">.</span><span class="na">avaje</span><span class="o">.</span><span class="na">ebean</span><span class="o">.</span><span class="na">SQL</span> <span class="o">-</span> <span class="n">txn</span><span class="o">[</span><span class="mi">1003</span><span class="o">]</span> <span class="n">delete</span> <span class="n">from</span> <span class="n">o_product</span>
<span class="mi">16</span><span class="o">:</span><span class="mi">38</span><span class="o">:</span><span class="mf">26.564</span> <span class="o">[</span><span class="n">main</span><span class="o">]</span> <span class="n">DEBUG</span> <span class="n">org</span><span class="o">.</span><span class="na">avaje</span><span class="o">.</span><span class="na">ebean</span><span class="o">.</span><span class="na">SUM</span> <span class="o">-</span> <span class="n">txn</span><span class="o">[</span><span class="mi">1003</span><span class="o">]</span> <span class="n">DeleteSql</span> <span class="n">table</span><span class="o">[</span><span class="n">o_product</span><span class="o">]</span> <span class="n">rows</span><span class="o">[</span><span class="mi">0</span><span class="o">]</span> <span class="n">bind</span><span class="o">[</span><span class="kc">null</span><span class="o">]</span>
<span class="mi">16</span><span class="o">:</span><span class="mi">38</span><span class="o">:</span><span class="mf">26.567</span> <span class="o">[</span><span class="n">main</span><span class="o">]</span> <span class="n">TRACE</span> <span class="n">org</span><span class="o">.</span><span class="na">avaje</span><span class="o">.</span><span class="na">ebean</span><span class="o">.</span><span class="na">SQL</span> <span class="o">-</span> <span class="n">txn</span><span class="o">[</span><span class="mi">1003</span><span class="o">]</span> <span class="n">insert</span> <span class="n">into</span> <span class="n">o_country</span> <span class="o">(</span><span class="n">code</span><span class="o">,</span> <span class="n">name</span><span class="o">)</span> <span class="n">values</span> <span class="o">(?,?);</span> <span class="o">--</span><span class="n">bind</span><span class="o">(</span><span class="n">NZ</span><span class="o">,</span><span class="n">New</span> <span class="n">Zealand</span><span class="o">,)</span>
<span class="mi">16</span><span class="o">:</span><span class="mi">38</span><span class="o">:</span><span class="mf">26.568</span> <span class="o">[</span><span class="n">main</span><span class="o">]</span> <span class="n">DEBUG</span> <span class="n">org</span><span class="o">.</span><span class="na">avaje</span><span class="o">.</span><span class="na">ebean</span><span class="o">.</span><span class="na">SUM</span> <span class="o">-</span> <span class="n">txn</span><span class="o">[</span><span class="mi">1003</span><span class="o">]</span> <span class="n">Inserted</span> <span class="o">[</span><span class="n">Country</span><span class="o">]</span> <span class="o">[</span><span class="n">NZ</span><span class="o">]</span>
<span class="mi">16</span><span class="o">:</span><span class="mi">38</span><span class="o">:</span><span class="mf">26.568</span> <span class="o">[</span><span class="n">main</span><span class="o">]</span> <span class="n">TRACE</span> <span class="n">org</span><span class="o">.</span><span class="na">avaje</span><span class="o">.</span><span class="na">ebean</span><span class="o">.</span><span class="na">SQL</span> <span class="o">-</span> <span class="n">txn</span><span class="o">[</span><span class="mi">1003</span><span class="o">]</span> <span class="n">insert</span> <span class="n">into</span> <span class="n">o_country</span> <span class="o">(</span><span class="n">code</span><span class="o">,</span> <span class="n">name</span><span class="o">)</span> <span class="n">values</span> <span class="o">(?,?);</span> <span class="o">--</span><span class="n">bind</span><span class="o">(</span><span class="n">AU</span><span class="o">,</span><span class="n">Australia</span><span class="o">,)</span>
<span class="mi">16</span><span class="o">:</span><span class="mi">38</span><span class="o">:</span><span class="mf">26.568</span> <span class="o">[</span><span class="n">main</span><span class="o">]</span> <span class="n">DEBUG</span> <span class="n">org</span><span class="o">.</span><span class="na">avaje</span><span class="o">.</span><span class="na">ebean</span><span class="o">.</span><span class="na">SUM</span> <span class="o">-</span> <span class="n">txn</span><span class="o">[</span><span class="mi">1003</span><span class="o">]</span> <span class="n">Inserted</span> <span class="o">[</span><span class="n">Country</span><span class="o">]</span> <span class="o">[</span><span class="n">AU</span><span class="o">]</span>
<span class="mi">16</span><span class="o">:</span><span class="mi">38</span><span class="o">:</span><span class="mf">26.570</span> <span class="o">[</span><span class="n">main</span><span class="o">]</span> <span class="n">TRACE</span> <span class="n">org</span><span class="o">.</span><span class="na">avaje</span><span class="o">.</span><span class="na">ebean</span><span class="o">.</span><span class="na">SQL</span> <span class="o">-</span> <span class="n">txn</span><span class="o">[</span><span class="mi">1003</span><span class="o">]</span> <span class="n">insert</span> <span class="n">into</span> <span class="n">o_product</span> <span class="o">(</span><span class="n">id</span><span class="o">,</span> <span class="n">sku</span><span class="o">,</span> <span class="n">name</span><span class="o">,</span> <span class="n">cretime</span><span class="o">,</span> <span class="n">updtime</span><span class="o">)</span> <span class="n">values</span> <span class="o">(?,?,?,?,?);</span> <span class="o">--</span><span class="n">bind</span>
</pre></div>
</div>

<h2 id="programmatic_transactions">Programmatic</h2>
<h4>Using begin, commit etc in a try finally block</h4>
<p>
A traditional approach for demarcating transactions via a try finally block.
</p>

<div class="syntax java"><div class="highlight"><pre><span class="n">ebeanServer</span><span class="o">.</span><span class="na">beginTransaction</span><span class="o">();</span>
<span class="k">try</span> <span class="o">{</span>
  <span class="c1">// fetch some stuff...</span>
  <span class="n">Customer</span> <span class="n">customer</span> <span class="o">=</span> <span class="n">ebeanServer</span><span class="o">.</span><span class="na">find</span><span class="o">(</span><span class="n">Customer</span><span class="o">.</span><span class="na">class</span><span class="o">,</span> <span class="n">id</span><span class="o">);</span>
  <span class="o">...</span>

  <span class="c1">// save or delete stuff...</span>
  <span class="n">ebeanServer</span><span class="o">.</span><span class="na">save</span><span class="o">(</span><span class="n">customer</span><span class="o">);</span>
  <span class="o">...</span>

  <span class="c1">// commit the transaction</span>
  <span class="n">ebeanServer</span><span class="o">.</span><span class="na">commitTransaction</span><span class="o">();</span>

<span class="o">}</span> <span class="k">finally</span> <span class="o">{</span>
  <span class="c1">// rollback the transaction if it was not committed</span>
  <span class="n">ebeanServer</span><span class="o">.</span><span class="na">endTransaction</span><span class="o">();</span>
<span class="o">}</span>
</pre></div>
</div>

<h2 id="tx_control_behaviour">Controlling behaviour in a transaction</h2>
<p>
You can use the Transaction to explicitly control behaviour.

<div class="syntax java"><div class="highlight"><pre><span class="n">Transaction</span> <span class="n">transaction</span> <span class="o">=</span> <span class="n">ebeanServer</span><span class="o">.</span><span class="na">beginTransaction</span><span class="o">();</span>
<span class="k">try</span> <span class="o">{</span>
  <span class="c1">// turn of cascade persist</span>
  <span class="n">transaction</span><span class="o">.</span><span class="na">setCascadePersist</span><span class="o">(</span><span class="kc">false</span><span class="o">);</span>

  <span class="c1">// control the jdbc batch mode and size</span>
  <span class="c1">// transaction.setBatchMode(true); // equivalent to transaction.setBatch(PersistBatch.ALL);</span>
  <span class="c1">// transaction.setBatchMode(false); // equivalent to transaction.setBatch(PersistBatch.NONE);</span>
  <span class="n">transaction</span><span class="o">.</span><span class="na">setBatch</span><span class="o">(</span><span class="n">PersistBatch</span><span class="o">.</span><span class="na">ALL</span><span class="o">);</span> <span class="c1">// PersistBatch: NONE, INSERT, ALL</span>
  <span class="n">transaction</span><span class="o">.</span><span class="na">setCascadeBatch</span><span class="o">(</span><span class="n">PersistBatch</span><span class="o">.</span><span class="na">INSERT</span><span class="o">);</span> <span class="c1">// PersistBatch: NONE, INSERT, ALL</span>
  <span class="n">transaction</span><span class="o">.</span><span class="na">setBatchSize</span><span class="o">(</span><span class="mi">30</span><span class="o">);</span>


  <span class="c1">// for a large batch insert if you want to skip</span>
  <span class="c1">// getting the generated keys</span>
  <span class="n">transaction</span><span class="o">.</span><span class="na">setBatchGetGeneratedKeys</span><span class="o">(</span><span class="kc">false</span><span class="o">);</span>

  <span class="c1">// for batch processing via raw SQL you can inform</span>
  <span class="c1">// Ebean what tables were modified so that it can</span>
  <span class="c1">// clear the appropriate L2 caches</span>
  <span class="n">String</span> <span class="n">tableName</span> <span class="o">=</span> <span class="s">&quot;o_customer&quot;</span><span class="o">;</span>
  <span class="kt">boolean</span> <span class="n">inserts</span> <span class="o">=</span> <span class="kc">true</span><span class="o">;</span>
  <span class="kt">boolean</span> <span class="n">upates</span> <span class="o">=</span> <span class="kc">true</span><span class="o">;</span>
  <span class="kt">boolean</span> <span class="n">deletes</span> <span class="o">=</span> <span class="kc">false</span><span class="o">;</span>
  <span class="n">transaction</span><span class="o">.</span><span class="na">addModification</span><span class="o">(</span><span class="n">tableName</span><span class="o">,</span> <span class="n">inserts</span><span class="o">,</span> <span class="n">updates</span><span class="o">,</span> <span class="n">deletes</span><span class="o">);</span>

  <span class="o">...</span>
<span class="o">}</span> <span class="k">finally</span> <span class="o">{</span>
  <span class="n">transaction</span><span class="o">.</span><span class="na">end</span><span class="o">();</span>
<span class="o">}</span>
</pre></div>
</div>
</p>

<h2 id="transactional">@Transactional</h2>
<p>
You must be using <em>ENHANCEMENT</em> for @Transactional to work. That means you
must be enhancing the classes via IDE Plugin, Ant Task or javaagent. Refer to the
user guide for more details on enhancement.
</p>

<p>
Ebean can enhance your pojos to add transactional support. To do so put the
@Transaction annotation on a method or class. Ebean enhancement will then add
the supporting transactional logic (begin transaction, commit, rollback, suspend and resuming transactions etc).
</p>

<div class="syntax java"><div class="highlight"><pre><span class="o">...</span>
<span class="c1">// any old pojo</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">MyService</span> <span class="o">{</span>

	<span class="nd">@Transactional</span>
	<span class="kd">public</span> <span class="kt">void</span> <span class="nf">runFirst</span><span class="o">()</span> <span class="kd">throws</span> <span class="n">IOException</span> <span class="o">{</span>

		<span class="c1">// run in a Transaction (REQUIRED is the default)</span>

		<span class="c1">// find a customer</span>
		<span class="n">Customer</span> <span class="n">customer</span> <span class="o">=</span> <span class="n">Ebean</span><span class="o">.</span><span class="na">find</span><span class="o">(</span><span class="n">Customer</span><span class="o">.</span><span class="na">class</span><span class="o">,</span> <span class="mi">1</span><span class="o">);</span>

		<span class="c1">// call another &quot;transactional&quot; method</span>
		<span class="n">runInTrans</span><span class="o">();</span>
	<span class="o">}</span>

	<span class="nd">@Transactional</span><span class="o">(</span><span class="n">type</span><span class="o">=</span><span class="n">TxType</span><span class="o">.</span><span class="na">REQUIRES_NEW</span><span class="o">)</span>
	<span class="kd">public</span> <span class="kt">void</span> <span class="nf">runInTrans</span><span class="o">()</span> <span class="kd">throws</span> <span class="n">IOException</span> <span class="o">{</span>

		<span class="c1">// run in its own NEW transaction</span>
		<span class="c1">// ... suspend an existing transaction if required</span>
		<span class="c1">// ... and resume it when this method ends</span>

		<span class="c1">// find new orders</span>
		<span class="n">List</span><span class="o">&amp;</span><span class="n">lt</span><span class="o">;</span><span class="n">Order</span><span class="o">&amp;</span><span class="n">gt</span><span class="o">;</span> <span class="n">orders</span> <span class="o">=</span> <span class="n">Ebean</span><span class="o">.</span><span class="na">find</span><span class="o">(</span><span class="n">Order</span><span class="o">.</span><span class="na">class</span><span class="o">)</span>
									<span class="o">.</span><span class="na">where</span><span class="o">().</span><span class="na">eq</span><span class="o">(</span><span class="s">&quot;status&quot;</span><span class="o">,</span><span class="n">OrderStatus</span><span class="o">.</span><span class="na">NEW</span><span class="o">)</span>
									<span class="o">.</span><span class="na">findList</span><span class="o">();</span>
		<span class="o">...</span>
</pre></div>
</div>

<p>
Put the @Transactional annotation on you methods and Ebean
can enhance the classes adding the Transactional management.
</p>

<h4 class="plain">Standard transaction scope types</h4>
<p>
This supports the standard propagation rules of
REQUIRED (the default), REQUIRES_NEW, MANDATORY, SUPPORTS, NOT_SUPPORTS, NEVER.
These are an exact match of the EJB TransactionAttributeTypes.
</p>

<h4 class="plain">Nested Transactions</h4>
<p>
Transactional methods can be nested as in the above example where
runFirst() calls runInTrans().
</p>

<h4 class="plain">Isolation level and specific exception support</h4>
<p>
@Transactional (like Spring) supports isolation levels and explicit
handling of Exceptions (to rollback or not for specific exceptions).
Please refer to the User Guide for a more detailed explanation.
</p>

<h4 class="plain">Interfaces</h4>
<p>
You can put @Transactional on interfaces and classes that
implement those interfaces will get the transactional enhancement.
</p>


<h2 id="tx_runnable">TxRunnable / TxCallable</h2>
<p>
TxRunnable and TxCallable are the programmatic equivalent to @Transactional.
</p>
<p>
You can mix @Transaction with TxRunnable and TxCallable if you like, they
will behave correctly together.
</p>

<div class="syntax java"><div class="highlight"><pre><span class="kd">public</span> <span class="kt">void</span> <span class="nf">myMethod</span><span class="o">()</span> <span class="o">{</span>
  <span class="o">...</span>
  <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&quot; Some code in myMethod...&quot;</span><span class="o">);</span>

  <span class="c1">// run in Transactional scope...</span>
  <span class="n">Ebean</span><span class="o">.</span><span class="na">execute</span><span class="o">(</span><span class="k">new</span> <span class="n">TxRunnable</span><span class="o">()</span> <span class="o">{</span>
	<span class="kd">public</span> <span class="kt">void</span> <span class="nf">run</span><span class="o">()</span> <span class="o">{</span>

		<span class="c1">// code running in &quot;REQUIRED&quot; transactional scope</span>
		<span class="c1">// ... as &quot;REQUIRED&quot; is the default TxType</span>
		<span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">Ebean</span><span class="o">.</span><span class="na">currentTransaction</span><span class="o">());</span>

		<span class="c1">// find stuff...</span>
		<span class="n">User</span> <span class="n">user</span> <span class="o">=</span> <span class="n">Ebean</span><span class="o">.</span><span class="na">find</span><span class="o">(</span><span class="n">User</span><span class="o">.</span><span class="na">class</span><span class="o">,</span> <span class="mi">1</span><span class="o">);</span>
		<span class="o">...</span>

		<span class="c1">// save and delete stuff...</span>
		<span class="n">Ebean</span><span class="o">.</span><span class="na">save</span><span class="o">(</span><span class="n">user</span><span class="o">);</span>
		<span class="n">Ebean</span><span class="o">.</span><span class="na">delete</span><span class="o">(</span><span class="n">order</span><span class="o">);</span>
		<span class="o">...</span>
	<span class="o">}</span>
  <span class="o">});</span>

  <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&quot; more code in myMethod...&quot;</span><span class="o">);</span>
<span class="o">}</span>
</pre></div>
</div>
<p>
Generally you will use TxRunnable like the above as anonymous inner classes.
</p>
<p>
The code inside the run() will execute inside a transactional scope with Ebean
handling the transaction propagation for you (just like @Transactional).
</p>

<div class="syntax java"><div class="highlight"><pre><span class="c1">// programmatic control over the scope such as</span>
<span class="c1">// ... isolation level</span>
<span class="c1">// ... and to rollback or not for specific exceptions</span>

<span class="n">TxScope</span> <span class="n">txScope</span> <span class="o">=</span> <span class="n">TxScope</span>
			<span class="o">.</span><span class="na">requiresNew</span><span class="o">()</span>
			<span class="o">.</span><span class="na">setIsolation</span><span class="o">(</span><span class="n">TxIsolation</span><span class="o">.</span><span class="na">SERIALIZABLE</span><span class="o">)</span>
			<span class="o">.</span><span class="na">setNoRollbackFor</span><span class="o">(</span><span class="n">IOException</span><span class="o">.</span><span class="na">class</span><span class="o">);</span>

<span class="n">Ebean</span><span class="o">.</span><span class="na">execute</span><span class="o">(</span><span class="n">txScope</span><span class="o">,</span> <span class="k">new</span> <span class="n">TxRunnable</span><span class="o">()</span> <span class="o">{</span>
	<span class="kd">public</span> <span class="kt">void</span> <span class="nf">run</span><span class="o">()</span> <span class="o">{</span>
		<span class="o">...</span>
<span class="o">}</span>
</pre></div>
</div>

<h2 id="Spring">Spring</h2>
(under construction)

<h2 id="jta">JTA</h2>
(under construction)

</div>

    </div>

    <div class="col-md-3" role="complementary">
      <nav class="bs-docs-sidebar hidden-print hidden-xs hidden-sm">
        <ul class="nav bs-docs-sidenav">


<li class="active">
  <a href="/docs/introduction">Introduction</a>
        <ul class="nav">
          <li><a href="#use_jpa_mapping">Use JPA mappings</a></li>
          <li><a href="#simple_query_language">Simple query language</a></li>
          <li><a href="#intro_save_and_delete">Save and delete</a></li>
          <li><a href="#jpa_comparison">Comparison to JPA</a></li>
          <li><a href="#ebean_does_not">Ebean does not...</a></li>
        </ul>
</li>
<li class="active">
  <a href="/docs/enhancement">Enhancement</a>

          <ul class="nav">
            <li><a href="#enhance_maven">Maven</a></li>
            <li><a href="#enhance_maven_eclipse">Eclipse + Maven</a></li>
            <li><a href="#enhance_ant">Ant</a></li>
            <li><a href="#enhance_agent">Agent</a></li>
            <li><a href="#enhance_ide">IDE enhancement</a></li>
          </ul>
</li>
<li >
  <a href="/docs/configuration">Configuration</a>
</li>
<li >
  <a href="/docs/ebean_access_patterns">Ebean access patterns</a>
</li>
<li >
  <a href="/docs/field_and_property_access">Field and property access</a>
</li>

<li class="active">
  <a href="/docs/queries">Queries</a>
          <ul class="nav">
            <li><a href="#where_clause">Where clause</a></li>
            <li><a href="#query_language">Ebean query language</a></li>
            <li><a href="#partial_objects">Partial objects</a></li>
            <li><a href="#query_joins">Query joins</a></li>
            <li><a href="#fetchconfig">FetchConfig</a></li>
            <li><a href="#lazy_loading">Lazy loading</a></li>
            <li><a href="#named_queries">Named Queries</a></li>
            <li><a href="#large_queries">Large queries</a></li>
            <li><a href="#paging">Paging</a></li>
            <li><a href="#async_queriess">Asynchronous queries</a></li>
            <li><a href="#rawsql">RawSql</a></li>
            <li><a href="#sqlquery">SqlQuery</a></li>
            <li><a href="#l2cache">L2 cache</a></li>
            <li><a href="#autofetch">Autofetch</a></li>
            <li><a href="#other_bits">Other bits</a></li>
          </ul>
</li>
<li class="active">
  <a href="/docs/saving">Saving</a>
          <ul class="nav">
            <li><a href="#saves">Save</a></li>
            <li><a href="#deletes">Delete</a></li>
            <li><a href="#cascading">Cascade</a></li>
            <li><a href="#bulkupdate">Bulk updates</a></li>
            <li><a href="#bulksqlupdate">Bulk SQL updates</a></li>
            <li><a href="#callablesql">CallableSql</a></li>
            <li><a href="#rawjdbc">Raw JDBC</a></li>
            <li><a href="#batch_processing">JDBC Batch</a></li>
          </ul>
</li>
<li class="active">
  <a href="/docs/mapping">Mapping</a>
          <ul class="nav">
            <li><a href="#jpa_mapping">JPA mapping</a></li>
            <li><a href="#ddl_generation">DDL generation</a></li>
            <li><a href="#naming_convention">Naming convention</a></li>
            <li><a href="#mapping_annotations">Mapping annotations</a></li>
            <li><a href="#relationships">Relationships</a></li>
            <li><a href="#id_generation">Id generation</a></li>
            <li><a href="#formula">Formula</a></li>
            <li><a href="#enummapping">EnumMapping</a></li>
            <li><a href="#encryption">Encryption</a></li>
          </ul>
</li>
<li class="active">
  <a href="/docs/transactions">Transactions</a>
          <ul class="nav">
            <li><a href="#implicit_transactions">Implicit</a></li>
            <li><a href="#programmatic_transactions">Programmatic</a></li>
            <li><a href="#tx_control_behaviour">Controlling behaviour in a transaction</a></li>
            <li><a href="#transactional">@Transactional</a></li>
            <li><a href="#tx_runnable">TxRunnable / TxCallable</a></li>
            <li><a href="#spring">Spring</a></li>
            <li><a href="#jta">JTA</a></li>
          </ul>
</li>
<li >
  <a href="/docs/json">JSON</a>
</li>
<li >
  <a href="/docs/eventlisteners">Event listeners</a>
</li>
<li >
  <a href="/docs/readaudit">Read Audit</a>
</li>
<li class="active">
  <a href="/docs/changelog">Change Log</a>
</li>
<li >
  <a href="/docs/l2caching">L2 caching</a>
</li>
<li >
  <a href="/docs/testing">Testing</a>
</li>
<li >
  <a href="/docs/jvmlanguages">JVM Languages</a>
</li>

<li >
  <a href="/docs/clustering">Clustering</a>
</li>
<li >
  <a href="/docs/monitoring">Monitoring</a>
</li>
<li >
  <a href="/docs/architecture">Architecture</a>
</li>

        </ul>
          <a class="back-to-top" href="#top">
            Back to top
          </a>
      </nav>
    </div>
  </div>

</div>
<!-- /.row -->
</div>  <!-- /.container -->
  </div>
</div>

<footer id="footer">
 <div class="doc-footer">
  <ul class="doc-footer-links">
    <li><a href="/">Ebean ORM</a></li>
    <li> | </li>
    <li><a href="http://avaje-metric.github.io">Metrics</a></li>
    <li> | </li>
    <li><a href="/websitegenerator/index">Website Generator</a></li>
    <li> | </li>
    <li><a href="/jetty/index">Jetty Runnable War</a></li>
  </ul>
 </div>
</footer>

  <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.2/jquery.min.js"></script>
  <script src="/js/bootstrap.min.js"></script>
  <script src="/js/jquery.easing.min.js"></script>

  <script src="/js/json2.js"></script>
  <script src="/js/jquery.cookie.min.js"></script>
  <script src="/js/jquery.storageapi.min.js"></script>

  <script src="/js/ebean-site.js"></script>

  </body>
</html>

<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta id="layout-head" />
    <title>avaje ebean</title>
    <link rel="shortcut icon" href="/images/favicon.ico" >
    <!--<link href="/css/bootstrap.min.css" rel="stylesheet">-->
    <!-- Latest compiled and minified CSS -->
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.5/css/bootstrap.min.css">
    <link rel="stylesheet" href="/css/pygments.css" type="text/css" />
    <link rel="stylesheet" href="/css/site.css">
    <link rel="stylesheet" href="//netdna.bootstrapcdn.com/font-awesome/4.1.0/css/font-awesome.min.css">
      <!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
      <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
      <script src="https://oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>
    <![endif]-->
</head>
  <body>
  <div id="wrap">
    <div id="header">
    <div class="navbar navbar-inverse navbar-fixed-top" role="navigation">
      <div class="container">
        <div class="navbar-header">
          <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
            <span class="sr-only">Toggle navigation</span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
          </button>
          <a class="navbar-brand" href="/">Ebean ORM</a>
        </div>
        <div class="collapse navbar-collapse">
          <ul class="nav navbar-nav pull-right">
            <li ><a href="/"><span class="glyphicon glyphicon-home"></span>  Home</a></li>
            <li ><a href="/videos">Videos</a></li>
            <li ><a href="/quickstart">Quick Start</a></li>
            <li ><a href="/support">Support</a></li>
            <li class="active"><a href="/docs">Docs</a></li>
            <li ><a target="_blank" href="/apidocs">ApiDocs</a></li>
            <li ><a href="/releases">Releases</a></li>
            <li ><a target="_blank" href="https://github.com/ebean-orm/avaje-ebeanorm"> <i class="fa fa-github"></i> Github</a></li>
          </ul>
        </div><!--/.nav-collapse -->
      </div>
    </div>

  </div>
  <div id="main" data-offset="60">
<div class="jumbotron mini">
  <div class="container">
    <h1><a href="/docs">Documentation</a> / JSON </h1>
  </div>
</div>

<div class="container doc-index bs-docs-container">

  <div class="row">

    <div class="col-md-9" role="main">

      <div class="bs-docs-section">
<h1 id="json">JSON</h1>
...(under construction)...

<p>

Ebean can hydrate a bean from json.  It will ignore the json properties that do not match up to properties on the bean.

<div class="syntax java"><div class="highlight"><pre><span class="n">String</span> <span class="n">jsonWithUnknown</span> <span class="o">=</span> <span class="s">&quot;{\&quot;id\&quot;:42, \&quot;unknownProp\&quot;:\&quot;foo\&quot;, \&quot;name\&quot;:\&quot;rob\&quot;, \&quot;version\&quot;:1}&quot;</span><span class="o">;</span>

<span class="n">Customer</span> <span class="n">customer</span> <span class="o">=</span> <span class="n">Ebean</span><span class="o">.</span><span class="na">json</span><span class="o">().</span><span class="na">toBean</span><span class="o">(</span><span class="n">Customer</span><span class="o">.</span><span class="na">class</span><span class="o">,</span> <span class="n">jsonWithUnknown</span><span class="o">);</span>
<span class="n">assertEquals</span><span class="o">(</span><span class="n">Integer</span><span class="o">.</span><span class="na">valueOf</span><span class="o">(</span><span class="mi">42</span><span class="o">),</span> <span class="n">customer</span><span class="o">.</span><span class="na">getId</span><span class="o">());</span>
<span class="n">assertEquals</span><span class="o">(</span><span class="s">&quot;rob&quot;</span><span class="o">,</span> <span class="n">customer</span><span class="o">.</span><span class="na">getName</span><span class="o">());</span>
</pre></div>
</div>

</p>
</div>

    </div>

    <div class="col-md-3" role="complementary">
      <nav class="bs-docs-sidebar hidden-print hidden-xs hidden-sm">
        <ul class="nav bs-docs-sidenav">


<li class="active">
  <a href="/docs/introduction">Introduction</a>
        <ul class="nav">
          <li><a href="#use_jpa_mapping">Use JPA mappings</a></li>
          <li><a href="#simple_query_language">Simple query language</a></li>
          <li><a href="#intro_save_and_delete">Save and delete</a></li>
          <li><a href="#jpa_comparison">Comparison to JPA</a></li>
          <li><a href="#ebean_does_not">Ebean does not...</a></li>
        </ul>
</li>
<li class="active">
  <a href="/docs/enhancement">Enhancement</a>

          <ul class="nav">
            <li><a href="#enhance_maven">Maven</a></li>
            <li><a href="#enhance_maven_eclipse">Eclipse + Maven</a></li>
            <li><a href="#enhance_ant">Ant</a></li>
            <li><a href="#enhance_agent">Agent</a></li>
            <li><a href="#enhance_ide">IDE enhancement</a></li>
          </ul>
</li>
<li >
  <a href="/docs/configuration">Configuration</a>
</li>
<li >
  <a href="/docs/ebean_access_patterns">Ebean access patterns</a>
</li>
<li >
  <a href="/docs/field_and_property_access">Field and property access</a>
</li>

<li class="active">
  <a href="/docs/queries">Queries</a>
          <ul class="nav">
            <li><a href="#where_clause">Where clause</a></li>
            <li><a href="#query_language">Ebean query language</a></li>
            <li><a href="#partial_objects">Partial objects</a></li>
            <li><a href="#query_joins">Query joins</a></li>
            <li><a href="#fetchconfig">FetchConfig</a></li>
            <li><a href="#lazy_loading">Lazy loading</a></li>
            <li><a href="#named_queries">Named Queries</a></li>
            <li><a href="#large_queries">Large queries</a></li>
            <li><a href="#paging">Paging</a></li>
            <li><a href="#async_queriess">Asynchronous queries</a></li>
            <li><a href="#rawsql">RawSql</a></li>
            <li><a href="#sqlquery">SqlQuery</a></li>
            <li><a href="#l2cache">L2 cache</a></li>
            <li><a href="#autofetch">Autofetch</a></li>
            <li><a href="#other_bits">Other bits</a></li>
          </ul>
</li>
<li class="active">
  <a href="/docs/saving">Saving</a>
          <ul class="nav">
            <li><a href="#saves">Save</a></li>
            <li><a href="#deletes">Delete</a></li>
            <li><a href="#cascading">Cascade</a></li>
            <li><a href="#bulkupdate">Bulk updates</a></li>
            <li><a href="#bulksqlupdate">Bulk SQL updates</a></li>
            <li><a href="#callablesql">CallableSql</a></li>
            <li><a href="#rawjdbc">Raw JDBC</a></li>
            <li><a href="#batch_processing">JDBC Batch</a></li>
          </ul>
</li>
<li class="active">
  <a href="/docs/mapping">Mapping</a>
          <ul class="nav">
            <li><a href="#jpa_mapping">JPA mapping</a></li>
            <li><a href="#ddl_generation">DDL generation</a></li>
            <li><a href="#naming_convention">Naming convention</a></li>
            <li><a href="#mapping_annotations">Mapping annotations</a></li>
            <li><a href="#relationships">Relationships</a></li>
            <li><a href="#id_generation">Id generation</a></li>
            <li><a href="#formula">Formula</a></li>
            <li><a href="#enummapping">EnumMapping</a></li>
            <li><a href="#encryption">Encryption</a></li>
          </ul>
</li>
<li class="active">
  <a href="/docs/transactions">Transactions</a>
          <ul class="nav">
            <li><a href="#implicit_transactions">Implicit</a></li>
            <li><a href="#programmatic_transactions">Programmatic</a></li>
            <li><a href="#tx_control_behaviour">Controlling behaviour in a transaction</a></li>
            <li><a href="#transactional">@Transactional</a></li>
            <li><a href="#tx_runnable">TxRunnable / TxCallable</a></li>
            <li><a href="#spring">Spring</a></li>
            <li><a href="#jta">JTA</a></li>
          </ul>
</li>
<li class="active">
  <a href="/docs/json">JSON</a>
</li>
<li >
  <a href="/docs/eventlisteners">Event listeners</a>
</li>
<li >
  <a href="/docs/readaudit">Read Audit</a>
</li>
<li class="active">
  <a href="/docs/changelog">Change Log</a>
</li>
<li >
  <a href="/docs/l2caching">L2 caching</a>
</li>
<li >
  <a href="/docs/testing">Testing</a>
</li>
<li >
  <a href="/docs/jvmlanguages">JVM Languages</a>
</li>

<li >
  <a href="/docs/clustering">Clustering</a>
</li>
<li >
  <a href="/docs/monitoring">Monitoring</a>
</li>
<li >
  <a href="/docs/architecture">Architecture</a>
</li>

        </ul>
          <a class="back-to-top" href="#top">
            Back to top
          </a>
      </nav>
    </div>
  </div>

</div>
<!-- /.row -->
</div>  <!-- /.container -->
  </div>
</div>

<footer id="footer">
 <div class="doc-footer">
  <ul class="doc-footer-links">
    <li><a href="/">Ebean ORM</a></li>
    <li> | </li>
    <li><a href="http://avaje-metric.github.io">Metrics</a></li>
    <li> | </li>
    <li><a href="/websitegenerator/index">Website Generator</a></li>
    <li> | </li>
    <li><a href="/jetty/index">Jetty Runnable War</a></li>
  </ul>
 </div>
</footer>

  <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.2/jquery.min.js"></script>
  <script src="/js/bootstrap.min.js"></script>
  <script src="/js/jquery.easing.min.js"></script>

  <script src="/js/json2.js"></script>
  <script src="/js/jquery.cookie.min.js"></script>
  <script src="/js/jquery.storageapi.min.js"></script>

  <script src="/js/ebean-site.js"></script>

  </body>
</html>

<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta id="layout-head" />
    <title>avaje ebean</title>
    <link rel="shortcut icon" href="/images/favicon.ico" >
    <!--<link href="/css/bootstrap.min.css" rel="stylesheet">-->
    <!-- Latest compiled and minified CSS -->
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.5/css/bootstrap.min.css">
    <link rel="stylesheet" href="/css/pygments.css" type="text/css" />
    <link rel="stylesheet" href="/css/site.css">
    <link rel="stylesheet" href="//netdna.bootstrapcdn.com/font-awesome/4.1.0/css/font-awesome.min.css">
      <!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
      <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
      <script src="https://oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>
    <![endif]-->
</head>
  <body>
  <div id="wrap">
    <div id="header">
    <div class="navbar navbar-inverse navbar-fixed-top" role="navigation">
      <div class="container">
        <div class="navbar-header">
          <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
            <span class="sr-only">Toggle navigation</span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
          </button>
          <a class="navbar-brand" href="/">Ebean ORM</a>
        </div>
        <div class="collapse navbar-collapse">
          <ul class="nav navbar-nav pull-right">
            <li ><a href="/"><span class="glyphicon glyphicon-home"></span>  Home</a></li>
            <li ><a href="/videos">Videos</a></li>
            <li ><a href="/quickstart">Quick Start</a></li>
            <li ><a href="/support">Support</a></li>
            <li class="active"><a href="/docs">Docs</a></li>
            <li ><a target="_blank" href="/apidocs">ApiDocs</a></li>
            <li ><a href="/releases">Releases</a></li>
            <li ><a target="_blank" href="https://github.com/ebean-orm/avaje-ebeanorm"> <i class="fa fa-github"></i> Github</a></li>
          </ul>
        </div><!--/.nav-collapse -->
      </div>
    </div>

  </div>
  <div id="main" data-offset="60">
<div class="jumbotron mini">
  <div class="container">
    <h1><a href="/docs">Documentation</a> / Event listeners </h1>
  </div>
</div>

<div class="container doc-index bs-docs-container">

  <div class="row">

    <div class="col-md-9" role="main">

      <div class="bs-docs-section">
<h1 id="event_listeners">Event listeners</h1>
...(under construction)...

<p>Since version 4.0.1, Ebean supports JPA EntityListener Annotations:
  <ul>
    <li>@PostLoad</li>
    <li>@PostPersist</li>
    <li>@PostRemove</li>
    <li>@PostUpdate</li>
    <li>@PrePersist</li>
    <li>@PreRemove</li>
    <li>@PreUpdate</li>
  </ul>

<div class="syntax java"><div class="highlight"><pre><span class="kn">import</span> <span class="nn">javax.persistence.PostLoad</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">javax.persistence.PostPersist</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">javax.persistence.PostRemove</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">javax.persistence.PostUpdate</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">javax.persistence.PrePersist</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">javax.persistence.PreRemove</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">javax.persistence.PreUpdate</span><span class="o">;</span>

<span class="o">...</span>

<span class="nd">@Entity</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">Customer</span> <span class="o">{</span>

  <span class="nd">@Id</span>
  <span class="n">Long</span> <span class="n">id</span><span class="o">;</span>

  <span class="n">String</span> <span class="n">name</span><span class="o">;</span>

  <span class="nd">@Version</span>
  <span class="n">Long</span> <span class="n">version</span><span class="o">;</span>


  <span class="nd">@PrePersist</span>
  <span class="kd">public</span> <span class="kt">void</span> <span class="nf">prePersist1</span><span class="o">()</span> <span class="o">{</span>
      <span class="o">...</span>
  <span class="o">}</span>


  <span class="nd">@PostPersist</span>
  <span class="kd">public</span> <span class="kt">void</span> <span class="nf">postPersist1</span><span class="o">()</span> <span class="o">{</span>
    <span class="o">...</span>
  <span class="o">}</span>


  <span class="nd">@PreUpdate</span>
  <span class="kd">public</span> <span class="kt">void</span> <span class="nf">preUpdate1</span><span class="o">()</span> <span class="o">{</span>
    <span class="o">...</span>
  <span class="o">}</span>

  <span class="nd">@PostUpdate</span>
  <span class="kd">public</span> <span class="kt">void</span> <span class="nf">postUpdate1</span><span class="o">()</span> <span class="o">{</span>
    <span class="o">...</span>
  <span class="o">}</span>


  <span class="nd">@PreRemove</span>
  <span class="kd">public</span> <span class="kt">void</span> <span class="nf">preRemove1</span><span class="o">()</span> <span class="o">{</span>
    <span class="o">...</span>
  <span class="o">}</span>

  <span class="nd">@PostRemove</span>
  <span class="kd">public</span> <span class="kt">void</span> <span class="nf">postRemove1</span><span class="o">()</span> <span class="o">{</span>
    <span class="o">...</span>
  <span class="o">}</span>

  <span class="nd">@PostLoad</span>
  <span class="kd">public</span> <span class="kt">void</span> <span class="nf">postLoad1</span><span class="o">()</span> <span class="o">{</span>
    <span class="o">...</span>
  <span class="o">}</span>
</pre></div>
</div>

<h4>BeanPersistController</h4>
<p>To listen for events on entity, you can also use the BeanPersistController</p>

<p>BeanPersistController is used to enhance or override the default bean persistence mechanism.</p>

<p>Note that if want to totally change the finding, you need to use a BeanQueryAdapter rather than using postLoad().</p>

<p>Note that getTransaction() on the PersistRequest returns the transaction used for the insert, update, delete or fetch. To explicitly use this same transaction you should use this transaction via methods on EbeanServer.</p>

<div class="syntax java"><div class="highlight"><pre><span class="n">Object</span> <span class="n">extaBeanToSave</span> <span class="o">=</span> <span class="o">...;</span>
<span class="n">Transaction</span> <span class="n">t</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="na">getTransaction</span><span class="o">();</span>
<span class="n">EbeanServer</span> <span class="n">server</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="na">getEbeanServer</span><span class="o">();</span>
<span class="n">server</span><span class="o">.</span><span class="na">save</span><span class="o">(</span><span class="n">extraBeanToSave</span><span class="o">,</span> <span class="n">t</span><span class="o">);</span>
</pre></div>
</div>

<p>It is worth noting that BeanPersistListener is different in three main ways from BeanPersistController postXXX methods.</p>

<p>BeanPersistListener only sees successfully committed events. BeanController pre and post methods occur before the commit or a rollback and will see events that are later rolled back</p>

<p>BeanPersistListener runs in a background thread and will not effect the response time of the actual persist where as BeanController code will
BeanPersistListener can be notified of events from other servers in a cluster.</p>

<p>A BeanPersistController is either found automatically via class path search or can be added programmatically via ServerConfiguration.addEntity().</p>



</div>

    </div>

    <div class="col-md-3" role="complementary">
      <nav class="bs-docs-sidebar hidden-print hidden-xs hidden-sm">
        <ul class="nav bs-docs-sidenav">


<li class="active">
  <a href="/docs/introduction">Introduction</a>
        <ul class="nav">
          <li><a href="#use_jpa_mapping">Use JPA mappings</a></li>
          <li><a href="#simple_query_language">Simple query language</a></li>
          <li><a href="#intro_save_and_delete">Save and delete</a></li>
          <li><a href="#jpa_comparison">Comparison to JPA</a></li>
          <li><a href="#ebean_does_not">Ebean does not...</a></li>
        </ul>
</li>
<li class="active">
  <a href="/docs/enhancement">Enhancement</a>

          <ul class="nav">
            <li><a href="#enhance_maven">Maven</a></li>
            <li><a href="#enhance_maven_eclipse">Eclipse + Maven</a></li>
            <li><a href="#enhance_ant">Ant</a></li>
            <li><a href="#enhance_agent">Agent</a></li>
            <li><a href="#enhance_ide">IDE enhancement</a></li>
          </ul>
</li>
<li >
  <a href="/docs/configuration">Configuration</a>
</li>
<li >
  <a href="/docs/ebean_access_patterns">Ebean access patterns</a>
</li>
<li >
  <a href="/docs/field_and_property_access">Field and property access</a>
</li>

<li class="active">
  <a href="/docs/queries">Queries</a>
          <ul class="nav">
            <li><a href="#where_clause">Where clause</a></li>
            <li><a href="#query_language">Ebean query language</a></li>
            <li><a href="#partial_objects">Partial objects</a></li>
            <li><a href="#query_joins">Query joins</a></li>
            <li><a href="#fetchconfig">FetchConfig</a></li>
            <li><a href="#lazy_loading">Lazy loading</a></li>
            <li><a href="#named_queries">Named Queries</a></li>
            <li><a href="#large_queries">Large queries</a></li>
            <li><a href="#paging">Paging</a></li>
            <li><a href="#async_queriess">Asynchronous queries</a></li>
            <li><a href="#rawsql">RawSql</a></li>
            <li><a href="#sqlquery">SqlQuery</a></li>
            <li><a href="#l2cache">L2 cache</a></li>
            <li><a href="#autofetch">Autofetch</a></li>
            <li><a href="#other_bits">Other bits</a></li>
          </ul>
</li>
<li class="active">
  <a href="/docs/saving">Saving</a>
          <ul class="nav">
            <li><a href="#saves">Save</a></li>
            <li><a href="#deletes">Delete</a></li>
            <li><a href="#cascading">Cascade</a></li>
            <li><a href="#bulkupdate">Bulk updates</a></li>
            <li><a href="#bulksqlupdate">Bulk SQL updates</a></li>
            <li><a href="#callablesql">CallableSql</a></li>
            <li><a href="#rawjdbc">Raw JDBC</a></li>
            <li><a href="#batch_processing">JDBC Batch</a></li>
          </ul>
</li>
<li class="active">
  <a href="/docs/mapping">Mapping</a>
          <ul class="nav">
            <li><a href="#jpa_mapping">JPA mapping</a></li>
            <li><a href="#ddl_generation">DDL generation</a></li>
            <li><a href="#naming_convention">Naming convention</a></li>
            <li><a href="#mapping_annotations">Mapping annotations</a></li>
            <li><a href="#relationships">Relationships</a></li>
            <li><a href="#id_generation">Id generation</a></li>
            <li><a href="#formula">Formula</a></li>
            <li><a href="#enummapping">EnumMapping</a></li>
            <li><a href="#encryption">Encryption</a></li>
          </ul>
</li>
<li class="active">
  <a href="/docs/transactions">Transactions</a>
          <ul class="nav">
            <li><a href="#implicit_transactions">Implicit</a></li>
            <li><a href="#programmatic_transactions">Programmatic</a></li>
            <li><a href="#tx_control_behaviour">Controlling behaviour in a transaction</a></li>
            <li><a href="#transactional">@Transactional</a></li>
            <li><a href="#tx_runnable">TxRunnable / TxCallable</a></li>
            <li><a href="#spring">Spring</a></li>
            <li><a href="#jta">JTA</a></li>
          </ul>
</li>
<li class="active">
  <a href="/docs/json">JSON</a>
</li>
<li class="active">
  <a href="/docs/eventlisteners">Event listeners</a>
</li>
<li >
  <a href="/docs/readaudit">Read Audit</a>
</li>
<li class="active">
  <a href="/docs/changelog">Change Log</a>
</li>
<li >
  <a href="/docs/l2caching">L2 caching</a>
</li>
<li >
  <a href="/docs/testing">Testing</a>
</li>
<li >
  <a href="/docs/jvmlanguages">JVM Languages</a>
</li>

<li >
  <a href="/docs/clustering">Clustering</a>
</li>
<li >
  <a href="/docs/monitoring">Monitoring</a>
</li>
<li >
  <a href="/docs/architecture">Architecture</a>
</li>

        </ul>
          <a class="back-to-top" href="#top">
            Back to top
          </a>
      </nav>
    </div>
  </div>

</div>
<!-- /.row -->
</div>  <!-- /.container -->
  </div>
</div>

<footer id="footer">
 <div class="doc-footer">
  <ul class="doc-footer-links">
    <li><a href="/">Ebean ORM</a></li>
    <li> | </li>
    <li><a href="http://avaje-metric.github.io">Metrics</a></li>
    <li> | </li>
    <li><a href="/websitegenerator/index">Website Generator</a></li>
    <li> | </li>
    <li><a href="/jetty/index">Jetty Runnable War</a></li>
  </ul>
 </div>
</footer>

  <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.2/jquery.min.js"></script>
  <script src="/js/bootstrap.min.js"></script>
  <script src="/js/jquery.easing.min.js"></script>

  <script src="/js/json2.js"></script>
  <script src="/js/jquery.cookie.min.js"></script>
  <script src="/js/jquery.storageapi.min.js"></script>

  <script src="/js/ebean-site.js"></script>

  </body>
</html>
<div class="bs-docs-section">
<h1 id="readaudit">@ReadAudit</h1>

  <h3>Overview</h3>
<p>
ReadAudit is a feature where read access is logged for auditing purposes. You can annotation entity
  beans with @ReadAudit and then read events on these beans (queries and hits in L2 cache) are logged.
</p>
<p>
An implementation of the ReadAuditPrepare interface is typically required. The readAuditPrepare.prepare()
  method is expected to populate the ReadEvent with user context information (user id, user ip address etc).
</p>
  <h3>Caveats</h3>
  <p>
    SqlQuery queries are currently not logged to the read audit log (RawSql queries are included in read auditing).
  </p>

  <h3>Steps - Getting started</h3>
<ul>
  <li>1) Add @ReadAudit annotation to all the entity beans that should have read auditing</li>
  <li>2) Create an implementation of ReadAuditPrepare</li>
  <li>3) Register the implementation of ReadAuditPrepare with ServerConfig</li>
  <li>4) Configure logging (logback etc) as desired. Typically read auditing is directed into it's own logs</li>
</ul>

  <h4>Step 1: Add @ReadAudit</h4>
  <p>
    Add @ReadAudit annotation to all the entity beans that should have read auditing.
  </p>
<div class="syntax java"><div class="highlight"><pre>  <span class="nd">@ReadAudit</span>
  <span class="nd">@Entity</span>
  <span class="nd">@Table</span><span class="o">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">&quot;customer&quot;</span><span class="o">)</span>
  <span class="kd">public</span> <span class="kd">class</span> <span class="nc">Customer</span> <span class="o">{</span>
    <span class="o">...</span>
</pre></div>
</div>
  <h4>Step 2: Implement ReadAuditPrepare</h4>
  <p>
    If you skip this step and don't supply a ReadAuditPrepare implementation a 'no op' implementation
    is used and the user context information (user id, user ip address etc) is left unpopulated.
  </p>

<div class="syntax java"><div class="highlight"><pre>  <span class="kd">class</span> <span class="nc">MyReadAuditPrepare</span> <span class="kd">implements</span> <span class="n">ReadAuditPrepare</span> <span class="o">{</span>

    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">prepare</span><span class="o">(</span><span class="n">ReadEvent</span> <span class="n">event</span><span class="o">)</span> <span class="o">{</span>

      <span class="c1">// get user context information typically from a</span>
      <span class="c1">// ThreadLocal or similar mechanism</span>

      <span class="n">String</span> <span class="n">currentUserId</span> <span class="o">=</span> <span class="o">...;</span>
      <span class="n">event</span><span class="o">.</span><span class="na">setUserId</span><span class="o">(</span><span class="n">currentUserId</span><span class="o">);</span>

      <span class="n">String</span> <span class="n">userIpAddress</span> <span class="o">=</span> <span class="o">...;</span>
      <span class="n">event</span><span class="o">.</span><span class="na">setUserIpAddress</span><span class="o">(</span><span class="n">userIpAddress</span><span class="o">);</span>

      <span class="n">event</span><span class="o">.</span><span class="na">setSource</span><span class="o">(</span><span class="s">&quot;myApplicationName&quot;</span><span class="o">);</span>

      <span class="c1">// add arbitrary user context information to the</span>
      <span class="c1">// userContext map</span>
      <span class="n">event</span><span class="o">.</span><span class="na">getUserContext</span><span class="o">().</span><span class="na">put</span><span class="o">(</span><span class="s">&quot;some&quot;</span><span class="o">,</span> <span class="s">&quot;thing&quot;</span><span class="o">);</span>
    <span class="o">}</span>
  <span class="o">}</span>
</pre></div>
</div>

  <h4>Step 3: Register ReadAuditPrepare implementation</h4>
  <p>
    The implementation of ReadAuditPrepare can be automatically detected
    if classpath scanning is on (just like entity beans are found etc). That is,
    if scanning is on you don't need to explicitly register the ReadAuditPrepare implementation
    and instead it will be found and instantiated.
  </p>
  <p>
    If scanning is not used or the ReadAuditPrepare implementation has dependencies and its
    instantiation should be performed externally to Ebean then you can register it explicitly
    with the ServerConfig.
  </p>

<div class="syntax java"><div class="highlight"><pre>  <span class="c1">// example code explicitly registering the ReadAuditPrepare implementation</span>

  <span class="n">MyReadAuditPrepare</span> <span class="n">readAuditPrepare</span> <span class="o">=</span> <span class="o">...;</span>

  <span class="n">ServerConfig</span> <span class="n">config</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ServerConfig</span><span class="o">();</span>
  <span class="n">config</span><span class="o">.</span><span class="na">setName</span><span class="o">(</span><span class="s">&quot;h2&quot;</span><span class="o">);</span>
  <span class="o">...</span>
  <span class="c1">// register explicitly here</span>
  <span class="n">config</span><span class="o">.</span><span class="na">setReadAuditPrepare</span><span class="o">(</span><span class="n">readAuditPrepare</span><span class="o">);</span>


  <span class="n">EbeanServer</span> <span class="n">server</span> <span class="o">=</span> <span class="n">EbeanServerFactory</span><span class="o">.</span><span class="na">create</span><span class="o">(</span><span class="n">config</span><span class="o">);</span>
  <span class="o">...</span>
</pre></div>
</div>

</div>

<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta id="layout-head" />
    <title>avaje ebean</title>
    <link rel="shortcut icon" href="/images/favicon.ico" >
    <!--<link href="/css/bootstrap.min.css" rel="stylesheet">-->
    <!-- Latest compiled and minified CSS -->
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.5/css/bootstrap.min.css">
    <link rel="stylesheet" href="/css/pygments.css" type="text/css" />
    <link rel="stylesheet" href="/css/site.css">
    <link rel="stylesheet" href="//netdna.bootstrapcdn.com/font-awesome/4.1.0/css/font-awesome.min.css">
      <!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
      <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
      <script src="https://oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>
    <![endif]-->
</head>
  <body>
  <div id="wrap">
    <div id="header">
    <div class="navbar navbar-inverse navbar-fixed-top" role="navigation">
      <div class="container">
        <div class="navbar-header">
          <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
            <span class="sr-only">Toggle navigation</span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
          </button>
          <a class="navbar-brand" href="/">Ebean ORM</a>
        </div>
        <div class="collapse navbar-collapse">
          <ul class="nav navbar-nav pull-right">
            <li ><a href="/"><span class="glyphicon glyphicon-home"></span>  Home</a></li>
            <li ><a href="/videos">Videos</a></li>
            <li ><a href="/quickstart">Quick Start</a></li>
            <li ><a href="/support">Support</a></li>
            <li class="active"><a href="/docs">Docs</a></li>
            <li ><a target="_blank" href="/apidocs">ApiDocs</a></li>
            <li ><a href="/releases">Releases</a></li>
            <li ><a target="_blank" href="https://github.com/ebean-orm/avaje-ebeanorm"> <i class="fa fa-github"></i> Github</a></li>
          </ul>
        </div><!--/.nav-collapse -->
      </div>
    </div>

  </div>
  <div id="main" data-offset="60">
<div class="jumbotron mini">
  <div class="container">
    <h1><a href="/docs">Documentation</a> / L2 caching </h1>
  </div>
</div>

<div class="container doc-index bs-docs-container">

  <div class="row">

    <div class="col-md-9" role="main">

      <div class="bs-docs-section">
<h1 id="l2caching">L2 caching</h1>

<p>
When we want to talk about caching for performance we are talking about the "Level 2"
cache or the "server cache". It is called the "Level 2 cache" because the persistence
context is often referred to as the "Level 1 cache".
</p>
<p>
The goal of the L2 server cache is to gain very significant performance improvement by
not having to hit the database.
</p>

<h2 id="bean_and_query_caches">Bean and query caches</h2>
<p>
Ebean has 2 types of caches â€“ Bean caches and Query caches.
</p>
<h4>Bean Caches</h4>
<p>Bean caches hold entity beans and are keyed by their Id values.</p>
<h4>Query Caches</h4>
<p>
Query caches hold the results of queries (Lists, Sets, Maps of entity beans) and are keyed
by the query hash value (effectively a hash of the query and its bind values).
The entries in a query cache are invalidated by ANY change to the underlying table â€“
insert, update or delete. This means that the query cache is only useful on entities that are
infrequently modified (typically "lookup tables" such as countries, currencies, status codes
etc).
</p>

<h2 id="read_only_instances">Read only instances</h2>
<p>
For a performance optimisation when using the cache you can inform Ebean that you
want "read only" entities. If you ask for "read only" entities Ebean can give you the
instance that is in the cache rather than creating a new copy (creating a new instance and
copying the data from the cached instance).
</p>
<p>
To be safe in allowing many threads to share the same instances (from the cache) Ebean
ensures that these instances can not be mutated. It sets flags (sharedInstance=true,
readOnly=true) and any attempt to modify the entity (via setters or putfields) results in an
IllegalStateException being thrown.
</p>

<div class="syntax java"><div class="highlight"><pre><span class="c1">// Cache countries. Use readOnly=true so unless explicitly</span>
<span class="c1">// stated in the query we will return read only/shared instances</span>
<span class="nd">@CacheStrategy</span><span class="o">(</span><span class="n">readOnly</span><span class="o">=</span><span class="kc">true</span><span class="o">,</span><span class="n">warmingQuery</span><span class="o">=</span><span class="s">&quot;order by name&quot;</span><span class="o">)</span>
<span class="nd">@Entity</span>
<span class="nd">@Table</span><span class="o">(</span><span class="n">name</span><span class="o">=</span><span class="s">&quot;o_country&quot;</span><span class="o">)</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">Country</span> <span class="o">{</span>
</pre></div>
</div>

<p>Note that Countries is a good candidate for a default setting of readOnly=true. This is
because (for my application) country information is very rarely changed. The application
code mostly treats the countries as read only.</p>

<p>Now, whenever we get a country (via direct query or indirectly via relationships/joins) unless
we explictly say query.setReadOnly(false) we are going to get back readOnly instances that
we will not be able to mutate.</p>

<div class="syntax java"><div class="highlight"><pre><span class="c1">// we will use the cache .. and the instance</span>
<span class="c1">// in the cache is returned to us (not a copy)</span>
<span class="n">Country</span> <span class="n">country</span> <span class="o">=</span> <span class="n">Ebean</span><span class="o">.</span><span class="na">find</span><span class="o">(</span><span class="n">Country</span><span class="o">.</span><span class="na">class</span><span class="o">,</span> <span class="s">&quot;NZ&quot;</span><span class="o">);</span>

<span class="c1">// this country instance is readOnly</span>
<span class="n">Assert</span><span class="o">.</span><span class="na">assertTrue</span><span class="o">(</span><span class="n">Ebean</span><span class="o">.</span><span class="na">getBeanState</span><span class="o">(</span><span class="n">country</span><span class="o">).</span><span class="na">isReadOnly</span><span class="o">());</span>
<span class="k">try</span> <span class="o">{</span>
  <span class="c1">// we can&#39;t modify a readOnly bean</span>
  <span class="c1">// â€¦ a IllegalStateException is thrown</span>
  <span class="n">country</span><span class="o">.</span><span class="na">setName</span><span class="o">(</span><span class="s">&quot;Nu Zilund&quot;</span><span class="o">);</span>
  <span class="n">Assert</span><span class="o">.</span><span class="na">assertFalse</span><span class="o">(</span><span class="s">&quot;Never get here&quot;</span><span class="o">,</span><span class="kc">true</span><span class="o">);</span>
<span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="n">IllegalStateException</span> <span class="n">e</span><span class="o">){</span>
  <span class="n">Assert</span><span class="o">.</span><span class="na">assertTrue</span><span class="o">(</span><span class="s">&quot;This is readOnly&quot;</span><span class="o">,</span><span class="kc">true</span><span class="o">);</span>
<span class="o">}</span>

<span class="c1">// explicitly state we want a MUTABLE COPY</span>
<span class="c1">// â€¦ not the same instance as the one in cache</span>
<span class="c1">// â€¦ a copy is made and returned instead</span>
<span class="n">Country</span> <span class="n">countryCopy</span> <span class="o">=</span> <span class="n">Ebean</span><span class="o">.</span><span class="na">find</span><span class="o">(</span><span class="n">Country</span><span class="o">.</span><span class="na">class</span><span class="o">)</span>
<span class="o">.</span><span class="na">setReadOnly</span><span class="o">(</span><span class="kc">false</span><span class="o">)</span>
<span class="o">.</span><span class="na">setId</span><span class="o">(</span><span class="s">&quot;NZ&quot;</span><span class="o">)</span>
<span class="o">.</span><span class="na">findUnique</span><span class="o">();</span>

<span class="c1">// we can mutate this one</span>
<span class="n">countryCopy</span><span class="o">.</span><span class="na">setName</span><span class="o">(</span><span class="s">&quot;Nu Zilund&quot;</span><span class="o">);</span>

<span class="c1">// save it, automatically maintaining the cache ...</span>
<span class="c1">// evicting NZ from the Country bean cache and</span>
<span class="c1">// clearing the Country query cache</span>
<span class="n">Ebean</span><span class="o">.</span><span class="na">save</span><span class="o">(</span><span class="n">countryCopy</span><span class="o">);</span>
</pre></div>
</div>

<h2 id="shared_instances">Shared instances</h2>
<p>Ebean sets a sharedInstance flag on a bean whenever it is put into the cache. This is
used to ensure that the bean is always treated in a read only fashion (and can be safely
shared by multiple threads concurrently).</p>

<p>
You can invoke lazy loading on a sharedInstance. When that occurs the sharedInstance
flag is propagated to the lazily loaded beans. If you lazy load a collection (list, set or map)
then the collection is also marked with the sharedInstance flag and that means you can't
add or remove elements from the collection (list, set or map).</p>

<o>
A sharedInstance and all its associated beans and collections are are all ensured to be
read only and can be safely shared by multiple threads concurrently.</p>

<h2 id="automatic_cache_maint">Automatic Cache Maintenance</h2>
<p>When you save entity beans or use an Update or SqlUpdate, Ebean will automatically
invalidate the appropriate parts of the cache.</p>

<p>If you save a entity bean that results in an update and there is a matching bean in the
cache it will be evicted automatically from the cache at commit time.
If you save an entity bean that results in an insert then the bean cache is not effected.
Whenever ANY change is made (insert/update or delete) the entire query cache for that
bean type is invalidated.</p>


<h2 id="external_mods">Handling External Modification</h2>

<p>When you save/delete beans via Ebean.save() and Ebean.delete() etc Ebean will
automatically maintain its cache (removing cached beans and cached queries as
appropriate). However, you may often find yourself modifying the database outside of
Ebean. (via stored procedures etc)</p>


<p>For example, you could be using other frameworks, your own JDBC code, stored
procedures, batch systems etc. When you do so (and you are using Ebean caching) then
you can inform Ebean so that it invalidates appropriate parts of its cache.</p>

<div class="syntax java"><div class="highlight"><pre><span class="c1">// inform Ebean that some rows have been inserted and updated</span>
<span class="c1">// on the o_country table.</span>
<span class="c1">// â€¦ Ebean will maintain the appropriate caches.</span>
<span class="kt">boolean</span> <span class="n">inserts</span> <span class="o">=</span> <span class="kc">true</span><span class="o">;</span>
<span class="kt">boolean</span> <span class="n">updates</span> <span class="o">=</span> <span class="kc">true</span><span class="o">;</span>
<span class="kt">boolean</span> <span class="n">deletes</span> <span class="o">=</span> <span class="kc">false</span><span class="o">;</span>
<span class="n">Ebean</span><span class="o">.</span><span class="na">externalModification</span><span class="o">(</span><span class="s">&quot;o_country&quot;</span><span class="o">,</span> <span class="n">inserts</span><span class="o">,</span> <span class="n">updates</span><span class="o">,</span> <span class="n">deletes</span><span class="o">);</span>

<span class="c1">// clearAll() caches via the ServerCacheManager ...</span>
<span class="n">ServerCacheManager</span> <span class="n">serverCacheManager</span> <span class="o">=</span>
<span class="n">Ebean</span><span class="o">.</span><span class="na">getServerCacheManager</span><span class="o">();</span>

<span class="c1">// Clear all the caches on the default/primary EbeanServer</span>
<span class="n">serverCacheManager</span><span class="o">.</span><span class="na">clearAll</span><span class="o">();</span>

<span class="c1">// clear both the bean and query cache</span>
<span class="c1">// for Country beans ...</span>
<span class="n">serverCacheManager</span><span class="o">.</span><span class="na">clear</span><span class="o">(</span><span class="n">Country</span><span class="o">.</span><span class="na">class</span><span class="o">);</span>

<span class="c1">// Warm the cache of Country beans</span>
<span class="n">Ebean</span><span class="o">.</span><span class="na">runCacheWarming</span><span class="o">(</span><span class="n">Country</span><span class="o">.</span><span class="na">class</span><span class="o">);</span>
</pre></div>
</div>

<h2 id="cachestrategy">@CacheStrategy</h2>

<p>CacheStrategy provides a way to automatically use the bean cache</p>

<p>The easiest way to use caching is to specify the @CacheStrategy annotation on the entity
class. This means that Ebean will try to use the bean cache as much as possible when it
fetches beans of that type.</p>

<div class="syntax java"><div class="highlight"><pre><span class="c1">// Cache countries. Use readOnly=true so unless explicitly</span>
<span class="c1">// stated in the query we will return read only/shared instances</span>
<span class="nd">@CacheStrategy</span><span class="o">(</span><span class="n">readOnly</span><span class="o">=</span><span class="kc">true</span><span class="o">,</span><span class="n">warmingQuery</span><span class="o">=</span><span class="s">&quot;order by name&quot;</span><span class="o">)</span>
<span class="nd">@Entity</span>
<span class="nd">@Table</span><span class="o">(</span><span class="n">name</span><span class="o">=</span><span class="s">&quot;o_country&quot;</span><span class="o">)</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">Country</span> <span class="o">{</span>
</pre></div>
</div>

<div class="syntax java"><div class="highlight"><pre><span class="c1">// automatically use the cache</span>
<span class="n">Country</span> <span class="n">country</span> <span class="o">=</span> <span class="n">Ebean</span><span class="o">.</span><span class="na">find</span><span class="o">(</span><span class="n">Country</span><span class="o">.</span><span class="na">class</span><span class="o">,</span><span class="s">&quot;NZ&quot;</span><span class="o">);</span>
<span class="c1">// references automatically use the cache too</span>
<span class="n">Country</span> <span class="n">countryRef</span> <span class="o">=</span> <span class="n">Ebean</span><span class="o">.</span><span class="na">getReference</span><span class="o">(</span><span class="n">Country</span><span class="o">.</span><span class="na">class</span><span class="o">,</span><span class="s">&quot;NZ&quot;</span><span class="o">);</span>
<span class="c1">// hit the country cache automatically via join</span>
<span class="n">Customer</span> <span class="n">customer</span> <span class="o">=</span> <span class="n">Ebean</span><span class="o">.</span><span class="na">find</span><span class="o">(</span><span class="n">Customer</span><span class="o">.</span><span class="na">class</span><span class="o">,</span> <span class="mi">1</span><span class="o">);</span>
<span class="n">Address</span> <span class="n">billingAddress</span> <span class="o">=</span> <span class="n">customer</span><span class="o">.</span><span class="na">getBillingAddress</span><span class="o">();</span>
<span class="n">Country</span> <span class="n">c2</span> <span class="o">=</span> <span class="n">billingAddress</span><span class="o">.</span><span class="na">getCountry</span><span class="o">();</span>
</pre></div>
</div>

<h4>ReadOnly</h4>
<p>The readOnly attribute of @CacheStrategy is used to determine if by default Ebean
should return the same instance from the cache (instances in the cache are readOnly and
effectively immutable) or whether Ebean should create a new instance and copy the data
from the cached bean onto the new instance.</p>

<p>The readOnly attribute of @CacheStrategy is the "default" Ebean will use unless you
explicitly specify the readOnly attribute of the query.</p>

<div class="syntax java"><div class="highlight"><pre><span class="c1">// explicitly state we want a MUTABLE COPY</span>
<span class="c1">// â€¦ not the same instance as the one in cache</span>
<span class="c1">// â€¦ a copy is made and returned instead</span>
<span class="n">Country</span> <span class="n">countryCopy</span> <span class="o">=</span> <span class="n">Ebean</span><span class="o">.</span><span class="na">find</span><span class="o">(</span><span class="n">Country</span><span class="o">.</span><span class="na">class</span><span class="o">)</span>
  <span class="o">.</span><span class="na">setReadOnly</span><span class="o">(</span><span class="kc">false</span><span class="o">)</span>
  <span class="o">.</span><span class="na">setId</span><span class="o">(</span><span class="s">&quot;NZ&quot;</span><span class="o">)</span>
  <span class="o">.</span><span class="na">findUnique</span><span class="o">();</span>

<span class="c1">// we can mutate this one</span>
<span class="n">countryCopy</span><span class="o">.</span><span class="na">setName</span><span class="o">(</span><span class="s">&quot;Nu Zilund&quot;</span><span class="o">);</span>

<span class="c1">// save it, automatically maintaining the cache ...</span>
<span class="c1">// evicting NZ from the Country bean cache and</span>
<span class="c1">// clearing the Country query cache</span>
<span class="n">Ebean</span><span class="o">.</span><span class="na">save</span><span class="o">(</span><span class="n">countryCopy</span><span class="o">);</span>
</pre></div>
</div>

<h2 id="manual_cache_use">Manually specifying to use the bean cache</h2>
<p>If you don't use @CacheStrategy you can programmatically specify to use the bean cache via query.setUseCache(true);</p>

<div class="syntax java"><div class="highlight"><pre><span class="c1">// explicitly state we want to use the bean cache</span>
<span class="n">Customer</span> <span class="n">customer</span> <span class="o">=</span> <span class="n">Ebean</span><span class="o">.</span><span class="na">find</span><span class="o">(</span><span class="n">Customer</span><span class="o">.</span><span class="na">class</span><span class="o">)</span>
  <span class="o">.</span><span class="na">setUseCache</span><span class="o">(</span><span class="kc">true</span><span class="o">)</span>
  <span class="o">.</span><span class="na">setId</span><span class="o">(</span><span class="mi">7</span><span class="o">)</span>
  <span class="o">.</span><span class="na">findUnique</span><span class="o">();</span>
<span class="c1">// use readOnly=true to return the &#39;sharedInstance&#39;</span>
<span class="c1">// from the cache (which is effectively immutable)</span>
<span class="n">Customer</span> <span class="n">customer</span> <span class="o">=</span> <span class="n">Ebean</span><span class="o">.</span><span class="na">find</span><span class="o">(</span><span class="n">Customer</span><span class="o">.</span><span class="na">class</span><span class="o">)</span>
  <span class="o">.</span><span class="na">setUseCache</span><span class="o">(</span><span class="kc">true</span><span class="o">)</span>
  <span class="o">.</span><span class="na">setReadOnly</span><span class="o">(</span><span class="kc">true</span><span class="o">)</span>
  <span class="o">.</span><span class="na">setId</span><span class="o">(</span><span class="mi">7</span><span class="o">)</span>
  <span class="o">.</span><span class="na">findUnique</span><span class="o">();</span>
</pre></div>
</div>

<h2 id="using_query_cache">Using the Query Cache</h2>
<p>To use the query cache you have to explicitly specify its use on a query.</p>

<div class="syntax java"><div class="highlight"><pre><span class="c1">// use the query cache</span>
<span class="n">List</span><span class="o">&lt;</span><span class="n">Country</span><span class="o">&gt;</span> <span class="n">list</span> <span class="o">=</span> <span class="n">Ebean</span><span class="o">.</span><span class="na">find</span><span class="o">(</span><span class="n">Country</span><span class="o">.</span><span class="na">class</span><span class="o">)</span>
  <span class="o">.</span><span class="na">setUseQueryCache</span><span class="o">(</span><span class="kc">true</span><span class="o">)</span>
  <span class="o">.</span><span class="na">where</span><span class="o">().</span><span class="na">ilike</span><span class="o">(</span><span class="s">&quot;name&quot;</span><span class="o">,</span> <span class="s">&quot;New%&quot;</span><span class="o">)</span>
  <span class="o">.</span><span class="na">findList</span><span class="o">();</span>
</pre></div>
</div>

<p>The query cache is generally useful for returning lists that are very infrequently changed. These lists would often be used to populate drop down lists / combo boxes in user
interfaces.</p>

<p>If you are familiar with the term "Lookup Tables" or "Reference Tables" these are typical candidates for using cached queries. Some examples of lookup/reference tables could be,
countries, currencies and order status.</p>

<p>Query cache lists are readOnly by default
<div class="syntax java"><div class="highlight"><pre><span class="c1">// by default the lists returned from the query</span>
<span class="c1">// cache are readOnly. Use setReadOnly(false) to</span>
<span class="c1">// return mutable lists</span>
<span class="n">List</span><span class="o">&lt;</span><span class="n">Country</span><span class="o">&gt;</span> <span class="n">list</span> <span class="o">=</span> <span class="n">Ebean</span><span class="o">.</span><span class="na">find</span><span class="o">(</span><span class="n">Country</span><span class="o">.</span><span class="na">class</span><span class="o">)</span>
  <span class="o">.</span><span class="na">setUseQueryCache</span><span class="o">(</span><span class="kc">true</span><span class="o">)</span>
  <span class="o">.</span><span class="na">setReadOnly</span><span class="o">(</span><span class="kc">false</span><span class="o">)</span>
  <span class="o">.</span><span class="na">where</span><span class="o">().</span><span class="na">ilike</span><span class="o">(</span><span class="s">&quot;name&quot;</span><span class="o">,</span> <span class="s">&quot;New%&quot;</span><span class="o">)</span>
  <span class="o">.</span><span class="na">findList</span><span class="o">();</span>
</pre></div>
</div>
</p>
</div>

    </div>

    <div class="col-md-3" role="complementary">
      <nav class="bs-docs-sidebar hidden-print hidden-xs hidden-sm">
        <ul class="nav bs-docs-sidenav">


<li class="active">
  <a href="/docs/introduction">Introduction</a>
        <ul class="nav">
          <li><a href="#use_jpa_mapping">Use JPA mappings</a></li>
          <li><a href="#simple_query_language">Simple query language</a></li>
          <li><a href="#intro_save_and_delete">Save and delete</a></li>
          <li><a href="#jpa_comparison">Comparison to JPA</a></li>
          <li><a href="#ebean_does_not">Ebean does not...</a></li>
        </ul>
</li>
<li class="active">
  <a href="/docs/enhancement">Enhancement</a>

          <ul class="nav">
            <li><a href="#enhance_maven">Maven</a></li>
            <li><a href="#enhance_maven_eclipse">Eclipse + Maven</a></li>
            <li><a href="#enhance_ant">Ant</a></li>
            <li><a href="#enhance_agent">Agent</a></li>
            <li><a href="#enhance_ide">IDE enhancement</a></li>
          </ul>
</li>
<li >
  <a href="/docs/configuration">Configuration</a>
</li>
<li >
  <a href="/docs/ebean_access_patterns">Ebean access patterns</a>
</li>
<li >
  <a href="/docs/field_and_property_access">Field and property access</a>
</li>

<li class="active">
  <a href="/docs/queries">Queries</a>
          <ul class="nav">
            <li><a href="#where_clause">Where clause</a></li>
            <li><a href="#query_language">Ebean query language</a></li>
            <li><a href="#partial_objects">Partial objects</a></li>
            <li><a href="#query_joins">Query joins</a></li>
            <li><a href="#fetchconfig">FetchConfig</a></li>
            <li><a href="#lazy_loading">Lazy loading</a></li>
            <li><a href="#named_queries">Named Queries</a></li>
            <li><a href="#large_queries">Large queries</a></li>
            <li><a href="#paging">Paging</a></li>
            <li><a href="#async_queriess">Asynchronous queries</a></li>
            <li><a href="#rawsql">RawSql</a></li>
            <li><a href="#sqlquery">SqlQuery</a></li>
            <li><a href="#l2cache">L2 cache</a></li>
            <li><a href="#autofetch">Autofetch</a></li>
            <li><a href="#other_bits">Other bits</a></li>
          </ul>
</li>
<li class="active">
  <a href="/docs/saving">Saving</a>
          <ul class="nav">
            <li><a href="#saves">Save</a></li>
            <li><a href="#deletes">Delete</a></li>
            <li><a href="#cascading">Cascade</a></li>
            <li><a href="#bulkupdate">Bulk updates</a></li>
            <li><a href="#bulksqlupdate">Bulk SQL updates</a></li>
            <li><a href="#callablesql">CallableSql</a></li>
            <li><a href="#rawjdbc">Raw JDBC</a></li>
            <li><a href="#batch_processing">JDBC Batch</a></li>
          </ul>
</li>
<li class="active">
  <a href="/docs/mapping">Mapping</a>
          <ul class="nav">
            <li><a href="#jpa_mapping">JPA mapping</a></li>
            <li><a href="#ddl_generation">DDL generation</a></li>
            <li><a href="#naming_convention">Naming convention</a></li>
            <li><a href="#mapping_annotations">Mapping annotations</a></li>
            <li><a href="#relationships">Relationships</a></li>
            <li><a href="#id_generation">Id generation</a></li>
            <li><a href="#formula">Formula</a></li>
            <li><a href="#enummapping">EnumMapping</a></li>
            <li><a href="#encryption">Encryption</a></li>
          </ul>
</li>
<li class="active">
  <a href="/docs/transactions">Transactions</a>
          <ul class="nav">
            <li><a href="#implicit_transactions">Implicit</a></li>
            <li><a href="#programmatic_transactions">Programmatic</a></li>
            <li><a href="#tx_control_behaviour">Controlling behaviour in a transaction</a></li>
            <li><a href="#transactional">@Transactional</a></li>
            <li><a href="#tx_runnable">TxRunnable / TxCallable</a></li>
            <li><a href="#spring">Spring</a></li>
            <li><a href="#jta">JTA</a></li>
          </ul>
</li>
<li class="active">
  <a href="/docs/json">JSON</a>
</li>
<li class="active">
  <a href="/docs/eventlisteners">Event listeners</a>
</li>
<li >
  <a href="/docs/readaudit">Read Audit</a>
</li>
<li class="active">
  <a href="/docs/changelog">Change Log</a>
</li>
<li class="active">
  <a href="/docs/l2caching">L2 caching</a>
          <ul class="nav">
            <li><a href="#bean_and_query_caches">Bean and query caches</a></li>
            <li><a href="#read_only_instances">Read only instances</a></li>
            <li><a href="#shared_instances">Shared instances</a></li>
            <li><a href="#automatic_cache_maint">Automatic Cache Maintenance</a></li>
            <li><a href="#external_mods">Handling External Modification</a></li>
            <li><a href="#cachestrategy">@CacheStrategy</a></li>
            <li><a href="#manual_cache_use">Manually specifying to use the bean cache</a></li>
            <li><a href="#using_query_cache">Using the Query Cache</a></li>
          </ul>
</li>
<li >
  <a href="/docs/testing">Testing</a>
</li>
<li >
  <a href="/docs/jvmlanguages">JVM Languages</a>
</li>

<li >
  <a href="/docs/clustering">Clustering</a>
</li>
<li >
  <a href="/docs/monitoring">Monitoring</a>
</li>
<li >
  <a href="/docs/architecture">Architecture</a>
</li>

        </ul>
          <a class="back-to-top" href="#top">
            Back to top
          </a>
      </nav>
    </div>
  </div>

</div>
<!-- /.row -->
</div>  <!-- /.container -->
  </div>
</div>

<footer id="footer">
 <div class="doc-footer">
  <ul class="doc-footer-links">
    <li><a href="/">Ebean ORM</a></li>
    <li> | </li>
    <li><a href="http://avaje-metric.github.io">Metrics</a></li>
    <li> | </li>
    <li><a href="/websitegenerator/index">Website Generator</a></li>
    <li> | </li>
    <li><a href="/jetty/index">Jetty Runnable War</a></li>
  </ul>
 </div>
</footer>

  <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.2/jquery.min.js"></script>
  <script src="/js/bootstrap.min.js"></script>
  <script src="/js/jquery.easing.min.js"></script>

  <script src="/js/json2.js"></script>
  <script src="/js/jquery.cookie.min.js"></script>
  <script src="/js/jquery.storageapi.min.js"></script>

  <script src="/js/ebean-site.js"></script>

  </body>
</html>

<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta id="layout-head" />
    <title>avaje ebean</title>
    <link rel="shortcut icon" href="/images/favicon.ico" >
    <!--<link href="/css/bootstrap.min.css" rel="stylesheet">-->
    <!-- Latest compiled and minified CSS -->
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.5/css/bootstrap.min.css">
    <link rel="stylesheet" href="/css/pygments.css" type="text/css" />
    <link rel="stylesheet" href="/css/site.css">
    <link rel="stylesheet" href="//netdna.bootstrapcdn.com/font-awesome/4.1.0/css/font-awesome.min.css">
      <!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
      <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
      <script src="https://oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>
    <![endif]-->
</head>
  <body>
  <div id="wrap">
    <div id="header">
    <div class="navbar navbar-inverse navbar-fixed-top" role="navigation">
      <div class="container">
        <div class="navbar-header">
          <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
            <span class="sr-only">Toggle navigation</span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
          </button>
          <a class="navbar-brand" href="/">Ebean ORM</a>
        </div>
        <div class="collapse navbar-collapse">
          <ul class="nav navbar-nav pull-right">
            <li ><a href="/"><span class="glyphicon glyphicon-home"></span>  Home</a></li>
            <li ><a href="/videos">Videos</a></li>
            <li ><a href="/quickstart">Quick Start</a></li>
            <li ><a href="/support">Support</a></li>
            <li class="active"><a href="/docs">Docs</a></li>
            <li ><a target="_blank" href="/apidocs">ApiDocs</a></li>
            <li ><a href="/releases">Releases</a></li>
            <li ><a target="_blank" href="https://github.com/ebean-orm/avaje-ebeanorm"> <i class="fa fa-github"></i> Github</a></li>
          </ul>
        </div><!--/.nav-collapse -->
      </div>
    </div>

  </div>
  <div id="main" data-offset="60">
<div class="jumbotron mini">
  <div class="container">
    <h1><a href="/docs">Documentation</a> / Testing </h1>
  </div>
</div>

<div class="container doc-index bs-docs-container">

  <div class="row">

    <div class="col-md-9" role="main">

      <div class="bs-docs-section">
<h1 id="testing">Testing</h1>

<h2 id="mockibean">MockiEbean</h2>

<code>MockiEbean</code> from <code>avaje-ebeanorm-mocker</code> project provides a helper object to support mocking the EbeanServer using tools like
<a href="http://code.google.com/p/mockito/">Mockito</a>. If you like the Play/Active record style or Ebean singleton style you can add a test
dependency on avaje-ebeanorm-mocker and use MockiEbean to enable use of Mockito and similar tools.

Mocking with Ebean singleton
<code>MockiEbean</code> from avaje-ebeanorm-mocker provides a mechanism for using a tool like Mockito and
replacing the default EbeanServer instance with a mock.
</p>

<div class="syntax java"><div class="highlight"><pre><span class="o">...</span>
<span class="kn">import</span> <span class="nn">com.avaje.ebeaninternal.server.core.DefaultServer</span><span class="o">;</span>
<span class="o">...</span>

  <span class="nd">@Test</span>
  <span class="kd">public</span> <span class="kt">void</span> <span class="nf">testWithMockito</span><span class="o">()</span> <span class="o">{</span>

    <span class="n">EbeanServer</span> <span class="n">defaultServer</span> <span class="o">=</span> <span class="n">Ebean</span><span class="o">.</span><span class="na">getServer</span><span class="o">(</span><span class="kc">null</span><span class="o">);</span>
    <span class="n">assertTrue</span><span class="o">(</span><span class="s">&quot;is a real EbeanServer&quot;</span><span class="o">,</span> <span class="n">defaultServer</span> <span class="k">instanceof</span> <span class="n">DefaultServer</span><span class="o">);</span>

    <span class="n">Long</span> <span class="n">someBeanId</span> <span class="o">=</span> <span class="n">Long</span><span class="o">.</span><span class="na">valueOf</span><span class="o">(</span><span class="mi">47L</span><span class="o">);</span>

    <span class="c1">// Use Mockito to create a mock for the EbeanServer interface</span>
    <span class="n">EbeanServer</span> <span class="n">mock</span> <span class="o">=</span> <span class="n">Mockito</span><span class="o">.</span><span class="na">mock</span><span class="o">(</span><span class="n">EbeanServer</span><span class="o">.</span><span class="na">class</span><span class="o">);</span>

    <span class="c1">// setup some required behaviour</span>
    <span class="n">when</span><span class="o">(</span><span class="n">mock</span><span class="o">.</span><span class="na">getBeanId</span><span class="o">(</span><span class="kc">null</span><span class="o">)).</span><span class="na">thenReturn</span><span class="o">(</span><span class="n">someBeanId</span><span class="o">);</span>

    <span class="c1">// ---------------</span>
    <span class="c1">// &#39;register&#39; the mock instance into Ebean</span>
    <span class="c1">// this becomes the &#39;default EbeanServer&#39; until</span>
    <span class="c1">// mockiEbean.restoreOriginal() is called</span>
    <span class="c1">// ---------------</span>
    <span class="n">MockiEbean</span> <span class="n">mockiEbean</span> <span class="o">=</span> <span class="n">MockiEbean</span><span class="o">.</span><span class="na">start</span><span class="o">(</span><span class="n">mock</span><span class="o">);</span>
    <span class="k">try</span> <span class="o">{</span>

      <span class="c1">// Ebean singleton &#39;default server&#39; now returns the mock instance</span>
      <span class="n">EbeanServer</span> <span class="n">server</span> <span class="o">=</span> <span class="n">Ebean</span><span class="o">.</span><span class="na">getServer</span><span class="o">(</span><span class="kc">null</span><span class="o">);</span>

      <span class="c1">// always returns the someBeanId setup by Mockito</span>
      <span class="n">Object</span> <span class="n">beanId</span> <span class="o">=</span> <span class="n">server</span><span class="o">.</span><span class="na">getBeanId</span><span class="o">(</span><span class="kc">null</span><span class="o">);</span>

      <span class="n">assertEquals</span><span class="o">(</span><span class="n">someBeanId</span><span class="o">,</span> <span class="n">beanId</span><span class="o">);</span>

    <span class="o">}</span> <span class="k">finally</span> <span class="o">{</span>
      <span class="c1">// ---------------</span>
      <span class="c1">// restore the original defaultServer instance</span>
      <span class="c1">// ---------------</span>
      <span class="n">mockiEbean</span><span class="o">.</span><span class="na">restoreOriginal</span><span class="o">();</span>
    <span class="o">}</span>

    <span class="n">EbeanServer</span> <span class="n">restoredServer</span> <span class="o">=</span> <span class="n">Ebean</span><span class="o">.</span><span class="na">getServer</span><span class="o">(</span><span class="kc">null</span><span class="o">);</span>
    <span class="n">assertTrue</span><span class="o">(</span><span class="s">&quot;is a real EbeanServer&quot;</span><span class="o">,</span> <span class="n">restoredServer</span> <span class="k">instanceof</span> <span class="n">DefaultServer</span><span class="o">);</span>
  <span class="o">}</span>
</pre></div>
</div>
<h4>MoickiEbean Maven dependency</h4>
<div class="syntax xml"><div class="highlight"><pre><span class="nt">&lt;dependency&gt;</span>
  <span class="nt">&lt;groupId&gt;</span>org.avaje.ebeanorm<span class="nt">&lt;/groupId&gt;</span>
  <span class="nt">&lt;artifactId&gt;</span>avaje-ebeanorm-mocker<span class="nt">&lt;/artifactId&gt;</span>
  <span class="nt">&lt;version&gt;</span>1.0.1<span class="nt">&lt;/version&gt;</span>
  <span class="nt">&lt;scope&gt;</span>test<span class="nt">&lt;/scope&gt;</span>
<span class="nt">&lt;/dependency&gt;</span>
</pre></div>
</div>
</div>

    </div>

    <div class="col-md-3" role="complementary">
      <nav class="bs-docs-sidebar hidden-print hidden-xs hidden-sm">
        <ul class="nav bs-docs-sidenav">


<li class="active">
  <a href="/docs/introduction">Introduction</a>
        <ul class="nav">
          <li><a href="#use_jpa_mapping">Use JPA mappings</a></li>
          <li><a href="#simple_query_language">Simple query language</a></li>
          <li><a href="#intro_save_and_delete">Save and delete</a></li>
          <li><a href="#jpa_comparison">Comparison to JPA</a></li>
          <li><a href="#ebean_does_not">Ebean does not...</a></li>
        </ul>
</li>
<li class="active">
  <a href="/docs/enhancement">Enhancement</a>

          <ul class="nav">
            <li><a href="#enhance_maven">Maven</a></li>
            <li><a href="#enhance_maven_eclipse">Eclipse + Maven</a></li>
            <li><a href="#enhance_ant">Ant</a></li>
            <li><a href="#enhance_agent">Agent</a></li>
            <li><a href="#enhance_ide">IDE enhancement</a></li>
          </ul>
</li>
<li >
  <a href="/docs/configuration">Configuration</a>
</li>
<li >
  <a href="/docs/ebean_access_patterns">Ebean access patterns</a>
</li>
<li >
  <a href="/docs/field_and_property_access">Field and property access</a>
</li>

<li class="active">
  <a href="/docs/queries">Queries</a>
          <ul class="nav">
            <li><a href="#where_clause">Where clause</a></li>
            <li><a href="#query_language">Ebean query language</a></li>
            <li><a href="#partial_objects">Partial objects</a></li>
            <li><a href="#query_joins">Query joins</a></li>
            <li><a href="#fetchconfig">FetchConfig</a></li>
            <li><a href="#lazy_loading">Lazy loading</a></li>
            <li><a href="#named_queries">Named Queries</a></li>
            <li><a href="#large_queries">Large queries</a></li>
            <li><a href="#paging">Paging</a></li>
            <li><a href="#async_queriess">Asynchronous queries</a></li>
            <li><a href="#rawsql">RawSql</a></li>
            <li><a href="#sqlquery">SqlQuery</a></li>
            <li><a href="#l2cache">L2 cache</a></li>
            <li><a href="#autofetch">Autofetch</a></li>
            <li><a href="#other_bits">Other bits</a></li>
          </ul>
</li>
<li class="active">
  <a href="/docs/saving">Saving</a>
          <ul class="nav">
            <li><a href="#saves">Save</a></li>
            <li><a href="#deletes">Delete</a></li>
            <li><a href="#cascading">Cascade</a></li>
            <li><a href="#bulkupdate">Bulk updates</a></li>
            <li><a href="#bulksqlupdate">Bulk SQL updates</a></li>
            <li><a href="#callablesql">CallableSql</a></li>
            <li><a href="#rawjdbc">Raw JDBC</a></li>
            <li><a href="#batch_processing">JDBC Batch</a></li>
          </ul>
</li>
<li class="active">
  <a href="/docs/mapping">Mapping</a>
          <ul class="nav">
            <li><a href="#jpa_mapping">JPA mapping</a></li>
            <li><a href="#ddl_generation">DDL generation</a></li>
            <li><a href="#naming_convention">Naming convention</a></li>
            <li><a href="#mapping_annotations">Mapping annotations</a></li>
            <li><a href="#relationships">Relationships</a></li>
            <li><a href="#id_generation">Id generation</a></li>
            <li><a href="#formula">Formula</a></li>
            <li><a href="#enummapping">EnumMapping</a></li>
            <li><a href="#encryption">Encryption</a></li>
          </ul>
</li>
<li class="active">
  <a href="/docs/transactions">Transactions</a>
          <ul class="nav">
            <li><a href="#implicit_transactions">Implicit</a></li>
            <li><a href="#programmatic_transactions">Programmatic</a></li>
            <li><a href="#tx_control_behaviour">Controlling behaviour in a transaction</a></li>
            <li><a href="#transactional">@Transactional</a></li>
            <li><a href="#tx_runnable">TxRunnable / TxCallable</a></li>
            <li><a href="#spring">Spring</a></li>
            <li><a href="#jta">JTA</a></li>
          </ul>
</li>
<li class="active">
  <a href="/docs/json">JSON</a>
</li>
<li class="active">
  <a href="/docs/eventlisteners">Event listeners</a>
</li>
<li >
  <a href="/docs/readaudit">Read Audit</a>
</li>
<li class="active">
  <a href="/docs/changelog">Change Log</a>
</li>
<li class="active">
  <a href="/docs/l2caching">L2 caching</a>
          <ul class="nav">
            <li><a href="#bean_and_query_caches">Bean and query caches</a></li>
            <li><a href="#read_only_instances">Read only instances</a></li>
            <li><a href="#shared_instances">Shared instances</a></li>
            <li><a href="#automatic_cache_maint">Automatic Cache Maintenance</a></li>
            <li><a href="#external_mods">Handling External Modification</a></li>
            <li><a href="#cachestrategy">@CacheStrategy</a></li>
            <li><a href="#manual_cache_use">Manually specifying to use the bean cache</a></li>
            <li><a href="#using_query_cache">Using the Query Cache</a></li>
          </ul>
</li>
<li class="active">
  <a href="/docs/testing">Testing</a>
          <ul class="nav">
            <li><a href="#mockibean">MockiEbean</a></li>
          </ul>
</li>
<li >
  <a href="/docs/jvmlanguages">JVM Languages</a>
</li>

<li >
  <a href="/docs/clustering">Clustering</a>
</li>
<li >
  <a href="/docs/monitoring">Monitoring</a>
</li>
<li >
  <a href="/docs/architecture">Architecture</a>
</li>

        </ul>
          <a class="back-to-top" href="#top">
            Back to top
          </a>
      </nav>
    </div>
  </div>

</div>
<!-- /.row -->
</div>  <!-- /.container -->
  </div>
</div>

<footer id="footer">
 <div class="doc-footer">
  <ul class="doc-footer-links">
    <li><a href="/">Ebean ORM</a></li>
    <li> | </li>
    <li><a href="http://avaje-metric.github.io">Metrics</a></li>
    <li> | </li>
    <li><a href="/websitegenerator/index">Website Generator</a></li>
    <li> | </li>
    <li><a href="/jetty/index">Jetty Runnable War</a></li>
  </ul>
 </div>
</footer>

  <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.2/jquery.min.js"></script>
  <script src="/js/bootstrap.min.js"></script>
  <script src="/js/jquery.easing.min.js"></script>

  <script src="/js/json2.js"></script>
  <script src="/js/jquery.cookie.min.js"></script>
  <script src="/js/jquery.storageapi.min.js"></script>

  <script src="/js/ebean-site.js"></script>

  </body>
</html>

<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta id="layout-head" />
    <title>avaje ebean</title>
    <link rel="shortcut icon" href="/images/favicon.ico" >
    <!--<link href="/css/bootstrap.min.css" rel="stylesheet">-->
    <!-- Latest compiled and minified CSS -->
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.5/css/bootstrap.min.css">
    <link rel="stylesheet" href="/css/pygments.css" type="text/css" />
    <link rel="stylesheet" href="/css/site.css">
    <link rel="stylesheet" href="//netdna.bootstrapcdn.com/font-awesome/4.1.0/css/font-awesome.min.css">
      <!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
      <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
      <script src="https://oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>
    <![endif]-->
</head>
  <body>
  <div id="wrap">
    <div id="header">
    <div class="navbar navbar-inverse navbar-fixed-top" role="navigation">
      <div class="container">
        <div class="navbar-header">
          <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
            <span class="sr-only">Toggle navigation</span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
          </button>
          <a class="navbar-brand" href="/">Ebean ORM</a>
        </div>
        <div class="collapse navbar-collapse">
          <ul class="nav navbar-nav pull-right">
            <li ><a href="/"><span class="glyphicon glyphicon-home"></span>  Home</a></li>
            <li ><a href="/videos">Videos</a></li>
            <li ><a href="/quickstart">Quick Start</a></li>
            <li ><a href="/support">Support</a></li>
            <li class="active"><a href="/docs">Docs</a></li>
            <li ><a target="_blank" href="/apidocs">ApiDocs</a></li>
            <li ><a href="/releases">Releases</a></li>
            <li ><a target="_blank" href="https://github.com/ebean-orm/avaje-ebeanorm"> <i class="fa fa-github"></i> Github</a></li>
          </ul>
        </div><!--/.nav-collapse -->
      </div>
    </div>

  </div>
  <div id="main" data-offset="60">
<div class="jumbotron mini">
  <div class="container">
    <h1><a href="/docs">Documentation</a> / JVM Languages </h1>
  </div>
</div>

<div class="container doc-index bs-docs-container">

  <div class="row">

    <div class="col-md-9" role="main">

      <div class="bs-docs-section">
<h1 id="language_support" class="page-header">JVM Languages</h1>


<h2 id="groovy">Groovy</h2>
<p>You can use Ebean with Groovy classes. There is nothing special you need to do. Just
annotate your groovy beans with the JPA annotations.


<div class="syntax groovy"><div class="highlight"><pre><span class="c1">//GROOVY CODE (generates the getters and setters etc)</span>
<span class="kn">package</span> <span class="n">test</span>
<span class="kn">import</span> <span class="nn">javax.persistence.*</span><span class="o">;</span>

<span class="nd">@Entity</span>
<span class="nd">@Table</span><span class="o">(</span><span class="n">name</span><span class="o">=</span><span class="s2">&quot;f_forum&quot;</span><span class="o">)</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">PersonG</span><span class="o">{</span>
  <span class="nd">@Id</span>
  <span class="n">Integer</span> <span class="n">id</span>

  <span class="nd">@Column</span><span class="o">(</span><span class="n">name</span><span class="o">=</span><span class="s2">&quot;title&quot;</span><span class="o">)</span>
  <span class="n">String</span> <span class="n">name</span>

  <span class="nd">@OneToMany</span><span class="o">(</span><span class="n">cascade</span><span class="o">=</span><span class="n">CascadeType</span><span class="o">.</span><span class="na">ALL</span><span class="o">)</span>
  <span class="n">List</span><span class="o">&lt;</span><span class="n">Topic</span><span class="o">&gt;</span> <span class="n">topics</span><span class="o">;</span>
  <span class="o">}</span>
</pre></div>
</div>

You can use Ebean just as you would in Java.

<div class="syntax groovy"><div class="highlight"><pre><span class="c1">// GROOVY CODE</span>
<span class="kn">package</span> <span class="n">test</span>

<span class="kn">import</span> <span class="nn">com.avaje.ebean.*</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">MainEbean</span><span class="o">{</span>
  <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="n">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="o">{</span>

    <span class="n">PersonG</span> <span class="n">g</span> <span class="o">=</span> <span class="n">Ebean</span><span class="o">.</span><span class="na">getReference</span><span class="o">(</span><span class="n">PersonG</span><span class="o">.</span><span class="na">class</span><span class="o">,</span> <span class="mi">1</span><span class="o">);</span>

    <span class="n">String</span> <span class="n">name</span> <span class="o">=</span> <span class="n">g</span><span class="o">.</span><span class="na">getName</span><span class="o">();</span>

    <span class="n">List</span><span class="o">&lt;</span><span class="n">PersonG</span><span class="o">&gt;</span> <span class="n">list</span> <span class="o">=</span> <span class="n">Ebean</span>
      <span class="o">.</span><span class="na">find</span><span class="o">(</span><span class="n">PersonG</span><span class="o">.</span><span class="na">class</span><span class="o">)</span>
      <span class="o">.</span><span class="na">fetch</span><span class="o">(</span><span class="s2">&quot;topics&quot;</span><span class="o">)</span>
      <span class="o">.</span><span class="na">findList</span><span class="o">()</span>

    <span class="n">println</span> <span class="s2">&quot;Got list &quot;</span><span class="o">+</span><span class="n">list</span>

    <span class="n">list</span><span class="o">.</span><span class="na">each</span><span class="o">()</span> <span class="o">{</span>
      <span class="n">print</span> <span class="s2">&quot; $\{it.id} $\{it.name} \n&quot;</span>
      <span class="n">print</span> <span class="s2">&quot; GOT DETAILS: &quot;</span><span class="o">+</span><span class="n">it</span><span class="o">.</span><span class="na">topics</span>
    <span class="o">};</span>

    <span class="n">println</span> <span class="s2">&quot;done&quot;</span><span class="o">;</span>
  <span class="o">}</span>
<span class="o">}</span>
</pre></div>
</div>
</p>
<p>
Note that if you want more groovy integration please make some suggestions of what you
would like to see.</p>

<h2 id="scala">Scala</h2>
<p>You can use Ebean with Scala as well. Again, annotate your scala â€œbeanâ€ with the JPA
annotations as you would normally.</p>
  
<p>In May 2010 Ebean 2.6.0 was released which included support for Scala 2.8.  That meant you could use Scala Option and mutable collection types
(Scala 2.8 mutable Buffer, Set and Map) in your entity beans rather than the java collection types (so pretty much have your entity beans written in Scala).</p>

<p>In Oct 2012 the Scala support was removed from the code base.  This was because :</p>
<ul>
  <li>It was becoming a pain to maintain (incompatible changes between scala versions) and it was increasingly hard to convert Scala types back to matching java ones to call JDBC etc.</li>
  <li>There was very little uptake</li>
  <li>No one in the community championed the Scala support</li>
</ul>

<p>If anyone is interested in championing Scala support, the old code would be in source history on github.</p>

</div>

    </div>

    <div class="col-md-3" role="complementary">
      <nav class="bs-docs-sidebar hidden-print hidden-xs hidden-sm">
        <ul class="nav bs-docs-sidenav">


<li class="active">
  <a href="/docs/introduction">Introduction</a>
        <ul class="nav">
          <li><a href="#use_jpa_mapping">Use JPA mappings</a></li>
          <li><a href="#simple_query_language">Simple query language</a></li>
          <li><a href="#intro_save_and_delete">Save and delete</a></li>
          <li><a href="#jpa_comparison">Comparison to JPA</a></li>
          <li><a href="#ebean_does_not">Ebean does not...</a></li>
        </ul>
</li>
<li class="active">
  <a href="/docs/enhancement">Enhancement</a>

          <ul class="nav">
            <li><a href="#enhance_maven">Maven</a></li>
            <li><a href="#enhance_maven_eclipse">Eclipse + Maven</a></li>
            <li><a href="#enhance_ant">Ant</a></li>
            <li><a href="#enhance_agent">Agent</a></li>
            <li><a href="#enhance_ide">IDE enhancement</a></li>
          </ul>
</li>
<li >
  <a href="/docs/configuration">Configuration</a>
</li>
<li >
  <a href="/docs/ebean_access_patterns">Ebean access patterns</a>
</li>
<li >
  <a href="/docs/field_and_property_access">Field and property access</a>
</li>

<li class="active">
  <a href="/docs/queries">Queries</a>
          <ul class="nav">
            <li><a href="#where_clause">Where clause</a></li>
            <li><a href="#query_language">Ebean query language</a></li>
            <li><a href="#partial_objects">Partial objects</a></li>
            <li><a href="#query_joins">Query joins</a></li>
            <li><a href="#fetchconfig">FetchConfig</a></li>
            <li><a href="#lazy_loading">Lazy loading</a></li>
            <li><a href="#named_queries">Named Queries</a></li>
            <li><a href="#large_queries">Large queries</a></li>
            <li><a href="#paging">Paging</a></li>
            <li><a href="#async_queriess">Asynchronous queries</a></li>
            <li><a href="#rawsql">RawSql</a></li>
            <li><a href="#sqlquery">SqlQuery</a></li>
            <li><a href="#l2cache">L2 cache</a></li>
            <li><a href="#autofetch">Autofetch</a></li>
            <li><a href="#other_bits">Other bits</a></li>
          </ul>
</li>
<li class="active">
  <a href="/docs/saving">Saving</a>
          <ul class="nav">
            <li><a href="#saves">Save</a></li>
            <li><a href="#deletes">Delete</a></li>
            <li><a href="#cascading">Cascade</a></li>
            <li><a href="#bulkupdate">Bulk updates</a></li>
            <li><a href="#bulksqlupdate">Bulk SQL updates</a></li>
            <li><a href="#callablesql">CallableSql</a></li>
            <li><a href="#rawjdbc">Raw JDBC</a></li>
            <li><a href="#batch_processing">JDBC Batch</a></li>
          </ul>
</li>
<li class="active">
  <a href="/docs/mapping">Mapping</a>
          <ul class="nav">
            <li><a href="#jpa_mapping">JPA mapping</a></li>
            <li><a href="#ddl_generation">DDL generation</a></li>
            <li><a href="#naming_convention">Naming convention</a></li>
            <li><a href="#mapping_annotations">Mapping annotations</a></li>
            <li><a href="#relationships">Relationships</a></li>
            <li><a href="#id_generation">Id generation</a></li>
            <li><a href="#formula">Formula</a></li>
            <li><a href="#enummapping">EnumMapping</a></li>
            <li><a href="#encryption">Encryption</a></li>
          </ul>
</li>
<li class="active">
  <a href="/docs/transactions">Transactions</a>
          <ul class="nav">
            <li><a href="#implicit_transactions">Implicit</a></li>
            <li><a href="#programmatic_transactions">Programmatic</a></li>
            <li><a href="#tx_control_behaviour">Controlling behaviour in a transaction</a></li>
            <li><a href="#transactional">@Transactional</a></li>
            <li><a href="#tx_runnable">TxRunnable / TxCallable</a></li>
            <li><a href="#spring">Spring</a></li>
            <li><a href="#jta">JTA</a></li>
          </ul>
</li>
<li class="active">
  <a href="/docs/json">JSON</a>
</li>
<li class="active">
  <a href="/docs/eventlisteners">Event listeners</a>
</li>
<li >
  <a href="/docs/readaudit">Read Audit</a>
</li>
<li class="active">
  <a href="/docs/changelog">Change Log</a>
</li>
<li class="active">
  <a href="/docs/l2caching">L2 caching</a>
          <ul class="nav">
            <li><a href="#bean_and_query_caches">Bean and query caches</a></li>
            <li><a href="#read_only_instances">Read only instances</a></li>
            <li><a href="#shared_instances">Shared instances</a></li>
            <li><a href="#automatic_cache_maint">Automatic Cache Maintenance</a></li>
            <li><a href="#external_mods">Handling External Modification</a></li>
            <li><a href="#cachestrategy">@CacheStrategy</a></li>
            <li><a href="#manual_cache_use">Manually specifying to use the bean cache</a></li>
            <li><a href="#using_query_cache">Using the Query Cache</a></li>
          </ul>
</li>
<li class="active">
  <a href="/docs/testing">Testing</a>
          <ul class="nav">
            <li><a href="#mockibean">MockiEbean</a></li>
          </ul>
</li>
<li class="active">
  <a href="/docs/jvmlanguages">JVM Languages</a>
          <ul class="nav">
            <li><a href="#groovy">Groovy</a></li>
            <li><a href="#scala">Scala</a></li>
          </ul>
</li>

<li >
  <a href="/docs/clustering">Clustering</a>
</li>
<li >
  <a href="/docs/monitoring">Monitoring</a>
</li>
<li >
  <a href="/docs/architecture">Architecture</a>
</li>

        </ul>
          <a class="back-to-top" href="#top">
            Back to top
          </a>
      </nav>
    </div>
  </div>

</div>
<!-- /.row -->
</div>  <!-- /.container -->
  </div>
</div>

<footer id="footer">
 <div class="doc-footer">
  <ul class="doc-footer-links">
    <li><a href="/">Ebean ORM</a></li>
    <li> | </li>
    <li><a href="http://avaje-metric.github.io">Metrics</a></li>
    <li> | </li>
    <li><a href="/websitegenerator/index">Website Generator</a></li>
    <li> | </li>
    <li><a href="/jetty/index">Jetty Runnable War</a></li>
  </ul>
 </div>
</footer>

  <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.2/jquery.min.js"></script>
  <script src="/js/bootstrap.min.js"></script>
  <script src="/js/jquery.easing.min.js"></script>

  <script src="/js/json2.js"></script>
  <script src="/js/jquery.cookie.min.js"></script>
  <script src="/js/jquery.storageapi.min.js"></script>

  <script src="/js/ebean-site.js"></script>

  </body>
</html>

<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta id="layout-head" />
    <title>avaje ebean</title>
    <link rel="shortcut icon" href="/images/favicon.ico" >
    <!--<link href="/css/bootstrap.min.css" rel="stylesheet">-->
    <!-- Latest compiled and minified CSS -->
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.5/css/bootstrap.min.css">
    <link rel="stylesheet" href="/css/pygments.css" type="text/css" />
    <link rel="stylesheet" href="/css/site.css">
    <link rel="stylesheet" href="//netdna.bootstrapcdn.com/font-awesome/4.1.0/css/font-awesome.min.css">
      <!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
      <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
      <script src="https://oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>
    <![endif]-->
</head>
  <body>
  <div id="wrap">
    <div id="header">
    <div class="navbar navbar-inverse navbar-fixed-top" role="navigation">
      <div class="container">
        <div class="navbar-header">
          <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
            <span class="sr-only">Toggle navigation</span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
          </button>
          <a class="navbar-brand" href="/">Ebean ORM</a>
        </div>
        <div class="collapse navbar-collapse">
          <ul class="nav navbar-nav pull-right">
            <li ><a href="/"><span class="glyphicon glyphicon-home"></span>  Home</a></li>
            <li ><a href="/videos">Videos</a></li>
            <li ><a href="/quickstart">Quick Start</a></li>
            <li ><a href="/support">Support</a></li>
            <li class="active"><a href="/docs">Docs</a></li>
            <li ><a target="_blank" href="/apidocs">ApiDocs</a></li>
            <li ><a href="/releases">Releases</a></li>
            <li ><a target="_blank" href="https://github.com/ebean-orm/avaje-ebeanorm"> <i class="fa fa-github"></i> Github</a></li>
          </ul>
        </div><!--/.nav-collapse -->
      </div>
    </div>

  </div>
  <div id="main" data-offset="60">
<div class="jumbotron mini">
  <div class="container">
    <h1><a href="/docs">Documentation</a> / Clustering </h1>
  </div>
</div>

<div class="container doc-index bs-docs-container">

  <div class="row">

    <div class="col-md-9" role="main">

      <div class="bs-docs-section">
<h1 id="clustering">Clustering</h1>

<p>...(under construction)... needs reviewed</p>

<p>
Use ContainerConfig Configuration for the container that holds the EbeanServer instances.
</p><p>
Provides configuration for cluster communication (if clustering is used). The cluster communication is used to invalidate appropriate parts of the L2 cache across the cluster.
</p>

<div class="syntax java"><div class="highlight"><pre><span class="kd">private</span> <span class="n">ContainerConfig</span> <span class="nf">createContainerConfig</span><span class="o">(</span><span class="n">String</span> <span class="n">local</span><span class="o">,</span> <span class="n">String</span> <span class="n">threadPoolName</span><span class="o">)</span> <span class="o">{</span>
    <span class="n">ContainerConfig</span> <span class="n">container</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ContainerConfig</span><span class="o">();</span>
    <span class="n">container</span><span class="o">.</span><span class="na">setMode</span><span class="o">(</span><span class="n">ContainerConfig</span><span class="o">.</span><span class="na">ClusterMode</span><span class="o">.</span><span class="na">SOCKET</span><span class="o">);</span>  <span class="c1">// also CusterMode.MULTICAST</span>

    <span class="n">ContainerConfig</span><span class="o">.</span><span class="na">SocketConfig</span> <span class="n">socketConfig</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ContainerConfig</span><span class="o">.</span><span class="na">SocketConfig</span><span class="o">();</span>
    <span class="n">socketConfig</span><span class="o">.</span><span class="na">setLocalHostPort</span><span class="o">(</span><span class="n">local</span><span class="o">);</span>
    <span class="n">socketConfig</span><span class="o">.</span><span class="na">setThreadPoolName</span><span class="o">(</span><span class="n">threadPoolName</span><span class="o">);</span>
    <span class="n">socketConfig</span><span class="o">.</span><span class="na">setMembers</span><span class="o">(</span><span class="n">Arrays</span><span class="o">.</span><span class="na">asList</span><span class="o">(</span><span class="s">&quot;127.0.0.1:9876&quot;</span><span class="o">,</span> <span class="s">&quot;127.0.0.1:9866&quot;</span><span class="o">));</span>

    <span class="n">container</span><span class="o">.</span><span class="na">setSocketConfig</span><span class="o">(</span><span class="n">socketConfig</span><span class="o">);</span>
    <span class="k">return</span> <span class="n">container</span><span class="o">;</span>
  <span class="o">}</span>
</pre></div>
</div>

<div class="syntax java"><div class="highlight"><pre><span class="c1">// Startup server 1</span>
<span class="n">ContainerConfig</span> <span class="n">container</span> <span class="o">=</span> <span class="n">createContainerConfig</span><span class="o">(</span><span class="s">&quot;127.0.0.1:9876&quot;</span><span class="o">,</span> <span class="s">&quot;pool0&quot;</span><span class="o">);</span>
<span class="n">ClusterManager</span> <span class="n">mgr</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ClusterManager</span><span class="o">(</span><span class="n">container</span><span class="o">);</span>

<span class="c1">// Create your ebean server as you normally do</span>
<span class="n">EbeanServer</span> <span class="n">server</span> <span class="o">=</span> <span class="o">...;</span>

<span class="c1">// Register the EbeanServer with the cluster manger</span>
<span class="n">mgr</span><span class="o">.</span><span class="na">registerServer</span><span class="o">(</span><span class="n">server</span><span class="o">);</span>

<span class="c1">// Register the cluster manager with the cluster</span>
<span class="n">mgr</span><span class="o">.</span><span class="na">startup</span><span class="o">();</span>

<span class="c1">// Deregister the cluster manager from the cluster</span>
<span class="n">mgr</span><span class="o">.</span><span class="na">shutdown</span><span class="o">();</span>
</pre></div>
</div>

Same code different port:
<div class="syntax java"><div class="highlight"><pre><span class="c1">// Startup server 2</span>
<span class="n">ContainerConfig</span> <span class="n">container</span> <span class="o">=</span> <span class="n">createContainerConfig</span><span class="o">(</span><span class="s">&quot;127.0.0.1:9866&quot;</span><span class="o">,</span> <span class="s">&quot;pool1&quot;</span><span class="o">);</span>

<span class="n">ClusterManager</span> <span class="n">mgr</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ClusterManager</span><span class="o">(</span><span class="n">container</span><span class="o">);</span>

<span class="n">ServerConfig</span> <span class="n">serverConfig</span> <span class="o">=</span> <span class="o">...;</span>

<span class="n">EbeanServer</span> <span class="n">server</span> <span class="o">=</span> <span class="n">EbeanServerFactory</span><span class="o">.</span><span class="na">create</span><span class="o">(</span><span class="n">config</span><span class="o">);</span>
<span class="n">mgr</span><span class="o">.</span><span class="na">registerServer</span><span class="o">(</span><span class="n">server</span><span class="o">);</span>

<span class="c1">// Create your ebean server as you normally do</span>
<span class="n">EbeanServer</span> <span class="n">server</span> <span class="o">=</span> <span class="o">...;</span>

<span class="c1">// Register the EbeanServer with the cluster manger</span>
<span class="n">mgr</span><span class="o">.</span><span class="na">registerServer</span><span class="o">(</span><span class="n">server</span><span class="o">);</span>

<span class="c1">// Register the cluster manager with the cluster</span>
<span class="n">mgr</span><span class="o">.</span><span class="na">startup</span><span class="o">();</span>

<span class="c1">// Deregister the cluster manager from the cluster</span>
<span class="n">mgr</span><span class="o">.</span><span class="na">shutdown</span><span class="o">();</span>
</pre></div>
</div>
</p>


<h4>Other notes</h4>
<p>The <a href="/apidocs/com/avaje/ebean/event/AbstractBeanPersistListener.html">BeanPersistListener</a> listens for committed bean events.</p>

<p>These listen events occur after a successful commit. They also occur in a background thread rather than the thread used to perform the actual insert update or delete. In this way there is a delay between the commit and when the listener is notified of the event.</p>

<p>For a cluster these events may need to be broadcast. Each of the inserted(), updated() and deleted() methods return true if you want those events to be broadcast to the other members of a cluster (the id values are broadcast). If these methods return false then the events are not broadcast.</p>

<p>
  Ebean.externalModification(String tableName, boolean inserted, boolean updated, boolean deleted) processes committed changes from another framework or clustered server
</p>

<p>
Calling Ebean.externalModification notifies Ebean that beans have been committed externally, either by another framework or clustered server. Ebean uses this information to maintain its cache and lucene indexes appropriately.
</p>


</div>

    </div>

    <div class="col-md-3" role="complementary">
      <nav class="bs-docs-sidebar hidden-print hidden-xs hidden-sm">
        <ul class="nav bs-docs-sidenav">


<li class="active">
  <a href="/docs/introduction">Introduction</a>
        <ul class="nav">
          <li><a href="#use_jpa_mapping">Use JPA mappings</a></li>
          <li><a href="#simple_query_language">Simple query language</a></li>
          <li><a href="#intro_save_and_delete">Save and delete</a></li>
          <li><a href="#jpa_comparison">Comparison to JPA</a></li>
          <li><a href="#ebean_does_not">Ebean does not...</a></li>
        </ul>
</li>
<li class="active">
  <a href="/docs/enhancement">Enhancement</a>

          <ul class="nav">
            <li><a href="#enhance_maven">Maven</a></li>
            <li><a href="#enhance_maven_eclipse">Eclipse + Maven</a></li>
            <li><a href="#enhance_ant">Ant</a></li>
            <li><a href="#enhance_agent">Agent</a></li>
            <li><a href="#enhance_ide">IDE enhancement</a></li>
          </ul>
</li>
<li >
  <a href="/docs/configuration">Configuration</a>
</li>
<li >
  <a href="/docs/ebean_access_patterns">Ebean access patterns</a>
</li>
<li >
  <a href="/docs/field_and_property_access">Field and property access</a>
</li>

<li class="active">
  <a href="/docs/queries">Queries</a>
          <ul class="nav">
            <li><a href="#where_clause">Where clause</a></li>
            <li><a href="#query_language">Ebean query language</a></li>
            <li><a href="#partial_objects">Partial objects</a></li>
            <li><a href="#query_joins">Query joins</a></li>
            <li><a href="#fetchconfig">FetchConfig</a></li>
            <li><a href="#lazy_loading">Lazy loading</a></li>
            <li><a href="#named_queries">Named Queries</a></li>
            <li><a href="#large_queries">Large queries</a></li>
            <li><a href="#paging">Paging</a></li>
            <li><a href="#async_queriess">Asynchronous queries</a></li>
            <li><a href="#rawsql">RawSql</a></li>
            <li><a href="#sqlquery">SqlQuery</a></li>
            <li><a href="#l2cache">L2 cache</a></li>
            <li><a href="#autofetch">Autofetch</a></li>
            <li><a href="#other_bits">Other bits</a></li>
          </ul>
</li>
<li class="active">
  <a href="/docs/saving">Saving</a>
          <ul class="nav">
            <li><a href="#saves">Save</a></li>
            <li><a href="#deletes">Delete</a></li>
            <li><a href="#cascading">Cascade</a></li>
            <li><a href="#bulkupdate">Bulk updates</a></li>
            <li><a href="#bulksqlupdate">Bulk SQL updates</a></li>
            <li><a href="#callablesql">CallableSql</a></li>
            <li><a href="#rawjdbc">Raw JDBC</a></li>
            <li><a href="#batch_processing">JDBC Batch</a></li>
          </ul>
</li>
<li class="active">
  <a href="/docs/mapping">Mapping</a>
          <ul class="nav">
            <li><a href="#jpa_mapping">JPA mapping</a></li>
            <li><a href="#ddl_generation">DDL generation</a></li>
            <li><a href="#naming_convention">Naming convention</a></li>
            <li><a href="#mapping_annotations">Mapping annotations</a></li>
            <li><a href="#relationships">Relationships</a></li>
            <li><a href="#id_generation">Id generation</a></li>
            <li><a href="#formula">Formula</a></li>
            <li><a href="#enummapping">EnumMapping</a></li>
            <li><a href="#encryption">Encryption</a></li>
          </ul>
</li>
<li class="active">
  <a href="/docs/transactions">Transactions</a>
          <ul class="nav">
            <li><a href="#implicit_transactions">Implicit</a></li>
            <li><a href="#programmatic_transactions">Programmatic</a></li>
            <li><a href="#tx_control_behaviour">Controlling behaviour in a transaction</a></li>
            <li><a href="#transactional">@Transactional</a></li>
            <li><a href="#tx_runnable">TxRunnable / TxCallable</a></li>
            <li><a href="#spring">Spring</a></li>
            <li><a href="#jta">JTA</a></li>
          </ul>
</li>
<li class="active">
  <a href="/docs/json">JSON</a>
</li>
<li class="active">
  <a href="/docs/eventlisteners">Event listeners</a>
</li>
<li >
  <a href="/docs/readaudit">Read Audit</a>
</li>
<li class="active">
  <a href="/docs/changelog">Change Log</a>
</li>
<li class="active">
  <a href="/docs/l2caching">L2 caching</a>
          <ul class="nav">
            <li><a href="#bean_and_query_caches">Bean and query caches</a></li>
            <li><a href="#read_only_instances">Read only instances</a></li>
            <li><a href="#shared_instances">Shared instances</a></li>
            <li><a href="#automatic_cache_maint">Automatic Cache Maintenance</a></li>
            <li><a href="#external_mods">Handling External Modification</a></li>
            <li><a href="#cachestrategy">@CacheStrategy</a></li>
            <li><a href="#manual_cache_use">Manually specifying to use the bean cache</a></li>
            <li><a href="#using_query_cache">Using the Query Cache</a></li>
          </ul>
</li>
<li class="active">
  <a href="/docs/testing">Testing</a>
          <ul class="nav">
            <li><a href="#mockibean">MockiEbean</a></li>
          </ul>
</li>
<li class="active">
  <a href="/docs/jvmlanguages">JVM Languages</a>
          <ul class="nav">
            <li><a href="#groovy">Groovy</a></li>
            <li><a href="#scala">Scala</a></li>
          </ul>
</li>

<li class="active">
  <a href="/docs/clustering">Clustering</a>
</li>
<li >
  <a href="/docs/monitoring">Monitoring</a>
</li>
<li >
  <a href="/docs/architecture">Architecture</a>
</li>

        </ul>
          <a class="back-to-top" href="#top">
            Back to top
          </a>
      </nav>
    </div>
  </div>

</div>
<!-- /.row -->
</div>  <!-- /.container -->
  </div>
</div>

<footer id="footer">
 <div class="doc-footer">
  <ul class="doc-footer-links">
    <li><a href="/">Ebean ORM</a></li>
    <li> | </li>
    <li><a href="http://avaje-metric.github.io">Metrics</a></li>
    <li> | </li>
    <li><a href="/websitegenerator/index">Website Generator</a></li>
    <li> | </li>
    <li><a href="/jetty/index">Jetty Runnable War</a></li>
  </ul>
 </div>
</footer>

  <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.2/jquery.min.js"></script>
  <script src="/js/bootstrap.min.js"></script>
  <script src="/js/jquery.easing.min.js"></script>

  <script src="/js/json2.js"></script>
  <script src="/js/jquery.cookie.min.js"></script>
  <script src="/js/jquery.storageapi.min.js"></script>

  <script src="/js/ebean-site.js"></script>

  </body>
</html>

<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta id="layout-head" />
    <title>avaje ebean</title>
    <link rel="shortcut icon" href="/images/favicon.ico" >
    <!--<link href="/css/bootstrap.min.css" rel="stylesheet">-->
    <!-- Latest compiled and minified CSS -->
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.5/css/bootstrap.min.css">
    <link rel="stylesheet" href="/css/pygments.css" type="text/css" />
    <link rel="stylesheet" href="/css/site.css">
    <link rel="stylesheet" href="//netdna.bootstrapcdn.com/font-awesome/4.1.0/css/font-awesome.min.css">
      <!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
      <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
      <script src="https://oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>
    <![endif]-->
</head>
  <body>
  <div id="wrap">
    <div id="header">
    <div class="navbar navbar-inverse navbar-fixed-top" role="navigation">
      <div class="container">
        <div class="navbar-header">
          <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
            <span class="sr-only">Toggle navigation</span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
          </button>
          <a class="navbar-brand" href="/">Ebean ORM</a>
        </div>
        <div class="collapse navbar-collapse">
          <ul class="nav navbar-nav pull-right">
            <li ><a href="/"><span class="glyphicon glyphicon-home"></span>  Home</a></li>
            <li ><a href="/videos">Videos</a></li>
            <li ><a href="/quickstart">Quick Start</a></li>
            <li ><a href="/support">Support</a></li>
            <li class="active"><a href="/docs">Docs</a></li>
            <li ><a target="_blank" href="/apidocs">ApiDocs</a></li>
            <li ><a href="/releases">Releases</a></li>
            <li ><a target="_blank" href="https://github.com/ebean-orm/avaje-ebeanorm"> <i class="fa fa-github"></i> Github</a></li>
          </ul>
        </div><!--/.nav-collapse -->
      </div>
    </div>

  </div>
  <div id="main" data-offset="60">
<div class="jumbotron mini">
  <div class="container">
    <h1><a href="/docs">Documentation</a> / Monitoring </h1>
  </div>
</div>

<div class="container doc-index bs-docs-container">

  <div class="row">

    <div class="col-md-9" role="main">

      <div class="bs-docs-section">
<h1 id="monitoring">Monitoring</h1>

...(under construction)...
</div>

    </div>

    <div class="col-md-3" role="complementary">
      <nav class="bs-docs-sidebar hidden-print hidden-xs hidden-sm">
        <ul class="nav bs-docs-sidenav">


<li class="active">
  <a href="/docs/introduction">Introduction</a>
        <ul class="nav">
          <li><a href="#use_jpa_mapping">Use JPA mappings</a></li>
          <li><a href="#simple_query_language">Simple query language</a></li>
          <li><a href="#intro_save_and_delete">Save and delete</a></li>
          <li><a href="#jpa_comparison">Comparison to JPA</a></li>
          <li><a href="#ebean_does_not">Ebean does not...</a></li>
        </ul>
</li>
<li class="active">
  <a href="/docs/enhancement">Enhancement</a>

          <ul class="nav">
            <li><a href="#enhance_maven">Maven</a></li>
            <li><a href="#enhance_maven_eclipse">Eclipse + Maven</a></li>
            <li><a href="#enhance_ant">Ant</a></li>
            <li><a href="#enhance_agent">Agent</a></li>
            <li><a href="#enhance_ide">IDE enhancement</a></li>
          </ul>
</li>
<li >
  <a href="/docs/configuration">Configuration</a>
</li>
<li >
  <a href="/docs/ebean_access_patterns">Ebean access patterns</a>
</li>
<li >
  <a href="/docs/field_and_property_access">Field and property access</a>
</li>

<li class="active">
  <a href="/docs/queries">Queries</a>
          <ul class="nav">
            <li><a href="#where_clause">Where clause</a></li>
            <li><a href="#query_language">Ebean query language</a></li>
            <li><a href="#partial_objects">Partial objects</a></li>
            <li><a href="#query_joins">Query joins</a></li>
            <li><a href="#fetchconfig">FetchConfig</a></li>
            <li><a href="#lazy_loading">Lazy loading</a></li>
            <li><a href="#named_queries">Named Queries</a></li>
            <li><a href="#large_queries">Large queries</a></li>
            <li><a href="#paging">Paging</a></li>
            <li><a href="#async_queriess">Asynchronous queries</a></li>
            <li><a href="#rawsql">RawSql</a></li>
            <li><a href="#sqlquery">SqlQuery</a></li>
            <li><a href="#l2cache">L2 cache</a></li>
            <li><a href="#autofetch">Autofetch</a></li>
            <li><a href="#other_bits">Other bits</a></li>
          </ul>
</li>
<li class="active">
  <a href="/docs/saving">Saving</a>
          <ul class="nav">
            <li><a href="#saves">Save</a></li>
            <li><a href="#deletes">Delete</a></li>
            <li><a href="#cascading">Cascade</a></li>
            <li><a href="#bulkupdate">Bulk updates</a></li>
            <li><a href="#bulksqlupdate">Bulk SQL updates</a></li>
            <li><a href="#callablesql">CallableSql</a></li>
            <li><a href="#rawjdbc">Raw JDBC</a></li>
            <li><a href="#batch_processing">JDBC Batch</a></li>
          </ul>
</li>
<li class="active">
  <a href="/docs/mapping">Mapping</a>
          <ul class="nav">
            <li><a href="#jpa_mapping">JPA mapping</a></li>
            <li><a href="#ddl_generation">DDL generation</a></li>
            <li><a href="#naming_convention">Naming convention</a></li>
            <li><a href="#mapping_annotations">Mapping annotations</a></li>
            <li><a href="#relationships">Relationships</a></li>
            <li><a href="#id_generation">Id generation</a></li>
            <li><a href="#formula">Formula</a></li>
            <li><a href="#enummapping">EnumMapping</a></li>
            <li><a href="#encryption">Encryption</a></li>
          </ul>
</li>
<li class="active">
  <a href="/docs/transactions">Transactions</a>
          <ul class="nav">
            <li><a href="#implicit_transactions">Implicit</a></li>
            <li><a href="#programmatic_transactions">Programmatic</a></li>
            <li><a href="#tx_control_behaviour">Controlling behaviour in a transaction</a></li>
            <li><a href="#transactional">@Transactional</a></li>
            <li><a href="#tx_runnable">TxRunnable / TxCallable</a></li>
            <li><a href="#spring">Spring</a></li>
            <li><a href="#jta">JTA</a></li>
          </ul>
</li>
<li class="active">
  <a href="/docs/json">JSON</a>
</li>
<li class="active">
  <a href="/docs/eventlisteners">Event listeners</a>
</li>
<li >
  <a href="/docs/readaudit">Read Audit</a>
</li>
<li class="active">
  <a href="/docs/changelog">Change Log</a>
</li>
<li class="active">
  <a href="/docs/l2caching">L2 caching</a>
          <ul class="nav">
            <li><a href="#bean_and_query_caches">Bean and query caches</a></li>
            <li><a href="#read_only_instances">Read only instances</a></li>
            <li><a href="#shared_instances">Shared instances</a></li>
            <li><a href="#automatic_cache_maint">Automatic Cache Maintenance</a></li>
            <li><a href="#external_mods">Handling External Modification</a></li>
            <li><a href="#cachestrategy">@CacheStrategy</a></li>
            <li><a href="#manual_cache_use">Manually specifying to use the bean cache</a></li>
            <li><a href="#using_query_cache">Using the Query Cache</a></li>
          </ul>
</li>
<li class="active">
  <a href="/docs/testing">Testing</a>
          <ul class="nav">
            <li><a href="#mockibean">MockiEbean</a></li>
          </ul>
</li>
<li class="active">
  <a href="/docs/jvmlanguages">JVM Languages</a>
          <ul class="nav">
            <li><a href="#groovy">Groovy</a></li>
            <li><a href="#scala">Scala</a></li>
          </ul>
</li>

<li class="active">
  <a href="/docs/clustering">Clustering</a>
</li>
<li class="active">
  <a href="/docs/monitoring">Monitoring</a>
</li>
<li >
  <a href="/docs/architecture">Architecture</a>
</li>

        </ul>
          <a class="back-to-top" href="#top">
            Back to top
          </a>
      </nav>
    </div>
  </div>

</div>
<!-- /.row -->
</div>  <!-- /.container -->
  </div>
</div>

<footer id="footer">
 <div class="doc-footer">
  <ul class="doc-footer-links">
    <li><a href="/">Ebean ORM</a></li>
    <li> | </li>
    <li><a href="http://avaje-metric.github.io">Metrics</a></li>
    <li> | </li>
    <li><a href="/websitegenerator/index">Website Generator</a></li>
    <li> | </li>
    <li><a href="/jetty/index">Jetty Runnable War</a></li>
  </ul>
 </div>
</footer>

  <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.2/jquery.min.js"></script>
  <script src="/js/bootstrap.min.js"></script>
  <script src="/js/jquery.easing.min.js"></script>

  <script src="/js/json2.js"></script>
  <script src="/js/jquery.cookie.min.js"></script>
  <script src="/js/jquery.storageapi.min.js"></script>

  <script src="/js/ebean-site.js"></script>

  </body>
</html>

<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta id="layout-head" />
    <title>avaje ebean</title>
    <link rel="shortcut icon" href="/images/favicon.ico" >
    <!--<link href="/css/bootstrap.min.css" rel="stylesheet">-->
    <!-- Latest compiled and minified CSS -->
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.5/css/bootstrap.min.css">
    <link rel="stylesheet" href="/css/pygments.css" type="text/css" />
    <link rel="stylesheet" href="/css/site.css">
    <link rel="stylesheet" href="//netdna.bootstrapcdn.com/font-awesome/4.1.0/css/font-awesome.min.css">
      <!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
      <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
      <script src="https://oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>
    <![endif]-->
</head>
  <body>
  <div id="wrap">
    <div id="header">
    <div class="navbar navbar-inverse navbar-fixed-top" role="navigation">
      <div class="container">
        <div class="navbar-header">
          <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
            <span class="sr-only">Toggle navigation</span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
          </button>
          <a class="navbar-brand" href="/">Ebean ORM</a>
        </div>
        <div class="collapse navbar-collapse">
          <ul class="nav navbar-nav pull-right">
            <li ><a href="/"><span class="glyphicon glyphicon-home"></span>  Home</a></li>
            <li ><a href="/videos">Videos</a></li>
            <li ><a href="/quickstart">Quick Start</a></li>
            <li ><a href="/support">Support</a></li>
            <li class="active"><a href="/docs">Docs</a></li>
            <li ><a target="_blank" href="/apidocs">ApiDocs</a></li>
            <li ><a href="/releases">Releases</a></li>
            <li ><a target="_blank" href="https://github.com/ebean-orm/avaje-ebeanorm"> <i class="fa fa-github"></i> Github</a></li>
          </ul>
        </div><!--/.nav-collapse -->
      </div>
    </div>

  </div>
  <div id="main" data-offset="60">
<div class="jumbotron mini">
  <div class="container">
    <h1><a href="/docs">Documentation</a> / Architecture </h1>
  </div>
</div>

<div class="container doc-index bs-docs-container">

  <div class="row">

    <div class="col-md-9" role="main">

      <div class="bs-docs-section">
<h1 id="architecture">Architecture</h1>


<h2 id="persistence_context">Persistence context</h2>

<p>Although Ebean doesn't have an "Entity Manager" it does have a "persistence context". In
fact, you could go as far to say that any ORM worth using needs a "persistence context".</p>

<h4>Definition</h4>
<p>JPA v1.0 specification - section 5.1</p>
<p>"A persistence context is a set of managed entity instances in which for any persistent entity identity
there is a unique entity instance. Within the persistence context, the entity instances and their
lifecycle are managed by the entity manager."</p>

<p>Ebean has a "Persistence Context" to ensure ... unique entity instances BUT Ebean has a
different approach to lifecycle management.</p>

<p>That is, Ebean has a persistence context to ensure "... unique entity instance." (the blue
section of JPA's definition) but has a different approach to the lifecycle management
compared with JPA. Ebean has no entity manager and no persist/merge/flush lifecycle
methods.</p>


<h4>Unique Entity Instances</h4>
<p>Ebean uses the "persistence context" for queries and lazy loading (when it is building object
graphs). The purpose of this is to ensure that 'consistent' object graphs are constructed (1
unique instance per identity).</p>

<p>For example, in fetching a list of orders and their customers â€¦ the persistence context
ensures that you only get 1 customer instance for it's given id (e.g. you are NOT allowed to
have 2 or more instances of "customer id=7".</p>

<p>You could even say that any ORM worth using needs a persistence context when it builds
object graphs from relational result sets due to the nature of relational result sets.</p>

<p>For example, if you didn't have a persistence context and did allow 2 or more instances of
"customer 7" â€¦ and modified one instance but not the other â€¦ things get very ugly. The
"persistence context" ensures the user/application code works with unique entity instances.</p>

<h4>Lifecycle Management</h4>
<p>Ebean has a different approach to lifecycle management. The core difference is that with
Ebean each bean itself has it's own dirty checking (detects when it has been modified and
holds it's old/original values for optimistic concurrency checking).
</p>
<p>With JPA implementations generally the dirty checking is performed by the entity manager.
The entity manager generally holds the old/original values for optimistic concurrency
checking and the beans need to be 'attached' to an entity manager to be 'flushed' (as an
insert/update/delete). [Note: JDO based JPA implementations do this a bit differently].
</p>

<p>
Pro's for Ebean's approach
<ul>
  <li>No need to manage Entity Manager's</li>
  <li>save/delete simpler that attached/detached beans with persist/merge/flush etc</li>
</ul>

Con's for Ebean's approach
<ul>
  <li>Ebean makes an assumption that scalar types are immutable. Most scalar types (String, Integer, Double, Float, BigDecimal etc) are immutable, however, some such as java.util.Date are not. What this means is that with Ebean if you mutate a java.util.Date Ebean will NOT detect the change â€“ instead you have to set a different java.util.Date instance.</li>
</ul>
</p>

<h4>Transaction scoped</h4>
<p>With Ebean the persistence context is transaction scoped. This means that when you begin
a new transaction (implicitly or explicitly) Ebean will start a new persistence context.</p>

<p>The persistence context uses weak references and lives beyond the end of a transaction. This enables any lazy loading occuring after the transaction ends to use the same persistence context that the instance was created with.
</p>
<p>
This means, a persistence context
<ul>
  <li>Starts when a transaction starts</li>
  <li>Is used during the transactions scope to build all object graphs (queries)</li>
  <li>Lives beyond the end of a transaction so that all lazy loading occuring on that object graph also uses the same persistence context</li>
</ul>
</p>


<h4>Multi-threaded object graph construction</h4>
<p>The persistence context is designed/implemented to be thread safe. Ebean internally can use multiple threads for object graph construction (query execution). Some advanced users may take an interest in this (and may want to do this in their own application code).</p>

<p> When Ebean uses background threads for fetching (findFutureList, PagingList, useBackgroundFetchAfter etc) Ebean will automatically propagate the persistence context. In these cases multiple threads can be using the same persistence context concurrently. This also enables Ebean to provide more advanced multi-threaded query strategies in the future.</p>


<h4>Persistence Context as a "first level cache"</h4>
<p>The persistence context is sometimes described as the "first level cache". I have also seen
it described as the "transactional cache" in that it is scoped to a transaction or longer.</p>

<div class="syntax java"><div class="highlight"><pre><span class="c1">// a new persistence context started with the transaction</span>
<span class="n">Ebean</span><span class="o">.</span><span class="na">beginTransaction</span><span class="o">();</span>
<span class="k">try</span> <span class="o">{</span>
  <span class="c1">// find &quot;order 72&quot; results in that instance being put</span>
  <span class="c1">// into the persistence context</span>
  <span class="n">Order</span> <span class="n">order</span> <span class="o">=</span> <span class="n">Ebean</span><span class="o">.</span><span class="na">find</span><span class="o">(</span><span class="n">Order</span><span class="o">.</span><span class="na">class</span><span class="o">,</span> <span class="mi">72</span><span class="o">);</span>

  <span class="c1">// finds an existing &quot;order 72&quot; in the persistence context</span>
  <span class="c1">// ... so just returns that instance</span>
  <span class="n">Order</span> <span class="n">o2</span> <span class="o">=</span> <span class="n">Ebean</span><span class="o">.</span><span class="na">find</span><span class="o">(</span><span class="n">Order</span><span class="o">.</span><span class="na">class</span><span class="o">,</span> <span class="mi">72</span><span class="o">);</span>
  <span class="n">Order</span> <span class="n">o3</span> <span class="o">=</span> <span class="n">Ebean</span><span class="o">.</span><span class="na">getReference</span><span class="o">(</span><span class="n">Order</span><span class="o">.</span><span class="na">class</span><span class="o">,</span> <span class="mi">72</span><span class="o">);</span>

  <span class="c1">// all the same instance</span>
  <span class="n">Assert</span><span class="o">.</span><span class="na">assertTrue</span><span class="o">(</span><span class="n">order</span> <span class="o">==</span> <span class="n">o2</span><span class="o">);</span>
  <span class="n">Assert</span><span class="o">.</span><span class="na">assertTrue</span><span class="o">(</span><span class="n">order</span> <span class="o">==</span> <span class="n">o3</span><span class="o">);</span>
<span class="o">}</span> <span class="k">finally</span> <span class="o">{</span>
  <span class="n">Ebean</span><span class="o">.</span><span class="na">endTransaction</span><span class="o">();</span>
<span class="o">}</span>
</pre></div>
</div>
<p>
The code above shows that there is only 1 instance of "Order 72". As we try to fetch it
again (during the scope of a single persistence context) we end up getting back the same
instance.</p>
<p>
However, typically you don't write code that fetches the same Order multiple times in a
single transaction. The code above is not something you would typically write.</p>

<p>
A more realistic example would be when the persistence context is used:

<div class="syntax java"><div class="highlight"><pre><span class="c1">// a new persistence context started with the transaction</span>
<span class="n">Ebean</span><span class="o">.</span><span class="na">beginTransaction</span><span class="o">();</span>

<span class="k">try</span> <span class="o">{</span>
  <span class="c1">// find &quot;customer 1&quot; results in this instance being</span>
  <span class="c1">// put into the persistence context</span>
  <span class="n">Customer</span> <span class="n">customer</span> <span class="o">=</span> <span class="n">Ebean</span><span class="o">.</span><span class="na">find</span><span class="o">(</span><span class="n">Customer</span><span class="o">.</span><span class="na">class</span><span class="o">,</span> <span class="mi">1</span><span class="o">);</span>
  <span class="c1">// for this example â€¦ &quot;customer 1&quot; placed &quot;order 72&quot;</span>
  <span class="c1">// when &quot;order 72&quot; is fetched/built it has a foreign</span>
  <span class="c1">// key value customer_id = 1...</span>
  <span class="c1">// As customer 1 is already in the persistence context</span>
  <span class="c1">// this same instance of customer 1 is used</span>
  <span class="n">Order</span> <span class="n">order</span> <span class="o">=</span> <span class="n">Ebean</span><span class="o">.</span><span class="na">find</span><span class="o">(</span><span class="n">Order</span><span class="o">.</span><span class="na">class</span><span class="o">,</span> <span class="mi">72</span><span class="o">);</span>
  <span class="n">Customer</span> <span class="n">customerB</span> <span class="o">=</span> <span class="n">order</span><span class="o">.</span><span class="na">getCustomer</span><span class="o">();</span>
  <span class="c1">// they are the same instance</span>
  <span class="n">Assert</span><span class="o">.</span><span class="na">assertTrue</span><span class="o">(</span><span class="n">customer</span> <span class="o">==</span> <span class="n">customerB</span><span class="o">);</span>
<span class="o">}</span> <span class="k">finally</span> <span class="o">{</span>
  <span class="n">Ebean</span><span class="o">.</span><span class="na">endTransaction</span><span class="o">();</span>
<span class="o">}</span>
</pre></div>
</div>
</p>

<p>From these examples you should hopefully see that the persistence context acts as a
cache to some degree. It can sometimes reduce the number of database queries required
when you get object graphs and navigate them.</p>

<p>However, the primary function of the persistence context is to ensure ... unique instances
for a given identity (so that the object graphs are constructed in a consistent manor). The
fact that it sometimes looks/acts like a cache is more of a side effect.</p>


<h2 id="internals">Internals</h2>
<p>
  The 4.0.1 release changed enhancement and how each bean knows which properties are loaded/changed. This is now held in a boolean. This change effected pretty much every part of the internals (lots of work) but has simplified a lot of those internals as the bean itself does the work of knowing what is loaded. It also has the effect of making embedded beans much better and paves the way for some JPA2 features for embedded beans like collections off embedded beans.
</p>

</div>

    </div>

    <div class="col-md-3" role="complementary">
      <nav class="bs-docs-sidebar hidden-print hidden-xs hidden-sm">
        <ul class="nav bs-docs-sidenav">


<li class="active">
  <a href="/docs/introduction">Introduction</a>
        <ul class="nav">
          <li><a href="#use_jpa_mapping">Use JPA mappings</a></li>
          <li><a href="#simple_query_language">Simple query language</a></li>
          <li><a href="#intro_save_and_delete">Save and delete</a></li>
          <li><a href="#jpa_comparison">Comparison to JPA</a></li>
          <li><a href="#ebean_does_not">Ebean does not...</a></li>
        </ul>
</li>
<li class="active">
  <a href="/docs/enhancement">Enhancement</a>

          <ul class="nav">
            <li><a href="#enhance_maven">Maven</a></li>
            <li><a href="#enhance_maven_eclipse">Eclipse + Maven</a></li>
            <li><a href="#enhance_ant">Ant</a></li>
            <li><a href="#enhance_agent">Agent</a></li>
            <li><a href="#enhance_ide">IDE enhancement</a></li>
          </ul>
</li>
<li >
  <a href="/docs/configuration">Configuration</a>
</li>
<li >
  <a href="/docs/ebean_access_patterns">Ebean access patterns</a>
</li>
<li >
  <a href="/docs/field_and_property_access">Field and property access</a>
</li>

<li class="active">
  <a href="/docs/queries">Queries</a>
          <ul class="nav">
            <li><a href="#where_clause">Where clause</a></li>
            <li><a href="#query_language">Ebean query language</a></li>
            <li><a href="#partial_objects">Partial objects</a></li>
            <li><a href="#query_joins">Query joins</a></li>
            <li><a href="#fetchconfig">FetchConfig</a></li>
            <li><a href="#lazy_loading">Lazy loading</a></li>
            <li><a href="#named_queries">Named Queries</a></li>
            <li><a href="#large_queries">Large queries</a></li>
            <li><a href="#paging">Paging</a></li>
            <li><a href="#async_queriess">Asynchronous queries</a></li>
            <li><a href="#rawsql">RawSql</a></li>
            <li><a href="#sqlquery">SqlQuery</a></li>
            <li><a href="#l2cache">L2 cache</a></li>
            <li><a href="#autofetch">Autofetch</a></li>
            <li><a href="#other_bits">Other bits</a></li>
          </ul>
</li>
<li class="active">
  <a href="/docs/saving">Saving</a>
          <ul class="nav">
            <li><a href="#saves">Save</a></li>
            <li><a href="#deletes">Delete</a></li>
            <li><a href="#cascading">Cascade</a></li>
            <li><a href="#bulkupdate">Bulk updates</a></li>
            <li><a href="#bulksqlupdate">Bulk SQL updates</a></li>
            <li><a href="#callablesql">CallableSql</a></li>
            <li><a href="#rawjdbc">Raw JDBC</a></li>
            <li><a href="#batch_processing">JDBC Batch</a></li>
          </ul>
</li>
<li class="active">
  <a href="/docs/mapping">Mapping</a>
          <ul class="nav">
            <li><a href="#jpa_mapping">JPA mapping</a></li>
            <li><a href="#ddl_generation">DDL generation</a></li>
            <li><a href="#naming_convention">Naming convention</a></li>
            <li><a href="#mapping_annotations">Mapping annotations</a></li>
            <li><a href="#relationships">Relationships</a></li>
            <li><a href="#id_generation">Id generation</a></li>
            <li><a href="#formula">Formula</a></li>
            <li><a href="#enummapping">EnumMapping</a></li>
            <li><a href="#encryption">Encryption</a></li>
          </ul>
</li>
<li class="active">
  <a href="/docs/transactions">Transactions</a>
          <ul class="nav">
            <li><a href="#implicit_transactions">Implicit</a></li>
            <li><a href="#programmatic_transactions">Programmatic</a></li>
            <li><a href="#tx_control_behaviour">Controlling behaviour in a transaction</a></li>
            <li><a href="#transactional">@Transactional</a></li>
            <li><a href="#tx_runnable">TxRunnable / TxCallable</a></li>
            <li><a href="#spring">Spring</a></li>
            <li><a href="#jta">JTA</a></li>
          </ul>
</li>
<li class="active">
  <a href="/docs/json">JSON</a>
</li>
<li class="active">
  <a href="/docs/eventlisteners">Event listeners</a>
</li>
<li >
  <a href="/docs/readaudit">Read Audit</a>
</li>
<li class="active">
  <a href="/docs/changelog">Change Log</a>
</li>
<li class="active">
  <a href="/docs/l2caching">L2 caching</a>
          <ul class="nav">
            <li><a href="#bean_and_query_caches">Bean and query caches</a></li>
            <li><a href="#read_only_instances">Read only instances</a></li>
            <li><a href="#shared_instances">Shared instances</a></li>
            <li><a href="#automatic_cache_maint">Automatic Cache Maintenance</a></li>
            <li><a href="#external_mods">Handling External Modification</a></li>
            <li><a href="#cachestrategy">@CacheStrategy</a></li>
            <li><a href="#manual_cache_use">Manually specifying to use the bean cache</a></li>
            <li><a href="#using_query_cache">Using the Query Cache</a></li>
          </ul>
</li>
<li class="active">
  <a href="/docs/testing">Testing</a>
          <ul class="nav">
            <li><a href="#mockibean">MockiEbean</a></li>
          </ul>
</li>
<li class="active">
  <a href="/docs/jvmlanguages">JVM Languages</a>
          <ul class="nav">
            <li><a href="#groovy">Groovy</a></li>
            <li><a href="#scala">Scala</a></li>
          </ul>
</li>

<li class="active">
  <a href="/docs/clustering">Clustering</a>
</li>
<li class="active">
  <a href="/docs/monitoring">Monitoring</a>
</li>
<li class="active">
  <a href="/docs/architecture">Architecture</a>
          <ul class="nav">
            <li><a href="#persistence_context">Persistence context</a></li>
            <li><a href="#internals">Internals</a></li>
          </ul>
</li>

        </ul>
          <a class="back-to-top" href="#top">
            Back to top
          </a>
      </nav>
    </div>
  </div>

</div>
<!-- /.row -->
</div>  <!-- /.container -->
  </div>
</div>

<footer id="footer">
 <div class="doc-footer">
  <ul class="doc-footer-links">
    <li><a href="/">Ebean ORM</a></li>
    <li> | </li>
    <li><a href="http://avaje-metric.github.io">Metrics</a></li>
    <li> | </li>
    <li><a href="/websitegenerator/index">Website Generator</a></li>
    <li> | </li>
    <li><a href="/jetty/index">Jetty Runnable War</a></li>
  </ul>
 </div>
</footer>

  <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.2/jquery.min.js"></script>
  <script src="/js/bootstrap.min.js"></script>
  <script src="/js/jquery.easing.min.js"></script>

  <script src="/js/json2.js"></script>
  <script src="/js/jquery.cookie.min.js"></script>
  <script src="/js/jquery.storageapi.min.js"></script>

  <script src="/js/ebean-site.js"></script>

  </body>
</html>

  </div>

  <div class="col-md-3" role="complementary">
    <nav class="bs-docs-sidebar hidden-print hidden-xs hidden-sm">
      <ul class="nav bs-docs-sidenav">
        <li>
          <a href="#introduction">Introduction</a>
          <ul class="nav">
            <li><a href="#use_jpa_mapping">Use JPA mappings</a></li>
            <li><a href="#simple_query_language">Simple query language</a></li>
            <li><a href="#intro_save_and_delete">Save and delete</a></li>
            <li><a href="#jpa_comparison">Comparison to JPA</a></li>
            <li><a href="#ebean_does_not">Ebean does not...</a></li>
          </ul>
        </li>
        <li>
          <a href="#enhancement">Enhancement</a>
          <ul class="nav">
            <li><a href="#enhance_maven">Maven</a></li>
            <li><a href="#enhance_maven_eclipse">Eclipse + Maven</a></li>
            <li><a href="#enhance_ant">Ant</a></li>
            <li><a href="#enhance_agent">Agent</a></li>
            <li><a href="#enhance_ide">IDE enhancement</a></li>
          </ul>
        </li>
        <li>
          <a href="#configuration">Configuration</a>
          <ul class="nav">
            <li><a href="#properties_config">ebean.properties configuration</a></li>
            <li><a href="#programmatic_config">Programmatic configuration</a></li>
            <li><a href="#logging">Logging</a></li>
          </ul>
        </li>
        <li>
          <a href="#ebean_access_patterns">Ebean access patterns</a>
          <ul class="nav">
            <li><a href="#dependency_injection">Dependency injection</a></li>
            <li><a href="#play_active_record">Active Record</a></li>
            <li><a href="#ebean_singleton">Ebean singleton</a></li>
          </ul>
        </li>
        <li>
          <a href="#field_and_property_access">Field and property access</a>
          <ul class="nav">
            <li><a href="#property_access">Property access</a></li>
            <li><a href="#field_access">Field access</a></li>
            <li><a href="#field_vs_property_access">Ebean â€“ Field vs Property access</a></li>
          </ul>
        </li>

        <li>
          <a href="#queries">Queries</a>
          <ul class="nav">
            <li><a href="#where_clause">Where clause</a></li>
            <li><a href="#query_language">Ebean query language</a></li>
            <li><a href="#partial_objects">Partial objects</a></li>
            <li><a href="#query_joins">Query joins</a></li>
            <li><a href="#fetchconfig">FetchConfig</a></li>
            <li><a href="#lazy_loading">Lazy loading</a></li>
            <li><a href="#named_queries">Named Queries</a></li>
            <li><a href="#large_queries">Large queries</a></li>
            <li><a href="#paging">Paging</a></li>
            <li><a href="#async_queriess">Asynchronous queries</a></li>
            <li><a href="#rawsql">RawSql</a></li>
            <li><a href="#sqlquery">SqlQuery</a></li>
            <li><a href="#l2cache">L2 cache</a></li>
            <li><a href="#autofetch">Autofetch</a></li>
            <li><a href="#other_bits">Other bits</a></li>
          </ul>
        </li>
        <li>
            <a href="#updates">Updates</a>
            <ul class="nav">
              <li><a href="#saves">Saves</a></li>
              <li><a href="#deletes">Deletes</a></li>
              <li><a href="#cascading">Cascading</a></li>
              <li><a href="#bulkupdate">Bulk updates</a></li>
              <li><a href="#bulksqlupdate">Bulk SQL updates</a></li>
              <li><a href="#callablesql">CallableSql</a></li>
              <li><a href="#rawjdbc">Raw JDBC</a></li>
              <li><a href="#batch_processing">Batch processing</a></li>
            </ul>
        </li>
        <li>
          <a href="#mapping">Mapping</a>
          <ul class="nav">
            <li><a href="#jpa_mapping">JPA mapping</a></li>
            <li><a href="#ddl_generation">DDL generation</a></li>
            <li><a href="#naming_convention">Naming convention</a></li>
            <li><a href="#mapping_annotations">Mapping annotations</a></li>
            <li><a href="#relationships">Relationships</a></li>
            <li><a href="#id_generation">Id generation</a></li>
            <li><a href="#formula">Formula</a></li>
            <li><a href="#enummapping">EnumMapping</a></li>
            <li><a href="#encryption">Encryption</a></li>
          </ul>
        </li>
        <li>
          <a href="#transactions">Transactions</a>
          <ul class="nav">
            <li><a href="#implicit_transactions">Implicit</a></li>
            <li><a href="#programmatic_transactions">Programmatic</a></li>
            <li><a href="#tx_control_behaviour">Controlling behaviour in a transaction</a></li>
            <li><a href="#transactional">@Transactional</a></li>
            <li><a href="#tx_runnable">TxRunnable / TxCallable</a></li>
            <li><a href="#spring">Spring</a></li>
            <li><a href="#jta">JTA</a></li>
          </ul>
        </li>
        <li><a href="#json">JSON</a></li>
        <li><a href="#event_listeners">Event listeners</a></li>
        <li>
            <a href="#l2caching">L2 caching</a>
            <ul class="nav">
              <li><a href="#bean_and_query_caches">Bean and query caches</a></li>
              <li><a href="#read_only_instances">Read only instances</a></li>
              <li><a href="#shared_instances">Shared instances</a></li>
              <li><a href="#automatic_cache_maint">Automatic Cache Maintenance</a></li>
              <li><a href="#external_mods">Handling External Modification</a></li>
              <li><a href="#cachestrategy">@CacheStrategy</a></li>
              <li><a href="#manual_cache_use">Manually specifying to use the bean cache</a></li>
              <li><a href="#using_query_cache">Using the Query Cache</a></li>
            </ul>
        </li>
        <li>
          <a href="#testing">Testing</a>
          <ul class="nav">
            <li><a href="#mockibean">MockiEbean</a></li>
          </ul>
        </li>
        <li>
          <a href="#language_support  ">Language Support</a>
          <ul class="nav">
            <li><a href="#groovy">Groovy</a></li>
            <li><a href="#scala">Scala</a></li>
          </ul>
        </li>

        <li><a href="#clustering">Clustering</a></li>
        <li><a href="#monitoring">Monitoring</a></li>
        <li>
          <a href="#architecture">Architecture</a>
          <ul class="nav">
            <li><a href="#persistence_context">Persistence context</a></li>
            <li><a href="#internals">Internals</a></li>
          </ul>
        </li>

      </ul>
      <a class="back-to-top" href="#top">
        Back to top
      </a>
    </nav>
  </div>
</div>

</div> <!-- /.row -->
</div>  <!-- /.container -->
  </div>
</div>

<footer id="footer">
 <div class="doc-footer">
  <ul class="doc-footer-links">
    <li><a href="/">Ebean ORM</a></li>
    <li> | </li>
    <li><a href="http://avaje-metric.github.io">Metrics</a></li>
    <li> | </li>
    <li><a href="/websitegenerator/index">Website Generator</a></li>
    <li> | </li>
    <li><a href="/jetty/index">Jetty Runnable War</a></li>
  </ul>
 </div>
</footer>

  <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.2/jquery.min.js"></script>
  <script src="/js/bootstrap.min.js"></script>
  <script src="/js/jquery.easing.min.js"></script>

  <script src="/js/json2.js"></script>
  <script src="/js/jquery.cookie.min.js"></script>
  <script src="/js/jquery.storageapi.min.js"></script>

  <script src="/js/ebean-site.js"></script>

  </body>
</html>
