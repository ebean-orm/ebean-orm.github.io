<!doctype html>
<html lang="en">
<head>
  <title>Query beans | Ebean</title>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  <link rel="shortcut icon" href="/images/favicon.ico">
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto|Source+Sans+Pro|Ubuntu&display=swap">
  <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.1.0/css/all.css" integrity="sha384-lKuwvrZot6UHsBSfcMvOkWwlCMgc0TaWr+30HWe3a4ltaBwTZhyTEggF5tJv8tbt" crossorigin="anonymous">
  <link rel="stylesheet" href="/css/reset3.css">
  <link rel="stylesheet" href="/css/site3.css">
  <link rel="stylesheet" href="/css/pygments3.css">
</head>
<body>
<div id="main">
  
<div id="banner">
  <header>
    <nav id="top">
      <h1 id="breadcrumb">
        <a class="nav-logo" href="/"><img src="/images/logo-200.png" height="35"></a>&nbsp;&nbsp;<a href="/docs">Documentation</a><span class="sep">&nbsp;/&nbsp;</span><a href="/docs/query/">Query</a><span class="sep">&nbsp;/&nbsp;</span><span class="last">Query beans</span>
      </h1>
      <ul>
        <li><a href="https://github.com/ebean-orm/ebean" title="github source"><i class="fab fa-github"></i></a></li>
        <li><a onclick="toggleTheme();" title="switch dark light theme"><i class="fas fa-adjust"></i></a></li>
      </ul>
    </nav>
  </header>
</div>
<div class="grid grid-docs">
  <aside>
<nav class="side">
  <ul>
      <li class="nav0 ">
    <a  href="/docs/getting-started">Getting started</a>
  </li>
  <li class="nav0 ">
    <a  href="/docs/intro">Introduction</a>
  </li>
  <li class="nav0 active">
    <a class="active" href="/docs">Documentation</a>
      <ul>
  <li class="nav1 ">
    <a  href="/docs/best-practice">Best practice</a>
  </li>
  <li class="nav1 active">
    <a class="active" href="/docs/query">Query</a>
<ul class="nav">
  <li class="active">
    <a class="active" href="/docs/query/query-beans">Query beans</a>
  </li>
  <li >
    <a  href="/docs/query/where">Where</a>
  </li>
  <li >
    <a  href="/docs/query/expressions">Expressions</a>
  </li>
  <li >
    <a  href="/docs/query/orderBy">OrderBy</a>
  </li>
  <li >
    <a  href="/docs/query/select">Select</a>
  </li>
  <li >
    <a  href="/docs/query/fetch">Fetch</a>
  </li>
  <li >
    <a  href="/docs/query/fetchgroup">FetchGroup</a>
  </li>
  <li >
    <a  href="/docs/query/filterMany">FilterMany</a>
  </li>

  <li >
    <a  href="/docs/query/aggregation">Aggregation</a>
  </li>
  <li >
    <a  href="/docs/query/having">Having</a>
  </li>
  <li >
    <a  href="/docs/query/native-sql">Native Sql</a>
  </li>
  <li >
    <a  href="/docs/query/rawSql">RawSql</a>
  </li>

  <li >
    <a  href="/docs/query/update">Update query</a>
  </li>
  <li >
    <a  href="/docs/query/delete">Delete query</a>
  </li>
  <li >
    <a  href="/docs/query/dtoquery">DtoQuery</a>
  </li>
  <li >
    <a  href="/docs/query/sqlquery">SqlQuery</a>
  </li>
  <li >
    <a  href="/docs/query/sqlupdate">SqlUpdate</a>
  </li>
  <li >
    <a  href="/docs/query/callablesql">CallableSql</a>
  </li>
</ul>
  </li>
  <li class="nav1 ">
    <a  href="/docs/persist">Persist</a>
  </li>
  <li class="nav1 ">
    <a  href="/docs/transactions">Transactions</a>
  </li>
  <li class="nav1 ">
    <a  href="/docs/mapping">Mapping</a>
  </li>
  <li class="nav1 ">
    <a  href="/docs/ddl-generation">DDL & Migrations</a>
  </li>
  <li class="nav1 ">
    <a  href="/docs/logging">Logging</a>
  </li>
  <li class="nav1 ">
    <a  href="/docs/testing">Testing</a>
  </li>
  <li class="nav1 ">
    <a  href="/docs/database">Database platforms</a>
  </li>
  <li class="nav1 ">
    <a  href="/docs/multi-database">Multiple databases</a>
  </li>
  <li class="nav1 ">
    <a  href="/docs/kotlin">Kotlin</a>
  </li>
        <li><a href="/docs/tuning">Tuning</a></li>
        <li><a href="/docs/features">Features</a></li>
      </ul>
  </li>
  <li class="nav0 ">
    <a  href="/support">Getting help</a>
  </li>
    <li class="nav0 ">
      <a target="_blank" href="/apidoc/12">API Javadoc</a>
    </li>
  <li class="nav0 ">
    <a  href="/videos">Videos</a>
  </li>
  <li class="nav0 ">
    <a  href="/docs/upgrading">Upgrading</a>
  </li>
  <li class="nav0 ">
    <a  href="/releases">Releases</a>
  </li>

  </ul>
</nav>
  </aside>
  <article>
<form action="https://www.google.com/search" method="get" class="inline-form">
  <input type="hidden" name="as_sitesearch" value="ebean.io">
  <div id="page-search">
    <div class="input-group">
      <input class="frm" name="q" id="searchinput" type="text" placeholder="Search... (press 's' to focus)" data-placeholder-focus="Search... (use '↑', '↓' and '⏎' to select results)" data-placeholder-blur="Search... (press 's' to focus)" autocomplete="off">
      <div class="input-group-btn">
        <button class="frm" type="submit"><i class="fas fa-search"></i></button>
      </div>
    </div>
    <div id="page-search-results" style="display: none;">
      <ul id="search-results-container" class="search-results"><li class=" active"><a href="/docs" title="Docs"><span style="color:#777;">Docs</span> Documentation </a></li><li class=""><small style="color:#999;">And 101 more...</small></li></ul>
    </div>
  </div>
</form>
    
  <h2 id="querybeans">Query beans</h2>
  <p>
    Query beans are optional but they provide a nice way to write queries with <code>type safe
    compile time checking</code>. They are also easy to use and learn with <code>IDE auto-completion</code>
    on properties and expressions.
  </p>
  <p>
    Query beans are generated using a Java annotation processing (<em>APT</em>) or
    Kotlin annotation processing (<em>KAPT</em>).
  </p>
  <p>
    For each entity a <em>query bean</em> is generated with the same name but prefixed with <code>Q</code>.
    So for an entity bean called <em>Customer</em> there is a query bean generated called <em>QCustomer</em>.
  </p>
  <p>
    When the entity bean model changes
    the query beans are regenerated and as developers we get compile time checking on
    our application queries - we get a compile time error if our queries are no longer
    valid for the model.
  </p>

  <h5>Examples:</h5>

  <div class="syntax java"><div class="highlight"><pre><span></span><span class="n">Contact</span> <span class="n">contact</span> <span class="o">=</span>
  <span class="k">new</span> <span class="n">QContact</span><span class="o">()</span>                                <span class="c1">// Contact query bean</span>
    <span class="o">.</span><span class="na field">email</span><span class="o">.</span><span class="na">equalTo</span><span class="o">(</span><span class="s">&quot;rob@foo.com&quot;</span><span class="o">)</span>               <span class="c1">// type safe expression</span>
    <span class="o">.</span><span class="na">findOne</span><span class="o">();</span>                                 <span class="c1">// with IDE auto-completion</span>
</pre></div>
</div>

  <div class="syntax java"><div class="highlight"><pre><span></span><span class="n">List</span><span class="o">&lt;</span><span class="n">Customer</span><span class="o">&gt;</span> <span class="n">customers</span> <span class="o">=</span>
  <span class="k">new</span> <span class="n">QCustomer</span><span class="o">()</span>                                <span class="c1">// Customer query bean</span>
    <span class="o">.</span><span class="na field">status</span><span class="o">.</span><span class="na">equalTo</span><span class="o">(</span><span class="n">Status</span><span class="o">.</span><span class="na">NEW</span><span class="o">)</span>
    <span class="o">.</span><span class="na field">billingAddress</span><span class="o">.</span><span class="na field">city</span><span class="o">.</span><span class="na">equalTo</span><span class="o">(</span><span class="s">&quot;Auckland&quot;</span><span class="o">)</span>     <span class="c1">// joins automatically added</span>
    <span class="o">.</span><span class="na field">contacts</span><span class="o">.</span><span class="na">isEmpty</span><span class="o">()</span>                          <span class="c1">// to support expressions</span>
    <span class="o">.</span><span class="na">findList</span><span class="o">();</span>
</pre></div>
</div>

  <h2 id="apt" class="art">APT / KAPT <em>(generating query beans)</em></h2>
  <p>
    To generate <code>Java</code> query beans we use the <em>io.ebean:querybean-generator</em>
    java annotation processor and to generate <code>Kotlin</code> query beans we use
    <em>io.ebean:kotlin-querybean-generator</em>.
  </p>

  <h4 id="maven" class="art">Generating with Maven</h4>
  <p>
    Refer to <a href="/docs/getting-started/maven">docs / getting-started / maven</a>
    for details of how to generate query beans using maven.
  </p>

  <h4 id="gradle">Generating with Gradle</h4>
  <p>
    Refer to <a href="/docs/getting-started/gradle">docs / getting-started / gradle</a>
    for details of how to generate query beans using gradle.
  </p>

  <h2 id="enhancement" class="art">Enhancement</h2>
  <p>
    Note that prior to version 12.1.8 we need to edit a <code>src/main/resources/ebean.mf</code>
    manifest file to specify <code>querybean-packages</code> for the packages that should
    be enhanced for query beans. This is no longer needed from 12.1.8 onwards.
  </p>

  <h5>Example (Pre 12.1.8)</h5>
  <div class="syntax properties"><div class="highlight"><pre><span></span><span class="na">entity-packages</span><span class="o">:</span> <span class="s">org.example.domain</span>
<span class="na">transactional-packages</span><span class="o">:</span> <span class="s">org.example</span>
<span class="na">querybean-packages</span><span class="o">:</span> <span class="s">org.example</span>
</pre></div>
</div>

  <h2 id="caveats" class="art">Caveats</h2>

  <h4>Refactor rename entity bean</h4>
  <p>
    When we refactor rename an entity bean in an IDE the query beans we should trigger a <code>build all</code>.
    This is because the query beans for the old bean names are kept around until the next <code>build all</code>.
  </p>
  <p>
    Once we do a <code>build all</code> this will effectively delete the old query beans and generate the new ones.
    At this point we get compiler errors for the queries that we need to adjust (use the new query bean names).
  </p>

  <h2 id="groovy">Groovy Spock</h2>
  <p>
    When using query beans with Groovy perhaps in Spock tests we need to use them inside a <code>@CompileStatic</code>
    block.
  </p>
  <div class="syntax groovy"><div class="highlight"><pre><span></span><span class="nd">@CompileStatic</span>
<span class="kd">static</span> <span class="kt">def</span> <span class="nf">findCount</span><span class="o">(</span><span class="n">String</span> <span class="n">name</span><span class="o">)</span> <span class="o">{</span>
  <span class="k">return</span> <span class="k">new</span> <span class="nf">QDbSample</span><span class="o">().</span><span class="na">name</span><span class="o">.</span><span class="na">eq</span><span class="o">(</span><span class="n">name</span><span class="o">).</span><span class="na">findCount</span><span class="o">()</span>
<span class="o">}</span>
</pre></div>
</div>
  <p>
    Then we can use the helper method in our spock test like:
  </p>
  <div class="syntax groovy"><div class="highlight"><pre><span></span><span class="o">...</span>
<span class="nl">then:</span>
  <span class="c1">// this line NPEs</span>
  <span class="n">findCount</span><span class="o">(</span><span class="s1">&#39;fred&#39;</span><span class="o">)</span> <span class="o">==</span> <span class="mi">1</span>
</pre></div>
</div>

  <nav class="next">
    <p class="edit-page">
      <a href="https://github.com/ebean-orm/website-source/blob/master/docs/query/query-beans.html"><i class="fab fa-github"></i> Edit Page</a>
    </p>
    <p class="next">
      <a href="/docs/query/where" class="btn btn-info">Next: Where</a>
    </p>
  </nav>

  </article>
</div>

</div>
<script src="https://code.jquery.com/jquery-3.4.1.slim.min.js" integrity="sha384-J6qa4849blE2+poT4WnyKhv5vZF5SrPo0iEjwBvKU7imGFAV0wwj1yYfoRSJoZ+n" crossorigin="anonymous"></script>
<script src="/js/site3.js"></script>
<script src="/js/search3.js"></script>
</body>
</html>
