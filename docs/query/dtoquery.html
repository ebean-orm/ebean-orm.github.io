<!doctype html>
<html lang="en">
<head>
  <title>DtoQuery | Query | Ebean</title>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  <link rel="shortcut icon" href="/images/favicon.ico">
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto|Source+Sans+Pro|Ubuntu&display=swap">
  <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.1.0/css/all.css" integrity="sha384-lKuwvrZot6UHsBSfcMvOkWwlCMgc0TaWr+30HWe3a4ltaBwTZhyTEggF5tJv8tbt" crossorigin="anonymous">
  <link rel="stylesheet" href="/css/reset3.css">
  <link rel="stylesheet" href="/css/site3.css">
  <link rel="stylesheet" href="/css/pygments3.css">
</head>
<body>
<div id="main">
  
<div id="banner">
  <header>
    <nav id="top">
      <h1 id="breadcrumb">
        <a class="nav-logo" href="/"><img src="/images/logo-200.png" height="35"></a>&nbsp;&nbsp;<a href="/docs">Documentation</a><span class="sep">&nbsp;/&nbsp;</span><a href="/docs/query/">Query</a><span class="sep">&nbsp;/&nbsp;</span><span class="last">DtoQuery</span>
      </h1>
      <ul>
        
        <li><a onclick="toggleTheme();" title="switch dark light theme"><i class="fas fa-adjust"></i></a></li>
      </ul>
    </nav>
  </header>
</div>
<div class="grid grid-docs">
  <aside>
<nav class="side">
  <ul>
      <li class="nav0 ">
    <a  href="/docs/getting-started">Getting started</a>
  </li>
  <li class="nav0 ">
    <a  href="/docs/intro">Introduction</a>
  </li>
  <li class="nav0 active">
    <a class="active" href="/docs">Documentation</a>
      <ul>
  <li class="nav1 ">
    <a  href="/docs/best-practice">Best practice</a>
  </li>
  <li class="nav1 active">
    <a class="active" href="/docs/query">Query</a>
<ul class="nav">
  <li >
    <a  href="/docs/query/query-beans">Query beans</a>
  </li>
  <li >
    <a  href="/docs/query/where">Where</a>
  </li>
  <li >
    <a  href="/docs/query/expressions">Expressions</a>
  </li>
  <li >
    <a  href="/docs/query/orderBy">OrderBy</a>
  </li>
  <li >
    <a  href="/docs/query/select">Select</a>
  </li>
  <li >
    <a  href="/docs/query/fetch">Fetch</a>
  </li>
  <li >
    <a  href="/docs/query/fetchgroup">FetchGroup</a>
  </li>
  <li >
    <a  href="/docs/query/filterMany">FilterMany</a>
  </li>

  <li >
    <a  href="/docs/query/aggregation">Aggregation</a>
  </li>
  <li >
    <a  href="/docs/query/having">Having</a>
  </li>
  <li >
    <a  href="/docs/query/native-sql">Native Sql</a>
  </li>
  <li >
    <a  href="/docs/query/rawSql">RawSql</a>
  </li>

  <li >
    <a  href="/docs/query/update">Update query</a>
  </li>
  <li >
    <a  href="/docs/query/delete">Delete query</a>
  </li>
  <li class="active">
    <a class="active" href="/docs/query/dtoquery">DtoQuery</a>
  <ul class="nav nav-scroll">
    <li><a href="#mapping">Mapping</a></li>
    <li><a href="#maxRows">firstRow / maxRows</a></li>
    <li><a href="#relaxedMode">RelaxedMode</a></li>
    <li><a href="#findEach">findEach</a></li>
  </ul>
  </li>
  <li >
    <a  href="/docs/query/sqlquery">SqlQuery</a>
  </li>
  <li >
    <a  href="/docs/query/sqlupdate">SqlUpdate</a>
  </li>
  <li >
    <a  href="/docs/query/callablesql">CallableSql</a>
  </li>
</ul>
  </li>
  <li class="nav1 ">
    <a  href="/docs/persist">Persist</a>
  </li>
  <li class="nav1 ">
    <a  href="/docs/transactions">Transactions</a>
  </li>
  <li class="nav1 ">
    <a  href="/docs/mapping">Mapping</a>
  </li>
  <li class="nav1 ">
    <a  href="/docs/ddl-generation">DDL & Migrations</a>
  </li>
  <li class="nav1 ">
    <a  href="/docs/logging">Logging</a>
  </li>
  <li class="nav1 ">
    <a  href="/docs/testing">Testing</a>
  </li>
  <li class="nav1 ">
    <a  href="/docs/database">Database platforms</a>
  </li>
  <li class="nav1 ">
    <a  href="/docs/multi-database">Multiple databases</a>
  </li>
  <li class="nav1 ">
    <a  href="/docs/kotlin">Kotlin</a>
  </li>
        <li><a href="/docs/tuning">Tuning</a></li>
  <li class="nav1 ">
    <a  href="/docs/features">Features</a>
  </li>
      </ul>
  </li>
  <li class="nav0 ">
    <a  href="/support">Getting help</a>
  </li>
    <li class="nav0 ">
      <a target="_blank" href="/apidoc/13">API Javadoc</a>
    </li>
  <li class="nav0 ">
    <a  href="/videos">Videos</a>
  </li>
  <li class="nav0 ">
    <a  href="/docs/upgrading">Upgrading</a>
  </li>
  <li class="nav0 ">
    <a  href="/releases">Releases</a>
  </li>

  </ul>
</nav>
  </aside>
  <article>
<form action="https://www.google.com/search" method="get" class="inline-form">
  <input type="hidden" name="as_sitesearch" value="ebean.io">
  <div id="page-search">
    <div class="input-group">
      <input class="frm" name="q" id="searchinput" type="text" placeholder="Search... (press 's' to focus)" data-placeholder-focus="Search... (use '↑', '↓' and '⏎' to select results)" data-placeholder-blur="Search... (press 's' to focus)" autocomplete="off">
      <div class="input-group-btn">
        <button class="frm" type="submit"><i class="fas fa-search"></i></button>
      </div>
    </div>
    <div id="page-search-results" style="display: none;">
      <ul id="search-results-container" class="search-results"><li class=" active"><a href="/docs" title="Docs"><span style="color:#777;">Docs</span> Documentation </a></li><li class=""><small style="color:#999;">And 101 more...</small></li></ul>
    </div>
  </div>
</form>
    
<h2 id="dto">DtoQuery</h2>
<p>
  DtoQuery is where we use SQL and map it into plain beans. These plain beans are just
  ordinary beans with public constructor(s) and public getters/setters.
</p>

<div class="syntax java"><div class="highlight"><pre><span></span><span class="kd">public</span> <span class="kd">static</span> <span class="kd">class</span> <span class="nc">CustomerDto</span> <span class="o">{</span>

  <span class="n">Integer</span> <span class="n">id</span><span class="o">;</span>
  <span class="n">String</span> <span class="n">name</span><span class="o">;</span>

  <span class="o">...</span> <span class="c1">// getters &amp; setters</span>
<span class="o">}</span>
</pre></div>
</div>
<div class="syntax java"><div class="highlight"><pre><span></span><span class="c1">// using positioned parameters</span>

<span class="n">List</span><span class="o">&lt;</span><span class="n">CustomerDto</span><span class="o">&gt;</span> <span class="n">beans</span> <span class="o">=</span>
  <span class="n">database</span><span class="o">.</span><span class="na">findDto</span><span class="o">(</span><span class="n">CustomerDto</span><span class="o">.</span><span class="na">class</span><span class="o">,</span> <span class="s">&quot;select id, name from customer where name = ?&quot;</span><span class="o">)</span>
  <span class="o">.</span><span class="na">setParameter</span><span class="o">(</span><span class="mi">1</span><span class="o">,</span> <span class="s">&quot;Rob&quot;</span><span class="o">)</span>
  <span class="o">.</span><span class="na">findList</span><span class="o">();</span>
</pre></div>
</div>

<div class="syntax java"><div class="highlight"><pre><span></span><span class="c1">// using named parameters</span>

<span class="n">List</span><span class="o">&lt;</span><span class="n">CustomerDto</span><span class="o">&gt;</span> <span class="n">beans</span> <span class="o">=</span>
  <span class="n">database</span><span class="o">.</span><span class="na">findDto</span><span class="o">(</span><span class="n">CustomerDto</span><span class="o">.</span><span class="na">class</span><span class="o">,</span> <span class="s">&quot;select id, name from customer where name = :name&quot;</span><span class="o">)</span>
  <span class="o">.</span><span class="na">setParameter</span><span class="o">(</span><span class="s">&quot;name&quot;</span><span class="o">,</span> <span class="s">&quot;Rob&quot;</span><span class="o">)</span>
  <span class="o">.</span><span class="na">findList</span><span class="o">();</span>
</pre></div>
</div>

<h2 id="mapping" class="art">Mapping</h2>
<p>
  When mapping the SQL resultSet to the DTO beans the following is used.
</p>
<ul>
  <li>
    Firstly we look for a constructor with the same number of arguments as columns in the resultSet.
    If we have such a constructor we use it for mapping (assuming the correct types).
  </li>
  <li>
    Secondly see if there are more columns in the resultSet than our largest constructor.
    If so we the largest constructor to read the first columns and then look to use setter methods
    to map the remaining columns.
  </li>
  <li>
    Finally we use the default constructor and setter methods.
  </li>
</ul>

<p>
  Note that we perform the mapping using MethodHandles rather than reflection.
  That does mean it expects the Constructor and Setter methods to have public access.
</p>

<h2 id="maxRows" class="art">firstRow / maxRows</h2>
<p>
  We can apply firstRows/maxRows to the sql query.
</p>
<div class="syntax java"><div class="highlight"><pre><span></span><span class="n">String</span> <span class="n">sql</span> <span class="o">=</span> <span class="s">&quot;select id, name from customer where name like ?&quot;</span><span class="o">;</span>

<span class="n">List</span><span class="o">&lt;</span><span class="n">CustomerDto</span><span class="o">&gt;</span> <span class="n">robs</span> <span class="o">=</span> <span class="n">server</span><span class="o">().</span><span class="na">findDto</span><span class="o">(</span><span class="n">CustomerDto</span><span class="o">.</span><span class="na">class</span><span class="o">,</span> <span class="n">sql</span><span class="o">)</span>
  <span class="o">.</span><span class="na">setParameter</span><span class="o">(</span><span class="mi">1</span><span class="o">,</span> <span class="s">&quot;Rob%&quot;</span><span class="o">)</span>
  <span class="o">.</span><span class="na">setMaxRows</span><span class="o">(</span><span class="mi">10</span><span class="o">)</span>
  <span class="o">.</span><span class="na">findList</span><span class="o">();</span>
</pre></div>
</div>
<p>
  The appropriate sql will be added to apply firstRows/maxRows for the database platform.
</p>

<div class="syntax sql"><div class="highlight"><pre><span></span><span class="k">select</span> <span class="n">id</span><span class="p">,</span> <span class="n">name</span> <span class="k">from</span> <span class="n">o_customer</span> <span class="k">where</span> <span class="n">name</span> <span class="k">like</span> <span class="o">?</span>
<span class="k">limit</span> <span class="mi">10</span>
</pre></div>
</div>

<h2 id="relaxedMode" class="art">RelaxedMode</h2>
<p>
  By default when performing the mapping, if we are not able to map a column to a property
  (setter method) then an exception is thrown.
<p>
  <p>
  Instead we can set relaxed mode on the query via <code>query.setRelaxedMode()</code> and that
  means it will effectively ignore/skip any column that it can't map.
</p>
<p>
  This is expected to be useful when there is potentially a large existing query and there
  is a desire to only map some of the columns into bean properties.
</p>

<h2 id="any" class="art">Postgres ANY</h2>
<p>
  When using Postgres we can use Postgres <code>ANY</code> in DtoQuery using positioned parameters
  or by using <code>setArrayParameter()</code>.
</p>
<p>
  The benefit of using Postgres <code>ANY</code> is that we end up using a single SQL query regardless of the number
  of parameters - a single JDBC PreparedStatement and the database has a single SQL query to parse. This results in
  the database doing less hard parsing and better use of PreparedStatement cache, less query plans to cache, less memory consumed.
</p>

<h5>Example: Positioned parameter</h5>
<p>
  When using index positioned parameters and binding a collection that will bind as a JDBC ARRAY.
</p>
<div class="syntax java"><div class="highlight"><pre><span></span><span class="n">List</span><span class="o">&lt;</span><span class="n">Integer</span><span class="o">&gt;</span> <span class="n">ids</span> <span class="o">=</span> <span class="n">List</span><span class="o">.</span><span class="na">of</span><span class="o">(</span><span class="mi">1</span><span class="o">,</span> <span class="mi">2</span><span class="o">);</span>
<span class="n">String</span> <span class="n">sql</span> <span class="o">=</span> <span class="s">&quot;select id, name from customer where id = any(?)&quot;</span>

<span class="n">List</span><span class="o">&lt;</span><span class="n">CustomerDto</span><span class="o">&gt;</span> <span class="n">list</span> <span class="o">=</span> <span class="n">DB</span><span class="o">.</span><span class="na">findDto</span><span class="o">(</span><span class="n">CustomerDto</span><span class="o">.</span><span class="na">class</span><span class="o">,</span> <span class="n">sql</span><span class="o">)</span>
  <span class="o">.</span><span class="na">setParameter</span><span class="o">(</span><span class="n">ids</span><span class="o">)</span> <span class="c1">// bind as JDBC ARRAY</span>
  <span class="o">.</span><span class="na">findList</span><span class="o">();</span>
</pre></div>
</div>
<h5>Example: Using setArrayParameter() for named parameters</h5>
<p>
  When using named parameters by default Ebean expects use of an <code>IN</code> clause and collections are "expanded".
  For example, a collection of 3 values is expanded into 3 separate JDBC bind values <code>?,?,?</code> rather than JDBC binding a single ARRAY.
  To bind collections as a Postgres ARRAY for an <code>ANY</code> clause we need to use <code>setArrayParameter()</code>.
</p>
<div class="syntax java"><div class="highlight"><pre><span></span><span class="n">List</span><span class="o">&lt;</span><span class="n">Integer</span><span class="o">&gt;</span> <span class="n">ids</span> <span class="o">=</span> <span class="n">List</span><span class="o">.</span><span class="na">of</span><span class="o">(</span><span class="mi">1</span><span class="o">,</span> <span class="mi">2</span><span class="o">);</span>
<span class="n">String</span> <span class="n">sql</span> <span class="o">=</span> <span class="s">&quot;select id, name from o_customer where id = any(:idList)&quot;</span>

<span class="n">List</span><span class="o">&lt;</span><span class="n">CustomerDto</span><span class="o">&gt;</span> <span class="n">list2</span> <span class="o">=</span> <span class="n">DB</span><span class="o">.</span><span class="na">findDto</span><span class="o">(</span><span class="n">CustomerDto</span><span class="o">.</span><span class="na">class</span><span class="o">,</span> <span class="n">sql</span><span class="o">)</span>
  <span class="o">.</span><span class="na">setArrayParameter</span><span class="o">(</span><span class="s">&quot;idList&quot;</span><span class="o">,</span> <span class="n">ids</span><span class="o">)</span> <span class="c1">// bind as JDBC ARRAY</span>
  <span class="o">.</span><span class="na">findList</span><span class="o">();</span>
</pre></div>
</div>

<h2 id="findEach" class="art">findEach</h2>
<p>
  We use <em>findEach</em> when processing a large query where we do not wish to hold
  all the beans in a list but instead process them one at a time.
</p>
<div class="syntax java"><div class="highlight"><pre><span></span><span class="n">String</span> <span class="n">sql</span> <span class="o">=</span> <span class="s">&quot;select id, name from o_customer where id &gt; :id order by id desc&quot;</span><span class="o">;</span>

<span class="n">database</span><span class="o">.</span><span class="na">findDto</span><span class="o">(</span><span class="n">CustomerDto</span><span class="o">.</span><span class="na">class</span><span class="o">,</span> <span class="n">sql</span><span class="o">)</span>
  <span class="o">.</span><span class="na">setParameter</span><span class="o">(</span><span class="s">&quot;id&quot;</span><span class="o">,</span> <span class="mi">0</span><span class="o">)</span>
  <span class="o">.</span><span class="na">findEach</span><span class="o">(</span><span class="n">customer</span> <span class="o">-&gt;</span> <span class="o">{</span>

    <span class="n">log</span><span class="o">.</span><span class="na">debug</span><span class="o">(</span><span class="s">&quot;got &quot;</span> <span class="o">+</span> <span class="n">customer</span><span class="o">.</span><span class="na">getId</span><span class="o">()</span> <span class="o">+</span> <span class="s">&quot; &quot;</span> <span class="o">+</span> <span class="n">customer</span><span class="o">.</span><span class="na">getName</span><span class="o">());</span>
    <span class="o">...</span>

  <span class="o">});</span>
</pre></div>
</div>

<h2 id="findStream" class="art">findStream</h2>
<p>
  <em>findStream</em> is similar to findEach where we process the result one at a time.
  We should use a <code>try with resources</code> block to ensure the underlying resources
  are closed.
</p>
<div class="syntax java"><div class="highlight"><pre><span></span><span class="n">String</span> <span class="n">sql</span> <span class="o">=</span> <span class="s">&quot;select id, name from o_customer where id &gt; ? order by id desc&quot;</span><span class="o">;</span>

<span class="k">try</span> <span class="o">(</span><span class="n">Stream</span><span class="o">&lt;</span><span class="n">CustomerDto</span><span class="o">&gt;</span> <span class="n">customers</span> <span class="o">=</span>
  <span class="n">database</span><span class="o">.</span><span class="na">findDto</span><span class="o">(</span><span class="n">CustomerDto</span><span class="o">.</span><span class="na">class</span><span class="o">,</span> <span class="n">sql</span><span class="o">)</span>
    <span class="o">.</span><span class="na">setParameter</span><span class="o">(</span><span class="mi">0</span><span class="o">)</span>
    <span class="o">.</span><span class="na">findStream</span><span class="o">())</span> <span class="o">{</span>

    <span class="c1">// use the stream of customers ...</span>
    <span class="o">...</span>
<span class="o">}</span>
</pre></div>
</div>

<h2 id="findIterate" class="art">findIterate</h2>
<p>
  <em>findIterate</em> is similar to findStream and findEach where we process the result one at a time.
  We should use a <code>try with resources</code> block to ensure the underlying resources
  are closed.
</p>
<div class="syntax java"><div class="highlight"><pre><span></span><span class="n">String</span> <span class="n">sql</span> <span class="o">=</span> <span class="s">&quot;select id, name from o_customer where id &gt; :id order by id desc&quot;</span><span class="o">;</span>

<span class="k">try</span> <span class="o">(</span><span class="n">QueryIterator</span><span class="o">&lt;</span><span class="n">CustomerDto</span><span class="o">&gt;</span> <span class="n">customers</span> <span class="o">=</span>
  <span class="n">database</span><span class="o">.</span><span class="na">findDto</span><span class="o">(</span><span class="n">CustomerDto</span><span class="o">.</span><span class="na">class</span><span class="o">,</span> <span class="n">sql</span><span class="o">)</span>
    <span class="o">.</span><span class="na">setParameter</span><span class="o">(</span><span class="mi">0</span><span class="o">)</span>
    <span class="o">.</span><span class="na">findIterate</span><span class="o">())</span> <span class="o">{</span>

    <span class="c1">// iterate through the customers</span>
    <span class="o">...</span>
<span class="o">}</span>
</pre></div>
</div>

<h2 id="scalar" class="art">Single column</h2>
<p>
  If we are looking to select a single column we look to use
  <a href="sqlquery#scalar">SqlQuery.mapToScalar()</a> for that.
</p>
<div class="syntax java"><div class="highlight"><pre><span></span><span class="n">String</span> <span class="n">sql</span> <span class="o">=</span> <span class="s">&quot;select mysequence.nextval&quot;</span><span class="o">;</span>

<span class="n">Long</span> <span class="n">nextVal</span> <span class="o">=</span> <span class="n">DB</span><span class="o">.</span><span class="na">sqlQuery</span><span class="o">(</span><span class="n">sql</span><span class="o">)</span>
  <span class="o">.</span><span class="na">mapToScalar</span><span class="o">(</span><span class="n">Long</span><span class="o">.</span><span class="na">class</span><span class="o">)</span>
  <span class="o">.</span><span class="na">findOne</span><span class="o">();</span>
</pre></div>
</div>

  <nav class="next">
    <p class="edit-page">
      <a href="https://github.com/ebean-orm/website-source/blob/master/docs/query/dtoquery.html"><i class="fab fa-github"></i> Edit Page</a>
    </p>
    <p class="next">
      <a href="/docs/query/" class="btn btn-info">Next: Queries</a>
    </p>
  </nav>


  </article>
</div>

</div>
<script src="https://code.jquery.com/jquery-3.4.1.slim.min.js" integrity="sha384-J6qa4849blE2+poT4WnyKhv5vZF5SrPo0iEjwBvKU7imGFAV0wwj1yYfoRSJoZ+n" crossorigin="anonymous"></script>
<script src="/js/site3.js"></script>
<script src="/js/search3.js"></script>
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-75181644-1"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());
  gtag('config', 'UA-75181644-1');
</script>
</body>
</html>
