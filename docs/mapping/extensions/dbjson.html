<!doctype html>
<html lang="en">
<head>
  <title>Mapping | Ebean</title>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  <link rel="shortcut icon" href="/images/favicon.ico">
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto|Source+Sans+Pro|Ubuntu&display=swap">
  <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.1.0/css/all.css" integrity="sha384-lKuwvrZot6UHsBSfcMvOkWwlCMgc0TaWr+30HWe3a4ltaBwTZhyTEggF5tJv8tbt" crossorigin="anonymous">
  <link rel="stylesheet" href="/css/reset3.css">
  <link rel="stylesheet" href="/css/site3.css">
  <link rel="stylesheet" href="/css/pygments3.css">
</head>
<body>
<div id="main">
  
<div id="banner">
  <header>
    <nav id="top">
      <h1 id="breadcrumb">
        <a class="nav-logo" href="/"><img src="/images/logo-200.png" height="35"></a>&nbsp;&nbsp;<a href="/docs">Documentation</a><span class="sep">&nbsp;/&nbsp;</span><a href="/docs/mapping/">Mapping</a><span class="sep">&nbsp;/&nbsp;</span><a href="/docs/mapping/extension">Extension</a><span class="sep">&nbsp;/&nbsp;</span><span class="last">@DbJson</span>
      </h1>
      <ul>
        <li><a href="https://github.com/ebean-orm/ebean" title="github source"><i class="fab fa-github"></i></a></li>
        <li><a onclick="toggleTheme();" title="switch dark light theme"><i class="fas fa-adjust"></i></a></li>
      </ul>
    </nav>
  </header>
</div>
<div class="grid grid-docs">
  <aside>
<nav class="side">
  <ul>
      <li class="nav0 ">
    <a  href="/docs/getting-started">Getting started</a>
  </li>
  <li class="nav0 ">
    <a  href="/docs/intro">Introduction</a>
  </li>
  <li class="nav0 active">
    <a class="active" href="/docs">Documentation</a>
      <ul>
  <li class="nav1 ">
    <a  href="/docs/best-practice">Best practice</a>
  </li>
  <li class="nav1 ">
    <a  href="/docs/query">Query</a>
  </li>
  <li class="nav1 ">
    <a  href="/docs/persist">Persist</a>
  </li>
  <li class="nav1 ">
    <a  href="/docs/transactions">Transactions</a>
  </li>
  <li class="nav1 active">
    <a class="active" href="/docs/mapping">Mapping</a>
<ul class="nav">
    <li class="nav1 ">
    <a  href="/docs/mapping/type">Types</a>
  </li>

  <li class="nav1 ">
    <a  href="/docs/mapping/jpa">JPA</a>
  </li>

  <li class="nav1 active">
    <a class="active" href="/docs/mapping/extensions">Extensions</a>
    <ul class="nav">
  <li >
    <a  href="/docs/mapping/extensions/identity">@Identity</a>
  </li>
  <li >
    <a  href="/docs/mapping/extensions/dbindex">@Index</a>
  </li>
  <li >
    <a  href="/docs/mapping/extensions/dbenumvalue">@DbEnumValue</a>
  </li>
  <li class="active">
    <a class="active" href="/docs/mapping/extensions/dbjson">@DbJson</a>
        <ul class="nav">
          <li><a href="#overview">Overview</a></li>
          <li><a href="#mixed">Mixing structured and unstructured</a></li>
          <li><a href="#simple-types">Mapping simple types</a></li>
          <li><a href="#jackson">Mapping with Jackson ObjectMapper</a></li>
          <li><a href="#fallback">Fallback mapping</a></li>
          <li><a href="#expressions">Query expressions</a></li>
        </ul>
  </li>
  <li >
    <a  href="/docs/mapping/extensions/dbarray">@DbArray</a>
  </li>
  <li >
    <a  href="/docs/mapping/extensions/dbmap">@DbMap</a>
  </li>
  <li >
    <a  href="/docs/mapping/extensions/dbcomment">@DbComment</a>
  </li>
  <li >
    <a  href="/docs/mapping/extensions/dbpartition">@DbPartition</a>
  </li>
  <li >
    <a  href="/docs/mapping/extensions/when-created">@WhenCreated</a>
  </li>
  <li >
    <a  href="/docs/mapping/extensions/when-modified">@WhenModified</a>
  </li>
  <li >
    <a  href="/docs/mapping/extensions/who-created">@WhoCreated</a>
  </li>
  <li >
    <a  href="/docs/mapping/extensions/who-modified">@WhoModified</a>
  </li>
  <li >
    <a  href="/docs/mapping/extensions/soft-delete">@SoftDelete</a>
  </li>
  <li >
    <a  href="/docs/mapping/extensions/encrypted">@Encrypted</a>
  </li>
  <li >
    <a  href="/docs/mapping/extensions/formula">@Formula</a>
  </li>
  <li >
    <a  href="/docs/mapping/extensions/view">@View</a>
  </li>
  <li >
    <a  href="/docs/mapping/extensions/history">@History</a>
  </li>
  <li >
    <a  href="/docs/mapping/extensions/change-log">@ChangeLog</a>
  </li>
  <li >
    <a  href="/docs/mapping/extensions/read-audit">@ReadAudit</a>
  </li>
    </ul>
  </li>
</ul>
  </li>
  <li class="nav1 ">
    <a  href="/docs/ddl-generation">DDL & Migrations</a>
  </li>
  <li class="nav1 ">
    <a  href="/docs/logging">Logging</a>
  </li>
  <li class="nav1 ">
    <a  href="/docs/testing">Testing</a>
  </li>
  <li class="nav1 ">
    <a  href="/docs/database">Database platforms</a>
  </li>
  <li class="nav1 ">
    <a  href="/docs/multi-database">Multiple databases</a>
  </li>
  <li class="nav1 ">
    <a  href="/docs/kotlin">Kotlin</a>
  </li>
        <li><a href="/docs/tuning">Tuning</a></li>
  <li class="nav1 ">
    <a  href="/docs/features">Features</a>
  </li>
      </ul>
  </li>
  <li class="nav0 ">
    <a  href="/support">Getting help</a>
  </li>
    <li class="nav0 ">
      <a target="_blank" href="/apidoc/13">API Javadoc</a>
    </li>
  <li class="nav0 ">
    <a  href="/videos">Videos</a>
  </li>
  <li class="nav0 ">
    <a  href="/docs/upgrading">Upgrading</a>
  </li>
  <li class="nav0 ">
    <a  href="/releases">Releases</a>
  </li>

  </ul>
</nav>
  </aside>
  <article>
<form action="https://www.google.com/search" method="get" class="inline-form">
  <input type="hidden" name="as_sitesearch" value="ebean.io">
  <div id="page-search">
    <div class="input-group">
      <input class="frm" name="q" id="searchinput" type="text" placeholder="Search... (press 's' to focus)" data-placeholder-focus="Search... (use '↑', '↓' and '⏎' to select results)" data-placeholder-blur="Search... (press 's' to focus)" autocomplete="off">
      <div class="input-group-btn">
        <button class="frm" type="submit"><i class="fas fa-search"></i></button>
      </div>
    </div>
    <div id="page-search-results" style="display: none;">
      <ul id="search-results-container" class="search-results"><li class=" active"><a href="/docs" title="Docs"><span style="color:#777;">Docs</span> Documentation </a></li><li class=""><small style="color:#999;">And 101 more...</small></li></ul>
    </div>
  </div>
</form>
    

<h2 id="overview">Overview</h2>
<p>
  Ebean provides <code>@DbJson</code> and <code>@DbJsonB</code> for mapping properties as
  JSON documents into Postgres JSON, Postgres JSONB, CLOB, VARCHAR or BLOB.
</p>
<p>
  Both <code>Postgres</code> and <code>Oracle</code> (and shortly <code>MySql</code>) provide
  functions/expressions for querying and manipulating the JSON.
</p>
<p>
  Ebean also has <code>ElasticSearch</code> integration so even without the built in database
  support we can use that integration to effectively replicate to ElasticSearch and use it
  to search our data.
</p>

<h2 id="mixed">Mixing structured and unstructured</h2>
<p>
  What these capabilities do is enable designers/developers to mix unstructured (or semi-structured)
  document content with our typically highly structured data.
</p>
<p>
  An example use case might be storing 'user preferences' where the data naturally comes in as JSON,
  has potentially deep nesting and where we only need limited queries/expressions on the document attributes.
  In this type of case the use of unstructured document storage as JSON can be a good fit.
</p>

<h2 id="simple-types">Mapping simple types</h2>
<p>
  If the mapping is to <code>String</code>, <code>Long</code> or <code>Map&lt;String,Object&gt;</code> types
  then Ebean will use it's built in JSON support to handle the marshalling to/from JSON.
</p>
<div class="syntax java"><div class="highlight"><pre><span></span><span class="nd">@DbJsonB</span>
<span class="n">Map</span><span class="o">&lt;</span><span class="n">String</span><span class="o">,</span><span class="n">Object</span><span class="o">&gt;</span> <span class="n">content</span><span class="o">;</span>

<span class="nd">@DbJsonB</span>
<span class="n">List</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span> <span class="n">contents</span><span class="o">;</span>
</pre></div>
</div>
<p>
  With these types note that Ebean will use <code>ModifyAware</code> collections so that it knows if the
  property is <code>dirty</code> and needs to be included in an update. If the type is not ModifyAware then
  it must be treated as dirty and included in an update.
</p>

<h2 id="jackson">Mapping with Jackson ObjectMapper</h2>
<p>
  If the type mapped is not one of <code>String</code>, <code>Long</code> or <code>Map&lt;String,Object&gt;</code> types
  then Ebean will use Jackson ObjectMapper to handle the marshalling to/from JSON.
  In this case <code>jackson-databind</code> becomes a required dependency.
</p>
<div class="syntax java"><div class="highlight"><pre><span></span><span class="c1">// Jackson ObjectMapper used here</span>
<span class="nd">@DbJsonB</span>
<span class="n">Map</span><span class="o">&lt;</span><span class="n">String</span><span class="o">,</span><span class="n">SomePojo</span><span class="o">&gt;</span> <span class="n">content</span><span class="o">;</span>

<span class="c1">// Jackson ObjectMapper used here</span>
<span class="nd">@DbJsonB</span>
<span class="n">SomePojo</span> <span class="n">content</span><span class="o">;</span>
</pre></div>
</div>
<p>
  Note that when we use Jackson for marshalling the property type is not <code>ModifyAware</code> and that
  means that it must be treated as <code>dirty</code> and included in updates.  It will only be included in
  updates if the property is actually loaded of course and so if you know a use case will not update the content
  it can be worth while to not load it in the first place (with the additional benefit that it won't be automatically
  included in the update).
</p>

<h4>ServerConfig</h4>
<p>
  An ObjectMapper instance can be configured on ServerConfig via <code>setObjectMapper()</code>. If an ObjectMapper is
  not specified in this way an instance will be created for use by Ebean (If Jackson ObjectMapper is
  detected in the classpath).
</p>

<h2 id="fallback">Fallback mapping</h2>
<p>
  When Postgres is not used then fallback is to store JSON into VARCHAR, CLOB or BLOB database types.
  If the <code>length</code> attribute is specified like <code>@DbJson(length=1000)</code>
  or <code>@DbJsonB(length=1000)</code> then VARCHAR is the fallback type and the length defined is the
  length of the varchar column definition.
</p>
<div class="syntax java"><div class="highlight"><pre><span></span><span class="c1">// fallback to store in VARCHAR(800)</span>
<span class="nd">@DbJson</span><span class="o">(</span><span class="nx">length</span><span class="o">=</span><span class="mi">800</span><span class="o">)</span>
<span class="n">Map</span><span class="o">&lt;</span><span class="n">String</span><span class="o">,</span><span class="n">Object</span><span class="o">&gt;</span> <span class="n">content</span><span class="o">;</span>
</pre></div>
</div>
<p>
  The storage can be explicitly defined using the <code>storage</code> attribute.
</p>
<div class="syntax java"><div class="highlight"><pre><span></span><span class="c1">// explicitly store using BLOB</span>
<span class="nd">@DbJson</span><span class="o">(</span><span class="nx">storage</span> <span class="o">=</span> <span class="nx">DbJsonType</span><span class="o">.</span><span class="na">BLOB</span><span class="o">)</span>
<span class="n">Map</span><span class="o">&lt;</span><span class="n">String</span><span class="o">,</span><span class="n">Object</span><span class="o">&gt;</span> <span class="n">content</span><span class="o">;</span>
</pre></div>
</div>
<p>
  The default fallback for JSON and JSONB types is CLOB and this is used when both the length and
  storage attributes are not defined.
</p>


<h2 id="expressions">Query expressions</h2>
<p>
  Refer to <a href="/docs/features/json-in-db">json-in-db</a> documentation for details on the query expressions
  and how those translate for both Postgres and Oracle expressions.
</p>


  </article>
</div>

</div>
<script src="https://code.jquery.com/jquery-3.4.1.slim.min.js" integrity="sha384-J6qa4849blE2+poT4WnyKhv5vZF5SrPo0iEjwBvKU7imGFAV0wwj1yYfoRSJoZ+n" crossorigin="anonymous"></script>
<script src="/js/site3.js"></script>
<script src="/js/search3.js"></script>
</body>
</html>
