
<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta id="layout-head" />
    <title>Ebean ORM - Java/Kotlin/JVM</title>
    <link rel="shortcut icon" href="/images/favicon.ico" >
    <!--<link href="/css/bootstrap.min.css" rel="stylesheet">-->
    <!-- Latest compiled and minified CSS -->
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.5/css/bootstrap.min.css">
    <link rel="stylesheet" href="/css/pygments.css" type="text/css" />
    <link rel="stylesheet" href="/css/site.css">
    <link rel="stylesheet" href="//netdna.bootstrapcdn.com/font-awesome/4.1.0/css/font-awesome.min.css">
      <!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
      <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
      <script src="https://oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>
    <![endif]-->
</head>
  <body>
  <div id="wrap">
    <div id="header">
    <div class="navbar navbar-inverse navbar-fixed-top" role="navigation">
      <div class="container">
        <div class="navbar-header">
          <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
            <span class="sr-only">Toggle navigation</span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
          </button>
          <a class="navbar-brand" href="/">Ebean ORM</a>
        </div>
        <div class="collapse navbar-collapse">
          <ul class="nav navbar-nav pull-right">
            <li ><a href="/"><span class="glyphicon glyphicon-home"></span>  Home</a></li>
            <li ><a href="/videos">Videos</a></li>
            <li ><a href="/quickstart">Quick Start</a></li>
            <li ><a href="/support">Support</a></li>
            <li class="active"><a href="/docs">Docs</a></li>
            <li ><a target="_blank" href="/apidocs">ApiDocs</a></li>
            <li ><a href="/releases">Releases</a></li>
            <li ><a target="_blank" href="https://github.com/ebean-orm/avaje-ebeanorm"> <i class="fa fa-github"></i> Github</a></li>
          </ul>
        </div><!--/.nav-collapse -->
      </div>
    </div>

  </div>
  <div id="main" data-offset="60">
<div class="jumbotron mini">
  <div class="container">
    <h1><a href="/docs">Documentation</a> / Draftable </h1>
  </div>
</div>

<div class="container doc-index bs-docs-container">

  <div class="row">

    <div class="col-md-9" role="main">

      <div class="bs-docs-section">
  <h2 id="overview">Overview</h2>
  <p>
    Draftable is a feature that uses a second set of tables to hold a 'draft' version of the
    object graph separately from the 'live'. Typically the draft objects are edited and go
    through an approval process before being published.
  </p>

  <h2 id="mapping">Mapping</h2>
  <p>

  </p>

  <hr/>
  <h4>ENTITY MAPPING</h4>
  <h4 id="draftable">@Draftable</h4>
  <p>
    <code>@Draftable</code> is an annotation put on entity beans that should support draftable
    features.
  </p>
  <p>
    The @Draftable annotation put on 'top level' (or root level) entity beans and @DraftableElement
    is put on related child entity beans which are considered part of the same graph.
  </p>
  <p>
    Publishing a <code>@Draftable</code> bean will publish the 'top level' @Draftable entity beans
    along with any of its related child @DraftableElement beans.
  </p>

  <h4 id="draftable-element">@DraftableElement</h4>
  <p>
    <code>@DraftableElement</code> is an annotation put on entity beans that are part of a draftable
    object graph but not 'top level' beans.
  </p>

  <hr/>
  <h4>PROPERTY MAPPING</h4>
  <h4 id="draft-only">@DraftOnly</h4>
  <p>
    <code>@DraftOnly</code> is an annotation put on properties that exist on the draft table only
    - these properties do not exist on the associated live table. For example, annotation properties
    that are on the draft to support approval workflow (workflow status, when publish timestamp etc).
  </p>

  <h4 id="draft-dirty">@DraftDirty</h4>
  <p>
    <code>@DraftDirty</code> is an annotation that can be put on a boolean property of a @Draftable entity bean.
    This property only exists on the draft table and it's value is automatically set to true when the draft
    bean is saved and automatically set to false when the draft bean is published. The property is expected
    to be used to identify (query) draft beans that should be published.
  </p>

  <h4 id="draft-comment">@DraftComment - NOT SUPPORTED YET</h4>
  <p>
    <code>@DraftComment</code> is an annotation that can be put on a String property of a @Draftable entity bean.
    This property only exists on the draft table and it's value is automatically set to null when the draft
    bean is published. The property is expected to contain some comments related to the approval workflow.
  </p>

  <h2 id="query-as-draft">Query As Draft</h2>
  <p>
    A normal Query builds the object graph from the 'live' tables. You can specify the query to run
    <code>asDraft()</code> and then it will build the object graph using the draft tables. This can be
    used to <code>PREVIEW</code> the currently editing state of the object graphs. The asDraft() query
    is also used internally as part of the publish function to get the 'draft' object graph to apply any
    changes to the 'live' object graph.
  </p>
<div class="syntax java"><div class="highlight"><pre>  <span class="c1">// Get the &#39;draft&#39; object graph</span>
  <span class="n">Document</span> <span class="n">documentDraft</span> <span class="o">=</span>
      <span class="n">Ebean</span><span class="o">.</span><span class="na">find</span><span class="o">(</span><span class="n">Document</span><span class="o">.</span><span class="na">class</span><span class="o">)</span>
        <span class="o">.</span><span class="na">setId</span><span class="o">(</span><span class="n">docId</span><span class="o">)</span>
        <span class="o">.</span><span class="na">asDraft</span><span class="o">()</span>
        <span class="o">.</span><span class="na">findUnique</span><span class="o">();</span>


  <span class="c1">// Get the &#39;draft&#39; documents</span>
  <span class="n">List</span><span class="o">&lt;</span><span class="n">Document</span><span class="o">&gt;</span> <span class="n">draftDocuments</span> <span class="o">=</span>
      <span class="n">Ebean</span><span class="o">.</span><span class="na">find</span><span class="o">(</span><span class="n">Document</span><span class="o">.</span><span class="na">class</span><span class="o">)</span>
        <span class="o">.</span><span class="na">where</span><span class="o">()</span>
          <span class="o">.</span><span class="na">eq</span><span class="o">(</span><span class="s">&quot;dirty&quot;</span><span class="o">,</span> <span class="kc">true</span><span class="o">)</span>
          <span class="o">.</span><span class="na">ge</span><span class="o">(</span><span class="s">&quot;whenPublish&quot;</span><span class="o">,</span> <span class="n">now</span><span class="o">)</span>
        <span class="o">.</span><span class="na">asDraft</span><span class="o">()</span>
        <span class="o">.</span><span class="na">findList</span><span class="o">();</span>
</pre></div>
</div>
  <p>
    Note: The <code>asDraft</code> query state is propagated to any lazy loading or query joins.
  </p>
  <p>
    Note: Any <code>asDraft</code> query does not use the L2 cache.
  </p>

  <h2 id="publish">Publish</h2>
  <p>
    <code>Publish</code> is the function that takes the values from draft object graph and applies them
    to the matching live object graph. The publish function cascades from a top level @Draftable entity bean
    to any related @DraftableElement entity beans.
  </p>

  <h4>@OneToMany</h4>
  <p>
    A <code>@OneToMany</code> relationship to a @DraftableElement effectively has save and delete cascade
    turned on automatically. The cascade save/delete is used internally to publish the object graph.
  </p>

  <h4>@ManyToMany</h4>
  <p>
    A <code>@ManyToMany</code> relationship to a @Draftable bean effectively has save and delete cascade
    turned on automatically to maintain the relationship.
  </p>

<div class="syntax java"><div class="highlight"><pre>  <span class="n">EbeanServer</span> <span class="n">server</span> <span class="o">=</span> <span class="n">Ebean</span><span class="o">.</span><span class="na">getDefaultServer</span><span class="o">();</span>

  <span class="c1">// publish a single bean (from draft to live)</span>
  <span class="c1">// returning the &#39;live&#39; bean</span>
  <span class="n">Document</span> <span class="n">liveDoc</span> <span class="o">=</span> <span class="n">server</span><span class="o">.</span><span class="na">publish</span><span class="o">(</span><span class="n">Document</span><span class="o">.</span><span class="na">class</span><span class="o">,</span> <span class="n">docId</span><span class="o">);</span>


  <span class="c1">// publish using a query</span>
  <span class="n">Query</span><span class="o">&lt;</span><span class="n">Link</span><span class="o">&gt;</span> <span class="n">pubQuery</span> <span class="o">=</span> <span class="n">server</span><span class="o">.</span><span class="na">find</span><span class="o">(</span><span class="n">Link</span><span class="o">.</span><span class="na">class</span><span class="o">)</span>
    <span class="o">.</span><span class="na">where</span><span class="o">().</span><span class="na">idIn</span><span class="o">(</span><span class="n">ids</span><span class="o">)</span>
    <span class="o">.</span><span class="na">order</span><span class="o">().</span><span class="na">asc</span><span class="o">(</span><span class="s">&quot;id&quot;</span><span class="o">);</span>

  <span class="c1">// publish returning the resulting &#39;live&#39; beans</span>
  <span class="n">List</span><span class="o">&lt;</span><span class="n">Link</span><span class="o">&gt;</span> <span class="n">pubList</span> <span class="o">=</span> <span class="n">server</span><span class="o">.</span><span class="na">publish</span><span class="o">(</span><span class="n">pubQuery</span><span class="o">);</span>
</pre></div>
</div>
  <h2 id="draft-restore">Draft Restore - NOT SUPPORTED YET</h2>
  <p>
    <code>DraftRestore</code> is the function that takes the values from the live object graph and applies them
    back to the matching draft object graph. You can consider it the opposite of a publish().
  </p>

<div class="syntax java"><div class="highlight"><pre>  <span class="n">EbeanServer</span> <span class="n">server</span> <span class="o">=</span> <span class="n">Ebean</span><span class="o">.</span><span class="na">getDefaultServer</span><span class="o">();</span>

  <span class="c1">// Restore the draft values from &#39;live&#39;</span>
  <span class="n">server</span><span class="o">.</span><span class="na">draftRestore</span><span class="o">(</span><span class="n">Document</span><span class="o">.</span><span class="na">class</span><span class="o">,</span> <span class="n">docId</span><span class="o">);</span>
</pre></div>
</div>

</div>

    </div>

    <div class="col-md-3" role="complementary">
      <nav class="bs-docs-sidebar hidden-print hidden-xs hidden-sm">
        <ul class="nav bs-docs-sidenav">
<li >
  <a href="/docs/introduction">Introduction</a>
</li>
<li >
  <a href="/docs/enhancement">Enhancement</a>
</li>
<li >
  <a href="/docs/logging">Logging</a>
</li>
<li >
  <a href="/docs/serverconfig">ServerConfig</a>
</li>
<li >
  <a href="/docs/guice">Guice</a>
</li>
<li >
  <a href="/docs/spring">Spring</a>
</li>
<li >
  <a href="/docs/activerecord">Active Record</a>
</li>
<li >
  <a href="/docs/dbmigration">DB Migration</a>
</li>
<li >
  <a href="/docs/testing">Testing</a>
</li>
<li >
  <a href="/docs/query-overview">Query Overview</a>
</li>
<li >
  <a href="/docs/query-nplus1">Query N + 1</a>
</li>
<li >
  <a href="/docs/query-partialobjects">Query Partial Objects</a>
</li>
<li >
  <a href="/docs/query-autotune">Query Automatic Tuning</a>
</li>
<li >
  <a href="/docs/query-typesafe">Query Type Safety</a>
</li>
<li >
  <a href="/docs/queries">Queries</a>
</li>
<li >
  <a href="/docs/persisting">Persisting</a>
</li>
<li >
  <a href="/docs/mapping">Mapping</a>
</li>
<li >
  <a href="/docs/transactions">Transactions</a>
</li>
<li >
  <a href="/docs/json">JSON</a>
</li>
<li >
  <a href="/docs/json-in-db">JSON in DB</a>
</li>
<li >
  <a href="/docs/eventlisteners">Event listeners</a>
</li>
<li >
  <a href="/docs/readauditing">Read Auditing</a>
</li>
<li >
  <a href="/docs/changelog">Change Log</a>
</li>
<li >
  <a href="/docs/history">History</a>
</li>
<li class="active">
  <a href="/docs/draftable">Draftable</a>
<ul class="nav">
  <li><a href="#overview">Overview</a></li>
  <li><a href="#mapping">Mapping</a></li>
  <li><a href="#query-as-draft">Query As Draft</a></li>
  <li><a href="#publish">Publish</a></li>
  <li><a href="#draft-restore">Draft Restore</a></li>
</ul>
</li>
<li >
  <a href="/docs/l2caching">L2 caching</a>
</li>
<li >
  <a href="/docs/jvmlanguages">JVM Languages</a>
</li>

<li >
  <a href="/docs/clustering">Clustering</a>
</li>
<li >
  <a href="/docs/monitoring">Monitoring</a>
</li>
<li >
  <a href="/docs/architecture/persistence-context">Architecture</a>
</li>
        </ul>
      </nav>
    </div>
  </div>

</div>
<!-- /.row -->
</div>  <!-- /.container -->
  </div>
</div>

<footer id="footer">
 <div class="doc-footer">
  <ul class="doc-footer-links">
    <li><a href="/">Ebean ORM</a></li>
    <li> | </li>
    <li><a href="http://avaje-metric.github.io">Metrics</a></li>
    <li> | </li>
    <li><a href="/websitegenerator/index">Website Generator</a></li>
    <li> | </li>
    <li><a href="/jetty/index">Jetty Runnable War</a></li>
  </ul>
 </div>
</footer>

  <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.2/jquery.min.js"></script>
  <script src="/js/bootstrap.min.js"></script>
  <script src="/js/jquery.easing.min.js"></script>

  <script src="/js/json2.js"></script>
  <script src="/js/jquery.cookie.min.js"></script>
  <script src="/js/jquery.storageapi.min.js"></script>

  <script src="/js/ebean-site.js"></script>

  </body>
</html>
