
<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta id="layout-head" />
    <title>Ebean ORM - Java/Kotlin/JVM</title>
    <link rel="shortcut icon" href="/images/favicon.ico" >
    <!--<link href="/css/bootstrap.min.css" rel="stylesheet">-->
    <!-- Latest compiled and minified CSS -->
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.5/css/bootstrap.min.css">
    <link rel="stylesheet" href="/css/pygments.css" type="text/css" />
    <link rel="stylesheet" href="/css/site.css">
    <link rel="stylesheet" href="//netdna.bootstrapcdn.com/font-awesome/4.1.0/css/font-awesome.min.css">
      <!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
      <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
      <script src="https://oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>
    <![endif]-->
</head>
  <body>
  <div id="wrap">
    <div id="header">
    <div class="navbar navbar-inverse navbar-fixed-top" role="navigation">
      <div class="container">
        <div class="navbar-header">
          <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
            <span class="sr-only">Toggle navigation</span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
          </button>
          <a class="navbar-brand" href="/">Ebean ORM</a>
        </div>
        <div class="collapse navbar-collapse">
          <ul class="nav navbar-nav pull-right">
            <li ><a href="/"><span class="glyphicon glyphicon-home"></span>  Home</a></li>
            <li ><a href="/videos">Videos</a></li>
            <li ><a href="/quickstart">Quick Start</a></li>
            <li ><a href="/support">Support</a></li>
            <li class="active"><a href="/docs">Docs</a></li>
            <li ><a target="_blank" href="/apidocs">ApiDocs</a></li>
            <li ><a href="/releases">Releases</a></li>
            <li ><a target="_blank" href="https://github.com/ebean-orm/avaje-ebeanorm"> <i class="fa fa-github"></i> Github</a></li>
          </ul>
        </div><!--/.nav-collapse -->
      </div>
    </div>

  </div>
  <div id="main" data-offset="60">
<div class="jumbotron mini">
  <div class="container">
    <h1><a href="/docs">Documentation</a> / JSON in DB </h1>
  </div>
</div>

<div class="container doc-index bs-docs-container">

  <div class="row">

    <div class="col-md-9" role="main">

      <div class="bs-docs-section">

  <h2 id="overview">Overview</h2>
  <p>
    Postgres and Oracle have extensive support with JSON stored in the database. Both provide a lot of support
    for writing queries using document path expressions.
  </p>
  <p>
    Ebean provides mapping support via <code>@DbJson</code> and <code>@DbJsonB</code> to map JSON documents to
    various database types including Postgres JSON, JSONB types as well as standard Varchar, Clob and Blob types.
    The mapping can be used with all supported databases and Postgres and Oracle provide support for including
    JSON expressions in query where clauses.
  </p>
  <p>
    Both Postgres and Oracle support writing queries with JSON expressions and Ebean exposes the most common
    query expressions.:
  </p>

  <h2 id="mapping">Mapping</h2>
  <p>
    For all databases JSON documents can be mapped on entity beans and saved and loaded from the database.
  </p>

  <h3>@DbJsonB</h3>
  <p>
    In your entity bean you can annotate a property with <code>@DbJsonB</code> and that indicates that the property
    maps to a JSONB database type.  For non-Postgres databases this maps to a database Clob.
  </p>
  <div class="syntax java"><div class="highlight"><pre><span class="nd">@Entity</span>
<span class="nd">@Table</span><span class="o">(</span><span class="n">name</span><span class="o">=</span><span class="s">&quot;p_doc&quot;</span><span class="o">)</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">SimpleDoc</span> <span class="kd">extends</span> <span class="n">Model</span> <span class="o">{</span>

  <span class="nd">@Id</span>
  <span class="n">Long</span> <span class="n">id</span><span class="o">;</span>
  <span class="o">...</span>

  <span class="nd">@DbJsonB</span>
  <span class="n">Map</span><span class="o">&lt;</span><span class="n">String</span><span class="o">,</span><span class="n">Object</span><span class="o">&gt;</span> <span class="n">content</span><span class="o">;</span>
  
</pre></div>
</div>

  <h3>@DbJson</h3>
  <p>
    In your entity bean you can annotate a property with <code>@DbJson</code> and that indicates that the property
    maps to a JSON database type.  For non-Postgres databases this maps to a database Clob.
  </p>
  <div class="syntax java"><div class="highlight"><pre><span class="nd">@Entity</span>
<span class="nd">@Table</span><span class="o">(</span><span class="n">name</span><span class="o">=</span><span class="s">&quot;p_doc&quot;</span><span class="o">)</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">SimpleDoc</span> <span class="kd">extends</span> <span class="n">Model</span> <span class="o">{</span>

  <span class="nd">@Id</span>
  <span class="n">Long</span> <span class="n">id</span><span class="o">;</span>
  <span class="o">...</span>

  <span class="nd">@DbJson</span>
  <span class="n">Map</span><span class="o">&lt;</span><span class="n">String</span><span class="o">,</span><span class="n">Object</span><span class="o">&gt;</span> <span class="n">content</span><span class="o">;</span>
  
</pre></div>
</div>


  <h2 id="save-find">Save and Find</h2>
  <p>
    You put JSON content into the content property and save it and fetch is as normal.
  </p>
<div class="syntax java"><div class="highlight"><pre>  <span class="n">String</span> <span class="n">rawJson</span> <span class="o">=</span> <span class="s">&quot;{\&quot;docName\&quot;:\&quot;My document\&quot;, \&quot;docScore\&quot;:234, \&quot;title\&quot;:\&quot;Some title\&quot;}&quot;</span><span class="o">;</span>

  <span class="c1">// get the JSON into a map using Jackson or similar tool.</span>
  <span class="c1">// Ebean has EJson which using Jackson core which can be used</span>
  <span class="c1">// to parse JSON content</span>
  <span class="n">Map</span><span class="o">&lt;</span><span class="n">String</span><span class="o">,</span> <span class="n">Object</span><span class="o">&gt;</span> <span class="n">content</span> <span class="o">=</span> <span class="n">EJson</span><span class="o">.</span><span class="na">parseObject</span><span class="o">(</span><span class="n">rawJson</span><span class="o">);</span>

  <span class="n">SimpleDoc</span> <span class="n">doc</span> <span class="o">=</span> <span class="k">new</span> <span class="n">SimpleDoc</span><span class="o">();</span>
  <span class="n">doc</span><span class="o">.</span><span class="na">setName</span><span class="o">(</span><span class="s">&quot;doc1&quot;</span><span class="o">);</span>
  <span class="n">doc</span><span class="o">.</span><span class="na">setContent</span><span class="o">(</span><span class="n">content</span><span class="o">);</span>

  <span class="c1">// save to db</span>
  <span class="n">doc</span><span class="o">.</span><span class="na">save</span><span class="o">();</span>

  <span class="c1">// fetch from db</span>
  <span class="n">SimpleDoc</span> <span class="n">doc1</span> <span class="o">=</span> <span class="n">SimpleDoc</span><span class="o">.</span><span class="na">find</span><span class="o">.</span><span class="na">byId</span><span class="o">(</span><span class="n">doc</span><span class="o">.</span><span class="na">getId</span><span class="o">());</span>

  <span class="n">assertEquals</span><span class="o">(</span><span class="s">&quot;My document&quot;</span><span class="o">,</span> <span class="n">doc1</span><span class="o">.</span><span class="na">getContent</span><span class="o">().</span><span class="na">get</span><span class="o">(</span><span class="s">&quot;docName&quot;</span><span class="o">));</span>
</pre></div>
</div>

  <h2>Query expressions</h2>
  <p>
    <code>Postgres</code> and <code>Oracle</code> provide expressions such that you can use a <code>path</code>
    expression to test is a given path <code>EXISTS</code> or test the value at a path.
  </p>
  <p>
    Ebean <code>ExpressionList</code> has expressions for:
  </p>
<div class="syntax java"><div class="highlight"><pre><span class="cm">/**</span>
<span class="cm"> * Path exists - for the given path in a JSON document.</span>
<span class="cm"> */</span>
<span class="n">ExpressionList</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span> <span class="n">jsonExists</span><span class="o">(</span><span class="n">String</span> <span class="n">propertyName</span><span class="o">,</span> <span class="n">String</span> <span class="n">path</span><span class="o">);</span>

<span class="cm">/**</span>
<span class="cm"> * Path does not exist - for the given path in a JSON document.</span>
<span class="cm"> */</span>
<span class="n">ExpressionList</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span> <span class="n">jsonNotExists</span><span class="o">(</span><span class="n">String</span> <span class="n">propertyName</span><span class="o">,</span> <span class="n">String</span> <span class="n">path</span><span class="o">);</span>

<span class="cm">/**</span>
<span class="cm"> * Equal to expression for the value at the given path in the JSON document.</span>
<span class="cm"> */</span>
<span class="n">ExpressionList</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span> <span class="n">jsonEqualTo</span><span class="o">(</span><span class="n">String</span> <span class="n">propertyName</span><span class="o">,</span> <span class="n">String</span> <span class="n">path</span><span class="o">,</span> <span class="n">Object</span> <span class="n">value</span><span class="o">);</span>

<span class="cm">/**</span>
<span class="cm"> * Not Equal to - for the given path in a JSON document.</span>
<span class="cm"> */</span>
<span class="n">ExpressionList</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span> <span class="n">jsonNotEqualTo</span><span class="o">(</span><span class="n">String</span> <span class="n">propertyName</span><span class="o">,</span> <span class="n">String</span> <span class="n">path</span><span class="o">,</span> <span class="n">Object</span> <span class="n">val</span><span class="o">);</span>

<span class="cm">/**</span>
<span class="cm"> * Greater than - for the given path in a JSON document.</span>
<span class="cm"> */</span>
<span class="n">ExpressionList</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span> <span class="n">jsonGreaterThan</span><span class="o">(</span><span class="n">String</span> <span class="n">propertyName</span><span class="o">,</span> <span class="n">String</span> <span class="n">path</span><span class="o">,</span> <span class="n">Object</span> <span class="n">val</span><span class="o">);</span>

<span class="cm">/**</span>
<span class="cm"> * Greater than or equal to - for the given path in a JSON document.</span>
<span class="cm"> */</span>
<span class="n">ExpressionList</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span> <span class="n">jsonGreaterOrEqual</span><span class="o">(</span><span class="n">String</span> <span class="n">propertyName</span><span class="o">,</span> <span class="n">String</span> <span class="n">path</span><span class="o">,</span> <span class="n">Object</span> <span class="n">val</span><span class="o">);</span>

<span class="cm">/**</span>
<span class="cm"> * Less than - for the given path in a JSON document.</span>
<span class="cm"> */</span>
<span class="n">ExpressionList</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span> <span class="n">jsonLessThan</span><span class="o">(</span><span class="n">String</span> <span class="n">propertyName</span><span class="o">,</span> <span class="n">String</span> <span class="n">path</span><span class="o">,</span> <span class="n">Object</span> <span class="n">val</span><span class="o">);</span>

<span class="cm">/**</span>
<span class="cm"> * Less than or equal to - for the given path in a JSON document.</span>
<span class="cm"> */</span>
<span class="n">ExpressionList</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span> <span class="n">jsonLessOrEqualTo</span><span class="o">(</span><span class="n">String</span> <span class="n">propertyName</span><span class="o">,</span> <span class="n">String</span> <span class="n">path</span><span class="o">,</span> <span class="n">Object</span> <span class="n">val</span><span class="o">);</span>
</pre></div>
</div>


  <h2>Postgres expressions</h2>
  <p>
    Ebean uses Postgres <code>->></code> and <code>#>></code> operators to support the JSON expressions.
  </p>

  <h3>Exists expression</h3>
  <p>
    For Postgres Ebean's <code>jsonExists()</code> <code>jsonNotExists()</code> expression result in the
    path value using <code>->></code> or <code>#>></code> and  <code>IS NULL</code>  and <code>IS NOT NULL</code>.
  </p>
  <div class="syntax java"><div class="highlight"><pre>  <span class="n">List</span><span class="o">&lt;</span><span class="n">SimpleDoc</span><span class="o">&gt;</span> <span class="n">list</span> <span class="o">=</span> <span class="k">new</span> <span class="n">QSimpleDoc</span><span class="o">().</span><span class="na">query</span><span class="o">()</span>
  <span class="o">.</span><span class="na">where</span><span class="o">()</span>
  <span class="o">.</span><span class="na">jsonExists</span><span class="o">(</span><span class="s">&quot;content&quot;</span><span class="o">,</span> <span class="s">&quot;path.other&quot;</span><span class="o">)</span>
  <span class="o">.</span><span class="na">findList</span><span class="o">();</span>
  
</pre></div>
</div>
  <p>
    The function can then be used in an Ebean query like:
  </p>

  <div class="syntax sql"><div class="highlight"><pre>  <span class="k">select</span> <span class="n">t0</span><span class="p">.</span><span class="n">id</span> <span class="n">c0</span><span class="p">,</span> <span class="p">...</span>
  <span class="k">where</span> <span class="p">(</span><span class="n">t0</span><span class="p">.</span><span class="n">content</span> <span class="o">#&gt;&gt;</span> <span class="s1">&#39;{path,other}&#39;</span><span class="p">)</span> <span class="k">is</span> <span class="k">not</span> <span class="k">null</span>
  
</pre></div>
</div>
  <h3>Value expressions</h3>
  <p>
    For Postgres Ebean's value expressions such as <code>jsonEqualTo()</code>, <code>jsonGreaterThan()</code> etc use
    the <code>->></code> or <code>#>></code> operator depending on the path and then cast the result depending on the
    value testing against. That is, if the value tested is a Integer or Long the DB path expression is cast to
    <code>::INTEGER</code> and there is similar casting for <code>::DECIMAL</code> and <code>::BOOLEAN</code>.
  </p>
<div class="syntax java"><div class="highlight"><pre><span class="n">List</span><span class="o">&lt;</span><span class="n">SimpleDoc</span><span class="o">&gt;</span> <span class="n">list</span> <span class="o">=</span> <span class="k">new</span> <span class="n">QSimpleDoc</span><span class="o">().</span><span class="na">query</span><span class="o">()</span>
  <span class="o">.</span><span class="na">where</span><span class="o">()</span>
  <span class="o">.</span><span class="na">jsonEqualTo</span><span class="o">(</span><span class="s">&quot;content&quot;</span><span class="o">,</span> <span class="s">&quot;path.other&quot;</span><span class="o">,</span> <span class="mi">34</span><span class="o">)</span>
  <span class="o">.</span><span class="na">findList</span><span class="o">();</span>
  
</pre></div>
</div>
<div class="syntax sql"><div class="highlight"><pre><span class="k">select</span> <span class="n">t0</span><span class="p">.</span><span class="n">id</span> <span class="n">c0</span><span class="p">,</span> <span class="p">...</span>
<span class="k">where</span> <span class="p">(</span><span class="n">t0</span><span class="p">.</span><span class="n">content</span> <span class="o">#&gt;&gt;</span> <span class="s1">&#39;{path,other}&#39;</span><span class="p">)::</span><span class="nb">INTEGER</span> <span class="o">=</span> <span class="o">?</span>
</pre></div>
</div>


  <h2>Oracle expressions</h2>
  <p>
    Ebean uses Oracles <code>json_exists</code> and <code>json_value</code> functions to support Ebean's JSON
    expressions.
  </p>

  <h3>Exists expression</h3>
  <p>
    For Oracle Ebean's jsonExists() expression uses the Oracle <code>json_exists</code> function.
  </p>
  <div class="syntax java"><div class="highlight"><pre>  <span class="n">List</span><span class="o">&lt;</span><span class="n">SimpleDoc</span><span class="o">&gt;</span> <span class="n">list</span> <span class="o">=</span> <span class="k">new</span> <span class="n">QSimpleDoc</span><span class="o">().</span><span class="na">query</span><span class="o">()</span>
    <span class="o">.</span><span class="na">where</span><span class="o">()</span>
    <span class="o">.</span><span class="na">jsonExists</span><span class="o">(</span><span class="s">&quot;content&quot;</span><span class="o">,</span> <span class="s">&quot;path.other&quot;</span><span class="o">)</span>
    <span class="o">.</span><span class="na">findList</span><span class="o">();</span>
    
</pre></div>
</div>
  <p>
    The function can then be used in an Ebean query like:
  </p>

<div class="syntax sql"><div class="highlight"><pre>  <span class="k">select</span> <span class="n">t0</span><span class="p">.</span><span class="n">id</span> <span class="n">c0</span><span class="p">,</span> <span class="p">...</span>
  <span class="k">where</span> <span class="n">json_exists</span><span class="p">(</span><span class="n">t0</span><span class="p">.</span><span class="n">content</span><span class="p">,</span> <span class="s1">&#39;$.path.other&#39;</span><span class="p">)</span>
</pre></div>
</div>
  <h3>Value expressions</h3>
  <p>
    For Oracle Ebean's value's jsonEqualTo() jsonGreaterThan() etc use the Oracle <code>json_value</code> function.
  </p>
<div class="syntax java"><div class="highlight"><pre><span class="n">List</span><span class="o">&lt;</span><span class="n">SimpleDoc</span><span class="o">&gt;</span> <span class="n">list</span> <span class="o">=</span> <span class="k">new</span> <span class="n">QSimpleDoc</span><span class="o">().</span><span class="na">query</span><span class="o">()</span>
  <span class="o">.</span><span class="na">where</span><span class="o">()</span>
  <span class="o">.</span><span class="na">jsonEqualTo</span><span class="o">(</span><span class="s">&quot;content&quot;</span><span class="o">,</span> <span class="s">&quot;path.other&quot;</span><span class="o">,</span> <span class="mi">34</span><span class="o">)</span>
  <span class="o">.</span><span class="na">findList</span><span class="o">();</span>
  
</pre></div>
</div>
<div class="syntax sql"><div class="highlight"><pre><span class="k">select</span> <span class="n">t0</span><span class="p">.</span><span class="n">id</span> <span class="n">c0</span><span class="p">,</span> <span class="p">...</span>
<span class="k">where</span> <span class="n">json_value</span><span class="p">(</span><span class="n">t0</span><span class="p">.</span><span class="n">content</span><span class="p">,</span> <span class="s1">&#39;$.path.other&#39;</span><span class="p">)</span> <span class="o">=</span> <span class="o">?</span>
</pre></div>
</div>

 <h2 id="raw">Raw expression</h2>
 <p>
   If the provided expressions do not match what is required you can use <code>raw()</code> expressions.
 </p>
<div class="syntax java"><div class="highlight"><pre><span class="n">List</span><span class="o">&lt;</span><span class="n">SimpleDoc</span><span class="o">&gt;</span> <span class="n">docs</span> <span class="o">=</span> <span class="n">SimpleDoc</span><span class="o">.</span><span class="na">find</span><span class="o">.</span><span class="na">where</span><span class="o">()</span>
  <span class="c1">// pass a raw expression through - property names are translated to</span>
  <span class="c1">// db columns but everything else is passed through to the DB</span>
  <span class="o">.</span><span class="na">raw</span><span class="o">(</span><span class="s">&quot;content#&gt;&#39;{docName}&#39; ? &#39;rob doc&#39;&quot;</span><span class="o">)</span>
  <span class="o">.</span><span class="na">findList</span><span class="o">();</span>
</pre></div>
</div>
</div>

    </div>

    <div class="col-md-3" role="complementary">
      <nav class="bs-docs-sidebar hidden-print hidden-xs hidden-sm">
        <ul class="nav bs-docs-sidenav">
<li >
  <a href="/docs/introduction">Introduction</a>
</li>
<li >
  <a href="/docs/enhancement">Enhancement</a>
</li>
<li >
  <a href="/docs/logging">Logging</a>
</li>
<li >
  <a href="/docs/serverconfig">ServerConfig</a>
</li>
<li >
  <a href="/docs/guice">Guice</a>
</li>
<li >
  <a href="/docs/spring">Spring</a>
</li>
<li >
  <a href="/docs/activerecord">Active Record</a>
</li>
<li >
  <a href="/docs/dbmigration">DB Migration</a>
</li>
<li >
  <a href="/docs/testing">Testing</a>
</li>
<li >
  <a href="/docs/query-overview">Query Overview</a>
</li>
<li >
  <a href="/docs/query-nplus1">Query N + 1</a>
</li>
<li >
  <a href="/docs/query-partialobjects">Query Partial Objects</a>
</li>
<li >
  <a href="/docs/query-autotune">Query Automatic Tuning</a>
</li>
<li >
  <a href="/docs/query-typesafe">Query Type Safety</a>
</li>
<li >
  <a href="/docs/queries">Queries</a>
</li>
<li >
  <a href="/docs/persisting">Persisting</a>
</li>
<li >
  <a href="/docs/mapping">Mapping</a>
</li>
<li >
  <a href="/docs/transactions">Transactions</a>
</li>
<li >
  <a href="/docs/json">JSON</a>
</li>
<li class="active">
  <a href="/docs/json-in-db">JSON in DB</a>
<ul class="nav">
  <li><a href="#overview">Overview</a></li>
  <li><a href="#mapping">Mapping</a></li>
  <li><a href="#save-find">Save and Find</a></li>
  <li><a href="#query">Query expressions</a></li>
  <li><a href="#postgres">Postgres</a></li>
  <li><a href="#oracle">Oracle</a></li>
  <li><a href="#oracle">Raw expression</a></li>
</ul>
</li>
<li >
  <a href="/docs/eventlisteners">Event listeners</a>
</li>
<li >
  <a href="/docs/readauditing">Read Auditing</a>
</li>
<li >
  <a href="/docs/changelog">Change Log</a>
</li>
<li >
  <a href="/docs/history">History</a>
</li>
<li >
  <a href="/docs/l2caching">L2 caching</a>
</li>
<li >
  <a href="/docs/jvmlanguages">JVM Languages</a>
</li>

<li >
  <a href="/docs/clustering">Clustering</a>
</li>
<li >
  <a href="/docs/monitoring">Monitoring</a>
</li>
<li >
  <a href="/docs/architecture/persistence-context">Architecture</a>
</li>
        </ul>
      </nav>
    </div>
  </div>

</div>
<!-- /.row -->
</div>  <!-- /.container -->
  </div>
</div>

<footer id="footer">
 <div class="doc-footer">
  <ul class="doc-footer-links">
    <li><a href="/">Ebean ORM</a></li>
    <li> | </li>
    <li><a href="http://avaje-metric.github.io">Metrics</a></li>
    <li> | </li>
    <li><a href="/websitegenerator/index">Website Generator</a></li>
    <li> | </li>
    <li><a href="/jetty/index">Jetty Runnable War</a></li>
  </ul>
 </div>
</footer>

  <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.2/jquery.min.js"></script>
  <script src="/js/bootstrap.min.js"></script>
  <script src="/js/jquery.easing.min.js"></script>

  <script src="/js/json2.js"></script>
  <script src="/js/jquery.cookie.min.js"></script>
  <script src="/js/jquery.storageapi.min.js"></script>

  <script src="/js/ebean-site.js"></script>

  </body>
</html>
