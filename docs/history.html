
<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta id="layout-head" />
    <title>avaje ebean</title>
    <link rel="shortcut icon" href="/images/favicon.ico" >
    <!--<link href="/css/bootstrap.min.css" rel="stylesheet">-->
    <!-- Latest compiled and minified CSS -->
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.5/css/bootstrap.min.css">
    <link rel="stylesheet" href="/css/pygments.css" type="text/css" />
    <link rel="stylesheet" href="/css/site.css">
    <link rel="stylesheet" href="//netdna.bootstrapcdn.com/font-awesome/4.1.0/css/font-awesome.min.css">
      <!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
      <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
      <script src="https://oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>
    <![endif]-->
</head>
  <body>
  <div id="wrap">
    <div id="header">
    <div class="navbar navbar-inverse navbar-fixed-top" role="navigation">
      <div class="container">
        <div class="navbar-header">
          <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
            <span class="sr-only">Toggle navigation</span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
          </button>
          <a class="navbar-brand" href="/">Ebean ORM</a>
        </div>
        <div class="collapse navbar-collapse">
          <ul class="nav navbar-nav pull-right">
            <li ><a href="/"><span class="glyphicon glyphicon-home"></span>  Home</a></li>
            <li ><a href="/videos">Videos</a></li>
            <li ><a href="/quickstart">Quick Start</a></li>
            <li ><a href="/support">Support</a></li>
            <li class="active"><a href="/docs">Docs</a></li>
            <li ><a target="_blank" href="/apidocs">ApiDocs</a></li>
            <li ><a href="/releases">Releases</a></li>
            <li ><a target="_blank" href="https://github.com/ebean-orm/avaje-ebeanorm"> <i class="fa fa-github"></i> Github</a></li>
          </ul>
        </div><!--/.nav-collapse -->
      </div>
    </div>

  </div>
  <div id="main" data-offset="60">
<div class="jumbotron mini">
  <div class="container">
    <h1><a href="/docs">Documentation</a> / History </h1>
  </div>
</div>

<div class="container doc-index bs-docs-container">

  <div class="row">

    <div class="col-md-9" role="main">

      <div class="bs-docs-section">
  <h2 id="overview">Overview</h2>
  <p>
    <a href="https://en.wikipedia.org/wiki/SQL:2011">SQL2011</a> introduced temporal extensions to SQL
    including <code>AS OF SYSTEM TIME</code> and <code>VERSIONS BETWEEN SYSTEM TIME</code>.
  </p>
  <p>
    Ebean has support for this extension to SQL. The support for this falls into 2 general cases where some
    databases have SQL2011 support built in (Oracle, DB2, MS SQL Server 2016) or where it is not built
    in (Postgres, MySql) and Ebean generates history tables/triggers/views to support the feature.
  </p>

  <h4>Current support in Ebean</h4>
  <ul>
    <li>Oracle via Total recall</li>
    <li>Postgres via Triggers/history table</li>
    <li>MySql via Triggers/history table</li>
  </ul>

  <h2 id="history">@History</h2>
  <p>
    Add the <code>@History</code> annotation to the entity beans that you want history support on. In the
    case of Postgres and MySql this means that Ebean will generate DDL (triggers, views etc) to support
    history on the underlying tables. For Oracle adding @History implies that the table has had flashback
    archive already assigned to the table.
  </p>

  <h2 id="as-of-query">As of query</h2>
  <p>
    A Timestamp can be used with <code>Query.asOf(Timestamp)</code> and Ebean will generate the query
    such that the returning object graph represents the state as of the given timestamp. More accurately
    for tables with history the query returns rows representing the table as of the given timestamp and for
    other tables included in the query the rows returned represent 'current values'.
  </p>

  <div class="syntax java"><div class="highlight"><pre>  <span class="c1">// asOf some time in the past like 1 hour ago, 1 week ago, 1 month ago etc</span>
  <span class="n">Timestamp</span> <span class="n">asOf</span> <span class="o">=</span> <span class="o">...;</span>

  <span class="n">Customer</span> <span class="n">customer</span> <span class="o">=</span>
      <span class="n">Customer</span><span class="o">.</span><span class="na">find</span><span class="o">.</span><span class="na">query</span><span class="o">()</span>
          <span class="o">.</span><span class="na">asOf</span><span class="o">(</span><span class="n">asOf</span><span class="o">)</span>
          <span class="o">.</span><span class="na">fetch</span><span class="o">(</span><span class="s">&quot;billingAddress&quot;</span><span class="o">)</span>
          <span class="o">.</span><span class="na">where</span><span class="o">().</span><span class="na">eq</span><span class="o">(</span><span class="s">&quot;name&quot;</span><span class="o">,</span> <span class="s">&quot;jim&quot;</span><span class="o">)</span>
          <span class="o">.</span><span class="na">findUnique</span><span class="o">();</span>

  
</pre></div>
</div>

  <h3>Lazy loading</h3>
  <p>
    The <code>AS OF</code> timestamp is propagated to all secondary queries including lazy loading queries.
    That is, the <code>AS OF</code> timestamp applies to the entire object graph loaded by and not just the
    "origin query".
  </p>


  <h2 id="versions-between-query">Versions between query</h2>
  <p>
    <code>Query.findVersionsBetween()</code> is used to return a list of versions for a given object
    over time. The version beans returned contain a "diff" to the prior version as well as the
    effective start and effective end timestamps.
  </p>

  <div class="syntax java"><div class="highlight"><pre>  <span class="n">Timestamp</span> <span class="n">start</span> <span class="o">=</span> <span class="o">...;</span>
  <span class="n">Timestamp</span> <span class="n">end</span> <span class="o">=</span> <span class="o">...;</span>

  <span class="n">List</span><span class="o">&lt;</span><span class="n">Version</span><span class="o">&lt;</span><span class="n">Customer</span><span class="o">&gt;&gt;</span> <span class="n">customerVersions</span> <span class="o">=</span>
      <span class="n">Customer</span><span class="o">.</span><span class="na">find</span><span class="o">.</span><span class="na">query</span><span class="o">()</span>
        <span class="o">.</span><span class="na">where</span><span class="o">()</span>
        <span class="o">.</span><span class="na">idEq</span><span class="o">(</span><span class="mi">42</span><span class="o">)</span>
        <span class="o">.</span><span class="na">findVersionsBetween</span><span class="o">(</span><span class="n">start</span><span class="o">,</span> <span class="n">end</span><span class="o">);</span>

  <span class="k">for</span> <span class="o">(</span><span class="n">Version</span><span class="o">&lt;</span><span class="n">Customer</span><span class="o">&gt;</span> <span class="n">customerVersion</span> <span class="o">:</span> <span class="n">customerVersions</span><span class="o">)</span> <span class="o">{</span>
    <span class="n">Customer</span> <span class="n">bean</span> <span class="o">=</span> <span class="n">customerVersion</span><span class="o">.</span><span class="na">getBean</span><span class="o">();</span>
    <span class="n">Map</span><span class="o">&lt;</span><span class="n">String</span><span class="o">,</span> <span class="n">ValuePair</span><span class="o">&gt;</span> <span class="n">diff</span> <span class="o">=</span> <span class="n">customerVersion</span><span class="o">.</span><span class="na">getDiff</span><span class="o">();</span>
    <span class="n">Timestamp</span> <span class="n">effectiveStart</span> <span class="o">=</span> <span class="n">customerVersion</span><span class="o">.</span><span class="na">getStart</span><span class="o">();</span>
    <span class="n">Timestamp</span> <span class="n">effectiveEnd</span> <span class="o">=</span> <span class="n">customerVersion</span><span class="o">.</span><span class="na">getEnd</span><span class="o">();</span>
  <span class="o">}</span>

  
</pre></div>
</div>


  <h2 id="postgres">Postgres</h2>
  <p>

  </p>

  <h2 id="mysql">MySql</h2>
  <p>

  </p>


  <h2 id="oracle">Oracle</h2>
  <p>
    Robs View: Oracle Total recall has some nice advantages over the explicit trigger/history table approach.
    The main ones being:
  </p>
    <ul>
      <li><b>Performance : low foreground impact</b> - History table population occurs in the background and results in a much lower overhead/impact
        on foreground response time</li>
      <li><b>Performance : batch processing</b> - History table population can be processed in batch reducing the overhead/impact for many small updates</li>
      <li><b>Admin : reduced DDL</b> - Table alterations (add columns etc) are handled automatically reducing the admin costs of maintaining
       triggers/views/history tables.
      </li>

    </ul>


</div>

    </div>

    <div class="col-md-3" role="complementary">
      <nav class="bs-docs-sidebar hidden-print hidden-xs hidden-sm">
        <ul class="nav bs-docs-sidenav">
<li >
  <a href="/docs/introduction">Introduction</a>
</li>
<li >
  <a href="/docs/enhancement">Enhancement</a>
</li>
<li >
  <a href="/docs/serverconfig">ServerConfig</a>
</li>
<li >
  <a href="/docs/guice">Guice</a>
</li>
<li >
  <a href="/docs/spring">Spring</a>
</li>
<li >
  <a href="/docs/activerecord">Active Record</a>
</li>
<li >
  <a href="/docs/testing">Testing</a>
</li>
<li >
  <a href="/docs/queries">Queries</a>
</li>
<li >
  <a href="/docs/saving">Saving</a>
</li>
<li >
  <a href="/docs/mapping">Mapping</a>
</li>
<li >
  <a href="/docs/transactions">Transactions</a>
</li>
<li >
  <a href="/docs/json">JSON</a>
</li>
<li >
  <a href="/docs/eventlisteners">Event listeners</a>
</li>
<li >
  <a href="/docs/readaudit">Read Audit</a>
</li>
<li >
  <a href="/docs/changelog">Change Log</a>
</li>
<li class="active">
  <a href="/docs/history">History</a>
<ul class="nav">
  <li><a href="#overview">Overview</a></li>
  <li><a href="#history">@History</a></li>
  <li><a href="#as-of-query">As of query</a></li>
  <li><a href="#versions-between-query">Versions between query</a></li>
  <li><a href="#postgres">Postgres</a></li>
  <li><a href="#mysql">MySql</a></li>
  <li><a href="#oracle">Oracle</a></li>
</ul>
</li>
<li >
  <a href="/docs/l2caching">L2 caching</a>
</li>
<li >
  <a href="/docs/jvmlanguages">JVM Languages</a>
</li>

<li >
  <a href="/docs/clustering">Clustering</a>
</li>
<li >
  <a href="/docs/monitoring">Monitoring</a>
</li>
<li >
  <a href="/docs/architecture">Architecture</a>
</li>
        </ul>
      </nav>
    </div>
  </div>

</div>
<!-- /.row -->
</div>  <!-- /.container -->
  </div>
</div>

<footer id="footer">
 <div class="doc-footer">
  <ul class="doc-footer-links">
    <li><a href="/">Ebean ORM</a></li>
    <li> | </li>
    <li><a href="http://avaje-metric.github.io">Metrics</a></li>
    <li> | </li>
    <li><a href="/websitegenerator/index">Website Generator</a></li>
    <li> | </li>
    <li><a href="/jetty/index">Jetty Runnable War</a></li>
  </ul>
 </div>
</footer>

  <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.2/jquery.min.js"></script>
  <script src="/js/bootstrap.min.js"></script>
  <script src="/js/jquery.easing.min.js"></script>

  <script src="/js/json2.js"></script>
  <script src="/js/jquery.cookie.min.js"></script>
  <script src="/js/jquery.storageapi.min.js"></script>

  <script src="/js/ebean-site.js"></script>

  </body>
</html>
